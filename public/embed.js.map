{
  "version": 3,
  "sources": ["../node_modules/@curia_/iframe-api-proxy/src/types/ApiTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/types/MessageTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/types/ProxyTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/client/ApiProxyClient.ts", "../node_modules/@curia_/iframe-api-proxy/src/server/ApiProxyServer.ts", "../node_modules/@curia_/iframe-api-proxy/src/index.ts", "../node_modules/qrcode/lib/can-promise.js", "../node_modules/qrcode/lib/core/utils.js", "../node_modules/qrcode/lib/core/error-correction-level.js", "../node_modules/qrcode/lib/core/bit-buffer.js", "../node_modules/qrcode/lib/core/bit-matrix.js", "../node_modules/qrcode/lib/core/alignment-pattern.js", "../node_modules/qrcode/lib/core/finder-pattern.js", "../node_modules/qrcode/lib/core/mask-pattern.js", "../node_modules/qrcode/lib/core/error-correction-code.js", "../node_modules/qrcode/lib/core/galois-field.js", "../node_modules/qrcode/lib/core/polynomial.js", "../node_modules/qrcode/lib/core/reed-solomon-encoder.js", "../node_modules/qrcode/lib/core/version-check.js", "../node_modules/qrcode/lib/core/regex.js", "../node_modules/qrcode/lib/core/mode.js", "../node_modules/qrcode/lib/core/version.js", "../node_modules/qrcode/lib/core/format-info.js", "../node_modules/qrcode/lib/core/numeric-data.js", "../node_modules/qrcode/lib/core/alphanumeric-data.js", "../node_modules/qrcode/lib/core/byte-data.js", "../node_modules/qrcode/lib/core/kanji-data.js", "../node_modules/dijkstrajs/dijkstra.js", "../node_modules/qrcode/lib/core/segments.js", "../node_modules/qrcode/lib/core/qrcode.js", "../node_modules/qrcode/lib/renderer/utils.js", "../node_modules/qrcode/lib/renderer/canvas.js", "../node_modules/qrcode/lib/renderer/svg-tag.js", "../node_modules/qrcode/lib/browser.js", "../src/lib/embed/core/EmbedConfig.ts", "../src/lib/embed/plugin-host/InternalPluginHost.ts", "../src/lib/SessionManager.ts", "../src/lib/embed/services/SessionServiceProxy.ts", "../src/lib/embed/styling/utils/gradients.ts", "../src/lib/embed/styling/utils/icons.ts", "../src/lib/embed/styling/reset.css", "../src/lib/embed/styling/styles.css", "../src/lib/embed/styling/sidebar.css", "../src/lib/embed/styling/preview.css", "../src/lib/embed/styling/profile-menu.css", "../src/lib/embed/styling/qr-dialog.css", "../src/lib/embed/styling/mobile.css", "../src/lib/embed/styling/themes/light.css", "../src/lib/embed/styling/themes/dark.css", "../src/lib/embed/styling/index.ts", "../src/lib/embed/components/sidebar/CommunityItem.ts", "../src/lib/embed/components/sidebar/CommunityPreview.ts", "../src/lib/embed/components/qr/QRCodeGenerator.ts", "../src/lib/embed/components/qr/QRCodeDialog.ts", "../src/lib/embed/components/profile/UserProfile.ts", "../src/lib/embed/components/mobile/MobileBottomNav.ts", "../src/lib/embed/components/mobile/MobileCommunityPicker.ts", "../src/lib/embed/components/mobile/MobileProfileDrawer.ts", "../src/lib/embed/utils/responsive.ts", "../src/lib/embed/components/sidebar/CommunitySidebar.ts", "../src/lib/embed/services/auth/AuthenticationService.ts", "../src/lib/embed/services/signature/FrontendSignatureValidator.ts", "../src/lib/embed/services/messaging/MessageRouter.ts", "../src/lib/embed/services/iframe/IframeManager.ts", "../src/lib/embed/embed-entry.ts"],
  "sourcesContent": [null, null, null, null, null, null, "// can-promise has a crash in some versions of react native that dont have\n// standard global objects\n// https://github.com/soldair/node-qrcode/issues/157\n\nmodule.exports = function () {\n  return typeof Promise === 'function' && Promise.prototype && Promise.prototype.then\n}\n", "let toSJISFunction\nconst CODEWORDS_COUNT = [\n  0, // Not used\n  26, 44, 70, 100, 134, 172, 196, 242, 292, 346,\n  404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n  1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185,\n  2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706\n]\n\n/**\n * Returns the QR Code size for the specified version\n *\n * @param  {Number} version QR Code version\n * @return {Number}         size of QR code\n */\nexports.getSymbolSize = function getSymbolSize (version) {\n  if (!version) throw new Error('\"version\" cannot be null or undefined')\n  if (version < 1 || version > 40) throw new Error('\"version\" should be in range from 1 to 40')\n  return version * 4 + 17\n}\n\n/**\n * Returns the total number of codewords used to store data and EC information.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Data length in bits\n */\nexports.getSymbolTotalCodewords = function getSymbolTotalCodewords (version) {\n  return CODEWORDS_COUNT[version]\n}\n\n/**\n * Encode data with Bose-Chaudhuri-Hocquenghem\n *\n * @param  {Number} data Value to encode\n * @return {Number}      Encoded value\n */\nexports.getBCHDigit = function (data) {\n  let digit = 0\n\n  while (data !== 0) {\n    digit++\n    data >>>= 1\n  }\n\n  return digit\n}\n\nexports.setToSJISFunction = function setToSJISFunction (f) {\n  if (typeof f !== 'function') {\n    throw new Error('\"toSJISFunc\" is not a valid function.')\n  }\n\n  toSJISFunction = f\n}\n\nexports.isKanjiModeEnabled = function () {\n  return typeof toSJISFunction !== 'undefined'\n}\n\nexports.toSJIS = function toSJIS (kanji) {\n  return toSJISFunction(kanji)\n}\n", "exports.L = { bit: 1 }\nexports.M = { bit: 0 }\nexports.Q = { bit: 3 }\nexports.H = { bit: 2 }\n\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'l':\n    case 'low':\n      return exports.L\n\n    case 'm':\n    case 'medium':\n      return exports.M\n\n    case 'q':\n    case 'quartile':\n      return exports.Q\n\n    case 'h':\n    case 'high':\n      return exports.H\n\n    default:\n      throw new Error('Unknown EC Level: ' + string)\n  }\n}\n\nexports.isValid = function isValid (level) {\n  return level && typeof level.bit !== 'undefined' &&\n    level.bit >= 0 && level.bit < 4\n}\n\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n", "function BitBuffer () {\n  this.buffer = []\n  this.length = 0\n}\n\nBitBuffer.prototype = {\n\n  get: function (index) {\n    const bufIndex = Math.floor(index / 8)\n    return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) === 1\n  },\n\n  put: function (num, length) {\n    for (let i = 0; i < length; i++) {\n      this.putBit(((num >>> (length - i - 1)) & 1) === 1)\n    }\n  },\n\n  getLengthInBits: function () {\n    return this.length\n  },\n\n  putBit: function (bit) {\n    const bufIndex = Math.floor(this.length / 8)\n    if (this.buffer.length <= bufIndex) {\n      this.buffer.push(0)\n    }\n\n    if (bit) {\n      this.buffer[bufIndex] |= (0x80 >>> (this.length % 8))\n    }\n\n    this.length++\n  }\n}\n\nmodule.exports = BitBuffer\n", "/**\n * Helper class to handle QR Code symbol modules\n *\n * @param {Number} size Symbol size\n */\nfunction BitMatrix (size) {\n  if (!size || size < 1) {\n    throw new Error('BitMatrix size must be defined and greater than 0')\n  }\n\n  this.size = size\n  this.data = new Uint8Array(size * size)\n  this.reservedBit = new Uint8Array(size * size)\n}\n\n/**\n * Set bit value at specified location\n * If reserved flag is set, this bit will be ignored during masking process\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n * @param {Boolean} reserved\n */\nBitMatrix.prototype.set = function (row, col, value, reserved) {\n  const index = row * this.size + col\n  this.data[index] = value\n  if (reserved) this.reservedBit[index] = true\n}\n\n/**\n * Returns bit value at specified location\n *\n * @param  {Number}  row\n * @param  {Number}  col\n * @return {Boolean}\n */\nBitMatrix.prototype.get = function (row, col) {\n  return this.data[row * this.size + col]\n}\n\n/**\n * Applies xor operator at specified location\n * (used during masking process)\n *\n * @param {Number}  row\n * @param {Number}  col\n * @param {Boolean} value\n */\nBitMatrix.prototype.xor = function (row, col, value) {\n  this.data[row * this.size + col] ^= value\n}\n\n/**\n * Check if bit at specified location is reserved\n *\n * @param {Number}   row\n * @param {Number}   col\n * @return {Boolean}\n */\nBitMatrix.prototype.isReserved = function (row, col) {\n  return this.reservedBit[row * this.size + col]\n}\n\nmodule.exports = BitMatrix\n", "/**\n * Alignment pattern are fixed reference pattern in defined positions\n * in a matrix symbology, which enables the decode software to re-synchronise\n * the coordinate mapping of the image modules in the event of moderate amounts\n * of distortion of the image.\n *\n * Alignment patterns are present only in QR Code symbols of version 2 or larger\n * and their number depends on the symbol version.\n */\n\nconst getSymbolSize = require('./utils').getSymbolSize\n\n/**\n * Calculate the row/column coordinates of the center module of each alignment pattern\n * for the specified QR Code version.\n *\n * The alignment patterns are positioned symmetrically on either side of the diagonal\n * running from the top left corner of the symbol to the bottom right corner.\n *\n * Since positions are simmetrical only half of the coordinates are returned.\n * Each item of the array will represent in turn the x and y coordinate.\n * @see {@link getPositions}\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinate\n */\nexports.getRowColCoords = function getRowColCoords (version) {\n  if (version === 1) return []\n\n  const posCount = Math.floor(version / 7) + 2\n  const size = getSymbolSize(version)\n  const intervals = size === 145 ? 26 : Math.ceil((size - 13) / (2 * posCount - 2)) * 2\n  const positions = [size - 7] // Last coord is always (size - 7)\n\n  for (let i = 1; i < posCount - 1; i++) {\n    positions[i] = positions[i - 1] - intervals\n  }\n\n  positions.push(6) // First coord is always 6\n\n  return positions.reverse()\n}\n\n/**\n * Returns an array containing the positions of each alignment pattern.\n * Each array's element represent the center point of the pattern as (x, y) coordinates\n *\n * Coordinates are calculated expanding the row/column coordinates returned by {@link getRowColCoords}\n * and filtering out the items that overlaps with finder pattern\n *\n * @example\n * For a Version 7 symbol {@link getRowColCoords} returns values 6, 22 and 38.\n * The alignment patterns, therefore, are to be centered on (row, column)\n * positions (6,22), (22,6), (22,22), (22,38), (38,22), (38,38).\n * Note that the coordinates (6,6), (6,38), (38,6) are occupied by finder patterns\n * and are not therefore used for alignment patterns.\n *\n * let pos = getPositions(7)\n * // [[6,22], [22,6], [22,22], [22,38], [38,22], [38,38]]\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const coords = []\n  const pos = exports.getRowColCoords(version)\n  const posLength = pos.length\n\n  for (let i = 0; i < posLength; i++) {\n    for (let j = 0; j < posLength; j++) {\n      // Skip if position is occupied by finder patterns\n      if ((i === 0 && j === 0) || // top-left\n          (i === 0 && j === posLength - 1) || // bottom-left\n          (i === posLength - 1 && j === 0)) { // top-right\n        continue\n      }\n\n      coords.push([pos[i], pos[j]])\n    }\n  }\n\n  return coords\n}\n", "const getSymbolSize = require('./utils').getSymbolSize\nconst FINDER_PATTERN_SIZE = 7\n\n/**\n * Returns an array containing the positions of each finder pattern.\n * Each array's element represent the top-left point of the pattern as (x, y) coordinates\n *\n * @param  {Number} version QR Code version\n * @return {Array}          Array of coordinates\n */\nexports.getPositions = function getPositions (version) {\n  const size = getSymbolSize(version)\n\n  return [\n    // top-left\n    [0, 0],\n    // top-right\n    [size - FINDER_PATTERN_SIZE, 0],\n    // bottom-left\n    [0, size - FINDER_PATTERN_SIZE]\n  ]\n}\n", "/**\n * Data mask pattern reference\n * @type {Object}\n */\nexports.Patterns = {\n  PATTERN000: 0,\n  PATTERN001: 1,\n  PATTERN010: 2,\n  PATTERN011: 3,\n  PATTERN100: 4,\n  PATTERN101: 5,\n  PATTERN110: 6,\n  PATTERN111: 7\n}\n\n/**\n * Weighted penalty scores for the undesirable features\n * @type {Object}\n */\nconst PenaltyScores = {\n  N1: 3,\n  N2: 3,\n  N3: 40,\n  N4: 10\n}\n\n/**\n * Check if mask pattern value is valid\n *\n * @param  {Number}  mask    Mask pattern\n * @return {Boolean}         true if valid, false otherwise\n */\nexports.isValid = function isValid (mask) {\n  return mask != null && mask !== '' && !isNaN(mask) && mask >= 0 && mask <= 7\n}\n\n/**\n * Returns mask pattern from a value.\n * If value is not valid, returns undefined\n *\n * @param  {Number|String} value        Mask pattern value\n * @return {Number}                     Valid mask pattern or undefined\n */\nexports.from = function from (value) {\n  return exports.isValid(value) ? parseInt(value, 10) : undefined\n}\n\n/**\n* Find adjacent modules in row/column with the same color\n* and assign a penalty value.\n*\n* Points: N1 + i\n* i is the amount by which the number of adjacent modules of the same color exceeds 5\n*/\nexports.getPenaltyN1 = function getPenaltyN1 (data) {\n  const size = data.size\n  let points = 0\n  let sameCountCol = 0\n  let sameCountRow = 0\n  let lastCol = null\n  let lastRow = null\n\n  for (let row = 0; row < size; row++) {\n    sameCountCol = sameCountRow = 0\n    lastCol = lastRow = null\n\n    for (let col = 0; col < size; col++) {\n      let module = data.get(row, col)\n      if (module === lastCol) {\n        sameCountCol++\n      } else {\n        if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n        lastCol = module\n        sameCountCol = 1\n      }\n\n      module = data.get(col, row)\n      if (module === lastRow) {\n        sameCountRow++\n      } else {\n        if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n        lastRow = module\n        sameCountRow = 1\n      }\n    }\n\n    if (sameCountCol >= 5) points += PenaltyScores.N1 + (sameCountCol - 5)\n    if (sameCountRow >= 5) points += PenaltyScores.N1 + (sameCountRow - 5)\n  }\n\n  return points\n}\n\n/**\n * Find 2x2 blocks with the same color and assign a penalty value\n *\n * Points: N2 * (m - 1) * (n - 1)\n */\nexports.getPenaltyN2 = function getPenaltyN2 (data) {\n  const size = data.size\n  let points = 0\n\n  for (let row = 0; row < size - 1; row++) {\n    for (let col = 0; col < size - 1; col++) {\n      const last = data.get(row, col) +\n        data.get(row, col + 1) +\n        data.get(row + 1, col) +\n        data.get(row + 1, col + 1)\n\n      if (last === 4 || last === 0) points++\n    }\n  }\n\n  return points * PenaltyScores.N2\n}\n\n/**\n * Find 1:1:3:1:1 ratio (dark:light:dark:light:dark) pattern in row/column,\n * preceded or followed by light area 4 modules wide\n *\n * Points: N3 * number of pattern found\n */\nexports.getPenaltyN3 = function getPenaltyN3 (data) {\n  const size = data.size\n  let points = 0\n  let bitsCol = 0\n  let bitsRow = 0\n\n  for (let row = 0; row < size; row++) {\n    bitsCol = bitsRow = 0\n    for (let col = 0; col < size; col++) {\n      bitsCol = ((bitsCol << 1) & 0x7FF) | data.get(row, col)\n      if (col >= 10 && (bitsCol === 0x5D0 || bitsCol === 0x05D)) points++\n\n      bitsRow = ((bitsRow << 1) & 0x7FF) | data.get(col, row)\n      if (col >= 10 && (bitsRow === 0x5D0 || bitsRow === 0x05D)) points++\n    }\n  }\n\n  return points * PenaltyScores.N3\n}\n\n/**\n * Calculate proportion of dark modules in entire symbol\n *\n * Points: N4 * k\n *\n * k is the rating of the deviation of the proportion of dark modules\n * in the symbol from 50% in steps of 5%\n */\nexports.getPenaltyN4 = function getPenaltyN4 (data) {\n  let darkCount = 0\n  const modulesCount = data.data.length\n\n  for (let i = 0; i < modulesCount; i++) darkCount += data.data[i]\n\n  const k = Math.abs(Math.ceil((darkCount * 100 / modulesCount) / 5) - 10)\n\n  return k * PenaltyScores.N4\n}\n\n/**\n * Return mask value at given position\n *\n * @param  {Number} maskPattern Pattern reference value\n * @param  {Number} i           Row\n * @param  {Number} j           Column\n * @return {Boolean}            Mask value\n */\nfunction getMaskAt (maskPattern, i, j) {\n  switch (maskPattern) {\n    case exports.Patterns.PATTERN000: return (i + j) % 2 === 0\n    case exports.Patterns.PATTERN001: return i % 2 === 0\n    case exports.Patterns.PATTERN010: return j % 3 === 0\n    case exports.Patterns.PATTERN011: return (i + j) % 3 === 0\n    case exports.Patterns.PATTERN100: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 === 0\n    case exports.Patterns.PATTERN101: return (i * j) % 2 + (i * j) % 3 === 0\n    case exports.Patterns.PATTERN110: return ((i * j) % 2 + (i * j) % 3) % 2 === 0\n    case exports.Patterns.PATTERN111: return ((i * j) % 3 + (i + j) % 2) % 2 === 0\n\n    default: throw new Error('bad maskPattern:' + maskPattern)\n  }\n}\n\n/**\n * Apply a mask pattern to a BitMatrix\n *\n * @param  {Number}    pattern Pattern reference number\n * @param  {BitMatrix} data    BitMatrix data\n */\nexports.applyMask = function applyMask (pattern, data) {\n  const size = data.size\n\n  for (let col = 0; col < size; col++) {\n    for (let row = 0; row < size; row++) {\n      if (data.isReserved(row, col)) continue\n      data.xor(row, col, getMaskAt(pattern, row, col))\n    }\n  }\n}\n\n/**\n * Returns the best mask pattern for data\n *\n * @param  {BitMatrix} data\n * @return {Number} Mask pattern reference number\n */\nexports.getBestMask = function getBestMask (data, setupFormatFunc) {\n  const numPatterns = Object.keys(exports.Patterns).length\n  let bestPattern = 0\n  let lowerPenalty = Infinity\n\n  for (let p = 0; p < numPatterns; p++) {\n    setupFormatFunc(p)\n    exports.applyMask(p, data)\n\n    // Calculate penalty\n    const penalty =\n      exports.getPenaltyN1(data) +\n      exports.getPenaltyN2(data) +\n      exports.getPenaltyN3(data) +\n      exports.getPenaltyN4(data)\n\n    // Undo previously applied mask\n    exports.applyMask(p, data)\n\n    if (penalty < lowerPenalty) {\n      lowerPenalty = penalty\n      bestPattern = p\n    }\n  }\n\n  return bestPattern\n}\n", "const ECLevel = require('./error-correction-level')\r\n\r\nconst EC_BLOCKS_TABLE = [\r\n// L  M  Q  H\r\n  1, 1, 1, 1,\r\n  1, 1, 1, 1,\r\n  1, 1, 2, 2,\r\n  1, 2, 2, 4,\r\n  1, 2, 4, 4,\r\n  2, 4, 4, 4,\r\n  2, 4, 6, 5,\r\n  2, 4, 6, 6,\r\n  2, 5, 8, 8,\r\n  4, 5, 8, 8,\r\n  4, 5, 8, 11,\r\n  4, 8, 10, 11,\r\n  4, 9, 12, 16,\r\n  4, 9, 16, 16,\r\n  6, 10, 12, 18,\r\n  6, 10, 17, 16,\r\n  6, 11, 16, 19,\r\n  6, 13, 18, 21,\r\n  7, 14, 21, 25,\r\n  8, 16, 20, 25,\r\n  8, 17, 23, 25,\r\n  9, 17, 23, 34,\r\n  9, 18, 25, 30,\r\n  10, 20, 27, 32,\r\n  12, 21, 29, 35,\r\n  12, 23, 34, 37,\r\n  12, 25, 34, 40,\r\n  13, 26, 35, 42,\r\n  14, 28, 38, 45,\r\n  15, 29, 40, 48,\r\n  16, 31, 43, 51,\r\n  17, 33, 45, 54,\r\n  18, 35, 48, 57,\r\n  19, 37, 51, 60,\r\n  19, 38, 53, 63,\r\n  20, 40, 56, 66,\r\n  21, 43, 59, 70,\r\n  22, 45, 62, 74,\r\n  24, 47, 65, 77,\r\n  25, 49, 68, 81\r\n]\r\n\r\nconst EC_CODEWORDS_TABLE = [\r\n// L  M  Q  H\r\n  7, 10, 13, 17,\r\n  10, 16, 22, 28,\r\n  15, 26, 36, 44,\r\n  20, 36, 52, 64,\r\n  26, 48, 72, 88,\r\n  36, 64, 96, 112,\r\n  40, 72, 108, 130,\r\n  48, 88, 132, 156,\r\n  60, 110, 160, 192,\r\n  72, 130, 192, 224,\r\n  80, 150, 224, 264,\r\n  96, 176, 260, 308,\r\n  104, 198, 288, 352,\r\n  120, 216, 320, 384,\r\n  132, 240, 360, 432,\r\n  144, 280, 408, 480,\r\n  168, 308, 448, 532,\r\n  180, 338, 504, 588,\r\n  196, 364, 546, 650,\r\n  224, 416, 600, 700,\r\n  224, 442, 644, 750,\r\n  252, 476, 690, 816,\r\n  270, 504, 750, 900,\r\n  300, 560, 810, 960,\r\n  312, 588, 870, 1050,\r\n  336, 644, 952, 1110,\r\n  360, 700, 1020, 1200,\r\n  390, 728, 1050, 1260,\r\n  420, 784, 1140, 1350,\r\n  450, 812, 1200, 1440,\r\n  480, 868, 1290, 1530,\r\n  510, 924, 1350, 1620,\r\n  540, 980, 1440, 1710,\r\n  570, 1036, 1530, 1800,\r\n  570, 1064, 1590, 1890,\r\n  600, 1120, 1680, 1980,\r\n  630, 1204, 1770, 2100,\r\n  660, 1260, 1860, 2220,\r\n  720, 1316, 1950, 2310,\r\n  750, 1372, 2040, 2430\r\n]\r\n\r\n/**\r\n * Returns the number of error correction block that the QR Code should contain\r\n * for the specified version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction blocks\r\n */\r\nexports.getBlocksCount = function getBlocksCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_BLOCKS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the number of error correction codewords to use for the specified\r\n * version and error correction level.\r\n *\r\n * @param  {Number} version              QR Code version\r\n * @param  {Number} errorCorrectionLevel Error correction level\r\n * @return {Number}                      Number of error correction codewords\r\n */\r\nexports.getTotalCodewordsCount = function getTotalCodewordsCount (version, errorCorrectionLevel) {\r\n  switch (errorCorrectionLevel) {\r\n    case ECLevel.L:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 0]\r\n    case ECLevel.M:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 1]\r\n    case ECLevel.Q:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 2]\r\n    case ECLevel.H:\r\n      return EC_CODEWORDS_TABLE[(version - 1) * 4 + 3]\r\n    default:\r\n      return undefined\r\n  }\r\n}\r\n", "const EXP_TABLE = new Uint8Array(512)\nconst LOG_TABLE = new Uint8Array(256)\n/**\n * Precompute the log and anti-log tables for faster computation later\n *\n * For each possible value in the galois field 2^8, we will pre-compute\n * the logarithm and anti-logarithm (exponential) of this value\n *\n * ref {@link https://en.wikiversity.org/wiki/Reed%E2%80%93Solomon_codes_for_coders#Introduction_to_mathematical_fields}\n */\n;(function initTables () {\n  let x = 1\n  for (let i = 0; i < 255; i++) {\n    EXP_TABLE[i] = x\n    LOG_TABLE[x] = i\n\n    x <<= 1 // multiply by 2\n\n    // The QR code specification says to use byte-wise modulo 100011101 arithmetic.\n    // This means that when a number is 256 or larger, it should be XORed with 0x11D.\n    if (x & 0x100) { // similar to x >= 256, but a lot faster (because 0x100 == 256)\n      x ^= 0x11D\n    }\n  }\n\n  // Optimization: double the size of the anti-log table so that we don't need to mod 255 to\n  // stay inside the bounds (because we will mainly use this table for the multiplication of\n  // two GF numbers, no more).\n  // @see {@link mul}\n  for (let i = 255; i < 512; i++) {\n    EXP_TABLE[i] = EXP_TABLE[i - 255]\n  }\n}())\n\n/**\n * Returns log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.log = function log (n) {\n  if (n < 1) throw new Error('log(' + n + ')')\n  return LOG_TABLE[n]\n}\n\n/**\n * Returns anti-log value of n inside Galois Field\n *\n * @param  {Number} n\n * @return {Number}\n */\nexports.exp = function exp (n) {\n  return EXP_TABLE[n]\n}\n\n/**\n * Multiplies two number inside Galois Field\n *\n * @param  {Number} x\n * @param  {Number} y\n * @return {Number}\n */\nexports.mul = function mul (x, y) {\n  if (x === 0 || y === 0) return 0\n\n  // should be EXP_TABLE[(LOG_TABLE[x] + LOG_TABLE[y]) % 255] if EXP_TABLE wasn't oversized\n  // @see {@link initTables}\n  return EXP_TABLE[LOG_TABLE[x] + LOG_TABLE[y]]\n}\n", "const GF = require('./galois-field')\n\n/**\n * Multiplies two polynomials inside Galois Field\n *\n * @param  {Uint8Array} p1 Polynomial\n * @param  {Uint8Array} p2 Polynomial\n * @return {Uint8Array}    Product of p1 and p2\n */\nexports.mul = function mul (p1, p2) {\n  const coeff = new Uint8Array(p1.length + p2.length - 1)\n\n  for (let i = 0; i < p1.length; i++) {\n    for (let j = 0; j < p2.length; j++) {\n      coeff[i + j] ^= GF.mul(p1[i], p2[j])\n    }\n  }\n\n  return coeff\n}\n\n/**\n * Calculate the remainder of polynomials division\n *\n * @param  {Uint8Array} divident Polynomial\n * @param  {Uint8Array} divisor  Polynomial\n * @return {Uint8Array}          Remainder\n */\nexports.mod = function mod (divident, divisor) {\n  let result = new Uint8Array(divident)\n\n  while ((result.length - divisor.length) >= 0) {\n    const coeff = result[0]\n\n    for (let i = 0; i < divisor.length; i++) {\n      result[i] ^= GF.mul(divisor[i], coeff)\n    }\n\n    // remove all zeros from buffer head\n    let offset = 0\n    while (offset < result.length && result[offset] === 0) offset++\n    result = result.slice(offset)\n  }\n\n  return result\n}\n\n/**\n * Generate an irreducible generator polynomial of specified degree\n * (used by Reed-Solomon encoder)\n *\n * @param  {Number} degree Degree of the generator polynomial\n * @return {Uint8Array}    Buffer containing polynomial coefficients\n */\nexports.generateECPolynomial = function generateECPolynomial (degree) {\n  let poly = new Uint8Array([1])\n  for (let i = 0; i < degree; i++) {\n    poly = exports.mul(poly, new Uint8Array([1, GF.exp(i)]))\n  }\n\n  return poly\n}\n", "const Polynomial = require('./polynomial')\n\nfunction ReedSolomonEncoder (degree) {\n  this.genPoly = undefined\n  this.degree = degree\n\n  if (this.degree) this.initialize(this.degree)\n}\n\n/**\n * Initialize the encoder.\n * The input param should correspond to the number of error correction codewords.\n *\n * @param  {Number} degree\n */\nReedSolomonEncoder.prototype.initialize = function initialize (degree) {\n  // create an irreducible generator polynomial\n  this.degree = degree\n  this.genPoly = Polynomial.generateECPolynomial(this.degree)\n}\n\n/**\n * Encodes a chunk of data\n *\n * @param  {Uint8Array} data Buffer containing input data\n * @return {Uint8Array}      Buffer containing encoded data\n */\nReedSolomonEncoder.prototype.encode = function encode (data) {\n  if (!this.genPoly) {\n    throw new Error('Encoder not initialized')\n  }\n\n  // Calculate EC for this data block\n  // extends data size to data+genPoly size\n  const paddedData = new Uint8Array(data.length + this.degree)\n  paddedData.set(data)\n\n  // The error correction codewords are the remainder after dividing the data codewords\n  // by a generator polynomial\n  const remainder = Polynomial.mod(paddedData, this.genPoly)\n\n  // return EC data blocks (last n byte, where n is the degree of genPoly)\n  // If coefficients number in remainder are less than genPoly degree,\n  // pad with 0s to the left to reach the needed number of coefficients\n  const start = this.degree - remainder.length\n  if (start > 0) {\n    const buff = new Uint8Array(this.degree)\n    buff.set(remainder, start)\n\n    return buff\n  }\n\n  return remainder\n}\n\nmodule.exports = ReedSolomonEncoder\n", "/**\n * Check if QR Code version is valid\n *\n * @param  {Number}  version QR Code version\n * @return {Boolean}         true if valid version, false otherwise\n */\nexports.isValid = function isValid (version) {\n  return !isNaN(version) && version >= 1 && version <= 40\n}\n", "const numeric = '[0-9]+'\nconst alphanumeric = '[A-Z $%*+\\\\-./:]+'\nlet kanji = '(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|' +\n  '[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|' +\n  '[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|' +\n  '[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+'\nkanji = kanji.replace(/u/g, '\\\\u')\n\nconst byte = '(?:(?![A-Z0-9 $%*+\\\\-./:]|' + kanji + ')(?:.|[\\r\\n]))+'\n\nexports.KANJI = new RegExp(kanji, 'g')\nexports.BYTE_KANJI = new RegExp('[^A-Z0-9 $%*+\\\\-./:]+', 'g')\nexports.BYTE = new RegExp(byte, 'g')\nexports.NUMERIC = new RegExp(numeric, 'g')\nexports.ALPHANUMERIC = new RegExp(alphanumeric, 'g')\n\nconst TEST_KANJI = new RegExp('^' + kanji + '$')\nconst TEST_NUMERIC = new RegExp('^' + numeric + '$')\nconst TEST_ALPHANUMERIC = new RegExp('^[A-Z0-9 $%*+\\\\-./:]+$')\n\nexports.testKanji = function testKanji (str) {\n  return TEST_KANJI.test(str)\n}\n\nexports.testNumeric = function testNumeric (str) {\n  return TEST_NUMERIC.test(str)\n}\n\nexports.testAlphanumeric = function testAlphanumeric (str) {\n  return TEST_ALPHANUMERIC.test(str)\n}\n", "const VersionCheck = require('./version-check')\nconst Regex = require('./regex')\n\n/**\n * Numeric mode encodes data from the decimal digit set (0 - 9)\n * (byte values 30HEX to 39HEX).\n * Normally, 3 data characters are represented by 10 bits.\n *\n * @type {Object}\n */\nexports.NUMERIC = {\n  id: 'Numeric',\n  bit: 1 << 0,\n  ccBits: [10, 12, 14]\n}\n\n/**\n * Alphanumeric mode encodes data from a set of 45 characters,\n * i.e. 10 numeric digits (0 - 9),\n *      26 alphabetic characters (A - Z),\n *   and 9 symbols (SP, $, %, *, +, -, ., /, :).\n * Normally, two input characters are represented by 11 bits.\n *\n * @type {Object}\n */\nexports.ALPHANUMERIC = {\n  id: 'Alphanumeric',\n  bit: 1 << 1,\n  ccBits: [9, 11, 13]\n}\n\n/**\n * In byte mode, data is encoded at 8 bits per character.\n *\n * @type {Object}\n */\nexports.BYTE = {\n  id: 'Byte',\n  bit: 1 << 2,\n  ccBits: [8, 16, 16]\n}\n\n/**\n * The Kanji mode efficiently encodes Kanji characters in accordance with\n * the Shift JIS system based on JIS X 0208.\n * The Shift JIS values are shifted from the JIS X 0208 values.\n * JIS X 0208 gives details of the shift coded representation.\n * Each two-byte character value is compacted to a 13-bit binary codeword.\n *\n * @type {Object}\n */\nexports.KANJI = {\n  id: 'Kanji',\n  bit: 1 << 3,\n  ccBits: [8, 10, 12]\n}\n\n/**\n * Mixed mode will contain a sequences of data in a combination of any of\n * the modes described above\n *\n * @type {Object}\n */\nexports.MIXED = {\n  bit: -1\n}\n\n/**\n * Returns the number of bits needed to store the data length\n * according to QR Code specifications.\n *\n * @param  {Mode}   mode    Data mode\n * @param  {Number} version QR Code version\n * @return {Number}         Number of bits\n */\nexports.getCharCountIndicator = function getCharCountIndicator (mode, version) {\n  if (!mode.ccBits) throw new Error('Invalid mode: ' + mode)\n\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid version: ' + version)\n  }\n\n  if (version >= 1 && version < 10) return mode.ccBits[0]\n  else if (version < 27) return mode.ccBits[1]\n  return mode.ccBits[2]\n}\n\n/**\n * Returns the most efficient mode to store the specified data\n *\n * @param  {String} dataStr Input data string\n * @return {Mode}           Best mode\n */\nexports.getBestModeForData = function getBestModeForData (dataStr) {\n  if (Regex.testNumeric(dataStr)) return exports.NUMERIC\n  else if (Regex.testAlphanumeric(dataStr)) return exports.ALPHANUMERIC\n  else if (Regex.testKanji(dataStr)) return exports.KANJI\n  else return exports.BYTE\n}\n\n/**\n * Return mode name as string\n *\n * @param {Mode} mode Mode object\n * @returns {String}  Mode name\n */\nexports.toString = function toString (mode) {\n  if (mode && mode.id) return mode.id\n  throw new Error('Invalid mode')\n}\n\n/**\n * Check if input param is a valid mode object\n *\n * @param   {Mode}    mode Mode object\n * @returns {Boolean} True if valid mode, false otherwise\n */\nexports.isValid = function isValid (mode) {\n  return mode && mode.bit && mode.ccBits\n}\n\n/**\n * Get mode object from its name\n *\n * @param   {String} string Mode name\n * @returns {Mode}          Mode object\n */\nfunction fromString (string) {\n  if (typeof string !== 'string') {\n    throw new Error('Param is not a string')\n  }\n\n  const lcStr = string.toLowerCase()\n\n  switch (lcStr) {\n    case 'numeric':\n      return exports.NUMERIC\n    case 'alphanumeric':\n      return exports.ALPHANUMERIC\n    case 'kanji':\n      return exports.KANJI\n    case 'byte':\n      return exports.BYTE\n    default:\n      throw new Error('Unknown mode: ' + string)\n  }\n}\n\n/**\n * Returns mode from a value.\n * If value is not a valid mode, returns defaultValue\n *\n * @param  {Mode|String} value        Encoding mode\n * @param  {Mode}        defaultValue Fallback value\n * @return {Mode}                     Encoding mode\n */\nexports.from = function from (value, defaultValue) {\n  if (exports.isValid(value)) {\n    return value\n  }\n\n  try {\n    return fromString(value)\n  } catch (e) {\n    return defaultValue\n  }\n}\n", "const Utils = require('./utils')\nconst ECCode = require('./error-correction-code')\nconst ECLevel = require('./error-correction-level')\nconst Mode = require('./mode')\nconst VersionCheck = require('./version-check')\n\n// Generator polynomial used to encode version information\nconst G18 = (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0)\nconst G18_BCH = Utils.getBCHDigit(G18)\n\nfunction getBestVersionForDataLength (mode, length, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, mode)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\nfunction getReservedBitsCount (mode, version) {\n  // Character count indicator + mode indicator bits\n  return Mode.getCharCountIndicator(mode, version) + 4\n}\n\nfunction getTotalBitsFromDataArray (segments, version) {\n  let totalBits = 0\n\n  segments.forEach(function (data) {\n    const reservedBits = getReservedBitsCount(data.mode, version)\n    totalBits += reservedBits + data.getBitsLength()\n  })\n\n  return totalBits\n}\n\nfunction getBestVersionForMixedData (segments, errorCorrectionLevel) {\n  for (let currentVersion = 1; currentVersion <= 40; currentVersion++) {\n    const length = getTotalBitsFromDataArray(segments, currentVersion)\n    if (length <= exports.getCapacity(currentVersion, errorCorrectionLevel, Mode.MIXED)) {\n      return currentVersion\n    }\n  }\n\n  return undefined\n}\n\n/**\n * Returns version number from a value.\n * If value is not a valid version, returns defaultValue\n *\n * @param  {Number|String} value        QR Code version\n * @param  {Number}        defaultValue Fallback value\n * @return {Number}                     QR Code version number\n */\nexports.from = function from (value, defaultValue) {\n  if (VersionCheck.isValid(value)) {\n    return parseInt(value, 10)\n  }\n\n  return defaultValue\n}\n\n/**\n * Returns how much data can be stored with the specified QR code version\n * and error correction level\n *\n * @param  {Number} version              QR Code version (1-40)\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Mode}   mode                 Data mode\n * @return {Number}                      Quantity of storable data\n */\nexports.getCapacity = function getCapacity (version, errorCorrectionLevel, mode) {\n  if (!VersionCheck.isValid(version)) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  // Use Byte mode as default\n  if (typeof mode === 'undefined') mode = Mode.BYTE\n\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  if (mode === Mode.MIXED) return dataTotalCodewordsBits\n\n  const usableBits = dataTotalCodewordsBits - getReservedBitsCount(mode, version)\n\n  // Return max number of storable codewords\n  switch (mode) {\n    case Mode.NUMERIC:\n      return Math.floor((usableBits / 10) * 3)\n\n    case Mode.ALPHANUMERIC:\n      return Math.floor((usableBits / 11) * 2)\n\n    case Mode.KANJI:\n      return Math.floor(usableBits / 13)\n\n    case Mode.BYTE:\n    default:\n      return Math.floor(usableBits / 8)\n  }\n}\n\n/**\n * Returns the minimum version needed to contain the amount of data\n *\n * @param  {Segment} data                    Segment of data\n * @param  {Number} [errorCorrectionLevel=H] Error correction level\n * @param  {Mode} mode                       Data mode\n * @return {Number}                          QR Code version\n */\nexports.getBestVersionForData = function getBestVersionForData (data, errorCorrectionLevel) {\n  let seg\n\n  const ecl = ECLevel.from(errorCorrectionLevel, ECLevel.M)\n\n  if (Array.isArray(data)) {\n    if (data.length > 1) {\n      return getBestVersionForMixedData(data, ecl)\n    }\n\n    if (data.length === 0) {\n      return 1\n    }\n\n    seg = data[0]\n  } else {\n    seg = data\n  }\n\n  return getBestVersionForDataLength(seg.mode, seg.getLength(), ecl)\n}\n\n/**\n * Returns version information with relative error correction bits\n *\n * The version information is included in QR Code symbols of version 7 or larger.\n * It consists of an 18-bit sequence containing 6 data bits,\n * with 12 error correction bits calculated using the (18, 6) Golay code.\n *\n * @param  {Number} version QR Code version\n * @return {Number}         Encoded version info bits\n */\nexports.getEncodedBits = function getEncodedBits (version) {\n  if (!VersionCheck.isValid(version) || version < 7) {\n    throw new Error('Invalid QR Code version')\n  }\n\n  let d = version << 12\n\n  while (Utils.getBCHDigit(d) - G18_BCH >= 0) {\n    d ^= (G18 << (Utils.getBCHDigit(d) - G18_BCH))\n  }\n\n  return (version << 12) | d\n}\n", "const Utils = require('./utils')\n\nconst G15 = (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0)\nconst G15_MASK = (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1)\nconst G15_BCH = Utils.getBCHDigit(G15)\n\n/**\n * Returns format information with relative error correction bits\n *\n * The format information is a 15-bit sequence containing 5 data bits,\n * with 10 error correction bits calculated using the (15, 5) BCH code.\n *\n * @param  {Number} errorCorrectionLevel Error correction level\n * @param  {Number} mask                 Mask pattern\n * @return {Number}                      Encoded format information bits\n */\nexports.getEncodedBits = function getEncodedBits (errorCorrectionLevel, mask) {\n  const data = ((errorCorrectionLevel.bit << 3) | mask)\n  let d = data << 10\n\n  while (Utils.getBCHDigit(d) - G15_BCH >= 0) {\n    d ^= (G15 << (Utils.getBCHDigit(d) - G15_BCH))\n  }\n\n  // xor final data with mask pattern in order to ensure that\n  // no combination of Error Correction Level and data mask pattern\n  // will result in an all-zero data string\n  return ((data << 10) | d) ^ G15_MASK\n}\n", "const Mode = require('./mode')\n\nfunction NumericData (data) {\n  this.mode = Mode.NUMERIC\n  this.data = data.toString()\n}\n\nNumericData.getBitsLength = function getBitsLength (length) {\n  return 10 * Math.floor(length / 3) + ((length % 3) ? ((length % 3) * 3 + 1) : 0)\n}\n\nNumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nNumericData.prototype.getBitsLength = function getBitsLength () {\n  return NumericData.getBitsLength(this.data.length)\n}\n\nNumericData.prototype.write = function write (bitBuffer) {\n  let i, group, value\n\n  // The input data string is divided into groups of three digits,\n  // and each group is converted to its 10-bit binary equivalent.\n  for (i = 0; i + 3 <= this.data.length; i += 3) {\n    group = this.data.substr(i, 3)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, 10)\n  }\n\n  // If the number of input digits is not an exact multiple of three,\n  // the final one or two digits are converted to 4 or 7 bits respectively.\n  const remainingNum = this.data.length - i\n  if (remainingNum > 0) {\n    group = this.data.substr(i)\n    value = parseInt(group, 10)\n\n    bitBuffer.put(value, remainingNum * 3 + 1)\n  }\n}\n\nmodule.exports = NumericData\n", "const Mode = require('./mode')\n\n/**\n * Array of characters available in alphanumeric mode\n *\n * As per QR Code specification, to each character\n * is assigned a value from 0 to 44 which in this case coincides\n * with the array index\n *\n * @type {Array}\n */\nconst ALPHA_NUM_CHARS = [\n  '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',\n  'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',\n  ' ', '$', '%', '*', '+', '-', '.', '/', ':'\n]\n\nfunction AlphanumericData (data) {\n  this.mode = Mode.ALPHANUMERIC\n  this.data = data\n}\n\nAlphanumericData.getBitsLength = function getBitsLength (length) {\n  return 11 * Math.floor(length / 2) + 6 * (length % 2)\n}\n\nAlphanumericData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nAlphanumericData.prototype.getBitsLength = function getBitsLength () {\n  return AlphanumericData.getBitsLength(this.data.length)\n}\n\nAlphanumericData.prototype.write = function write (bitBuffer) {\n  let i\n\n  // Input data characters are divided into groups of two characters\n  // and encoded as 11-bit binary codes.\n  for (i = 0; i + 2 <= this.data.length; i += 2) {\n    // The character value of the first character is multiplied by 45\n    let value = ALPHA_NUM_CHARS.indexOf(this.data[i]) * 45\n\n    // The character value of the second digit is added to the product\n    value += ALPHA_NUM_CHARS.indexOf(this.data[i + 1])\n\n    // The sum is then stored as 11-bit binary number\n    bitBuffer.put(value, 11)\n  }\n\n  // If the number of input data characters is not a multiple of two,\n  // the character value of the final character is encoded as a 6-bit binary number.\n  if (this.data.length % 2) {\n    bitBuffer.put(ALPHA_NUM_CHARS.indexOf(this.data[i]), 6)\n  }\n}\n\nmodule.exports = AlphanumericData\n", "const Mode = require('./mode')\n\nfunction ByteData (data) {\n  this.mode = Mode.BYTE\n  if (typeof (data) === 'string') {\n    this.data = new TextEncoder().encode(data)\n  } else {\n    this.data = new Uint8Array(data)\n  }\n}\n\nByteData.getBitsLength = function getBitsLength (length) {\n  return length * 8\n}\n\nByteData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nByteData.prototype.getBitsLength = function getBitsLength () {\n  return ByteData.getBitsLength(this.data.length)\n}\n\nByteData.prototype.write = function (bitBuffer) {\n  for (let i = 0, l = this.data.length; i < l; i++) {\n    bitBuffer.put(this.data[i], 8)\n  }\n}\n\nmodule.exports = ByteData\n", "const Mode = require('./mode')\nconst Utils = require('./utils')\n\nfunction KanjiData (data) {\n  this.mode = Mode.KANJI\n  this.data = data\n}\n\nKanjiData.getBitsLength = function getBitsLength (length) {\n  return length * 13\n}\n\nKanjiData.prototype.getLength = function getLength () {\n  return this.data.length\n}\n\nKanjiData.prototype.getBitsLength = function getBitsLength () {\n  return KanjiData.getBitsLength(this.data.length)\n}\n\nKanjiData.prototype.write = function (bitBuffer) {\n  let i\n\n  // In the Shift JIS system, Kanji characters are represented by a two byte combination.\n  // These byte values are shifted from the JIS X 0208 values.\n  // JIS X 0208 gives details of the shift coded representation.\n  for (i = 0; i < this.data.length; i++) {\n    let value = Utils.toSJIS(this.data[i])\n\n    // For characters with Shift JIS values from 0x8140 to 0x9FFC:\n    if (value >= 0x8140 && value <= 0x9FFC) {\n      // Subtract 0x8140 from Shift JIS value\n      value -= 0x8140\n\n    // For characters with Shift JIS values from 0xE040 to 0xEBBF\n    } else if (value >= 0xE040 && value <= 0xEBBF) {\n      // Subtract 0xC140 from Shift JIS value\n      value -= 0xC140\n    } else {\n      throw new Error(\n        'Invalid SJIS character: ' + this.data[i] + '\\n' +\n        'Make sure your charset is UTF-8')\n    }\n\n    // Multiply most significant byte of result by 0xC0\n    // and add least significant byte to product\n    value = (((value >>> 8) & 0xff) * 0xC0) + (value & 0xff)\n\n    // Convert result to a 13-bit binary string\n    bitBuffer.put(value, 13)\n  }\n}\n\nmodule.exports = KanjiData\n", "'use strict';\n\n/******************************************************************************\n * Created 2008-08-19.\n *\n * Dijkstra path-finding functions. Adapted from the Dijkstar Python project.\n *\n * Copyright (C) 2008\n *   Wyatt Baldwin <self@wyattbaldwin.com>\n *   All rights reserved\n *\n * Licensed under the MIT license.\n *\n *   http://www.opensource.org/licenses/mit-license.php\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *****************************************************************************/\nvar dijkstra = {\n  single_source_shortest_paths: function(graph, s, d) {\n    // Predecessor map for each node that has been encountered.\n    // node ID => predecessor node ID\n    var predecessors = {};\n\n    // Costs of shortest paths from s to all nodes encountered.\n    // node ID => cost\n    var costs = {};\n    costs[s] = 0;\n\n    // Costs of shortest paths from s to all nodes encountered; differs from\n    // `costs` in that it provides easy access to the node that currently has\n    // the known shortest path from s.\n    // XXX: Do we actually need both `costs` and `open`?\n    var open = dijkstra.PriorityQueue.make();\n    open.push(s, 0);\n\n    var closest,\n        u, v,\n        cost_of_s_to_u,\n        adjacent_nodes,\n        cost_of_e,\n        cost_of_s_to_u_plus_cost_of_e,\n        cost_of_s_to_v,\n        first_visit;\n    while (!open.empty()) {\n      // In the nodes remaining in graph that have a known cost from s,\n      // find the node, u, that currently has the shortest path from s.\n      closest = open.pop();\n      u = closest.value;\n      cost_of_s_to_u = closest.cost;\n\n      // Get nodes adjacent to u...\n      adjacent_nodes = graph[u] || {};\n\n      // ...and explore the edges that connect u to those nodes, updating\n      // the cost of the shortest paths to any or all of those nodes as\n      // necessary. v is the node across the current edge from u.\n      for (v in adjacent_nodes) {\n        if (adjacent_nodes.hasOwnProperty(v)) {\n          // Get the cost of the edge running from u to v.\n          cost_of_e = adjacent_nodes[v];\n\n          // Cost of s to u plus the cost of u to v across e--this is *a*\n          // cost from s to v that may or may not be less than the current\n          // known cost to v.\n          cost_of_s_to_u_plus_cost_of_e = cost_of_s_to_u + cost_of_e;\n\n          // If we haven't visited v yet OR if the current known cost from s to\n          // v is greater than the new cost we just found (cost of s to u plus\n          // cost of u to v across e), update v's cost in the cost list and\n          // update v's predecessor in the predecessor list (it's now u).\n          cost_of_s_to_v = costs[v];\n          first_visit = (typeof costs[v] === 'undefined');\n          if (first_visit || cost_of_s_to_v > cost_of_s_to_u_plus_cost_of_e) {\n            costs[v] = cost_of_s_to_u_plus_cost_of_e;\n            open.push(v, cost_of_s_to_u_plus_cost_of_e);\n            predecessors[v] = u;\n          }\n        }\n      }\n    }\n\n    if (typeof d !== 'undefined' && typeof costs[d] === 'undefined') {\n      var msg = ['Could not find a path from ', s, ' to ', d, '.'].join('');\n      throw new Error(msg);\n    }\n\n    return predecessors;\n  },\n\n  extract_shortest_path_from_predecessor_list: function(predecessors, d) {\n    var nodes = [];\n    var u = d;\n    var predecessor;\n    while (u) {\n      nodes.push(u);\n      predecessor = predecessors[u];\n      u = predecessors[u];\n    }\n    nodes.reverse();\n    return nodes;\n  },\n\n  find_path: function(graph, s, d) {\n    var predecessors = dijkstra.single_source_shortest_paths(graph, s, d);\n    return dijkstra.extract_shortest_path_from_predecessor_list(\n      predecessors, d);\n  },\n\n  /**\n   * A very naive priority queue implementation.\n   */\n  PriorityQueue: {\n    make: function (opts) {\n      var T = dijkstra.PriorityQueue,\n          t = {},\n          key;\n      opts = opts || {};\n      for (key in T) {\n        if (T.hasOwnProperty(key)) {\n          t[key] = T[key];\n        }\n      }\n      t.queue = [];\n      t.sorter = opts.sorter || T.default_sorter;\n      return t;\n    },\n\n    default_sorter: function (a, b) {\n      return a.cost - b.cost;\n    },\n\n    /**\n     * Add a new item to the queue and ensure the highest priority element\n     * is at the front of the queue.\n     */\n    push: function (value, cost) {\n      var item = {value: value, cost: cost};\n      this.queue.push(item);\n      this.queue.sort(this.sorter);\n    },\n\n    /**\n     * Return the highest priority element in the queue.\n     */\n    pop: function () {\n      return this.queue.shift();\n    },\n\n    empty: function () {\n      return this.queue.length === 0;\n    }\n  }\n};\n\n\n// node.js module exports\nif (typeof module !== 'undefined') {\n  module.exports = dijkstra;\n}\n", "const Mode = require('./mode')\nconst NumericData = require('./numeric-data')\nconst AlphanumericData = require('./alphanumeric-data')\nconst ByteData = require('./byte-data')\nconst KanjiData = require('./kanji-data')\nconst Regex = require('./regex')\nconst Utils = require('./utils')\nconst dijkstra = require('dijkstrajs')\n\n/**\n * Returns UTF8 byte length\n *\n * @param  {String} str Input string\n * @return {Number}     Number of byte\n */\nfunction getStringByteLength (str) {\n  return unescape(encodeURIComponent(str)).length\n}\n\n/**\n * Get a list of segments of the specified mode\n * from a string\n *\n * @param  {Mode}   mode Segment mode\n * @param  {String} str  String to process\n * @return {Array}       Array of object with segments data\n */\nfunction getSegments (regex, mode, str) {\n  const segments = []\n  let result\n\n  while ((result = regex.exec(str)) !== null) {\n    segments.push({\n      data: result[0],\n      index: result.index,\n      mode: mode,\n      length: result[0].length\n    })\n  }\n\n  return segments\n}\n\n/**\n * Extracts a series of segments with the appropriate\n * modes from a string\n *\n * @param  {String} dataStr Input string\n * @return {Array}          Array of object with segments data\n */\nfunction getSegmentsFromString (dataStr) {\n  const numSegs = getSegments(Regex.NUMERIC, Mode.NUMERIC, dataStr)\n  const alphaNumSegs = getSegments(Regex.ALPHANUMERIC, Mode.ALPHANUMERIC, dataStr)\n  let byteSegs\n  let kanjiSegs\n\n  if (Utils.isKanjiModeEnabled()) {\n    byteSegs = getSegments(Regex.BYTE, Mode.BYTE, dataStr)\n    kanjiSegs = getSegments(Regex.KANJI, Mode.KANJI, dataStr)\n  } else {\n    byteSegs = getSegments(Regex.BYTE_KANJI, Mode.BYTE, dataStr)\n    kanjiSegs = []\n  }\n\n  const segs = numSegs.concat(alphaNumSegs, byteSegs, kanjiSegs)\n\n  return segs\n    .sort(function (s1, s2) {\n      return s1.index - s2.index\n    })\n    .map(function (obj) {\n      return {\n        data: obj.data,\n        mode: obj.mode,\n        length: obj.length\n      }\n    })\n}\n\n/**\n * Returns how many bits are needed to encode a string of\n * specified length with the specified mode\n *\n * @param  {Number} length String length\n * @param  {Mode} mode     Segment mode\n * @return {Number}        Bit length\n */\nfunction getSegmentBitsLength (length, mode) {\n  switch (mode) {\n    case Mode.NUMERIC:\n      return NumericData.getBitsLength(length)\n    case Mode.ALPHANUMERIC:\n      return AlphanumericData.getBitsLength(length)\n    case Mode.KANJI:\n      return KanjiData.getBitsLength(length)\n    case Mode.BYTE:\n      return ByteData.getBitsLength(length)\n  }\n}\n\n/**\n * Merges adjacent segments which have the same mode\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction mergeSegments (segs) {\n  return segs.reduce(function (acc, curr) {\n    const prevSeg = acc.length - 1 >= 0 ? acc[acc.length - 1] : null\n    if (prevSeg && prevSeg.mode === curr.mode) {\n      acc[acc.length - 1].data += curr.data\n      return acc\n    }\n\n    acc.push(curr)\n    return acc\n  }, [])\n}\n\n/**\n * Generates a list of all possible nodes combination which\n * will be used to build a segments graph.\n *\n * Nodes are divided by groups. Each group will contain a list of all the modes\n * in which is possible to encode the given text.\n *\n * For example the text '12345' can be encoded as Numeric, Alphanumeric or Byte.\n * The group for '12345' will contain then 3 objects, one for each\n * possible encoding mode.\n *\n * Each node represents a possible segment.\n *\n * @param  {Array} segs Array of object with segments data\n * @return {Array}      Array of object with segments data\n */\nfunction buildNodes (segs) {\n  const nodes = []\n  for (let i = 0; i < segs.length; i++) {\n    const seg = segs[i]\n\n    switch (seg.mode) {\n      case Mode.NUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.ALPHANUMERIC, length: seg.length },\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.ALPHANUMERIC:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: seg.length }\n        ])\n        break\n      case Mode.KANJI:\n        nodes.push([seg,\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n        break\n      case Mode.BYTE:\n        nodes.push([\n          { data: seg.data, mode: Mode.BYTE, length: getStringByteLength(seg.data) }\n        ])\n    }\n  }\n\n  return nodes\n}\n\n/**\n * Builds a graph from a list of nodes.\n * All segments in each node group will be connected with all the segments of\n * the next group and so on.\n *\n * At each connection will be assigned a weight depending on the\n * segment's byte length.\n *\n * @param  {Array} nodes    Array of object with segments data\n * @param  {Number} version QR Code version\n * @return {Object}         Graph of all possible segments\n */\nfunction buildGraph (nodes, version) {\n  const table = {}\n  const graph = { start: {} }\n  let prevNodeIds = ['start']\n\n  for (let i = 0; i < nodes.length; i++) {\n    const nodeGroup = nodes[i]\n    const currentNodeIds = []\n\n    for (let j = 0; j < nodeGroup.length; j++) {\n      const node = nodeGroup[j]\n      const key = '' + i + j\n\n      currentNodeIds.push(key)\n      table[key] = { node: node, lastCount: 0 }\n      graph[key] = {}\n\n      for (let n = 0; n < prevNodeIds.length; n++) {\n        const prevNodeId = prevNodeIds[n]\n\n        if (table[prevNodeId] && table[prevNodeId].node.mode === node.mode) {\n          graph[prevNodeId][key] =\n            getSegmentBitsLength(table[prevNodeId].lastCount + node.length, node.mode) -\n            getSegmentBitsLength(table[prevNodeId].lastCount, node.mode)\n\n          table[prevNodeId].lastCount += node.length\n        } else {\n          if (table[prevNodeId]) table[prevNodeId].lastCount = node.length\n\n          graph[prevNodeId][key] = getSegmentBitsLength(node.length, node.mode) +\n            4 + Mode.getCharCountIndicator(node.mode, version) // switch cost\n        }\n      }\n    }\n\n    prevNodeIds = currentNodeIds\n  }\n\n  for (let n = 0; n < prevNodeIds.length; n++) {\n    graph[prevNodeIds[n]].end = 0\n  }\n\n  return { map: graph, table: table }\n}\n\n/**\n * Builds a segment from a specified data and mode.\n * If a mode is not specified, the more suitable will be used.\n *\n * @param  {String} data             Input data\n * @param  {Mode | String} modesHint Data mode\n * @return {Segment}                 Segment\n */\nfunction buildSingleSegment (data, modesHint) {\n  let mode\n  const bestMode = Mode.getBestModeForData(data)\n\n  mode = Mode.from(modesHint, bestMode)\n\n  // Make sure data can be encoded\n  if (mode !== Mode.BYTE && mode.bit < bestMode.bit) {\n    throw new Error('\"' + data + '\"' +\n      ' cannot be encoded with mode ' + Mode.toString(mode) +\n      '.\\n Suggested mode is: ' + Mode.toString(bestMode))\n  }\n\n  // Use Mode.BYTE if Kanji support is disabled\n  if (mode === Mode.KANJI && !Utils.isKanjiModeEnabled()) {\n    mode = Mode.BYTE\n  }\n\n  switch (mode) {\n    case Mode.NUMERIC:\n      return new NumericData(data)\n\n    case Mode.ALPHANUMERIC:\n      return new AlphanumericData(data)\n\n    case Mode.KANJI:\n      return new KanjiData(data)\n\n    case Mode.BYTE:\n      return new ByteData(data)\n  }\n}\n\n/**\n * Builds a list of segments from an array.\n * Array can contain Strings or Objects with segment's info.\n *\n * For each item which is a string, will be generated a segment with the given\n * string and the more appropriate encoding mode.\n *\n * For each item which is an object, will be generated a segment with the given\n * data and mode.\n * Objects must contain at least the property \"data\".\n * If property \"mode\" is not present, the more suitable mode will be used.\n *\n * @param  {Array} array Array of objects with segments data\n * @return {Array}       Array of Segments\n */\nexports.fromArray = function fromArray (array) {\n  return array.reduce(function (acc, seg) {\n    if (typeof seg === 'string') {\n      acc.push(buildSingleSegment(seg, null))\n    } else if (seg.data) {\n      acc.push(buildSingleSegment(seg.data, seg.mode))\n    }\n\n    return acc\n  }, [])\n}\n\n/**\n * Builds an optimized sequence of segments from a string,\n * which will produce the shortest possible bitstream.\n *\n * @param  {String} data    Input string\n * @param  {Number} version QR Code version\n * @return {Array}          Array of segments\n */\nexports.fromString = function fromString (data, version) {\n  const segs = getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n\n  const nodes = buildNodes(segs)\n  const graph = buildGraph(nodes, version)\n  const path = dijkstra.find_path(graph.map, 'start', 'end')\n\n  const optimizedSegs = []\n  for (let i = 1; i < path.length - 1; i++) {\n    optimizedSegs.push(graph.table[path[i]].node)\n  }\n\n  return exports.fromArray(mergeSegments(optimizedSegs))\n}\n\n/**\n * Splits a string in various segments with the modes which\n * best represent their content.\n * The produced segments are far from being optimized.\n * The output of this function is only used to estimate a QR Code version\n * which may contain the data.\n *\n * @param  {string} data Input string\n * @return {Array}       Array of segments\n */\nexports.rawSplit = function rawSplit (data) {\n  return exports.fromArray(\n    getSegmentsFromString(data, Utils.isKanjiModeEnabled())\n  )\n}\n", "const Utils = require('./utils')\nconst ECLevel = require('./error-correction-level')\nconst BitBuffer = require('./bit-buffer')\nconst BitMatrix = require('./bit-matrix')\nconst AlignmentPattern = require('./alignment-pattern')\nconst FinderPattern = require('./finder-pattern')\nconst MaskPattern = require('./mask-pattern')\nconst ECCode = require('./error-correction-code')\nconst ReedSolomonEncoder = require('./reed-solomon-encoder')\nconst Version = require('./version')\nconst FormatInfo = require('./format-info')\nconst Mode = require('./mode')\nconst Segments = require('./segments')\n\n/**\n * QRCode for JavaScript\n *\n * modified by Ryan Day for nodejs support\n * Copyright (c) 2011 Ryan Day\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/mit-license.php\n *\n//---------------------------------------------------------------------\n// QRCode for JavaScript\n//\n// Copyright (c) 2009 Kazuhiko Arase\n//\n// URL: http://www.d-project.com/\n//\n// Licensed under the MIT license:\n//   http://www.opensource.org/licenses/mit-license.php\n//\n// The word \"QR Code\" is registered trademark of\n// DENSO WAVE INCORPORATED\n//   http://www.denso-wave.com/qrcode/faqpatent-e.html\n//\n//---------------------------------------------------------------------\n*/\n\n/**\n * Add finder patterns bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupFinderPattern (matrix, version) {\n  const size = matrix.size\n  const pos = FinderPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -1; r <= 7; r++) {\n      if (row + r <= -1 || size <= row + r) continue\n\n      for (let c = -1; c <= 7; c++) {\n        if (col + c <= -1 || size <= col + c) continue\n\n        if ((r >= 0 && r <= 6 && (c === 0 || c === 6)) ||\n          (c >= 0 && c <= 6 && (r === 0 || r === 6)) ||\n          (r >= 2 && r <= 4 && c >= 2 && c <= 4)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add timing pattern bits to matrix\n *\n * Note: this function must be called before {@link setupAlignmentPattern}\n *\n * @param  {BitMatrix} matrix Modules matrix\n */\nfunction setupTimingPattern (matrix) {\n  const size = matrix.size\n\n  for (let r = 8; r < size - 8; r++) {\n    const value = r % 2 === 0\n    matrix.set(r, 6, value, true)\n    matrix.set(6, r, value, true)\n  }\n}\n\n/**\n * Add alignment patterns bits to matrix\n *\n * Note: this function must be called after {@link setupTimingPattern}\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupAlignmentPattern (matrix, version) {\n  const pos = AlignmentPattern.getPositions(version)\n\n  for (let i = 0; i < pos.length; i++) {\n    const row = pos[i][0]\n    const col = pos[i][1]\n\n    for (let r = -2; r <= 2; r++) {\n      for (let c = -2; c <= 2; c++) {\n        if (r === -2 || r === 2 || c === -2 || c === 2 ||\n          (r === 0 && c === 0)) {\n          matrix.set(row + r, col + c, true, true)\n        } else {\n          matrix.set(row + r, col + c, false, true)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Add version info bits to matrix\n *\n * @param  {BitMatrix} matrix  Modules matrix\n * @param  {Number}    version QR Code version\n */\nfunction setupVersionInfo (matrix, version) {\n  const size = matrix.size\n  const bits = Version.getEncodedBits(version)\n  let row, col, mod\n\n  for (let i = 0; i < 18; i++) {\n    row = Math.floor(i / 3)\n    col = i % 3 + size - 8 - 3\n    mod = ((bits >> i) & 1) === 1\n\n    matrix.set(row, col, mod, true)\n    matrix.set(col, row, mod, true)\n  }\n}\n\n/**\n * Add format info bits to matrix\n *\n * @param  {BitMatrix} matrix               Modules matrix\n * @param  {ErrorCorrectionLevel}    errorCorrectionLevel Error correction level\n * @param  {Number}    maskPattern          Mask pattern reference value\n */\nfunction setupFormatInfo (matrix, errorCorrectionLevel, maskPattern) {\n  const size = matrix.size\n  const bits = FormatInfo.getEncodedBits(errorCorrectionLevel, maskPattern)\n  let i, mod\n\n  for (i = 0; i < 15; i++) {\n    mod = ((bits >> i) & 1) === 1\n\n    // vertical\n    if (i < 6) {\n      matrix.set(i, 8, mod, true)\n    } else if (i < 8) {\n      matrix.set(i + 1, 8, mod, true)\n    } else {\n      matrix.set(size - 15 + i, 8, mod, true)\n    }\n\n    // horizontal\n    if (i < 8) {\n      matrix.set(8, size - i - 1, mod, true)\n    } else if (i < 9) {\n      matrix.set(8, 15 - i - 1 + 1, mod, true)\n    } else {\n      matrix.set(8, 15 - i - 1, mod, true)\n    }\n  }\n\n  // fixed module\n  matrix.set(size - 8, 8, 1, true)\n}\n\n/**\n * Add encoded data bits to matrix\n *\n * @param  {BitMatrix}  matrix Modules matrix\n * @param  {Uint8Array} data   Data codewords\n */\nfunction setupData (matrix, data) {\n  const size = matrix.size\n  let inc = -1\n  let row = size - 1\n  let bitIndex = 7\n  let byteIndex = 0\n\n  for (let col = size - 1; col > 0; col -= 2) {\n    if (col === 6) col--\n\n    while (true) {\n      for (let c = 0; c < 2; c++) {\n        if (!matrix.isReserved(row, col - c)) {\n          let dark = false\n\n          if (byteIndex < data.length) {\n            dark = (((data[byteIndex] >>> bitIndex) & 1) === 1)\n          }\n\n          matrix.set(row, col - c, dark)\n          bitIndex--\n\n          if (bitIndex === -1) {\n            byteIndex++\n            bitIndex = 7\n          }\n        }\n      }\n\n      row += inc\n\n      if (row < 0 || size <= row) {\n        row -= inc\n        inc = -inc\n        break\n      }\n    }\n  }\n}\n\n/**\n * Create encoded codewords from data input\n *\n * @param  {Number}   version              QR Code version\n * @param  {ErrorCorrectionLevel}   errorCorrectionLevel Error correction level\n * @param  {ByteData} data                 Data input\n * @return {Uint8Array}                    Buffer containing encoded codewords\n */\nfunction createData (version, errorCorrectionLevel, segments) {\n  // Prepare data buffer\n  const buffer = new BitBuffer()\n\n  segments.forEach(function (data) {\n    // prefix data with mode indicator (4 bits)\n    buffer.put(data.mode.bit, 4)\n\n    // Prefix data with character count indicator.\n    // The character count indicator is a string of bits that represents the\n    // number of characters that are being encoded.\n    // The character count indicator must be placed after the mode indicator\n    // and must be a certain number of bits long, depending on the QR version\n    // and data mode\n    // @see {@link Mode.getCharCountIndicator}.\n    buffer.put(data.getLength(), Mode.getCharCountIndicator(data.mode, version))\n\n    // add binary data sequence to buffer\n    data.write(buffer)\n  })\n\n  // Calculate required number of bits\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n  const dataTotalCodewordsBits = (totalCodewords - ecTotalCodewords) * 8\n\n  // Add a terminator.\n  // If the bit string is shorter than the total number of required bits,\n  // a terminator of up to four 0s must be added to the right side of the string.\n  // If the bit string is more than four bits shorter than the required number of bits,\n  // add four 0s to the end.\n  if (buffer.getLengthInBits() + 4 <= dataTotalCodewordsBits) {\n    buffer.put(0, 4)\n  }\n\n  // If the bit string is fewer than four bits shorter, add only the number of 0s that\n  // are needed to reach the required number of bits.\n\n  // After adding the terminator, if the number of bits in the string is not a multiple of 8,\n  // pad the string on the right with 0s to make the string's length a multiple of 8.\n  while (buffer.getLengthInBits() % 8 !== 0) {\n    buffer.putBit(0)\n  }\n\n  // Add pad bytes if the string is still shorter than the total number of required bits.\n  // Extend the buffer to fill the data capacity of the symbol corresponding to\n  // the Version and Error Correction Level by adding the Pad Codewords 11101100 (0xEC)\n  // and 00010001 (0x11) alternately.\n  const remainingByte = (dataTotalCodewordsBits - buffer.getLengthInBits()) / 8\n  for (let i = 0; i < remainingByte; i++) {\n    buffer.put(i % 2 ? 0x11 : 0xEC, 8)\n  }\n\n  return createCodewords(buffer, version, errorCorrectionLevel)\n}\n\n/**\n * Encode input data with Reed-Solomon and return codewords with\n * relative error correction bits\n *\n * @param  {BitBuffer} bitBuffer            Data to encode\n * @param  {Number}    version              QR Code version\n * @param  {ErrorCorrectionLevel} errorCorrectionLevel Error correction level\n * @return {Uint8Array}                     Buffer containing encoded codewords\n */\nfunction createCodewords (bitBuffer, version, errorCorrectionLevel) {\n  // Total codewords for this QR code version (Data + Error correction)\n  const totalCodewords = Utils.getSymbolTotalCodewords(version)\n\n  // Total number of error correction codewords\n  const ecTotalCodewords = ECCode.getTotalCodewordsCount(version, errorCorrectionLevel)\n\n  // Total number of data codewords\n  const dataTotalCodewords = totalCodewords - ecTotalCodewords\n\n  // Total number of blocks\n  const ecTotalBlocks = ECCode.getBlocksCount(version, errorCorrectionLevel)\n\n  // Calculate how many blocks each group should contain\n  const blocksInGroup2 = totalCodewords % ecTotalBlocks\n  const blocksInGroup1 = ecTotalBlocks - blocksInGroup2\n\n  const totalCodewordsInGroup1 = Math.floor(totalCodewords / ecTotalBlocks)\n\n  const dataCodewordsInGroup1 = Math.floor(dataTotalCodewords / ecTotalBlocks)\n  const dataCodewordsInGroup2 = dataCodewordsInGroup1 + 1\n\n  // Number of EC codewords is the same for both groups\n  const ecCount = totalCodewordsInGroup1 - dataCodewordsInGroup1\n\n  // Initialize a Reed-Solomon encoder with a generator polynomial of degree ecCount\n  const rs = new ReedSolomonEncoder(ecCount)\n\n  let offset = 0\n  const dcData = new Array(ecTotalBlocks)\n  const ecData = new Array(ecTotalBlocks)\n  let maxDataSize = 0\n  const buffer = new Uint8Array(bitBuffer.buffer)\n\n  // Divide the buffer into the required number of blocks\n  for (let b = 0; b < ecTotalBlocks; b++) {\n    const dataSize = b < blocksInGroup1 ? dataCodewordsInGroup1 : dataCodewordsInGroup2\n\n    // extract a block of data from buffer\n    dcData[b] = buffer.slice(offset, offset + dataSize)\n\n    // Calculate EC codewords for this data block\n    ecData[b] = rs.encode(dcData[b])\n\n    offset += dataSize\n    maxDataSize = Math.max(maxDataSize, dataSize)\n  }\n\n  // Create final data\n  // Interleave the data and error correction codewords from each block\n  const data = new Uint8Array(totalCodewords)\n  let index = 0\n  let i, r\n\n  // Add data codewords\n  for (i = 0; i < maxDataSize; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      if (i < dcData[r].length) {\n        data[index++] = dcData[r][i]\n      }\n    }\n  }\n\n  // Apped EC codewords\n  for (i = 0; i < ecCount; i++) {\n    for (r = 0; r < ecTotalBlocks; r++) {\n      data[index++] = ecData[r][i]\n    }\n  }\n\n  return data\n}\n\n/**\n * Build QR Code symbol\n *\n * @param  {String} data                 Input string\n * @param  {Number} version              QR Code version\n * @param  {ErrorCorretionLevel} errorCorrectionLevel Error level\n * @param  {MaskPattern} maskPattern     Mask pattern\n * @return {Object}                      Object containing symbol data\n */\nfunction createSymbol (data, version, errorCorrectionLevel, maskPattern) {\n  let segments\n\n  if (Array.isArray(data)) {\n    segments = Segments.fromArray(data)\n  } else if (typeof data === 'string') {\n    let estimatedVersion = version\n\n    if (!estimatedVersion) {\n      const rawSegments = Segments.rawSplit(data)\n\n      // Estimate best version that can contain raw splitted segments\n      estimatedVersion = Version.getBestVersionForData(rawSegments, errorCorrectionLevel)\n    }\n\n    // Build optimized segments\n    // If estimated version is undefined, try with the highest version\n    segments = Segments.fromString(data, estimatedVersion || 40)\n  } else {\n    throw new Error('Invalid data')\n  }\n\n  // Get the min version that can contain data\n  const bestVersion = Version.getBestVersionForData(segments, errorCorrectionLevel)\n\n  // If no version is found, data cannot be stored\n  if (!bestVersion) {\n    throw new Error('The amount of data is too big to be stored in a QR Code')\n  }\n\n  // If not specified, use min version as default\n  if (!version) {\n    version = bestVersion\n\n  // Check if the specified version can contain the data\n  } else if (version < bestVersion) {\n    throw new Error('\\n' +\n      'The chosen QR Code version cannot contain this amount of data.\\n' +\n      'Minimum version required to store current data is: ' + bestVersion + '.\\n'\n    )\n  }\n\n  const dataBits = createData(version, errorCorrectionLevel, segments)\n\n  // Allocate matrix buffer\n  const moduleCount = Utils.getSymbolSize(version)\n  const modules = new BitMatrix(moduleCount)\n\n  // Add function modules\n  setupFinderPattern(modules, version)\n  setupTimingPattern(modules)\n  setupAlignmentPattern(modules, version)\n\n  // Add temporary dummy bits for format info just to set them as reserved.\n  // This is needed to prevent these bits from being masked by {@link MaskPattern.applyMask}\n  // since the masking operation must be performed only on the encoding region.\n  // These blocks will be replaced with correct values later in code.\n  setupFormatInfo(modules, errorCorrectionLevel, 0)\n\n  if (version >= 7) {\n    setupVersionInfo(modules, version)\n  }\n\n  // Add data codewords\n  setupData(modules, dataBits)\n\n  if (isNaN(maskPattern)) {\n    // Find best mask pattern\n    maskPattern = MaskPattern.getBestMask(modules,\n      setupFormatInfo.bind(null, modules, errorCorrectionLevel))\n  }\n\n  // Apply mask pattern\n  MaskPattern.applyMask(maskPattern, modules)\n\n  // Replace format info bits with correct values\n  setupFormatInfo(modules, errorCorrectionLevel, maskPattern)\n\n  return {\n    modules: modules,\n    version: version,\n    errorCorrectionLevel: errorCorrectionLevel,\n    maskPattern: maskPattern,\n    segments: segments\n  }\n}\n\n/**\n * QR Code\n *\n * @param {String | Array} data                 Input data\n * @param {Object} options                      Optional configurations\n * @param {Number} options.version              QR Code version\n * @param {String} options.errorCorrectionLevel Error correction level\n * @param {Function} options.toSJISFunc         Helper func to convert utf8 to sjis\n */\nexports.create = function create (data, options) {\n  if (typeof data === 'undefined' || data === '') {\n    throw new Error('No input text')\n  }\n\n  let errorCorrectionLevel = ECLevel.M\n  let version\n  let mask\n\n  if (typeof options !== 'undefined') {\n    // Use higher error correction level as default\n    errorCorrectionLevel = ECLevel.from(options.errorCorrectionLevel, ECLevel.M)\n    version = Version.from(options.version)\n    mask = MaskPattern.from(options.maskPattern)\n\n    if (options.toSJISFunc) {\n      Utils.setToSJISFunction(options.toSJISFunc)\n    }\n  }\n\n  return createSymbol(data, version, errorCorrectionLevel, mask)\n}\n", "function hex2rgba (hex) {\n  if (typeof hex === 'number') {\n    hex = hex.toString()\n  }\n\n  if (typeof hex !== 'string') {\n    throw new Error('Color should be defined as hex string')\n  }\n\n  let hexCode = hex.slice().replace('#', '').split('')\n  if (hexCode.length < 3 || hexCode.length === 5 || hexCode.length > 8) {\n    throw new Error('Invalid hex color: ' + hex)\n  }\n\n  // Convert from short to long form (fff -> ffffff)\n  if (hexCode.length === 3 || hexCode.length === 4) {\n    hexCode = Array.prototype.concat.apply([], hexCode.map(function (c) {\n      return [c, c]\n    }))\n  }\n\n  // Add default alpha value\n  if (hexCode.length === 6) hexCode.push('F', 'F')\n\n  const hexValue = parseInt(hexCode.join(''), 16)\n\n  return {\n    r: (hexValue >> 24) & 255,\n    g: (hexValue >> 16) & 255,\n    b: (hexValue >> 8) & 255,\n    a: hexValue & 255,\n    hex: '#' + hexCode.slice(0, 6).join('')\n  }\n}\n\nexports.getOptions = function getOptions (options) {\n  if (!options) options = {}\n  if (!options.color) options.color = {}\n\n  const margin = typeof options.margin === 'undefined' ||\n    options.margin === null ||\n    options.margin < 0\n    ? 4\n    : options.margin\n\n  const width = options.width && options.width >= 21 ? options.width : undefined\n  const scale = options.scale || 4\n\n  return {\n    width: width,\n    scale: width ? 4 : scale,\n    margin: margin,\n    color: {\n      dark: hex2rgba(options.color.dark || '#000000ff'),\n      light: hex2rgba(options.color.light || '#ffffffff')\n    },\n    type: options.type,\n    rendererOpts: options.rendererOpts || {}\n  }\n}\n\nexports.getScale = function getScale (qrSize, opts) {\n  return opts.width && opts.width >= qrSize + opts.margin * 2\n    ? opts.width / (qrSize + opts.margin * 2)\n    : opts.scale\n}\n\nexports.getImageWidth = function getImageWidth (qrSize, opts) {\n  const scale = exports.getScale(qrSize, opts)\n  return Math.floor((qrSize + opts.margin * 2) * scale)\n}\n\nexports.qrToImageData = function qrToImageData (imgData, qr, opts) {\n  const size = qr.modules.size\n  const data = qr.modules.data\n  const scale = exports.getScale(size, opts)\n  const symbolSize = Math.floor((size + opts.margin * 2) * scale)\n  const scaledMargin = opts.margin * scale\n  const palette = [opts.color.light, opts.color.dark]\n\n  for (let i = 0; i < symbolSize; i++) {\n    for (let j = 0; j < symbolSize; j++) {\n      let posDst = (i * symbolSize + j) * 4\n      let pxColor = opts.color.light\n\n      if (i >= scaledMargin && j >= scaledMargin &&\n        i < symbolSize - scaledMargin && j < symbolSize - scaledMargin) {\n        const iSrc = Math.floor((i - scaledMargin) / scale)\n        const jSrc = Math.floor((j - scaledMargin) / scale)\n        pxColor = palette[data[iSrc * size + jSrc] ? 1 : 0]\n      }\n\n      imgData[posDst++] = pxColor.r\n      imgData[posDst++] = pxColor.g\n      imgData[posDst++] = pxColor.b\n      imgData[posDst] = pxColor.a\n    }\n  }\n}\n", "const Utils = require('./utils')\n\nfunction clearCanvas (ctx, canvas, size) {\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n  if (!canvas.style) canvas.style = {}\n  canvas.height = size\n  canvas.width = size\n  canvas.style.height = size + 'px'\n  canvas.style.width = size + 'px'\n}\n\nfunction getCanvasElement () {\n  try {\n    return document.createElement('canvas')\n  } catch (e) {\n    throw new Error('You need to specify a canvas element')\n  }\n}\n\nexports.render = function render (qrData, canvas, options) {\n  let opts = options\n  let canvasEl = canvas\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!canvas) {\n    canvasEl = getCanvasElement()\n  }\n\n  opts = Utils.getOptions(opts)\n  const size = Utils.getImageWidth(qrData.modules.size, opts)\n\n  const ctx = canvasEl.getContext('2d')\n  const image = ctx.createImageData(size, size)\n  Utils.qrToImageData(image.data, qrData, opts)\n\n  clearCanvas(ctx, canvasEl, size)\n  ctx.putImageData(image, 0, 0)\n\n  return canvasEl\n}\n\nexports.renderToDataURL = function renderToDataURL (qrData, canvas, options) {\n  let opts = options\n\n  if (typeof opts === 'undefined' && (!canvas || !canvas.getContext)) {\n    opts = canvas\n    canvas = undefined\n  }\n\n  if (!opts) opts = {}\n\n  const canvasEl = exports.render(qrData, canvas, opts)\n\n  const type = opts.type || 'image/png'\n  const rendererOpts = opts.rendererOpts || {}\n\n  return canvasEl.toDataURL(type, rendererOpts.quality)\n}\n", "const Utils = require('./utils')\n\nfunction getColorAttrib (color, attrib) {\n  const alpha = color.a / 255\n  const str = attrib + '=\"' + color.hex + '\"'\n\n  return alpha < 1\n    ? str + ' ' + attrib + '-opacity=\"' + alpha.toFixed(2).slice(1) + '\"'\n    : str\n}\n\nfunction svgCmd (cmd, x, y) {\n  let str = cmd + x\n  if (typeof y !== 'undefined') str += ' ' + y\n\n  return str\n}\n\nfunction qrToPath (data, size, margin) {\n  let path = ''\n  let moveBy = 0\n  let newRow = false\n  let lineLength = 0\n\n  for (let i = 0; i < data.length; i++) {\n    const col = Math.floor(i % size)\n    const row = Math.floor(i / size)\n\n    if (!col && !newRow) newRow = true\n\n    if (data[i]) {\n      lineLength++\n\n      if (!(i > 0 && col > 0 && data[i - 1])) {\n        path += newRow\n          ? svgCmd('M', col + margin, 0.5 + row + margin)\n          : svgCmd('m', moveBy, 0)\n\n        moveBy = 0\n        newRow = false\n      }\n\n      if (!(col + 1 < size && data[i + 1])) {\n        path += svgCmd('h', lineLength)\n        lineLength = 0\n      }\n    } else {\n      moveBy++\n    }\n  }\n\n  return path\n}\n\nexports.render = function render (qrData, options, cb) {\n  const opts = Utils.getOptions(options)\n  const size = qrData.modules.size\n  const data = qrData.modules.data\n  const qrcodesize = size + opts.margin * 2\n\n  const bg = !opts.color.light.a\n    ? ''\n    : '<path ' + getColorAttrib(opts.color.light, 'fill') +\n      ' d=\"M0 0h' + qrcodesize + 'v' + qrcodesize + 'H0z\"/>'\n\n  const path =\n    '<path ' + getColorAttrib(opts.color.dark, 'stroke') +\n    ' d=\"' + qrToPath(data, size, opts.margin) + '\"/>'\n\n  const viewBox = 'viewBox=\"' + '0 0 ' + qrcodesize + ' ' + qrcodesize + '\"'\n\n  const width = !opts.width ? '' : 'width=\"' + opts.width + '\" height=\"' + opts.width + '\" '\n\n  const svgTag = '<svg xmlns=\"http://www.w3.org/2000/svg\" ' + width + viewBox + ' shape-rendering=\"crispEdges\">' + bg + path + '</svg>\\n'\n\n  if (typeof cb === 'function') {\n    cb(null, svgTag)\n  }\n\n  return svgTag\n}\n", "\nconst canPromise = require('./can-promise')\n\nconst QRCode = require('./core/qrcode')\nconst CanvasRenderer = require('./renderer/canvas')\nconst SvgRenderer = require('./renderer/svg-tag.js')\n\nfunction renderCanvas (renderFunc, canvas, text, opts, cb) {\n  const args = [].slice.call(arguments, 1)\n  const argsNum = args.length\n  const isLastArgCb = typeof args[argsNum - 1] === 'function'\n\n  if (!isLastArgCb && !canPromise()) {\n    throw new Error('Callback required as last argument')\n  }\n\n  if (isLastArgCb) {\n    if (argsNum < 2) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 2) {\n      cb = text\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 3) {\n      if (canvas.getContext && typeof cb === 'undefined') {\n        cb = opts\n        opts = undefined\n      } else {\n        cb = opts\n        opts = text\n        text = canvas\n        canvas = undefined\n      }\n    }\n  } else {\n    if (argsNum < 1) {\n      throw new Error('Too few arguments provided')\n    }\n\n    if (argsNum === 1) {\n      text = canvas\n      canvas = opts = undefined\n    } else if (argsNum === 2 && !canvas.getContext) {\n      opts = text\n      text = canvas\n      canvas = undefined\n    }\n\n    return new Promise(function (resolve, reject) {\n      try {\n        const data = QRCode.create(text, opts)\n        resolve(renderFunc(data, canvas, opts))\n      } catch (e) {\n        reject(e)\n      }\n    })\n  }\n\n  try {\n    const data = QRCode.create(text, opts)\n    cb(null, renderFunc(data, canvas, opts))\n  } catch (e) {\n    cb(e)\n  }\n}\n\nexports.create = QRCode.create\nexports.toCanvas = renderCanvas.bind(null, CanvasRenderer.render)\nexports.toDataURL = renderCanvas.bind(null, CanvasRenderer.renderToDataURL)\n\n// only svg for now.\nexports.toString = renderCanvas.bind(null, function (data, _, opts) {\n  return SvgRenderer.render(data, opts)\n})\n", "/**\n * Embed Configuration Module\n * \n * Handles parsing configuration from script data attributes\n */\n\nimport { EmbedConfig } from '../types/EmbedTypes';\n\n/**\n * Parse configuration from script data attributes\n */\nexport function parseEmbedConfig(scriptElement?: HTMLScriptElement): EmbedConfig {\n  // Get the script element - either passed in or from document.currentScript\n  const script = scriptElement || (document.currentScript as HTMLScriptElement);\n  if (!script) {\n    throw new Error('[Curia] Could not find script element');\n  }\n\n  // Read configuration from data attributes\n  const config: EmbedConfig = {\n    community: script.getAttribute('data-community') || null,\n    theme: (script.getAttribute('data-theme') as 'light' | 'dark' | 'auto') || 'light',\n    backgroundColor: script.getAttribute('data-background-color') || undefined,\n    borderRadius: script.getAttribute('data-border-radius') || undefined,\n    container: script.getAttribute('data-container') || null,\n    height: script.getAttribute('data-height') || '600px',\n    width: script.getAttribute('data-width') || '100%',\n    mode: (script.getAttribute('data-mode') as 'full' | 'auth-only') || 'full'\n  };\n\n  console.log('[Curia] Parsed embed config:', config);\n  console.log('[Curia] Dimensions parsed:', {\n    width: config.width,\n    height: config.height,\n    widthSource: script.getAttribute('data-width') ? 'data-width' : 'default',\n    heightSource: script.getAttribute('data-height') ? 'data-height' : 'default'\n  });\n  return config;\n}\n\n/**\n * Validate embed configuration\n */\nexport function validateEmbedConfig(config: EmbedConfig): void {\n  // Validate theme\n  if (config.theme !== 'light' && config.theme !== 'dark' && config.theme !== 'auto') {\n    console.warn('[Curia] Invalid theme, using light:', config.theme);\n    config.theme = 'light';\n  }\n\n  // Validate background color (if provided)\n  if (config.backgroundColor && !config.backgroundColor.match(/^#[0-9A-Fa-f]{6}$/)) {\n    console.warn('[Curia] Invalid background color format, removing:', config.backgroundColor);\n    config.backgroundColor = undefined;\n  }\n\n  // Validate height format\n  if (config.height && !config.height.match(/^\\d+(px|%|vh|em|rem)$/)) {\n    console.warn('[Curia] Invalid height format, using 600px:', config.height);\n    config.height = '600px';\n  }\n\n  // Validate width format\n  if (config.width && !config.width.match(/^\\d+(px|%|vw|em|rem)$/)) {\n    console.warn('[Curia] Invalid width format, using 100%:', config.width);\n    config.width = '100%';\n  }\n}\n\n/**\n * Generate embed script configuration JavaScript\n */\nexport function generateConfigCode(config: EmbedConfig): string {\n  return `\n  // Get the script element that loaded this code\n  const script = document.currentScript;\n  if (!script) {\n    console.error('[Curia] Could not find script element');\n    return;\n  }\n\n  // Read configuration from data attributes\n  const config = {\n    community: script.getAttribute('data-community') || null,\n    theme: script.getAttribute('data-theme') || 'light',\n    backgroundColor: script.getAttribute('data-background-color') || undefined,\n    borderRadius: script.getAttribute('data-border-radius') || undefined,\n    container: script.getAttribute('data-container') || null,\n    height: script.getAttribute('data-height') || '600px',\n    width: script.getAttribute('data-width') || '100%'\n  };\n\n  console.log('[Curia] Initializing embed with config:', config);\n  `;\n} ", "/**\n * Internal Plugin Host - Self-contained plugin hosting within embed script\n * \n * This class embeds all ClientPluginHost functionality directly into the embed script,\n * making it completely self-contained so customers don't need to implement any logic.\n * \n * Updated to use SessionManager instead of localStorage for session management.\n * \n * Responsibilities:\n * 1. Handle auth completion from embed iframe\n * 2. Manage iframe switching (auth \u2192 forum)\n * 3. Route API requests from forum to host service\n * 4. Maintain auth context throughout session\n */\n\nimport { EmbedConfig } from '../types/EmbedTypes';\nimport { ApiProxyClient } from '@curia_/iframe-api-proxy';\nimport { sessionManager } from '../../SessionManager';\nimport { SessionServiceProxy } from '../services/SessionServiceProxy';\nimport { CommunitySidebar } from '../components';\nimport {\n  AuthenticationService,\n  AuthenticationCallbacks,\n  InternalAuthContext,\n  UserCommunityMembership,\n  UserProfile,\n  MessageRouter,\n  MessageRouterCallbacks,\n  IframeManager,\n  IframeManagerCallbacks\n} from '../services';\n\n// Interface definitions moved to services - imported above\n\nenum InternalMessageType {\n  API_REQUEST = 'api_request',\n  API_RESPONSE = 'api_response',\n  INIT = 'init',\n  ERROR = 'error'\n}\n\n/**\n * Internal plugin message interface\n */\ninterface InternalPluginMessage {\n  type: InternalMessageType;\n  iframeUid: string;\n  requestId: string;\n  method?: string;\n  params?: any;\n  data?: any;\n  error?: string;\n}\n\n/**\n * Get iframe permissions for forum functionality\n */\nfunction getIframePermissions(): string {\n  return [\n    'clipboard-write *',\n    'clipboard-read *', \n    'fullscreen *',\n    'web-share *',\n    'autoplay *',\n    'picture-in-picture *',\n    'payment *',\n    'encrypted-media *',\n    'storage-access *',\n    'camera *',\n    'microphone *',\n    'geolocation *'\n  ].join('; ');\n}\n\n/**\n * Internal Plugin Host - Lean orchestrator using service layer architecture\n * \n * Responsibilities:\n * - Coordinate between services\n * - Manage overall embed lifecycle\n * - Handle UI component composition\n * - Orchestrate phase transitions (auth \u2192 forum)\n */\nexport class InternalPluginHost {\n  // \uD83D\uDE80 FIX: Singleton API proxy to prevent multiple client instances in React Strict Mode\n  private static sharedApiProxy: ApiProxyClient | null = null;\n  \n  // \uD83D\uDE80 FIX: Singleton session service to prevent multiple iframes and proxies\n  private static sharedSessionServiceIframe: HTMLIFrameElement | null = null;\n  private static sharedSessionServiceProxy: SessionServiceProxy | null = null;\n  private static sessionServiceRefCount = 0;\n  \n  /**\n   * Get shared ApiProxyClient instance for embed context\n   */\n  private static getSharedApiProxy(): ApiProxyClient {\n    if (!InternalPluginHost.sharedApiProxy) {\n      console.log('[InternalPluginHost] Creating shared ApiProxyClient singleton');\n      InternalPluginHost.sharedApiProxy = new ApiProxyClient({\n        debug: true,\n        defaultTimeout: 10000,\n        maxRetries: 3\n      });\n    } else {\n      console.log('[InternalPluginHost] Reusing shared ApiProxyClient singleton');\n    }\n    return InternalPluginHost.sharedApiProxy;\n  }\n  \n  /**\n   * Get shared session service (iframe + proxy) for embed context\n   */\n  private static getSharedSessionService(hostServiceUrl: string): { iframe: HTMLIFrameElement; proxy: SessionServiceProxy } {\n    if (!InternalPluginHost.sharedSessionServiceIframe || !InternalPluginHost.sharedSessionServiceProxy) {\n      console.log('[InternalPluginHost] Creating shared session service singleton');\n      \n      // Create hidden session service iframe\n      InternalPluginHost.sharedSessionServiceIframe = document.createElement('iframe');\n      InternalPluginHost.sharedSessionServiceIframe.src = `${hostServiceUrl}/session-service`;\n      InternalPluginHost.sharedSessionServiceIframe.style.display = 'none';\n      InternalPluginHost.sharedSessionServiceIframe.style.position = 'absolute';\n      InternalPluginHost.sharedSessionServiceIframe.style.width = '0px';\n      InternalPluginHost.sharedSessionServiceIframe.style.height = '0px';\n      InternalPluginHost.sharedSessionServiceIframe.style.border = 'none';\n      InternalPluginHost.sharedSessionServiceIframe.setAttribute('data-purpose', 'session-service');\n      InternalPluginHost.sharedSessionServiceIframe.setAttribute('data-curia-iframe', 'true');\n      \n      // Add to document body\n      document.body.appendChild(InternalPluginHost.sharedSessionServiceIframe);\n      \n      // Initialize proxy\n      InternalPluginHost.sharedSessionServiceProxy = new SessionServiceProxy(InternalPluginHost.sharedSessionServiceIframe);\n    } else {\n      console.log('[InternalPluginHost] Reusing shared session service singleton');\n    }\n    \n    InternalPluginHost.sessionServiceRefCount++;\n    console.log(`[InternalPluginHost] Session service ref count: ${InternalPluginHost.sessionServiceRefCount}`);\n    \n    return {\n      iframe: InternalPluginHost.sharedSessionServiceIframe,\n      proxy: InternalPluginHost.sharedSessionServiceProxy\n    };\n  }\n  \n  /**\n   * Clean up shared resources (called when embed is destroyed)\n   */\n  private static cleanupSharedResources(): void {\n    // Clean up API proxy\n    if (InternalPluginHost.sharedApiProxy) {\n      console.log('[InternalPluginHost] Destroying shared ApiProxyClient singleton');\n      InternalPluginHost.sharedApiProxy.destroy();\n      InternalPluginHost.sharedApiProxy = null;\n    }\n    \n    // Clean up session service (with ref counting)\n    InternalPluginHost.sessionServiceRefCount--;\n    console.log(`[InternalPluginHost] Session service ref count: ${InternalPluginHost.sessionServiceRefCount}`);\n    \n    if (InternalPluginHost.sessionServiceRefCount <= 0) {\n      if (InternalPluginHost.sharedSessionServiceProxy) {\n        console.log('[InternalPluginHost] Destroying shared session service singleton');\n        InternalPluginHost.sharedSessionServiceProxy.destroy();\n        InternalPluginHost.sharedSessionServiceProxy = null;\n      }\n      if (InternalPluginHost.sharedSessionServiceIframe && InternalPluginHost.sharedSessionServiceIframe.parentNode) {\n        InternalPluginHost.sharedSessionServiceIframe.parentNode.removeChild(InternalPluginHost.sharedSessionServiceIframe);\n        InternalPluginHost.sharedSessionServiceIframe = null;\n      }\n      console.log('[InternalPluginHost] Session service singleton destroyed');\n    }\n  }\n  private container: HTMLElement;\n  private config: EmbedConfig;\n  private hostServiceUrl: string;\n  private forumUrl: string;\n  \n  // Service Layer - Injected Dependencies\n  private authService: AuthenticationService;\n  private messageRouter: MessageRouter;\n  private iframeManager: IframeManager;\n  private apiProxy: ApiProxyClient;\n  \n  // Session Service - Dedicated iframe for cross-domain session management\n  private sessionServiceIframe: HTMLIFrameElement | null = null;\n  private sessionServiceProxy: SessionServiceProxy | null = null;\n  private sessionServiceSyncTimer: NodeJS.Timeout | null = null;\n  \n  // UI State\n  private communitySidebar: CommunitySidebar | null = null;\n  private embedContainer: HTMLElement | null = null;\n  \n  // Discovery Modal State\n  private discoveryModal: HTMLElement | null = null;\n  private discoveryIframe: HTMLIFrameElement | null = null;\n  \n  // Add Session Modal State\n  private addSessionModal: HTMLElement | null = null;\n  private addSessionIframe: HTMLIFrameElement | null = null;\n  \n  // Multi-iframe community switching\n  private communityIframes: Map<string, HTMLIFrameElement> = new Map();\n  private activeCommunityId: string | null = null;\n  \n  // Community polling for sidebar refresh (covers both initial load and switchCommunity joins)\n  private communityPollingTimer: NodeJS.Timeout | null = null;\n  private lastKnownCommunities: UserCommunityMembership[] = [];\n  \n  // Cross-tab update throttling\n  private lastCrossTabReload: number = 0;\n  private readonly CROSS_TAB_RELOAD_THROTTLE = 2000; // 2 seconds\n  \n  // Signature validation\n  private readonly publicKey: string;\n\n  constructor(container: HTMLElement, config: EmbedConfig, hostServiceUrl: string, forumUrl: string, publicKey: string) {\n    this.container = container;\n    this.config = config;\n    this.hostServiceUrl = hostServiceUrl;\n    this.forumUrl = forumUrl;\n    this.publicKey = publicKey;\n    \n    // \uD83D\uDE80 FIX: Use singleton API proxy to prevent multiple client instances\n    this.apiProxy = InternalPluginHost.getSharedApiProxy();\n    \n    // \uD83D\uDD27 Configure SessionManager with host service URL and API proxy for embed context\n    sessionManager.configure(hostServiceUrl, this.apiProxy);\n    \n    // Initialize services with dependency injection\n    // Note: Create IframeManager first to get UID for MessageRouter\n    this.iframeManager = new IframeManager(\n      hostServiceUrl,\n      forumUrl,\n      this.apiProxy,\n      {\n        onIframeSwitch: this.onIframeSwitch.bind(this)\n      }\n    );\n    \n    this.authService = new AuthenticationService(hostServiceUrl, {\n      onAuthComplete: this.onAuthComplete.bind(this),\n      onSessionSwitch: this.onSessionSwitch.bind(this),\n      onSignOut: this.onSignOut.bind(this),\n      onCrossTabSessionUpdate: this.onCrossTabUpdate.bind(this)\n    }, this.apiProxy);  // \uD83C\uDD95 NEW - Pass API proxy for CSP-compliant calls\n    \n    this.messageRouter = new MessageRouter(\n      this.iframeManager.getUid(),\n      this.apiProxy, // Share the same ApiProxyClient instance!\n      {\n        onAuthComplete: this.onMessageAuthComplete.bind(this),\n        onForumInit: this.onForumInit.bind(this),\n        getAuthContext: () => this.authService.getAuthContext(),\n        onCommunitySwitchRequest: this.handleCommunitySwitchRequest.bind(this),\n        onCommunityDiscoveryComplete: this.handleCommunityDiscoveryComplete.bind(this),\n        onAddSessionComplete: this.handleAddSessionComplete.bind(this),\n        onApiProxyReady: this.onApiProxyReady.bind(this)\n      },\n      publicKey // Pass public key for signature validation\n    );\n    \n    // \uD83D\uDE80 NEW: Initialize dedicated session service iframe for cross-domain session persistence\n    // (async, non-blocking - will sync session data when ready)\n    this.initializeSessionService().catch(error => {\n      console.error('[InternalPluginHost] Session service initialization failed:', error);\n    });\n    \n    // Initialize the embed\n    this.initialize();\n    \n    console.log(`[MULTI-IFRAME] InternalPluginHost initialized with multi-iframe community switching support`);\n  }\n\n  /**\n   * Initialize dedicated session service iframe for cross-domain session persistence\n   */\n  private async initializeSessionService(): Promise<void> {\n    console.log('[InternalPluginHost] Initializing dedicated session service iframe');\n    \n    try {\n      // \uD83D\uDE80 FIX: Use singleton session service to prevent multiple iframes\n      const sessionService = InternalPluginHost.getSharedSessionService(this.hostServiceUrl);\n      this.sessionServiceIframe = sessionService.iframe;\n      this.sessionServiceProxy = sessionService.proxy;\n      \n      console.log('[InternalPluginHost] Session service singleton initialized');\n      \n      // \uD83D\uDE80 NEW: Wait for session service to be ready and sync data to parent SessionManager\n      await this.syncSessionServiceToParent();\n      \n    } catch (error) {\n      console.error('[InternalPluginHost] Failed to initialize session service:', error);\n    }\n  }\n\n  /**\n   * Sync session data from session service to parent SessionManager (explicit integration)\n   */\n  private async syncSessionServiceToParent(): Promise<void> {\n    try {\n      if (!this.sessionServiceProxy) {\n        console.warn('[InternalPluginHost] No session service proxy available for sync');\n        return;\n      }\n\n      console.log('[InternalPluginHost] \uD83D\uDD04 Waiting for session service to be ready...');\n      await this.sessionServiceProxy.waitForReady();\n      \n      console.log('[InternalPluginHost] \uD83D\uDD04 Session service ready, syncing data to parent SessionManager...');\n      \n      // Pull authoritative session data from session service\n      const sessions = await this.sessionServiceProxy.getAllSessions();\n      const activeSession = await this.sessionServiceProxy.getActiveSession();\n      \n      console.log('[InternalPluginHost] \uD83D\uDD04 Retrieved from session service:', sessions.length, 'sessions, active:', activeSession?.userId);\n      \n      // Update parent SessionManager with authoritative data\n      sessionManager.bulkUpdateSessions(sessions);\n      \n      if (activeSession && sessions.some(s => s.sessionToken === activeSession.sessionToken)) {\n        sessionManager.setActiveSession(activeSession.sessionToken);\n        console.log('[InternalPluginHost] \uD83D\uDD04 Active session set to:', activeSession.userId);\n      }\n      \n      console.log('[InternalPluginHost] \u2705 Session service sync completed successfully');\n      \n      // Setup periodic refresh to keep parent in sync with session service\n      this.setupSessionServicePeriodicSync();\n      \n    } catch (error) {\n      console.error('[InternalPluginHost] Failed to sync session service to parent:', error);\n    }\n  }\n\n  /**\n   * Setup periodic sync timer to keep parent SessionManager in sync with session service\n   */\n  private setupSessionServicePeriodicSync(): void {\n    // Clear any existing timer\n    if (this.sessionServiceSyncTimer) {\n      clearInterval(this.sessionServiceSyncTimer);\n    }\n    \n    // Setup new periodic sync (every 30 seconds)\n    this.sessionServiceSyncTimer = setInterval(async () => {\n      try {\n        if (!this.sessionServiceProxy) return;\n        \n        console.log('[InternalPluginHost] \uD83D\uDD04 Periodic session service sync...');\n        const sessions = await this.sessionServiceProxy.getAllSessions();\n        sessionManager.bulkUpdateSessions(sessions);\n        console.log('[InternalPluginHost] \uD83D\uDD04 Periodic sync completed:', sessions.length, 'sessions');\n      } catch (error) {\n        console.warn('[InternalPluginHost] Periodic session sync failed:', error);\n      }\n    }, 30000); // 30 seconds\n    \n    console.log('[InternalPluginHost] \uD83D\uDD04 Periodic session service sync timer established');\n  }\n\n  /**\n   * Initialize the embed - start with auth phase\n   */\n  private initialize(): void {\n    console.log('[InternalPluginHost] Initializing embed');\n    \n    // \uD83C\uDFAF CRITICAL FIX: Apply theme to document early (fixes community sidebar and profile menu)\n    this.applyThemeToDocument();\n    \n    // Setup message listener and cross-tab sync\n    this.messageRouter.setupMessageListener();\n    this.authService.setupCrossTabSessionListener();\n    \n    // Create and display auth iframe\n    this.initializeAuthPhase();\n  }\n\n  /**\n   * Resolve theme from config and system preferences\n   * Extracted from getThemeAwareBackground for reuse\n   */\n  private resolveTheme(): 'light' | 'dark' {\n    let resolvedTheme = this.config.theme || 'light';\n    if (resolvedTheme === 'auto') {\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        resolvedTheme = 'dark';\n      } else {\n        resolvedTheme = 'light';\n      }\n      console.log('[InternalPluginHost] Resolved auto theme to:', resolvedTheme);\n    }\n    return resolvedTheme as 'light' | 'dark';\n  }\n\n  /**\n   * Apply resolved theme to document.documentElement \n   * This fixes community sidebar and profile menu theming by matching Next.js page behavior\n   */\n  private applyThemeToDocument(): void {\n    const resolvedTheme = this.resolveTheme();\n    \n    console.log('[InternalPluginHost] Applying theme to document:', resolvedTheme);\n    \n    // Remove existing theme classes to avoid conflicts\n    document.documentElement.classList.remove('light', 'dark');\n    \n    // Add resolved theme class (matches EmbedThemeProvider behavior)\n    document.documentElement.classList.add(resolvedTheme);\n    \n    console.log('[InternalPluginHost] Document theme applied - sidebar and profile menu should now work correctly');\n  }\n\n  // ============================================================================\n  // SERVICE CALLBACK HANDLERS - Orchestration Logic\n  // ============================================================================\n\n  /**\n   * Handle authentication completion from auth service (with context)\n   */\n  private async onAuthComplete(authData: any, context: InternalAuthContext): Promise<void> {\n    console.log('[InternalPluginHost] Auth completion received from service');\n    if (authData.mode === 'auth-only') {\n      console.log('[InternalPluginHost] Auth-only mode - staying on auth phase');\n      return;\n    }\n    \n    // \uD83C\uDFAF STEP 1: Prepare API proxy with early forum iframe creation\n    console.log('[InternalPluginHost] Step 1: Preparing API proxy server');\n    await this.prepareApiProxy();\n    \n    // \uD83C\uDFAF STEP 2: Initialize community navigation with working API proxy\n    console.log('[InternalPluginHost] Step 2: Fetching community/profile data via API proxy');\n    await this.initializeCommunityNavigation();\n    \n    // \uD83C\uDFAF STEP 3: Complete forum layout setup (sidebar now exists)\n    console.log('[InternalPluginHost] Step 3: Setting up final layout with sidebar');\n    await this.switchToForum();\n  }\n\n  /**\n   * Handle authentication completion from message router (without context)\n   */\n  private async onMessageAuthComplete(authData: any): Promise<void> {\n    console.log('[InternalPluginHost] Auth completion received from message router');\n    \n    // Delegate to auth service handler\n    await this.authService.handleAuthCompletion(authData);\n  }\n\n  /**\n   * Handle session switching from auth service\n   * Performs full embed reload to ensure new session context is properly applied\n   */\n  private async onSessionSwitch(profile: UserProfile): Promise<void> {\n    console.log('[InternalPluginHost] Session switch detected - performing full embed reload');\n    console.log('[InternalPluginHost] New session profile:', profile);\n    \n    // Perform full reload to pick up new session context\n    this.reloadForSessionSwitch();\n  }\n\n  /**\n   * Handle sign out from auth service\n   */\n  private onSignOut(): void {\n    console.log('[InternalPluginHost] Sign out received from service');\n    this.resetToInitialState();\n  }\n\n  /**\n   * Handle cross-tab session updates with throttling\n   */\n  private onCrossTabUpdate(): void {\n    console.log('[InternalPluginHost] Cross-tab update received from service');\n    \n    // Throttle rapid successive cross-tab updates\n    const now = Date.now();\n    if (now - this.lastCrossTabReload < this.CROSS_TAB_RELOAD_THROTTLE) {\n      console.log('[InternalPluginHost] Cross-tab update throttled - too recent');\n      return;\n    }\n\n    // Get current auth context to check if we actually need to reload\n    const currentAuthContext = this.authService.getAuthContext();\n    if (!currentAuthContext) {\n      console.log('[InternalPluginHost] No auth context - skipping cross-tab update');\n      return;\n    }\n\n    // Only reload if we're in the forum phase (have an iframe that needs session updates)\n    const currentIframe = this.iframeManager.getCurrentIframe();\n    if (currentIframe && currentIframe.src.includes('mod=standalone')) {\n      console.log('[InternalPluginHost] Reloading forum iframe due to cross-tab session change');\n      this.lastCrossTabReload = now;\n      this.iframeManager.reloadCurrentIframe();\n    } else {\n      console.log('[InternalPluginHost] Auth phase - no reload needed for cross-tab update');\n    }\n  }\n\n  /**\n   * Handle forum initialization\n   */\n  private onForumInit(): void {\n    console.log('[InternalPluginHost] Forum initialized');\n  }\n\n  /**\n   * Handle iframe switching\n   */\n  private onIframeSwitch(iframe: HTMLIFrameElement, type: 'auth' | 'forum'): void {\n    console.log(`[InternalPluginHost] Iframe switched to: ${type}`, {\n      iframeSrc: iframe.src,\n      hasContentWindow: !!iframe.contentWindow,\n      iframeUid: this.iframeManager.getUid()\n    });\n    \n    // Could add additional logic here for iframe lifecycle management\n    // For now, the services handle the specifics\n  }\n\n  // ============================================================================\n  // ORCHESTRATION METHODS - Compose services for complex operations\n  // ============================================================================\n\n  /**\n   * Prepare API proxy by creating forum iframe (without layout setup)\n   * This ensures the API proxy server is ready before we fetch community/profile data\n   */\n  private async prepareApiProxy(): Promise<void> {\n    console.log('[InternalPluginHost] Preparing API proxy with early forum iframe creation');\n    \n    const authContext = this.authService.getAuthContext();\n    if (!authContext) {\n      console.error('[InternalPluginHost] Cannot prepare API proxy - no auth context');\n      return;\n    }\n\n    // \uD83D\uDE80 FIX: Auto-join user to community if they selected one (first-time user flow)\n    if (authContext.communityId) {\n      console.log(`[InternalPluginHost] Auto-joining user to selected community: ${authContext.communityId}`);\n      await this.autoJoinCommunityOnVisit(authContext.communityId, authContext.userId);\n    }\n\n    // Create forum iframe (hidden) just for API proxy functionality\n    const tempContainer = document.createElement('div');\n    tempContainer.style.display = 'none'; // Hide until full layout\n    this.container.appendChild(tempContainer);\n    \n    // Create forum iframe using service - this sets up the API proxy server\n    const proxyIframe = this.iframeManager.createForumIframe(\n      this.config,\n      authContext,\n      tempContainer\n    );\n    \n    // \uD83C\uDFAF CRITICAL FIX: Wait for API proxy ready notification instead of guessing\n    await this.waitForApiProxyReady(proxyIframe);\n    console.log('[InternalPluginHost] API proxy ready notification received - ready for API calls');\n    \n    // Track this iframe for community switching (using auth context community)\n    if (authContext.communityId) {\n      console.log(`[InternalPluginHost] Tracking proxy iframe for community: ${authContext.communityId}`);\n      this.communityIframes.set(authContext.communityId, proxyIframe);\n      this.activeCommunityId = authContext.communityId;\n    }\n    \n    console.log('[InternalPluginHost] API proxy prepared - forum iframe ready for API calls');\n  }\n\n  // ============================================================================\n  // API PROXY EVENT HANDLERS - Event-driven iframe readiness\n  // ============================================================================\n\n  /**\n   * Handle API proxy ready notification from iframe\n   * Resolves waiting promises when the expected iframe is ready\n   */\n  private apiProxyReadyPromise: Promise<void> | null = null;\n  private apiProxyReadyResolve: (() => void) | null = null;\n\n  private onApiProxyReady(sourceWindow: Window): void {\n    console.log('[InternalPluginHost] API proxy ready notification received');\n    \n    // Resolve the waiting promise if one exists\n    if (this.apiProxyReadyResolve) {\n      this.apiProxyReadyResolve();\n      this.apiProxyReadyResolve = null;\n      this.apiProxyReadyPromise = null;\n    }\n\n    // \uD83D\uDE80 NEW: Trigger SessionManager initial sync now that API proxy is ready\n    sessionManager.triggerInitialSyncWhenReady();\n  }\n\n  /**\n   * Wait for API proxy ready notification from specific iframe\n   * Event-driven replacement for iframe load polling\n   */\n  private waitForApiProxyReady(expectedIframe: HTMLIFrameElement): Promise<void> {\n    if (this.apiProxyReadyPromise) {\n      return this.apiProxyReadyPromise;\n    }\n\n    this.apiProxyReadyPromise = new Promise((resolve) => {\n      this.apiProxyReadyResolve = resolve;\n      \n      // Set a reasonable timeout (should be much faster than before)\n      setTimeout(() => {\n        if (this.apiProxyReadyResolve) {\n          console.warn('[InternalPluginHost] API proxy ready timeout - falling back to old behavior');\n          this.apiProxyReadyResolve();\n          this.apiProxyReadyResolve = null;\n          this.apiProxyReadyPromise = null;\n        }\n      }, 5000); // Much shorter timeout since we expect immediate notification\n    });\n\n    return this.apiProxyReadyPromise;\n  }\n\n  /**\n   * Initialize auth phase - now delegates to IframeManager service\n   */\n  private initializeAuthPhase(): void {\n    console.log('[InternalPluginHost] Initializing auth phase via service');\n    \n    // Apply config dimensions to the main container first\n    this.applyContainerDimensions();\n    \n    // Create auth iframe using service\n    const iframe = this.iframeManager.createAuthIframe(this.config);\n    \n    // Add iframe to container\n    this.container.appendChild(iframe);\n    \n    console.log('[InternalPluginHost] Auth iframe created and added to container');\n  }\n\n  /**\n   * Get theme-aware background color based on config and system preferences\n   */\n  private getThemeAwareBackground(): string {\n    // If background color is explicitly set in config, use that\n    if (this.config.backgroundColor) {\n      return this.config.backgroundColor;\n    }\n    \n    // Use centralized theme resolution\n    const resolvedTheme = this.resolveTheme();\n    \n    // Return theme-appropriate background\n    return resolvedTheme === 'dark' ? '#0f172a' : '#ffffff';\n  }\n\n  /**\n   * Apply config dimensions to the main container element\n   */\n  private applyContainerDimensions(): void {\n    console.log('[InternalPluginHost] Applying container dimensions:', {\n      width: this.config.width,\n      height: this.config.height\n    });\n    \n    // Apply width and height from config to the main container\n    this.container.style.width = this.config.width || '100%';\n    this.container.style.height = this.config.height || '600px';\n    \n    // Ensure the container has proper display properties\n    if (!this.container.style.display) {\n      this.container.style.display = 'block';\n    }\n    \n    // Add border radius if specified\n    if (this.config.borderRadius) {\n      this.container.style.borderRadius = this.config.borderRadius;\n      this.container.style.overflow = 'hidden';\n    }\n    \n    console.log('[InternalPluginHost] Container dimensions applied');\n  }\n\n  /**\n   * Initialize community navigation if user has multiple communities\n   */\n  private async initializeCommunityNavigation(): Promise<void> {\n    console.log('[InternalPluginHost] Initializing community navigation');\n    \n    // Fetch both user communities and profile data from service\n    const [communities, profile] = await Promise.all([\n      this.authService.fetchUserCommunities(),\n      this.authService.fetchUserProfile()\n    ]);\n    \n    // Always show sidebar - adapt content based on community count\n    console.log('[InternalPluginHost] User has', communities.length, 'communities, showing navigation');\n    console.log(`[MULTI-IFRAME] Community navigation initialized - switching enabled for ${communities.length} communities`);\n    \n    // Create community sidebar with user profile and menu action handler\n    this.communitySidebar = new CommunitySidebar({\n      communities,\n      currentCommunityId: this.authService.getAuthContext()?.communityId || '',\n      userProfile: profile,\n      hostServiceUrl: this.hostServiceUrl, // \uD83C\uDFAF Pass host service URL for absolute asset paths\n      onCommunitySelect: (community) => {\n        console.log('[InternalPluginHost] Community selected:', community.name);\n        console.log(`[MULTI-IFRAME] Community selection triggered for: ${community.id} (${community.name})`);\n        this.switchToCommunity(community.id).catch(error => {\n          console.error(`[MULTI-IFRAME] Failed to switch to community ${community.id}:`, error);\n        });\n      },\n      onMenuAction: (action: string) => this.handleMenuAction(action),\n      getIframeStatus: (communityId: string) => this.hasIframeLoaded(communityId),\n      onPlusButtonClick: () => this.openDiscoveryModal(),\n      embedContainer: this.embedContainer || undefined // \uD83C\uDFAF Pass embed container for mobile boundary respect (null \u2192 undefined)\n    });\n\n    // \uD83D\uDE80 REMOVED: Start initial 5-second polling to catch immediate community joins\n    // this.startCommunityPolling('initial'); // REPLACED by auto-join on visit\n  }\n\n  /**\n   * Start 5-second community polling (DRY implementation)\n   * Used for both initial load and switchCommunity scenarios\n   */\n  private startCommunityPolling(reason: 'initial' | 'community-switch'): void {\n    console.log(`[InternalPluginHost] Starting 5-second community polling (${reason})`);\n    \n    // Stop any existing polling first\n    this.stopCommunityPolling();\n    \n    let pollCount = 0;\n    const maxPolls = 5;\n    \n    this.communityPollingTimer = setInterval(async () => {\n      pollCount++;\n      console.log(`[InternalPluginHost] Community refresh poll ${pollCount}/${maxPolls} (${reason})`);\n      \n      try {\n        await this.refreshCommunitySidebar();\n      } catch (error) {\n        console.error('[InternalPluginHost] Failed to refresh communities during polling:', error);\n      }\n      \n      // Stop polling after 5 iterations\n      if (pollCount >= maxPolls) {\n        console.log(`[InternalPluginHost] Polling completed (${reason}), switching to event-driven updates`);\n        this.stopCommunityPolling();\n      }\n    }, 1000); // Poll every second for 5 seconds\n  }\n\n  /**\n   * Stop the community polling timer\n   */\n  private stopCommunityPolling(): void {\n    if (this.communityPollingTimer) {\n      clearInterval(this.communityPollingTimer);\n      this.communityPollingTimer = null;\n    }\n  }\n\n  /**\n   * Refresh the community sidebar with fresh data (with flickering prevention)\n   * Used by both initial polling and switchCommunity events\n   */\n  private async refreshCommunitySidebar(): Promise<void> {\n    if (!this.communitySidebar) {\n      console.log('[InternalPluginHost] Skipping sidebar refresh - sidebar not initialized');\n      return;\n    }\n    \n    try {\n      const freshCommunities = await this.authService.fetchUserCommunities();\n      \n      // \uD83C\uDFAF RACE CONDITION FIX: Check sidebar still exists after async operation\n      if (!this.communitySidebar) {\n        console.log('[InternalPluginHost] Sidebar became null during community fetch - skipping update');\n        return;\n      }\n      \n      // \uD83C\uDFAF FLICKERING FIX: Only update UI if communities actually changed\n      if (this.hasCommunitiesChanged(freshCommunities, this.lastKnownCommunities)) {\n        this.communitySidebar.updateCommunities(freshCommunities);\n        this.lastKnownCommunities = freshCommunities;\n        console.log(`[InternalPluginHost] Sidebar updated with ${freshCommunities.length} communities (changes detected)`);\n      } else {\n        console.log(`[InternalPluginHost] No community changes detected, skipping UI update`);\n      }\n    } catch (error) {\n      console.error('[InternalPluginHost] Failed to refresh community sidebar:', error);\n    }\n  }\n\n  /**\n   * Compare two community arrays to detect actual changes\n   * Prevents unnecessary UI flickering during polling\n   */\n  private hasCommunitiesChanged(\n    newCommunities: UserCommunityMembership[], \n    oldCommunities: UserCommunityMembership[]\n  ): boolean {\n    // Different lengths = definitely changed\n    if (newCommunities.length !== oldCommunities.length) {\n      return true;\n    }\n    \n    // Check if any community IDs are different\n    const newIds = new Set(newCommunities.map(c => c.id));\n    const oldIds = new Set(oldCommunities.map(c => c.id));\n    \n    // Compare sets\n    if (newIds.size !== oldIds.size) return true;\n    \n    for (const id of newIds) {\n      if (!oldIds.has(id)) return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Setup container layout - always use flex layout with sidebar\n   */\n  private setupContainerLayout(): void {\n    // Always create flex container with sidebar + iframe layout\n      this.embedContainer = document.createElement('div');\n      this.embedContainer.className = 'curia-embed-container';\n    \n    // Use config dimensions for the embed container - raw CSS values\n    const configWidth = this.config.width || '100%';\n    const configHeight = this.config.height || '600px';\n    \n    console.log('[InternalPluginHost] Setting up container layout with dimensions:', {\n      width: configWidth,\n      height: configHeight,\n      configHeight: this.config.height\n    });\n    \n          // Get theme-aware background color\n    const themeBackground = this.getThemeAwareBackground();\n    \n    this.embedContainer.style.cssText = `\n      display: flex;\n      width: ${configWidth};\n      height: ${configHeight};\n      background: ${themeBackground};\n      border-radius: ${this.config.borderRadius || '8px'};\n      overflow: hidden;\n      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      position: relative; /* \uD83C\uDFAF Positioning context for mobile modals */\n    `;\n\n    // Add navigation sidebar (always present)\n    const navElement = this.communitySidebar!.render();\n      this.embedContainer.appendChild(navElement);\n\n      // Add iframe container\n      const iframeContainer = document.createElement('div');\n      iframeContainer.className = 'curia-iframe-container';\n          iframeContainer.style.cssText = `\n      flex: 1;\n      display: flex;\n      position: relative;\n      background: ${themeBackground};\n      align-items: stretch;\n    `;\n    \n      this.embedContainer.appendChild(iframeContainer);\n\n        // Replace original container content\n    this.container.innerHTML = '';\n    this.container.appendChild(this.embedContainer);\n    \n    // \uD83C\uDFAF UPDATE SIDEBAR: Pass embedContainer reference for mobile boundary respect\n    if (this.communitySidebar) {\n      this.communitySidebar.updateEmbedContainer(this.embedContainer);\n    }\n  }\n\n  /**\n   * Switch to forum phase using services\n   */\n  private async switchToForum(): Promise<void> {\n    console.log('[InternalPluginHost] Switching to forum phase via services');\n    \n    const authContext = this.authService.getAuthContext();\n    if (!authContext) {\n      console.error('[InternalPluginHost] Cannot switch to forum - no auth context');\n      return;\n    }\n\n    // Setup container layout (sidebar + iframe or just iframe)\n    this.setupContainerLayout();\n\n    // Get the iframe container\n    const iframeContainer = this.embedContainer?.querySelector('.curia-iframe-container') || this.container;\n    \n    // Check if we already have an iframe from prepareApiProxy()\n    const existingIframe = authContext.communityId ? this.communityIframes.get(authContext.communityId) : null;\n    \n    let initialIframe: HTMLIFrameElement;\n    \n    if (existingIframe) {\n      console.log('[InternalPluginHost] Reusing existing forum iframe from API proxy preparation');\n      \n      // Move iframe from temp container to proper layout container\n      const tempContainer = existingIframe.parentElement;\n      if (tempContainer) {\n        tempContainer.removeChild(existingIframe);\n        // Remove the temporary container\n        tempContainer.parentElement?.removeChild(tempContainer);\n      }\n      \n      // Show the iframe and add to proper container\n      existingIframe.style.display = 'block';\n      (iframeContainer as HTMLElement).appendChild(existingIframe);\n      \n      initialIframe = existingIframe;\n    } else {\n      console.log('[InternalPluginHost] Creating new forum iframe (no existing iframe found)');\n      \n      // Create forum iframe using service\n      initialIframe = this.iframeManager.createForumIframe(\n        this.config,\n        authContext,\n        iframeContainer as HTMLElement\n      );\n      \n      // Track the initial forum iframe for community switching\n      if (authContext.communityId) {\n        console.log(`[MULTI-IFRAME] Tracking new forum iframe for community: ${authContext.communityId}`);\n        this.communityIframes.set(authContext.communityId, initialIframe);\n        this.activeCommunityId = authContext.communityId;\n      }\n    }\n    \n    // Ensure API proxy is pointing to the correct iframe (important for reused iframes)\n    this.apiProxy.setActiveIframe(initialIframe);\n    console.log('[InternalPluginHost] API proxy confirmed for final forum iframe');\n    \n    console.log('[InternalPluginHost] Forum phase setup complete');\n  }\n\n  /**\n   * Switch to a specific community with state preservation\n   * Implements the TODO for community switching\n   */\n  private async switchToCommunity(communityId: string): Promise<void> {\n    console.log(`[MULTI-IFRAME] Starting community switch to: ${communityId}`);\n    console.log(`[MULTI-IFRAME] Current active community: ${this.activeCommunityId}`);\n    console.log(`[MULTI-IFRAME] Total community iframes tracked: ${this.communityIframes.size}`);\n\n    // Don't switch if already on this community\n    if (this.activeCommunityId === communityId) {\n      console.log(`[MULTI-IFRAME] Already on community ${communityId}, skipping switch`);\n      return;\n    }\n\n    // Get auth context for building forum URLs\n    const authContext = this.authService.getAuthContext();\n    if (!authContext) {\n      console.error(`[MULTI-IFRAME] No auth context available for community switch`);\n      return;\n    }\n\n    // \uD83D\uDE80 FIX: Always auto-join when switching to community (even if iframe exists)\n    console.log(`[MULTI-IFRAME] Auto-joining user to community: ${communityId}`);\n    await this.autoJoinCommunityOnVisit(communityId, authContext.userId);\n\n    // Get or create iframe for target community\n    let targetIframe = this.communityIframes.get(communityId);\n    \n    if (!targetIframe) {\n      console.log(`[MULTI-IFRAME] Creating new iframe for community: ${communityId}`);\n      targetIframe = await this.createCommunityIframe(communityId, authContext);\n      this.communityIframes.set(communityId, targetIframe);\n      console.log(`[MULTI-IFRAME] New iframe created and stored for community: ${communityId}`);\n    } else {\n      console.log(`[MULTI-IFRAME] Using existing iframe for community: ${communityId}`);\n    }\n\n    // Hide current active iframe if exists\n    if (this.activeCommunityId) {\n      const currentIframe = this.communityIframes.get(this.activeCommunityId);\n      if (currentIframe) {\n        currentIframe.style.display = 'none';\n        console.log(`[MULTI-IFRAME] Hidden iframe for community: ${this.activeCommunityId}`);\n      }\n    }\n\n    // Show target iframe\n    targetIframe.style.display = 'block';\n    console.log(`[MULTI-IFRAME] Showing iframe for community: ${communityId}`);\n\n    // Update API proxy to route to new active iframe\n    this.apiProxy.setActiveIframe(targetIframe);\n    console.log(`[MULTI-IFRAME] API proxy updated to route to community: ${communityId}`);\n\n    // Update internal state\n    this.activeCommunityId = communityId;\n\n    // \u2705 CRITICAL FIX: Update auth context so API requests use correct community\n    this.authService.updateCommunityContext(communityId);\n\n    // Update sidebar active state\n    if (this.communitySidebar) {\n      this.communitySidebar.updateActiveCommunity(communityId);\n      // Refresh online indicators after iframe status might have changed\n      this.communitySidebar.updateOnlineIndicators();\n      console.log(`[MULTI-IFRAME] Sidebar updated to show active community: ${communityId}`);\n    }\n\n    console.log(`[MULTI-IFRAME] Community switch completed successfully to: ${communityId}`);\n  }\n\n  /**\n   * Create a new forum iframe for a specific community\n   * Based on IframeManager.createForumIframe logic but for community switching\n   */\n  private async createCommunityIframe(communityId: string, authContext: InternalAuthContext): Promise<HTMLIFrameElement> {\n    console.log(`[MULTI-IFRAME] Creating iframe for community: ${communityId}`);\n\n    // Get iframe container (same as in switchToForum)\n    const iframeContainer = this.embedContainer?.querySelector('.curia-iframe-container') || this.container;\n\n    // Build forum URL with community-specific parameters (similar to IframeManager.createForumIframe)\n    const forumUrl = new URL(this.iframeManager['forumUrl']); // Access private property\n    forumUrl.searchParams.set('mod', 'standalone');\n    forumUrl.searchParams.set('iframeUid', this.iframeManager.getUid());\n\n    // Add community ID to URL\n    forumUrl.searchParams.set('community', communityId);\n\n    // Theme resolution (copied from IframeManager)\n    let resolvedTheme = this.config.theme || 'light';\n    if (resolvedTheme === 'auto') {\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        resolvedTheme = 'dark';\n      } else {\n        resolvedTheme = 'light';\n      }\n      console.log(`[MULTI-IFRAME] Resolved auto theme to: ${resolvedTheme}`);\n    }\n    \n    forumUrl.searchParams.set('cg_theme', resolvedTheme);\n    if (this.config.backgroundColor) {\n      forumUrl.searchParams.set('cg_bg_color', this.config.backgroundColor);\n    }\n\n    // Add parent URL parameter if community is pre-specified\n    if (this.config.community && this.config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(this.config.parentUrl);\n      forumUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n      console.log(`[MULTI-IFRAME] Adding parent URL for community: ${this.config.parentUrl}`);\n    }\n\n    // Add external parameters to forum URL\n    if (authContext.externalParams) {\n      console.log(`[MULTI-IFRAME] Adding external parameters:`, authContext.externalParams);\n      for (const [key, value] of Object.entries(authContext.externalParams)) {\n        forumUrl.searchParams.set(key, value);\n      }\n    }\n\n    console.log(`[MULTI-IFRAME] Forum URL for community ${communityId}:`, forumUrl.toString());\n\n    // Create iframe element (copied styling from IframeManager.createForumIframe)\n    const iframe = document.createElement('iframe');\n    iframe.src = forumUrl.toString();\n    iframe.style.width = '100%';\n    iframe.style.height = '100%';\n    iframe.style.border = 'none';\n    iframe.style.margin = '0';\n    iframe.style.padding = '0';\n    iframe.style.display = 'none'; // Start hidden\n    iframe.style.verticalAlign = 'top';\n    \n    // Apply border radius (only right side since sidebar is on left)\n    const borderRadius = this.config.borderRadius || '8px';\n    iframe.style.borderRadius = `0 ${borderRadius} ${borderRadius} 0`;\n    \n    // Set security attributes\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', this.getIframePermissions());\n\n    // Add data attributes for debugging\n    iframe.setAttribute('data-community-id', communityId);\n    iframe.setAttribute('data-iframe-uid', this.iframeManager.getUid());\n\n    console.log(`[MULTI-IFRAME] Iframe element created for community: ${communityId}`);\n\n    // Add to DOM\n    (iframeContainer as HTMLElement).appendChild(iframe);\n    console.log(`[MULTI-IFRAME] Iframe added to DOM for community: ${communityId}`);\n\n    return iframe;\n  }\n\n  /**\n   * Get iframe permissions (copied from IframeManager)\n   */\n  private getIframePermissions(): string {\n    return [\n      'clipboard-write *',\n      'clipboard-read *', \n      'fullscreen *',\n      'web-share *',\n      'autoplay *',\n      'picture-in-picture *',\n      'payment *',\n      'encrypted-media *',\n      'storage-access *',\n      'camera *',\n      'microphone *',\n      'geolocation *'\n    ].join('; ');\n  }\n\n  /**\n   * Simple method to check if a community has an iframe loaded\n   */\n  private hasIframeLoaded(communityId: string): boolean {\n    return this.communityIframes.has(communityId);\n  }\n\n  /**\n   * Handle menu actions from community sidebar\n   */\n  private handleMenuAction(action: string): void {\n    console.log('[InternalPluginHost] Menu action:', action);\n    \n    if (action === 'add-session') {\n      this.openAddSessionModal();\n    } else if (action === 'sign-out') {\n      this.authService.signOut();\n    } else if (action.startsWith('switch-session:')) {\n      const sessionToken = action.replace('switch-session:', '');\n      console.log('[InternalPluginHost] Switching to session via SessionServiceProxy:', sessionToken);\n      \n      // \uD83D\uDE80 FIX: Route session switch through SessionServiceProxy + trigger full reload\n      if (this.sessionServiceProxy) {\n        this.sessionServiceProxy.setActiveSession(sessionToken)\n          .then(() => {\n            console.log('[InternalPluginHost] Session updated in service, triggering full reload');\n            this.reloadForSessionSwitch();\n          })\n          .catch(error => {\n            console.error('[InternalPluginHost] Failed to switch session via proxy:', error);\n          });\n      } else {\n        console.warn('[InternalPluginHost] No SessionServiceProxy available, falling back to parent SessionManager');\n        sessionManager.setActiveSession(sessionToken)\n          .then(() => {\n            console.log('[InternalPluginHost] Session updated locally, triggering full reload');\n            this.reloadForSessionSwitch();\n          })\n          .catch(error => {\n            console.error('[InternalPluginHost] Failed to switch session via fallback:', error);\n          });\n      }\n    } else if (action === 'switch-account') {\n      // DEPRECATED: Use session switching in profile menu instead\n      console.log('[InternalPluginHost] Switch account deprecated - use session switching');\n    } else if (action === 'settings') {\n      console.log('[InternalPluginHost] Settings (placeholder)');\n    }\n  }\n\n  /**\n   * Handle community switch requests from forum app\n   */\n  private async handleCommunitySwitchRequest(\n    communityId: string, \n    options?: any\n  ): Promise<any> {\n    console.log(`[InternalPluginHost] Community switch requested: ${communityId}`, options);\n\n    try {\n      // Use existing switchToCommunity logic!\n      await this.switchToCommunity(communityId);\n\n      // \uD83D\uDE80 REMOVED: START POLLING: User will join community during iframe load, so start polling to detect it\n      // this.startCommunityPolling('community-switch'); // REPLACED by auto-join on visit\n\n      const result = {\n        switched: true,\n        communityId: communityId\n      };\n\n      console.log(`[InternalPluginHost] Community switch completed successfully:`, result);\n      return result;\n\n    } catch (error) {\n      console.error(`[InternalPluginHost] Community switch failed:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Open discovery modal with community discovery iframe\n   */\n  private openDiscoveryModal(): void {\n    console.log('[InternalPluginHost] Opening community discovery modal');\n    \n    // Close existing modal if open\n    this.closeDiscoveryModal();\n    \n    // Create modal overlay\n    this.discoveryModal = document.createElement('div');\n    this.discoveryModal.className = 'curia-discovery-modal-overlay';\n    this.discoveryModal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 1000000;\n      backdrop-filter: blur(4px);\n    `;\n    \n    // Create modal content container\n    const modalContent = document.createElement('div');\n    modalContent.className = 'curia-discovery-modal-content';\n    modalContent.style.cssText = `\n      background: white;\n      border-radius: 12px;\n      width: 90%;\n      max-width: 600px;\n      height: 80%;\n      max-height: 700px;\n      position: relative;\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      overflow: hidden;\n    `;\n    \n    // Create close button\n    const closeButton = document.createElement('button');\n    closeButton.innerHTML = '\u00D7';\n    closeButton.style.cssText = `\n      position: absolute;\n      top: 16px;\n      right: 16px;\n      background: rgba(0, 0, 0, 0.1);\n      border: none;\n      border-radius: 50%;\n      width: 32px;\n      height: 32px;\n      font-size: 20px;\n      cursor: pointer;\n      z-index: 10001;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s ease;\n    `;\n    \n    closeButton.addEventListener('mouseenter', () => {\n      closeButton.style.background = 'rgba(0, 0, 0, 0.2)';\n    });\n    closeButton.addEventListener('mouseleave', () => {\n      closeButton.style.background = 'rgba(0, 0, 0, 0.1)';\n    });\n    closeButton.addEventListener('click', () => {\n      this.closeDiscoveryModal();\n    });\n    \n    // Create discovery iframe\n    this.discoveryIframe = document.createElement('iframe');\n    this.discoveryIframe.src = `${this.hostServiceUrl}/embed?mode=community-discovery`;\n    this.discoveryIframe.style.cssText = `\n      width: 100%;\n      height: 100%;\n      border: none;\n      border-radius: 12px;\n    `;\n    this.discoveryIframe.allow = getIframePermissions();\n    \n    // Assemble modal\n    modalContent.appendChild(closeButton);\n    modalContent.appendChild(this.discoveryIframe);\n    this.discoveryModal.appendChild(modalContent);\n    \n    // Close modal on overlay click\n    this.discoveryModal.addEventListener('click', (e) => {\n      if (e.target === this.discoveryModal) {\n        this.closeDiscoveryModal();\n      }\n    });\n    \n    // Add to DOM\n    document.body.appendChild(this.discoveryModal);\n    \n    console.log('[InternalPluginHost] Discovery modal opened successfully');\n  }\n\n  /**\n   * Close discovery modal and cleanup\n   */\n  private closeDiscoveryModal(): void {\n    if (this.discoveryModal) {\n      console.log('[InternalPluginHost] Closing discovery modal');\n      document.body.removeChild(this.discoveryModal);\n      this.discoveryModal = null;\n      this.discoveryIframe = null;\n    }\n  }\n\n  /**\n   * Handle community discovery completion from discovery iframe\n   */\n  private async handleCommunityDiscoveryComplete(discoveryData: any): Promise<void> {\n    console.log('[InternalPluginHost] Community discovery completed:', discoveryData);\n    \n    const { communityId } = discoveryData;\n    \n    try {\n      // 1. Close discovery modal\n      this.closeDiscoveryModal();\n      \n      // 2. Switch to selected community using existing infrastructure\n      // This includes auto-join + sidebar refresh, so no need for duplicate refresh\n      await this.switchToCommunity(communityId);\n      \n      console.log('[InternalPluginHost] Discovery-to-community switch completed');\n    } catch (error) {\n      console.error('[InternalPluginHost] Discovery community switch failed:', error);\n    }\n  }\n\n  /**\n   * Handle add session completion from add-session iframe\n   */\n  private async handleAddSessionComplete(sessionMessage: any): Promise<void> {\n    console.log('[InternalPluginHost] Add session completed:', sessionMessage);\n    \n    const { sessionData } = sessionMessage;\n    \n    try {\n      // 1. Close add session modal\n      this.closeAddSessionModal();\n      \n      // 2. Check if session already exists (profile components create sessions during auth)\n      const existingSession = sessionManager.getSessionByToken(sessionData.sessionToken);\n      \n      if (existingSession) {\n        // Session already exists, just activate it\n        console.log('[InternalPluginHost] \uD83D\uDD27 Session already exists, just activating:', sessionData.sessionToken);\n        await sessionManager.setActiveSession(sessionData.sessionToken);\n      } else {\n        // Session doesn't exist, create it\n        console.log('[InternalPluginHost] \uD83D\uDD27 Creating new session:', sessionData.sessionToken);\n        await sessionManager.addSession({\n          sessionToken: sessionData.sessionToken,\n          userId: sessionData.userId,\n          identityType: sessionData.identityType,\n          walletAddress: sessionData.walletAddress,\n          ensName: sessionData.ensName,\n          upAddress: sessionData.upAddress,\n          name: sessionData.name,\n          profileImageUrl: sessionData.profileImageUrl,\n          expiresAt: new Date(sessionData.expiresAt),\n          isActive: true,\n        });\n      }\n      \n      console.log('[InternalPluginHost] New session activated');\n    } catch (error) {\n      console.error('[InternalPluginHost] Failed to handle new session:', error);\n    }\n  }\n\n  /**\n   * Open add session modal with add-session iframe\n   */\n  private openAddSessionModal(): void {\n    console.log('[InternalPluginHost] Opening add session modal');\n    \n    // Close existing modal if open\n    this.closeAddSessionModal();\n    \n    // Create modal overlay\n    this.addSessionModal = document.createElement('div');\n    this.addSessionModal.className = 'curia-add-session-modal-overlay';\n    this.addSessionModal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 1000000;\n      backdrop-filter: blur(4px);\n    `;\n    \n    // Create modal content container\n    const modalContent = document.createElement('div');\n    modalContent.className = 'curia-add-session-modal-content';\n    modalContent.style.cssText = `\n      background: white;\n      border-radius: 12px;\n      width: 90%;\n      max-width: 600px;\n      height: 80%;\n      max-height: 700px;\n      position: relative;\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      overflow: hidden;\n    `;\n    \n    // Create close button\n    const closeButton = document.createElement('button');\n    closeButton.innerHTML = '\u00D7';\n    closeButton.style.cssText = `\n      position: absolute;\n      top: 16px;\n      right: 16px;\n      background: rgba(0, 0, 0, 0.1);\n      border: none;\n      border-radius: 50%;\n      width: 32px;\n      height: 32px;\n      font-size: 20px;\n      cursor: pointer;\n      z-index: 10001;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s ease;\n    `;\n    \n    closeButton.addEventListener('mouseenter', () => {\n      closeButton.style.background = 'rgba(0, 0, 0, 0.2)';\n    });\n    closeButton.addEventListener('mouseleave', () => {\n      closeButton.style.background = 'rgba(0, 0, 0, 0.1)';\n    });\n    closeButton.addEventListener('click', () => {\n      this.closeAddSessionModal();\n    });\n    \n    // Create add session iframe\n    this.addSessionIframe = document.createElement('iframe');\n    this.addSessionIframe.src = `${this.hostServiceUrl}/embed?mode=add-session`;\n    this.addSessionIframe.style.cssText = `\n      width: 100%;\n      height: 100%;\n      border: none;\n      border-radius: 12px;\n    `;\n    this.addSessionIframe.allow = getIframePermissions();\n    \n    // Assemble modal\n    modalContent.appendChild(closeButton);\n    modalContent.appendChild(this.addSessionIframe);\n    this.addSessionModal.appendChild(modalContent);\n    \n    // Close modal on overlay click\n    this.addSessionModal.addEventListener('click', (e) => {\n      if (e.target === this.addSessionModal) {\n        this.closeAddSessionModal();\n      }\n    });\n    \n    // Add to DOM\n    document.body.appendChild(this.addSessionModal);\n    \n    console.log('[InternalPluginHost] Add session modal opened successfully');\n  }\n\n  /**\n   * Close add session modal and cleanup\n   */\n  private closeAddSessionModal(): void {\n    if (this.addSessionModal) {\n      console.log('[InternalPluginHost] Closing add session modal');\n      document.body.removeChild(this.addSessionModal);\n      this.addSessionModal = null;\n      this.addSessionIframe = null;\n    }\n  }\n\n  /**\n   * Add account: Reset to initial state for new auth\n   */\n  private addAccount(): void {\n    console.log('[InternalPluginHost] Add account - resetting to initial state');\n        this.resetToInitialState();\n  }\n\n  /**\n   * Reload embed for session switching - TRUE FULL RELOAD\n   * Destroys current instance and creates brand new one (like page refresh)\n   */\n  private reloadForSessionSwitch(): void {\n    console.log('[InternalPluginHost] Performing TRUE FULL RELOAD for session switch');\n    console.log('[InternalPluginHost] This will destroy current instance and create fresh one');\n    \n    // Store parameters needed for recreation\n    const container = this.container;\n    const config = { ...this.config }; // \u2705 Create copy to avoid mutation\n    const hostServiceUrl = this.hostServiceUrl;\n    const forumUrl = this.forumUrl;\n    \n    // \uD83C\uDFAF PRESERVE COMMUNITY CONTEXT!\n    if (this.activeCommunityId) {\n      console.log('[InternalPluginHost] Preserving community context:', this.activeCommunityId);\n      config.community = this.activeCommunityId; // \u2705 Override with current community\n    }\n    \n    // 1. Completely destroy current instance (cleanup all state and services)\n    this.destroy();\n    \n    // 2. Create brand new InternalPluginHost instance (fresh start)\n    console.log('[InternalPluginHost] Creating fresh InternalPluginHost instance');\n    const newInstance = new InternalPluginHost(container, config, hostServiceUrl, forumUrl, this.publicKey);\n    \n    // 3. Update global reference if it exists (for window.curiaEmbed.destroy() etc)\n    if (window.curiaEmbed) {\n      console.log('[InternalPluginHost] Updating global curiaEmbed reference');\n      window.curiaEmbed = newInstance;\n    }\n    \n    console.log('[InternalPluginHost] TRUE FULL RELOAD complete - fresh instance will authenticate with new session');\n  }\n\n  /**\n   * Reset to initial state - start over with auth\n   */\n  private resetToInitialState(): void {\n    console.log('[InternalPluginHost] Resetting to initial state');\n    \n    // Clean up iframe-related elements\n    this.iframeManager.cleanupPortalElements();\n    \n    // Reset UI state\n    this.communitySidebar = null;\n    this.embedContainer = null;\n    \n    // Clear session using SessionManager\n    try {\n      sessionManager.removeActiveSession().catch(error => {\n        console.error('[InternalPluginHost] Failed to clear session via SessionManager:', error);\n      });\n      console.log('[InternalPluginHost] Session cleared via SessionManager');\n    } catch (error) {\n      console.error('[InternalPluginHost] SessionManager clear error:', error);\n    }\n    \n    // Recreate clean auth iframe\n    this.container.innerHTML = '';\n    this.initializeAuthPhase();\n    \n    console.log('[InternalPluginHost] Reset to initial state complete');\n  }\n\n  /**\n   * Auto-join user to community on visit (UPSERT pattern)\n   * Eliminates need for polling by creating membership immediately when user visits community\n   */\n  private async autoJoinCommunityOnVisit(communityId: string, userId: string): Promise<boolean> {\n    try {\n      console.log(`[InternalPluginHost] Auto-joining user ${userId} to community ${communityId}`);\n      \n      // Get session token for authentication\n      const authContext = this.authService.getAuthContext();\n      if (!authContext?.sessionToken) {\n        console.error(`[InternalPluginHost] No session token available for auto-join`);\n        return false;\n      }\n      \n      // Use enhanced API proxy with correct parameter order\n      const response = await this.apiProxy.makeAuthenticatedRequest(\n        `/api/communities/${communityId}/auto-join`,\n        authContext.sessionToken,    // token parameter\n        { method: 'POST' }          // options parameter\n      );\n      \n      if (response.success) {\n        // \uD83D\uDD27 Handle both response formats: production (wrapped) vs localhost (unwrapped)\n        const membership = response.data?.membership || response.membership;\n        \n        if (!membership) {\n          console.error(`[InternalPluginHost] Auto-join response missing membership data:`, response);\n          return false;\n        }\n        \n        const { isNewMember, status, visitCount } = membership;\n        \n        // \uD83D\uDE80 FIX: Always refresh sidebar after successful auto-join\n        // This ensures new users see their selected community immediately\n        console.log(`[InternalPluginHost] \uD83D\uDD04 Refreshing sidebar after auto-join response`);\n        await this.refreshCommunitySidebar();\n        \n        if (isNewMember && status === 'active') {\n          console.log(`[InternalPluginHost] \u2705 User auto-joined community: ${communityId}`);\n          return true;\n        } else if (status === 'pending') {\n          console.log(`[InternalPluginHost] \u23F3 User membership pending approval: ${communityId}`);\n          return false;\n        } else {\n          console.log(`[InternalPluginHost] \uD83D\uDD04 User visit updated for community: ${communityId} (visit #${visitCount})`);\n          return false;\n        }\n      }\n      \n      return false;\n    } catch (error) {\n      console.error(`[InternalPluginHost] Auto-join failed for ${communityId}:`, error);\n      // Don't throw - iframe should still load even if auto-join fails\n      return false;\n    }\n  }\n\n  /**\n   * Cleanup when embed is destroyed\n   */\n  public destroy(): void {\n    console.log('[InternalPluginHost] Destroying plugin host');\n    \n    // \uD83D\uDE80 CRITICAL FIX: Stop community polling timer to prevent performance leaks\n    this.stopCommunityPolling();\n    \n    // Destroy services\n    if (this.authService) {\n      this.authService.destroy();\n    }\n    \n    if (this.messageRouter) {\n      this.messageRouter.destroy();\n    }\n    \n    if (this.iframeManager) {\n      this.iframeManager.destroy();\n    }\n    \n    // Destroy community sidebar\n    if (this.communitySidebar) {\n      this.communitySidebar.destroy();\n      this.communitySidebar = null;\n    }\n    \n    // Clean up session service references (singleton will be cleaned by shared resources)\n    if (this.sessionServiceSyncTimer) {\n      clearInterval(this.sessionServiceSyncTimer);\n      this.sessionServiceSyncTimer = null;\n      console.log('[InternalPluginHost] Session service sync timer cleaned up');\n    }\n    this.sessionServiceProxy = null;\n    this.sessionServiceIframe = null;\n    \n    // Clean up community iframes\n    console.log(`[MULTI-IFRAME] Cleaning up ${this.communityIframes.size} community iframes`);\n    this.communityIframes.forEach((iframe, communityId) => {\n      if (iframe.parentNode) {\n        iframe.parentNode.removeChild(iframe);\n      }\n      console.log(`[MULTI-IFRAME] Removed iframe for community: ${communityId}`);\n    });\n    this.communityIframes.clear();\n    this.activeCommunityId = null;\n    console.log(`[MULTI-IFRAME] Community iframe cleanup complete`);\n    \n    // Clear container\n    this.container.innerHTML = '';\n    this.embedContainer = null;\n    \n    // \uD83D\uDE80 FIX: Clean up shared API proxy when instance is destroyed\n    InternalPluginHost.cleanupSharedResources();\n    \n    console.log('[InternalPluginHost] Plugin host destroyed');\n  }\n}\n\n ", "/**\n * SessionManager - Centralized session management for Curia\n * \n * Replaces scattered localStorage usage with a unified system that supports:\n * - Multi-account sessions (ENS, Universal Profile, Anonymous)\n * - Database-backed session persistence\n * - Cross-tab synchronization\n * - Automatic token rotation handling\n * - Bulletproof error recovery\n */\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\nexport interface SessionData {\n  sessionToken: string;\n  userId: string;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress?: string;\n  ensName?: string;\n  upAddress?: string;\n  name?: string;\n  profileImageUrl?: string;\n  expiresAt: Date;\n  lastAccessedAt: Date;\n  isActive: boolean;\n}\n\nexport interface SessionStorage {\n  activeSessions: SessionData[];\n  activeSessionToken: string | null;\n  lastSyncedAt: number;\n  version: number; // For migration handling\n}\n\nexport type SessionChangeListener = (\n  sessions: SessionData[], \n  activeToken: string | null,\n  activeSession: SessionData | null\n) => void;\n\n// ============================================================================\n// CORE SESSION MANAGER CLASS\n// ============================================================================\n\nexport class SessionManager {\n  private static instance: SessionManager;\n  private static readonly STORAGE_KEY = 'curia_sessions';\n  private static readonly LEGACY_TOKEN_KEY = 'curia_session_token';\n  private static readonly STORAGE_VERSION = 1;\n  private static readonly SYNC_INTERVAL = 30_000; // 30 seconds\n  \n  private storage: SessionStorage;\n  private listeners: Set<SessionChangeListener> = new Set();\n  private syncInterval: NodeJS.Timeout | null = null;\n  private isInitialized = false;\n  private hostServiceUrl: string = ''; // Host service URL for API calls\n  private apiProxy: any | null = null; // API proxy for CSP-compliant calls\n\n  private constructor() {\n    this.storage = this.loadFromStorage();\n    this.setupStorageListener();\n    this.setupPeriodicTimer(); // \uD83D\uDE80 FIX: Setup timer only, defer initial sync\n    this.migrateLegacySession();\n    this.isInitialized = true;\n    \n    console.log('[SessionManager] Initialized with', this.storage.activeSessions.length, 'sessions (sync deferred until configured)');\n  }\n\n  public static getInstance(): SessionManager {\n    if (!SessionManager.instance) {\n      SessionManager.instance = new SessionManager();\n    }\n    return SessionManager.instance;\n  }\n\n  /**\n   * Configure the host service URL and API proxy for API calls\n   * Must be called before making any API calls in embed context\n   * \n   * \uD83D\uDE80 FIX: Now triggers initial database sync after configuration\n   */\n  public configure(hostServiceUrl: string, apiProxy?: any): void {\n    this.hostServiceUrl = hostServiceUrl;\n    this.apiProxy = apiProxy || null;\n    console.log('[SessionManager] Configured with host service URL:', hostServiceUrl);\n    if (apiProxy) {\n      console.log('[SessionManager] API proxy configured for CSP-compliant calls');\n    }\n    console.log('[SessionManager] Configuration complete - initial sync deferred until API proxy ready');\n  }\n\n  /**\n   * Trigger initial database sync when API proxy is confirmed ready\n   * Called from InternalPluginHost when 'curia-api-proxy-ready' event is received\n   */\n  public triggerInitialSyncWhenReady(): void {\n    if (!this.hostServiceUrl) {\n      console.warn('[SessionManager] Cannot sync - not configured yet');\n      return;\n    }\n\n    if (this.storage.activeSessions.length > 0) {\n      console.log('[SessionManager] \uD83D\uDE80 Triggering initial database sync (API proxy ready)');\n      this.syncWithDatabase();\n    } else {\n      console.log('[SessionManager] No sessions to sync initially (API proxy ready)');\n    }\n  }\n\n  // ============================================================================\n  // CORE SESSION OPERATIONS\n  // ============================================================================\n\n  /**\n   * Add a new session to the manager\n   */\n  public async addSession(sessionData: Omit<SessionData, 'lastAccessedAt'>): Promise<void> {\n    console.log('[SessionManager] \uD83D\uDD27 addSession called with:', sessionData);\n    \n    try {\n      const session: SessionData = {\n        ...sessionData,\n        lastAccessedAt: new Date(),\n        expiresAt: new Date(sessionData.expiresAt),\n      };\n\n      console.log('[SessionManager] \uD83D\uDD27 Converted session data:', session);\n\n      if (!this.validateSession(session)) {\n        console.error('[SessionManager] \u274C Session validation failed for:', session);\n        throw new Error('Invalid session data provided');\n      }\n\n      console.log('[SessionManager] \u2705 Session validation passed');\n\n      // Remove existing session with same token (if any)\n      this.storage.activeSessions = this.storage.activeSessions.filter(\n        s => s.sessionToken !== session.sessionToken\n      );\n\n      // Add new session\n      this.storage.activeSessions.push(session);\n\n      // Set as active if it's the first session OR if this session should be active\n      if (!this.storage.activeSessionToken || session.isActive) {\n        this.storage.activeSessionToken = session.sessionToken;\n        console.log('[SessionManager] Session set as active:', session.sessionToken);\n      }\n\n      console.log('[SessionManager] \uD83D\uDD27 Sessions before save:', this.storage.activeSessions.length);\n      console.log('[SessionManager] \uD83D\uDD27 Active token before save:', this.storage.activeSessionToken);\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] \u2705 Session added successfully:', session.identityType, session.userId);\n      console.log('[SessionManager] \uD83D\uDD27 Total sessions now:', this.storage.activeSessions.length);\n    } catch (error) {\n      console.error('[SessionManager] Failed to add session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remove a session by token\n   */\n  public async removeSession(sessionToken: string): Promise<void> {\n    try {\n      const sessionExists = this.storage.activeSessions.some(s => s.sessionToken === sessionToken);\n      \n      if (!sessionExists) {\n        console.warn('[SessionManager] Attempted to remove non-existent session:', sessionToken);\n        return;\n      }\n\n      // Remove session\n      this.storage.activeSessions = this.storage.activeSessions.filter(\n        s => s.sessionToken !== sessionToken\n      );\n\n      // Update active session if we removed the active one\n      if (this.storage.activeSessionToken === sessionToken) {\n        this.storage.activeSessionToken = this.storage.activeSessions[0]?.sessionToken || null;\n      }\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Session removed:', sessionToken);\n    } catch (error) {\n      console.error('[SessionManager] Failed to remove session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Set the active session\n   */\n  public async setActiveSession(sessionToken: string): Promise<void> {\n    try {\n      const session = this.getSessionByToken(sessionToken);\n      if (!session) {\n        throw new Error(`Session not found: ${sessionToken}`);\n      }\n\n      if (!session.isActive || session.expiresAt <= new Date()) {\n        throw new Error('Cannot activate expired or inactive session');\n      }\n\n      this.storage.activeSessionToken = sessionToken;\n      \n      // Update last accessed time\n      session.lastAccessedAt = new Date();\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Active session changed:', session.identityType, session.userId);\n    } catch (error) {\n      console.error('[SessionManager] Failed to set active session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remove the active session (logout)\n   */\n  public async removeActiveSession(): Promise<void> {\n    try {\n      if (!this.storage.activeSessionToken) {\n        console.warn('[SessionManager] No active session to remove');\n        return;\n      }\n\n      await this.removeSession(this.storage.activeSessionToken);\n      console.log('[SessionManager] Active session removed (logout)');\n    } catch (error) {\n      console.error('[SessionManager] Failed to remove active session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Clear all sessions (full logout)\n   */\n  public async clearAllSessions(): Promise<void> {\n    try {\n      this.storage.activeSessions = [];\n      this.storage.activeSessionToken = null;\n      this.storage.lastSyncedAt = Date.now();\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] All sessions cleared');\n    } catch (error) {\n      console.error('[SessionManager] Failed to clear all sessions:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Bulk update sessions from session service (used by SessionServiceProxy integration)\n   * Replaces entire session cache with authoritative data from session service\n   */\n  public bulkUpdateSessions(sessions: SessionData[]): void {\n    try {\n      console.log('[SessionManager] \uD83D\uDD04 Bulk updating sessions from session service:', sessions.length, 'sessions');\n      \n      // Validate and sanitize incoming sessions\n      const validSessions = sessions\n        .map(session => ({\n          ...session,\n          expiresAt: new Date(session.expiresAt),\n          lastAccessedAt: new Date(session.lastAccessedAt),\n        }))\n        .filter(this.validateSession);\n\n      console.log('[SessionManager] \uD83D\uDD04 Valid sessions after filtering:', validSessions.length);\n\n      // Track the original active session token to detect actual changes\n      const originalActiveToken = this.storage.activeSessionToken;\n\n      // Update storage with authoritative session data\n      this.storage.activeSessions = validSessions;\n      this.storage.lastSyncedAt = Date.now();\n\n      // Ensure active session token is still valid\n      const activeStillValid = validSessions.some(\n        s => s.sessionToken === this.storage.activeSessionToken\n      );\n\n      if (!activeStillValid) {\n        // Current active session is invalid, set to first available session\n        this.storage.activeSessionToken = validSessions[0]?.sessionToken || null;\n        console.log('[SessionManager] \uD83D\uDD04 Active session updated to:', this.storage.activeSessionToken);\n      }\n\n      this.saveToStorage();\n\n      // \uD83D\uDE80 FIX: Only notify listeners if the active session token actually changed\n      // This prevents background sync from triggering unwanted session switch reloads\n      if (this.storage.activeSessionToken !== originalActiveToken) {\n        console.log('[SessionManager] \uD83D\uDD04 Active session token changed during bulk update, notifying listeners');\n        this.notifyListeners();\n      } else {\n        console.log('[SessionManager] \uD83D\uDD04 Bulk update completed, no active session change detected');\n      }\n\n      console.log('[SessionManager] \u2705 Bulk update completed:', validSessions.length, 'sessions, active:', this.storage.activeSessionToken);\n    } catch (error) {\n      console.error('[SessionManager] Failed to bulk update sessions:', error);\n      throw error;\n    }\n  }\n\n  // ============================================================================\n  // GETTERS\n  // ============================================================================\n\n  public getActiveSession(): SessionData | null {\n    if (!this.storage.activeSessionToken) return null;\n    \n    const session = this.getSessionByToken(this.storage.activeSessionToken);\n    if (!session || !session.isActive || session.expiresAt <= new Date()) {\n      // Clean up expired or invalid active session\n      this.storage.activeSessionToken = null;\n      this.saveToStorage();\n      return null;\n    }\n    \n    return session;\n  }\n\n  public getActiveToken(): string | null {\n    const activeSession = this.getActiveSession();\n    return activeSession?.sessionToken || null;\n  }\n\n  public getAllSessions(): SessionData[] {\n    // Filter out expired sessions\n    const validSessions = this.storage.activeSessions.filter(\n      session => session.isActive && session.expiresAt > new Date()\n    );\n\n    // Update storage if we filtered out expired sessions\n    if (validSessions.length !== this.storage.activeSessions.length) {\n      this.storage.activeSessions = validSessions;\n      this.saveToStorage();\n    }\n\n    return validSessions;\n  }\n\n  public getSessionByToken(token: string): SessionData | null {\n    return this.storage.activeSessions.find(s => s.sessionToken === token) || null;\n  }\n\n  public getSessionsByIdentityType(type: 'ens' | 'universal_profile' | 'anonymous'): SessionData[] {\n    return this.getAllSessions().filter(s => s.identityType === type);\n  }\n\n  public isAuthenticated(): boolean {\n    return this.getActiveSession() !== null;\n  }\n\n  // ============================================================================\n  // REACTIVITY & EVENTS\n  // ============================================================================\n\n  public subscribe(callback: SessionChangeListener): () => void {\n    this.listeners.add(callback);\n    \n    // Immediately call with current state\n    if (this.isInitialized) {\n      callback(this.getAllSessions(), this.getActiveToken(), this.getActiveSession());\n    }\n    \n    return () => {\n      this.listeners.delete(callback);\n    };\n  }\n\n  private notifyListeners(): void {\n    const sessions = this.getAllSessions();\n    const activeToken = this.getActiveToken();\n    const activeSession = this.getActiveSession();\n    \n    this.listeners.forEach(callback => {\n      try {\n        callback(sessions, activeToken, activeSession);\n      } catch (error) {\n        console.error('[SessionManager] Listener error:', error);\n      }\n    });\n  }\n\n  // ============================================================================\n  // PERSISTENCE & STORAGE\n  // ============================================================================\n\n  private loadFromStorage(): SessionStorage {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, using default storage');\n        return this.getDefaultStorage();\n      }\n\n      const stored = localStorage.getItem(SessionManager.STORAGE_KEY);\n      if (!stored) {\n        return this.getDefaultStorage();\n      }\n\n      const parsed: SessionStorage = JSON.parse(stored);\n      \n      // Validate and sanitize storage\n      return this.sanitizeStorage(parsed);\n    } catch (error) {\n      console.error('[SessionManager] Failed to load from storage, using defaults:', error);\n      return this.getDefaultStorage();\n    }\n  }\n\n  private saveToStorage(): void {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, skipping storage save');\n        return;\n      }\n\n      const serialized = JSON.stringify({\n        ...this.storage,\n        lastSyncedAt: Date.now(),\n      });\n      \n      localStorage.setItem(SessionManager.STORAGE_KEY, serialized);\n    } catch (error) {\n      if (error instanceof DOMException && error.code === 22) {\n        console.error('[SessionManager] localStorage quota exceeded, clearing old sessions');\n        this.handleStorageQuotaExceeded();\n      } else {\n        console.error('[SessionManager] Failed to save to storage:', error);\n      }\n    }\n  }\n\n  private getDefaultStorage(): SessionStorage {\n    return {\n      activeSessions: [],\n      activeSessionToken: null,\n      lastSyncedAt: Date.now(),\n      version: SessionManager.STORAGE_VERSION,\n    };\n  }\n\n  private sanitizeStorage(storage: SessionStorage): SessionStorage {\n    try {\n      // Ensure version compatibility\n      if (!storage.version || storage.version < SessionManager.STORAGE_VERSION) {\n        console.log('[SessionManager] Migrating storage to version', SessionManager.STORAGE_VERSION);\n        storage.version = SessionManager.STORAGE_VERSION;\n      }\n\n      // Validate and filter sessions\n      const validSessions = (storage.activeSessions || [])\n        .map(session => ({\n          ...session,\n          expiresAt: new Date(session.expiresAt),\n          lastAccessedAt: new Date(session.lastAccessedAt),\n        }))\n        .filter(this.validateSession);\n\n      // Ensure active session is still valid\n      const activeStillValid = validSessions.some(\n        s => s.sessionToken === storage.activeSessionToken\n      );\n\n      return {\n        activeSessions: validSessions,\n        activeSessionToken: activeStillValid \n          ? storage.activeSessionToken \n          : (validSessions[0]?.sessionToken || null),\n        lastSyncedAt: storage.lastSyncedAt || Date.now(),\n        version: SessionManager.STORAGE_VERSION,\n      };\n    } catch (error) {\n      console.error('[SessionManager] Storage sanitization failed:', error);\n      return this.getDefaultStorage();\n    }\n  }\n\n  private validateSession(session: SessionData): boolean {\n    try {\n      return (\n        typeof session.sessionToken === 'string' &&\n        session.sessionToken.length > 10 &&\n        typeof session.userId === 'string' &&\n        session.userId.length > 0 &&\n        ['ens', 'universal_profile', 'anonymous'].includes(session.identityType) &&\n        session.expiresAt instanceof Date &&\n        session.expiresAt > new Date() &&\n        typeof session.isActive === 'boolean' &&\n        session.isActive\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  private handleStorageQuotaExceeded(): void {\n    try {\n      // Remove oldest sessions first, keeping at least the active one\n      const sorted = this.storage.activeSessions.sort(\n        (a, b) => a.lastAccessedAt.getTime() - b.lastAccessedAt.getTime()\n      );\n\n      const activeToken = this.storage.activeSessionToken;\n      const keepSessions = sorted.filter(s => s.sessionToken === activeToken).slice(-3); // Keep last 3\n      \n      this.storage.activeSessions = keepSessions;\n      this.saveToStorage();\n      \n      console.log('[SessionManager] Cleaned up old sessions due to storage quota');\n    } catch (error) {\n      console.error('[SessionManager] Failed to handle storage quota:', error);\n      \n      // Last resort: clear everything (browser-only)\n      if (typeof window !== 'undefined') {\n        localStorage.removeItem(SessionManager.STORAGE_KEY);\n      }\n      this.storage = this.getDefaultStorage();\n    }\n  }\n\n  // ============================================================================\n  // CROSS-TAB SYNCHRONIZATION\n  // ============================================================================\n\n  private setupStorageListener(): void {\n    if (typeof window === 'undefined') return;\n\n    // Listen for localStorage changes from other tabs\n    window.addEventListener('storage', (e) => {\n      if (e.key === SessionManager.STORAGE_KEY && e.newValue) {\n        try {\n          const newStorage: SessionStorage = JSON.parse(e.newValue);\n          this.storage = this.sanitizeStorage(newStorage);\n          this.notifyListeners();\n          console.log('[SessionManager] Cross-tab sync: Session state updated from other tab');\n        } catch (error) {\n          console.error('[SessionManager] Cross-tab sync failed:', error);\n        }\n      }\n    });\n\n    // Listen for custom session events (same-tab updates)\n    window.addEventListener('curia-session-change', () => {\n      this.storage = this.loadFromStorage();\n      this.notifyListeners();\n    });\n  }\n\n  private broadcastChange(): void {\n    if (typeof window !== 'undefined') {\n      window.dispatchEvent(new CustomEvent('curia-session-change', {\n        detail: {\n          activeToken: this.getActiveToken(),\n          sessionCount: this.storage.activeSessions.length,\n        }\n      }));\n    }\n  }\n\n  // ============================================================================\n  // DATABASE SYNCHRONIZATION\n  // ============================================================================\n\n  /**\n   * Setup periodic sync timer (without initial sync)\n   * \uD83D\uDE80 FIX: Renamed from setupPeriodicSync to be more explicit\n   */\n  private setupPeriodicTimer(): void {\n    if (typeof window === 'undefined') return;\n\n    // \uD83D\uDE80 FIX: Only set up the periodic timer, don't sync immediately\n    // Initial sync will be triggered by configure() when ready\n    this.syncInterval = setInterval(() => {\n      if (this.storage.activeSessions.length > 0) {\n        this.syncWithDatabase();\n      }\n    }, SessionManager.SYNC_INTERVAL);\n    \n    console.log('[SessionManager] Periodic sync timer setup (initial sync deferred)');\n  }\n\n  /**\n   * Sync localStorage sessions with database\n   * Ensures sessions remain up to date across browser sessions\n   * \n   * =============================================================================\n   * \uD83D\uDE80 Enhanced API Proxy Integration\n   * =============================================================================\n   * \n   * When running in CSP-restricted environments (like external embeds), this\n   * method uses the enhanced iframe-api-proxy to make authenticated requests.\n   * \n   * OLD (complex, forced format):\n   * const requestData = { method: 'getSessions', userId: '', communityId: '', params: { sessionToken } };\n   * const response = await this.apiProxy.makeApiRequest(requestData);\n   * \n   * NEW (clean, semantic):\n   * const sessions = await this.apiProxy.makeAuthenticatedRequest('/api/auth/sessions', token);\n   * \n   * This provides:\n   * - \u2705 Proper HTTP semantics (GET with Authorization header)\n   * - \u2705 Clean, readable code\n   * - \u2705 No artificial userId/communityId placeholders\n   * - \u2705 CSP compliance through iframe proxy\n   * - \u2705 Automatic fallback to direct fetch when proxy unavailable\n   * \n   * =============================================================================\n   */\n  public async syncWithDatabase(): Promise<void> {\n    try {\n      const activeToken = this.getActiveToken();\n      if (!activeToken) {\n        console.log('[SessionManager] No active session for database sync');\n        return;\n      }\n\n      let dbSessions: SessionData[] = [];\n\n      // Use API proxy if available (embed context with CSP), otherwise direct fetch\n      if (this.apiProxy) {\n        console.log('[SessionManager] Using API proxy for database sync (CSP-compliant)');\n        \n        try {\n          // \uD83D\uDE80 NEW: Use clean authenticated request API\n          const response = await this.apiProxy.makeAuthenticatedRequest('/api/auth/sessions', activeToken);\n          \n          // Extract data from ApiResponse format\n          dbSessions = response.success ? response.data : [];\n          console.log('[SessionManager] API proxy database sync success:', dbSessions.length, 'sessions');\n        } catch (proxyError) {\n          console.warn('[SessionManager] API proxy database sync error:', proxyError);\n          return;\n        }\n      } else {\n        // Fallback to direct fetch for regular app usage\n        console.log('[SessionManager] Using direct fetch for database sync');\n        \n        const apiUrl = this.hostServiceUrl ? `${this.hostServiceUrl}/api/auth/sessions` : '/api/auth/sessions';\n        \n        const response = await fetch(apiUrl, {\n          method: 'GET',\n          headers: {\n            'Authorization': `Bearer ${activeToken}`,\n            'Content-Type': 'application/json',\n          },\n        });\n\n        if (!response.ok) {\n          console.warn('[SessionManager] Database sync failed:', response.status, response.statusText);\n          return;\n        }\n\n        dbSessions = await response.json();\n      }\n      \n      // Merge database sessions with localStorage cache\n      const mergedSessions = this.mergeSessionStates(this.storage.activeSessions, dbSessions);\n      \n      this.storage.activeSessions = mergedSessions;\n      this.storage.lastSyncedAt = Date.now();\n      this.saveToStorage();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Database sync completed:', mergedSessions.length, 'sessions');\n    } catch (error) {\n      console.error('[SessionManager] Database sync error:', error);\n      // Graceful degradation - continue with localStorage cache\n    }\n  }\n\n  private mergeSessionStates(localSessions: SessionData[], dbSessions: SessionData[]): SessionData[] {\n    const sessionMap = new Map<string, SessionData>();\n\n    // Start with database sessions (source of truth for metadata)\n    for (const session of dbSessions) {\n      sessionMap.set(session.sessionToken, {\n        ...session,\n        expiresAt: new Date(session.expiresAt),\n        lastAccessedAt: new Date(session.lastAccessedAt),\n      });\n    }\n\n    // Override with localStorage cache for active session context\n    for (const session of localSessions) {\n      const existing = sessionMap.get(session.sessionToken);\n      if (existing) {\n        // Keep database metadata but preserve localStorage context\n        sessionMap.set(session.sessionToken, {\n          ...existing,\n          lastAccessedAt: session.lastAccessedAt, // Keep local access time\n        });\n      } else {\n        // \uD83D\uDD25 FIX: Keep new sessions that aren't in database yet\n        console.log('[SessionManager] \uD83D\uDD27 Preserving local session not yet in database:', session.sessionToken);\n        sessionMap.set(session.sessionToken, session);\n      }\n    }\n\n    return Array.from(sessionMap.values());\n  }\n\n  // ============================================================================\n  // LEGACY MIGRATION\n  // ============================================================================\n\n  private migrateLegacySession(): void {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, skipping legacy migration');\n        return;\n      }\n\n      const legacyToken = localStorage.getItem(SessionManager.LEGACY_TOKEN_KEY);\n      if (!legacyToken || this.storage.activeSessions.length > 0) {\n        return; // No migration needed\n      }\n\n      console.log('[SessionManager] Migrating legacy session token');\n\n      // Create a placeholder session that will be validated by the next database sync\n      const legacySession: SessionData = {\n        sessionToken: legacyToken,\n        userId: 'legacy-migration', // Will be updated by database sync\n        identityType: 'anonymous', // Will be updated by database sync\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n        lastAccessedAt: new Date(),\n        isActive: true,\n      };\n\n      this.storage.activeSessions = [legacySession];\n      this.storage.activeSessionToken = legacyToken;\n      this.saveToStorage();\n\n      // Remove legacy token\n      localStorage.removeItem(SessionManager.LEGACY_TOKEN_KEY);\n      \n      // Trigger immediate database sync to validate and populate session data\n      this.syncWithDatabase();\n\n      console.log('[SessionManager] Legacy session migration completed');\n    } catch (error) {\n      console.error('[SessionManager] Legacy migration failed:', error);\n    }\n  }\n\n  // ============================================================================\n  // CLEANUP\n  // ============================================================================\n\n  public destroy(): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n    }\n    this.listeners.clear();\n    console.log('[SessionManager] Destroyed');\n  }\n}\n\n// ============================================================================\n// SINGLETON INSTANCE & CONVENIENCE EXPORTS\n// ============================================================================\n\nexport const sessionManager = SessionManager.getInstance();\n\n// Convenience functions for simple use cases\nexport const getSessionToken = (): string | null => sessionManager.getActiveToken();\nexport const setSessionToken = (sessionData: Omit<SessionData, 'lastAccessedAt'>): Promise<void> => sessionManager.addSession(sessionData);\nexport const clearSessionToken = (): Promise<void> => sessionManager.removeActiveSession();\nexport const isAuthenticated = (): boolean => sessionManager.isAuthenticated(); ", "interface PendingRequest {\n  resolve: (value: any) => void;\n  reject: (error: Error) => void;\n  timeout: NodeJS.Timeout;\n}\n\nexport class SessionServiceProxy {\n  private iframe: HTMLIFrameElement;\n  private pendingRequests: Map<string, PendingRequest> = new Map();\n  private isReady = false;\n  private readyPromise: Promise<void>;\n  private readyResolve: (() => void) | null = null;\n\n  constructor(iframe: HTMLIFrameElement) {\n    this.iframe = iframe;\n    \n    // Setup ready promise\n    this.readyPromise = new Promise((resolve) => {\n      this.readyResolve = resolve;\n    });\n\n    // Listen for responses\n    window.addEventListener('message', this.handleMessage.bind(this));\n  }\n\n  public async waitForReady(): Promise<void> {\n    return this.readyPromise;\n  }\n\n  public async addSession(session: any): Promise<void> {\n    return this.sendRequest('addSession', { session });\n  }\n\n  public async removeSession(sessionId: string): Promise<void> {\n    return this.sendRequest('removeSession', { sessionId });\n  }\n\n  public async syncWithDatabase(): Promise<any> {\n    return this.sendRequest('syncWithDatabase');\n  }\n\n  public async getAllSessions(): Promise<any[]> {\n    return this.sendRequest('getAllSessions');\n  }\n\n  public async getActiveSession(): Promise<any> {\n    return this.sendRequest('getActiveSession');\n  }\n\n  public async setActiveSession(sessionId: string): Promise<void> {\n    return this.sendRequest('setActiveSession', { sessionId });\n  }\n\n  private async sendRequest(operation: string, data?: any): Promise<any> {\n    await this.waitForReady();\n\n    const requestId = this.generateRequestId();\n    \n    return new Promise((resolve, reject) => {\n      // Setup timeout\n      const timeout = setTimeout(() => {\n        this.pendingRequests.delete(requestId);\n        reject(new Error(`Session service request timeout: ${operation}`));\n      }, 10000);\n\n      this.pendingRequests.set(requestId, { resolve, reject, timeout });\n\n      // Send message to iframe\n      this.iframe.contentWindow?.postMessage({\n        type: 'session-operation',\n        operation,\n        data,\n        requestId\n      }, '*');\n    });\n  }\n\n  private handleMessage(event: MessageEvent): void {\n    if (!event.data) return;\n\n    // Handle ready notification\n    if (event.data.type === 'session-service-ready') {\n      console.log('[SessionServiceProxy] Session service is ready');\n      this.isReady = true;\n      if (this.readyResolve) {\n        this.readyResolve();\n        this.readyResolve = null;\n      }\n      return;\n    }\n\n    // Handle operation responses\n    if (event.data.type === 'session-operation-response') {\n      const { requestId, success, data, error } = event.data;\n      const pendingRequest = this.pendingRequests.get(requestId);\n      \n      if (pendingRequest) {\n        clearTimeout(pendingRequest.timeout);\n        this.pendingRequests.delete(requestId);\n        \n        if (success) {\n          pendingRequest.resolve(data);\n        } else {\n          pendingRequest.reject(new Error(error || 'Unknown session service error'));\n        }\n      }\n    }\n  }\n\n  private generateRequestId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  public destroy(): void {\n    // Clear any pending requests\n    this.pendingRequests.forEach((request) => {\n      clearTimeout(request.timeout);\n      request.reject(new Error('Session service proxy destroyed'));\n    });\n    this.pendingRequests.clear();\n\n    window.removeEventListener('message', this.handleMessage.bind(this));\n  }\n} ", "/**\n * Gradient utilities for community icons\n * Extracted from InternalPluginHost.ts for better maintainability\n */\n\n/**\n * Get gradient class based on community name\n */\nexport function getGradientClass(name: string): string {\n  // Simple hash function to get consistent gradient based on name\n  let hash = 0;\n  for (let i = 0; i < name.length; i++) {\n    const char = name.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  // Map to gradient classes (8 beautiful gradients)\n  const gradients = [\n    'gradient-blue',     // Blue to indigo\n    'gradient-purple',   // Purple to pink\n    'gradient-green',    // Green to teal\n    'gradient-orange',   // Orange to red\n    'gradient-cyan',     // Cyan to blue\n    'gradient-pink',     // Pink to rose\n    'gradient-yellow',   // Yellow to orange\n    'gradient-teal'      // Teal to green\n  ];\n\n  return gradients[Math.abs(hash) % gradients.length];\n}\n\n/**\n * Get CSS gradient style for a gradient class\n */\nexport function getGradientStyle(gradientClass: string): string {\n  const gradientMap: Record<string, string> = {\n    'gradient-blue': 'linear-gradient(135deg, #3b82f6 0%, #6366f1 100%)',\n    'gradient-purple': 'linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%)',\n    'gradient-green': 'linear-gradient(135deg, #10b981 0%, #06b6d4 100%)',\n    'gradient-orange': 'linear-gradient(135deg, #f59e0b 0%, #ef4444 100%)',\n    'gradient-cyan': 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\n    'gradient-pink': 'linear-gradient(135deg, #ec4899 0%, #f43f5e 100%)',\n    'gradient-yellow': 'linear-gradient(135deg, #eab308 0%, #f59e0b 100%)',\n    'gradient-teal': 'linear-gradient(135deg, #14b8a6 0%, #10b981 100%)'\n  };\n\n  return gradientMap[gradientClass] || gradientMap['gradient-blue'];\n}\n\n/**\n * All available gradient classes for reference\n */\nexport const GRADIENT_CLASSES = [\n  'gradient-blue',\n  'gradient-purple', \n  'gradient-green',\n  'gradient-orange',\n  'gradient-cyan',\n  'gradient-pink',\n  'gradient-yellow',\n  'gradient-teal'\n] as const;\n\nexport type GradientClass = typeof GRADIENT_CLASSES[number]; ", "/**\n * Lucide Icons Utility\n * Beautiful, consistent SVG icons for the mobile navigation\n * All icons are 24x24 and support CSS theming via currentColor\n */\n\nexport interface IconOptions {\n  size?: number;\n  className?: string;\n  color?: string;\n}\n\n/**\n * Render an SVG icon with consistent styling\n */\nfunction renderIcon(svgContent: string, options: IconOptions = {}): string {\n  const { size = 20, className = '', color = 'currentColor' } = options;\n  \n  return `<svg \n    width=\"${size}\" \n    height=\"${size}\" \n    viewBox=\"0 0 24 24\" \n    fill=\"none\" \n    stroke=\"${color}\" \n    stroke-width=\"2\" \n    stroke-linecap=\"round\" \n    stroke-linejoin=\"round\"\n    class=\"lucide-icon ${className}\"\n    style=\"display: inline-block; vertical-align: middle;\"\n  >${svgContent}</svg>`;\n}\n\n/**\n * Mobile Navigation Icons\n */\nexport const MobileIcons = {\n  // Search - magnifying glass\n  search: (options?: IconOptions) => renderIcon(\n    '<circle cx=\"11\" cy=\"11\" r=\"8\"/><path d=\"m21 21-4.35-4.35\"/>',\n    options\n  ),\n\n  // Messages - message square  \n  messages: (options?: IconOptions) => renderIcon(\n    '<path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/>',\n    options\n  ),\n\n  // Notifications - bell\n  notifications: (options?: IconOptions) => renderIcon(\n    '<path d=\"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9\"/><path d=\"M10.3 21a1.94 1.94 0 0 0 3.4 0\"/>',\n    options\n  ),\n\n  // Chevron Down - for collapse\n  chevronDown: (options?: IconOptions) => renderIcon(\n    '<path d=\"m6 9 6 6 6-6\"/>',\n    options\n  ),\n\n  // Chevron Up - for expand  \n  chevronUp: (options?: IconOptions) => renderIcon(\n    '<path d=\"m18 15-6-6-6 6\"/>',\n    options\n  )\n};\n\n/**\n * Get icon HTML string for direct innerHTML usage\n */\nexport function getIconHTML(iconName: keyof typeof MobileIcons, options?: IconOptions): string {\n  return MobileIcons[iconName](options);\n}\n\n// ==========================================\n// EXISTING COMMUNITY ICON FUNCTIONS\n// (Preserving original functionality)\n// ==========================================\n\n/**\n * Get emoji icon for community based on name\n */\nexport function getIconForCommunity(name: string): string {\n  // Clean the name for better matching\n  const cleanName = name.toLowerCase().trim();\n  \n  // Direct matches for common terms\n  if (cleanName.includes('dev') || cleanName.includes('code') || cleanName.includes('tech')) return '\uD83D\uDCBB';\n  if (cleanName.includes('art') || cleanName.includes('design') || cleanName.includes('creative')) return '\uD83C\uDFA8';\n  if (cleanName.includes('music') || cleanName.includes('audio') || cleanName.includes('sound')) return '\uD83C\uDFB5';\n  if (cleanName.includes('game') || cleanName.includes('gaming') || cleanName.includes('play')) return '\uD83C\uDFAE';\n  if (cleanName.includes('book') || cleanName.includes('read') || cleanName.includes('literature')) return '\uD83D\uDCDA';\n  if (cleanName.includes('food') || cleanName.includes('cook') || cleanName.includes('recipe')) return '\uD83C\uDF7D\uFE0F';\n  if (cleanName.includes('travel') || cleanName.includes('explore') || cleanName.includes('adventure')) return '\uD83C\uDF0D';\n  if (cleanName.includes('fitness') || cleanName.includes('gym') || cleanName.includes('workout')) return '\uD83D\uDCAA';\n  if (cleanName.includes('photo') || cleanName.includes('camera') || cleanName.includes('picture')) return '\uD83D\uDCF8';\n  if (cleanName.includes('film') || cleanName.includes('movie') || cleanName.includes('cinema')) return '\uD83C\uDFAC';\n  if (cleanName.includes('science') || cleanName.includes('research') || cleanName.includes('lab')) return '\uD83D\uDD2C';\n  if (cleanName.includes('crypto') || cleanName.includes('bitcoin') || cleanName.includes('blockchain')) return '\u20BF';\n  if (cleanName.includes('nft') || cleanName.includes('collectible') || cleanName.includes('token')) return '\uD83D\uDDBC\uFE0F';\n  if (cleanName.includes('dao') || cleanName.includes('governance') || cleanName.includes('vote')) return '\uD83C\uDFDB\uFE0F';\n  if (cleanName.includes('defi') || cleanName.includes('finance') || cleanName.includes('trading')) return '\uD83D\uDCB0';\n  \n  // Fallback based on first letter hash\n  const icons = [\n    '\uD83D\uDE80', '\u2B50', '\uD83C\uDF1F', '\u2728', '\uD83D\uDD25', '\u26A1', '\uD83D\uDC8E', '\uD83C\uDFAF',\n    '\uD83C\uDFAA', '\uD83C\uDFAD', '\uD83C\uDFA8', '\uD83C\uDFB5', '\uD83C\uDFAE', '\uD83C\uDFC6', '\uD83C\uDF08', '\uD83E\uDD84',\n    '\uD83D\uDC09', '\uD83E\uDD8B', '\uD83C\uDF3A', '\uD83C\uDF40', '\uD83C\uDF19', '\u2600\uFE0F', '\uD83D\uDD2E', '\uD83D\uDCAB'\n  ];\n  \n  // Use first character for consistent selection\n  const charCode = name.charCodeAt(0) || 0;\n  return icons[charCode % icons.length];\n}\n\n/**\n * Get user initials from name\n */\nexport function getUserInitials(name: string): string {\n  if (!name) return '?';\n  \n  const words = name.trim().split(/\\s+/);\n  if (words.length === 1) {\n    return words[0].substring(0, 2).toUpperCase();\n  }\n  \n  return words\n    .slice(0, 2)\n    .map(word => word.charAt(0).toUpperCase())\n    .join('');\n}\n\n/**\n * Identity type icons\n */\nexport function getIdentityIcon(identityType: string): string {\n  const iconMap: Record<string, string> = {\n    'ens': '\uD83C\uDFF7\uFE0F',\n    'universal_profile': '\uD83C\uDD94', \n    'anonymous': '\uD83D\uDC64'\n  };\n  \n  return iconMap[identityType] || '\uD83D\uDC64';\n}\n\n/**\n * All available fallback icons\n */\nexport const FALLBACK_ICONS = [\n  '\uD83D\uDE80', '\u2B50', '\uD83C\uDF1F', '\u2728', '\uD83D\uDD25', '\u26A1', '\uD83D\uDC8E', '\uD83C\uDFAF',\n  '\uD83C\uDFAA', '\uD83C\uDFAD', '\uD83C\uDFA8', '\uD83C\uDFB5', '\uD83C\uDFAE', '\uD83C\uDFC6', '\uD83C\uDF08', '\uD83E\uDD84',\n  '\uD83D\uDC09', '\uD83E\uDD8B', '\uD83C\uDF3A', '\uD83C\uDF40', '\uD83C\uDF19', '\u2600\uFE0F', '\uD83D\uDD2E', '\uD83D\uDCAB'\n] as const;\n\nexport type FallbackIcon = typeof FALLBACK_ICONS[number]; ", "/*\n * Curia Embed CSS Isolation Layer - SURGICAL APPROACH\n * \n * STRATEGY: Only block parent interference, preserve our design system\n * This reset targets ONLY the properties that commonly cause inheritance issues\n */\n\n/* ==========================================================================\n   CSS CONTAINMENT & ISOLATION - Keep this, it's essential\n   ========================================================================== */\n\n.curia-embed-container {\n  /* CSS Containment - Isolates layout, style, and paint from parent */\n  contain: layout style paint;\n  \n  /* Create new stacking context - prevents z-index conflicts */\n  isolation: isolate;\n  \n  /* Establish positioning context for absolute children */\n  position: relative;\n  \n  /* Prevent parent flexbox/grid from affecting our layout */\n  flex-shrink: 0;\n  \n  /* Block inheritance of parent transforms that could break fixed positioning */\n  transform: translateZ(0);\n}\n\n/* ==========================================================================\n   SURGICAL RESET - Only target problematic inheritance\n   ========================================================================== */\n\n/* Target all elements within embed + portal elements outside embed */\n.curia-embed-container,\n.curia-embed-container *,\n.mobile-community-picker-overlay,\n.mobile-community-picker-overlay *,\n.mobile-profile-drawer-overlay,\n.mobile-profile-drawer-overlay *,\n.community-preview,\n.community-preview *,\n.user-profile-menu,\n.user-profile-menu * {\n  \n  /* ==========================================================================\n     BOX MODEL PROTECTION - Critical for layout integrity\n     ========================================================================== */\n  \n  /* Force border-box - prevents layout breaks from parent content-box */\n  box-sizing: border-box !important;\n  \n  /* ==========================================================================\n     TYPOGRAPHY BASELINE - Prevent font chaos from parent\n     ========================================================================== */\n  \n  /* Reset only the most problematic font properties */\n  text-decoration: none !important;\n  text-transform: none !important;\n  letter-spacing: normal !important;\n  word-spacing: normal !important;\n  text-indent: 0 !important;\n  text-shadow: none !important;\n  \n  /* Font rendering optimization */\n  text-rendering: optimizeLegibility !important;\n  -webkit-font-smoothing: antialiased !important;\n  -moz-osx-font-smoothing: grayscale !important;\n  \n  /* ==========================================================================\n     LAYOUT INTERFERENCE PROTECTION\n     ========================================================================== */\n  \n  /* Reset floats and clears that could break our layout */\n  float: none !important;\n  clear: none !important;\n  \n  /* ==========================================================================\n     ANIMATION/TRANSITION INTERFERENCE\n     ========================================================================== */\n  \n  /* Reset will-change that could interfere */\n  will-change: auto !important;\n}\n\n/* ==========================================================================\n   PORTAL ELEMENT ISOLATION - Keep this for modals/tooltips\n   ========================================================================== */\n\n.mobile-community-picker-overlay,\n.mobile-profile-drawer-overlay,\n.community-preview,\n.user-profile-menu {\n  /* Create isolated rendering context */\n  contain: layout style paint;\n  isolation: isolate;\n  \n  /* Ensure proper stacking */\n  position: fixed;\n  z-index: 999999;\n  \n  /* Prevent parent transforms from affecting positioning */\n  transform: translateZ(0);\n}\n\n/* ==========================================================================\n   EMBED DESIGN SYSTEM - Apply our actual styles\n   ========================================================================== */\n\n/* Apply our design system to embed container */\n.curia-embed-container {\n  /* Typography foundation */\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #1f2937;\n  \n  /* Remove any inherited backgrounds */\n  background: transparent;\n}\n\n/* Apply design system to portal elements */\n.mobile-community-picker-overlay,\n.mobile-profile-drawer-overlay,\n.community-preview,\n.user-profile-menu {\n  /* Typography foundation */\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif !important;\n  font-size: 14px !important;\n  line-height: 1.5 !important;\n  color: #1f2937 !important;\n  \n  /* Clean background */\n  background: transparent !important;\n}\n\n/* Ensure all embed children inherit proper typography */\n.curia-embed-container *,\n.mobile-community-picker-overlay *,\n.mobile-profile-drawer-overlay *,\n.community-preview *,\n.user-profile-menu * {\n  font-family: inherit;\n  color: inherit;\n}\n\n/* ==========================================================================\n   SPECIFIC ELEMENT RESETS - Only what's necessary\n   ========================================================================== */\n\n/* Reset button appearance */\n.curia-embed-container button,\n.mobile-community-picker-overlay button,\n.mobile-profile-drawer-overlay button,\n.community-preview button,\n.user-profile-menu button {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n/* Reset input appearance */\n.curia-embed-container input,\n.curia-embed-container textarea,\n.curia-embed-container select,\n.mobile-community-picker-overlay input,\n.mobile-community-picker-overlay textarea,\n.mobile-community-picker-overlay select,\n.mobile-profile-drawer-overlay input,\n.mobile-profile-drawer-overlay textarea,\n.mobile-profile-drawer-overlay select {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n/* Reset list styles only if problematic */\n.curia-embed-container ul,\n.curia-embed-container ol {\n  list-style: none;\n}\n\n/* Reset link colors */\n.curia-embed-container a,\n.mobile-community-picker-overlay a,\n.mobile-profile-drawer-overlay a,\n.community-preview a,\n.user-profile-menu a {\n  color: inherit;\n  text-decoration: none;\n} ", "/*\n * Main CSS Entry Point for Curia Embed Styling\n * \n * NOTE: Individual CSS files are bundled via esbuild in index.ts\n * @import statements here would execute in browser and try to load from customer domain\n */\n\n/* All CSS is bundled in styling/index.ts - no @import needed */ ", "/* \n * Community Sidebar Styles\n * Extracted from InternalPluginHost.ts for better maintainability\n * \n * Responsive Design System using absolute px units\n * Benefits: Complete isolation from parent site, consistent rendering\n * No dependency on parent's font-size settings\n */\n\n.curia-community-nav {\n  /* Responsive sidebar dimensions - absolute px units */\n  --sidebar-width: 80px;        /* Fixed width for consistency */\n  --sidebar-padding: 16px;      /* Fixed padding */\n  \n  /* Community icon dimensions - absolute px units */\n  --icon-size: 48px;            /* Fixed icon size */\n  --icon-image-size: 44px;      /* Fixed image size */\n  --icon-emoji-size: 24px;      /* Fixed emoji size */\n  --icon-border-radius: 12px;   /* Fixed border radius */\n  \n  /* Consistent spacing system - absolute px units */\n  --space-xs: 8px;              /* Extra small spacing */\n  --space-sm: 12px;             /* Small spacing */\n  --space-md: 16px;             /* Medium spacing */\n  --space-lg: 20px;             /* Large spacing */\n  \n  /* Profile section - absolute px units */\n  --profile-height: 64px;       /* Fixed profile height */\n  \n  /* Navigation section - absolute px units */\n  --nav-item-size: 40px;        /* Fixed nav item size */\n  --nav-icon-size: 20px;        /* Fixed nav icon size */\n  \n  /* Main sidebar layout */\n  width: var(--sidebar-width);\n  height: 100%;\n  min-height: 100%;\n  flex-shrink: 0;\n  flex-grow: 0;\n  background: linear-gradient(135deg, \n    var(--sidebar-bg-from, #f8fafc) 0%, \n    var(--sidebar-bg-to, #f1f5f9) 100%);\n  border-right: 1px solid var(--sidebar-border, rgba(148, 163, 184, 0.2));\n  box-shadow: \n    inset 2px 0 4px rgba(0, 0, 0, 0.05),\n    inset 0 2px 4px rgba(0, 0, 0, 0.03);\n  display: flex;\n  flex-direction: column;\n  padding: var(--sidebar-padding);\n  position: relative;\n}\n\n.curia-community-nav::-webkit-scrollbar { \n  display: none; \n}\n\n/* ==========================================\n * LOGO SECTION\n * ========================================== */\n\n.sidebar-logo-section {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: var(--space-md) 0;\n  margin-bottom: var(--space-sm);\n}\n\n.sidebar-logo-img {\n  width: 32px;\n  height: 32px;\n  object-fit: contain;\n  opacity: 0.9;\n  transition: opacity 0.2s ease;\n}\n\n.sidebar-logo-img:hover {\n  opacity: 1;\n}\n\n/* ==========================================\n * NAVIGATION SECTION  \n * ========================================== */\n\n.sidebar-nav-section {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: var(--space-xs);\n  margin-bottom: var(--space-md);\n}\n\n.sidebar-nav-item {\n  width: var(--nav-item-size);\n  height: var(--nav-item-size);\n  min-width: var(--nav-item-size);\n  min-height: var(--nav-item-size);\n  margin: 0 auto; /* Center horizontally */\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n  background: transparent;\n  border: 1px solid transparent;\n}\n\n.sidebar-nav-item:hover {\n  background: var(--sidebar-hover-bg, rgba(99, 102, 241, 0.1));\n  border-color: var(--sidebar-hover-border, rgba(99, 102, 241, 0.2));\n  transform: translateY(-1px);\n}\n\n.sidebar-nav-icon {\n  width: var(--nav-icon-size);\n  height: var(--nav-icon-size);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--sidebar-text, #64748b);\n}\n\n.sidebar-nav-item:hover .sidebar-nav-icon {\n  color: var(--sidebar-text-hover, #4f46e5);\n}\n\n.sidebar-nav-icon .lucide-icon {\n  stroke: currentColor;\n  stroke-width: 2;\n}\n\n/* ==========================================\n * DIVIDER\n * ========================================== */\n\n.sidebar-divider {\n  width: calc(100% - 16px);\n  height: 1px;\n  margin: var(--space-sm) auto var(--space-md) auto;\n  background: var(--sidebar-border, rgba(148, 163, 184, 0.3));\n  border-radius: 1px;\n}\n\n/* Community list container - scrollable with badge space */\n.community-list-container {\n  flex: 1;\n  height: 0; /* Force flex to work properly */\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: var(--sidebar-border) transparent;\n  padding: 8px 8px 0px 4px; /* Space for online badges (top/right) */\n  margin: -8px -8px 0px -4px; /* Offset padding to maintain container size */\n  display: flex;\n  flex-direction: column;\n  gap: 14px;\n}\n\n.community-list-container::-webkit-scrollbar {\n  width: 6px;\n}\n\n.community-list-container::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.community-list-container::-webkit-scrollbar-thumb {\n  background: var(--sidebar-border);\n  border-radius: 3px;\n}\n\n.community-list-container::-webkit-scrollbar-thumb:hover {\n  background: var(--preview-text-muted);\n}\n\n/* Community item styling */\n.community-item {\n  width: var(--icon-size);\n  height: var(--icon-size);\n  min-width: var(--icon-size);\n  min-height: var(--icon-size);\n  max-width: var(--icon-size);\n  max-height: var(--icon-size);\n  border-radius: var(--icon-border-radius);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: visible;\n  user-select: none;\n  flex-shrink: 0;\n  border: 2px solid transparent;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  z-index: 10;\n}\n\n.community-item.active {\n  border-color: var(--item-active-border);\n  box-shadow: 0 4px 12px var(--item-active-shadow), 0 0 0 1px var(--item-active-border);\n}\n\n.community-item:hover:not(.active) {\n  transform: scale(1.08) translateY(-1px);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\n}\n\n/* Community item hover effects */\n.community-item:hover::after {\n  content: '';\n  position: absolute;\n  inset: -2px;\n  border-radius: 14px;\n  background: var(--item-hover-bg);\n  z-index: -1;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* Community icon image */\n.community-icon-image {\n  width: var(--icon-image-size);\n  height: var(--icon-image-size);\n  object-fit: cover;\n  border-radius: 10px;\n  margin: 2px;\n  flex-shrink: 0;\n}\n\n/* Community icon emoji */\n.community-icon-emoji {\n  font-size: var(--icon-emoji-size);\n  line-height: 1;\n  width: var(--icon-emoji-size);\n  height: var(--icon-emoji-size);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n\n/* User profile section styling - fixed at bottom */\n.user-profile-section {\n  margin-top: var(--space-md);\n  padding-top: var(--space-md);\n  border-top: 1px solid var(--sidebar-border, rgba(148, 163, 184, 0.2));\n  flex-shrink: 0;\n  height: var(--profile-height);\n  min-height: var(--profile-height);\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n}\n\n.user-profile-avatar {\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n  user-select: none;\n  border: 2px solid transparent;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.user-profile-avatar:hover {\n  transform: scale(1.08) translateY(-1px);\n  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\n} ", "/*\n * Community Preview Cards & Tooltips\n * Extracted from InternalPluginHost.ts for better maintainability\n */\n\n/* Preview card styling - Portal pattern for document-level rendering */\n.community-preview {\n  position: fixed;\n  min-width: 220px;\n  max-width: 280px;\n  background: var(--preview-bg);\n  border: 1px solid var(--preview-border);\n  border-radius: 12px;\n  padding: 16px;\n  box-shadow: \n    0 20px 40px rgba(0, 0, 0, 0.15),\n    0 8px 16px rgba(0, 0, 0, 0.1);\n  z-index: 999999;\n  opacity: 0;\n  transform: translateX(-8px) scale(0.95);\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  pointer-events: none;\n  backdrop-filter: blur(12px);\n}\n\n.community-preview.show {\n  opacity: 1;\n  transform: translateX(0) scale(1);\n}\n\n.community-preview-header {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 12px;\n}\n\n.community-preview-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  flex-shrink: 0;\n}\n\n.community-preview-info h4 {\n  color: var(--preview-text);\n  font-weight: 600;\n  font-size: 16px;\n  margin: 0 0 4px 0;\n  line-height: 1.2;\n}\n\n.community-preview-info p {\n  color: var(--preview-text-muted);\n  font-size: 14px;\n  margin: 0;\n  line-height: 1.3;\n}\n\n.community-preview-stats {\n  display: flex;\n  gap: 16px;\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid var(--preview-border);\n}\n\n.community-preview-stat {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  color: var(--preview-text-muted);\n  font-size: 13px;\n} ", "/*\n * User Profile Menu & Account Switcher\n * Extracted from InternalPluginHost.ts for better maintainability\n */\n\n/* Profile menu styling - Portal pattern */\n.user-profile-menu {\n  position: fixed;\n  min-width: 280px;\n  max-width: 320px;\n  background: rgb(255, 255, 255);  /* Solid white background */\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  border-radius: 12px;\n  padding: 16px;\n  box-shadow: \n    0 20px 40px rgba(0, 0, 0, 0.15),\n    0 8px 16px rgba(0, 0, 0, 0.1);\n  z-index: 999999;\n  opacity: 0;\n  transform: translateX(-8px) scale(0.95);\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  pointer-events: none;\n  backdrop-filter: blur(12px);\n  \n  /* Define CSS variables locally since menu is rendered outside .curia-community-nav scope */\n  --preview-bg: rgb(255, 255, 255);\n  --preview-border: rgba(148, 163, 184, 0.3);\n  --preview-text: #1f2937;  /* Dark gray for high contrast on white */\n  --preview-text-muted: #4b5563;  /* Darker muted text for better readability */\n  --item-hover-bg: rgba(249, 250, 251, 1);  /* Solid light gray hover */\n}\n\n/* Dark theme support for profile menu */\n[data-theme=\"dark\"] .user-profile-menu,\n.dark .user-profile-menu {\n  background: rgb(31, 41, 55);  /* Solid background - no transparency issues */\n  border: 1px solid rgba(75, 85, 99, 0.5);\n  \n  --preview-bg: rgb(31, 41, 55);\n  --preview-border: rgba(75, 85, 99, 0.5);\n  --preview-text: #ffffff;  /* Pure white for maximum contrast */\n  --preview-text-muted: #d1d5db;  /* Much lighter gray for better readability */\n  --item-hover-bg: rgba(55, 65, 81, 1);  /* Solid hover state */\n}\n\n.user-profile-menu.show {\n  opacity: 1;\n  transform: translateX(0) scale(1);\n  pointer-events: auto;\n}\n\n.profile-menu-header {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin-bottom: 16px;\n  padding-bottom: 16px;\n  border-bottom: 1px solid var(--preview-border);\n}\n\n.profile-menu-avatar {\n  width: 48px;\n  height: 48px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n\n.profile-menu-info h4 {\n  color: var(--preview-text);\n  font-weight: 600;\n  font-size: 16px;\n  margin: 0 0 4px 0;\n  line-height: 1.2;\n}\n\n.profile-menu-info p {\n  color: var(--preview-text-muted);\n  font-size: 14px;\n  margin: 0;\n  line-height: 1.3;\n}\n\n.profile-menu-actions {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.profile-menu-action {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px;\n  border-radius: 8px;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: var(--preview-text);\n  font-size: 14px;\n  text-align: left;\n  width: 100%;\n}\n\n.profile-menu-action:hover {\n  background: var(--item-hover-bg);\n}\n\n.profile-menu-action-icon {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--preview-text-muted);\n}\n\n/* Account Switcher Styles */\n.profile-menu-accounts {\n  margin: 16px 0;\n  padding-top: 16px;\n  border-top: 1px solid var(--preview-border);\n}\n\n.profile-menu-section-title {\n  color: var(--preview-text-muted);\n  font-size: 12px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  margin-bottom: 12px;\n  padding: 0 4px;\n}\n\n/* Session Management Styles */\n.profile-menu-sessions {\n  margin: 16px 0;\n  padding-top: 16px;\n}\n\n.profile-menu-section-label {\n  color: var(--preview-text-muted);\n  font-size: 12px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  margin-bottom: 12px;\n  padding: 0 4px;\n}\n\n.profile-menu-session {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 8px 12px;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.profile-menu-session:hover {\n  background: var(--item-hover-bg);\n}\n\n.profile-session-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  overflow: hidden;\n}\n\n.profile-session-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.profile-session-name {\n  color: var(--preview-text);\n  font-size: 14px;\n  font-weight: 500;\n  margin-bottom: 2px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.profile-session-type {\n  color: var(--preview-text-muted);\n  font-size: 12px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.profile-menu-account {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 10px 8px;\n  border-radius: 8px;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  color: var(--preview-text);\n  font-size: 14px;\n  text-align: left;\n  width: 100%;\n  margin-bottom: 4px;\n}\n\n.profile-menu-account:hover {\n  background: var(--item-hover-bg);\n  transform: translateX(2px);\n}\n\n.profile-account-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  border: 2px solid rgba(255, 255, 255, 0.1);\n}\n\n.profile-account-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.profile-account-name {\n  color: var(--preview-text);\n  font-weight: 500;\n  font-size: 14px;\n  margin: 0 0 2px 0;\n  line-height: 1.2;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.profile-account-type {\n  color: var(--preview-text-muted);\n  font-size: 12px;\n  margin: 0;\n  line-height: 1.2;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n} ", "/*\n * QR Dialog Styles\n * Responsive dialog component for displaying QR codes\n */\n\n/* ============================================================================\n   BACKDROP AND OVERLAY\n   ============================================================================ */\n\n.qr-dialog-backdrop {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 10000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 1rem;\n  opacity: 0;\n  transition: opacity 0.2s ease;\n  backdrop-filter: blur(4px);\n}\n\n.qr-dialog-backdrop-visible {\n  opacity: 1;\n}\n\n/* ============================================================================\n   DIALOG CONTAINER\n   ============================================================================ */\n\n.qr-dialog {\n  background: var(--bg-primary, #ffffff);\n  border: 1px solid var(--border-color, rgba(148, 163, 184, 0.2));\n  border-radius: 12px;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n  max-height: 90vh;\n  max-width: 400px;\n  width: 90vw;\n  overflow: hidden;\n  transform: scale(0.95);\n  transition: transform 0.2s ease;\n  outline: none;\n}\n\n.qr-dialog-visible {\n  transform: scale(1);\n}\n\n/* ============================================================================\n   DIALOG HEADER\n   ============================================================================ */\n\n.qr-dialog-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 1.25rem 1.5rem 1rem 1.5rem;\n  border-bottom: 1px solid var(--border-color, rgba(148, 163, 184, 0.2));\n}\n\n.qr-dialog-title {\n  margin: 0;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--text-primary, #1e293b);\n  line-height: 1.4;\n}\n\n.qr-dialog-close {\n  background: none;\n  border: none;\n  font-size: 1.5rem;\n  color: var(--text-secondary, #64748b);\n  cursor: pointer;\n  padding: 0.25rem;\n  border-radius: 4px;\n  line-height: 1;\n  transition: all 0.15s ease;\n  min-width: 28px;\n  min-height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.qr-dialog-close:hover {\n  background: var(--hover-bg, rgba(148, 163, 184, 0.1));\n  color: var(--text-primary, #1e293b);\n}\n\n.qr-dialog-close:focus {\n  outline: 2px solid var(--focus-color, #3b82f6);\n  outline-offset: 2px;\n}\n\n/* ============================================================================\n   DIALOG CONTENT\n   ============================================================================ */\n\n.qr-dialog-content {\n  padding: 1.5rem;\n}\n\n.qr-code-container {\n  display: flex;\n  justify-content: center;\n  margin-bottom: 1.5rem;\n  padding: 1rem;\n  background: var(--bg-secondary, #f8fafc);\n  border-radius: 8px;\n  border: 1px solid var(--border-color, rgba(148, 163, 184, 0.1));\n}\n\n.qr-code-image {\n  width: 100%;\n  max-width: 256px;\n  height: auto;\n  border-radius: 8px;\n  background: white;\n  padding: 8px;\n}\n\n/* ============================================================================\n   TRANSFER INFO\n   ============================================================================ */\n\n.qr-transfer-info {\n  text-align: center;\n  margin-bottom: 1.5rem;\n}\n\n.qr-session-count {\n  margin: 0 0 0.75rem 0;\n  font-size: 1rem;\n  font-weight: 500;\n  color: var(--text-primary, #1e293b);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n}\n\n.qr-instructions {\n  margin: 0;\n  font-size: 0.875rem;\n  color: var(--text-secondary, #64748b);\n  line-height: 1.5;\n}\n\n/* ============================================================================\n   ACTIONS\n   ============================================================================ */\n\n.qr-actions {\n  display: flex;\n  justify-content: center;\n}\n\n.qr-copy-button {\n  background: var(--button-secondary-bg, #f1f5f9);\n  border: 1px solid var(--border-color, rgba(148, 163, 184, 0.2));\n  color: var(--text-primary, #1e293b);\n  padding: 0.75rem 1.25rem;\n  border-radius: 8px;\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.qr-copy-button:hover:not(:disabled) {\n  background: var(--button-secondary-hover, #e2e8f0);\n  border-color: var(--border-hover, rgba(148, 163, 184, 0.3));\n}\n\n.qr-copy-button:focus {\n  outline: 2px solid var(--focus-color, #3b82f6);\n  outline-offset: 2px;\n}\n\n.qr-copy-button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* ============================================================================\n   RESPONSIVE DESIGN\n   ============================================================================ */\n\n/* Tablet and up */\n@media (min-width: 768px) {\n  .qr-dialog {\n    max-width: 480px;\n    width: auto;\n  }\n  \n  .qr-dialog-header {\n    padding: 1.5rem 2rem 1.25rem 2rem;\n  }\n  \n  .qr-dialog-content {\n    padding: 2rem;\n  }\n  \n  .qr-code-container {\n    padding: 1.5rem;\n  }\n  \n  .qr-code-image {\n    max-width: 320px;\n  }\n}\n\n/* Desktop */\n@media (min-width: 1024px) {\n  .qr-dialog {\n    max-width: 520px;\n  }\n  \n  .qr-dialog-title {\n    font-size: 1.25rem;\n  }\n}\n\n/* ============================================================================\n   DARK THEME SUPPORT\n   ============================================================================ */\n\n.dark .qr-dialog {\n  --bg-primary: #1e293b;\n  --bg-secondary: #334155;\n  --text-primary: #f1f5f9;\n  --text-secondary: #94a3b8;\n  --border-color: rgba(148, 163, 184, 0.2);\n  --border-hover: rgba(148, 163, 184, 0.3);\n  --hover-bg: rgba(148, 163, 184, 0.1);\n  --button-secondary-bg: #334155;\n  --button-secondary-hover: #475569;\n  --focus-color: #60a5fa;\n}\n\n.dark .qr-code-image {\n  background: white; /* QR code background should stay white for readability */\n}\n\n/* ============================================================================\n   MOBILE OPTIMIZATIONS\n   ============================================================================ */\n\n@media (max-width: 480px) {\n  .qr-dialog-backdrop {\n    padding: 0.75rem;\n  }\n  \n  .qr-dialog {\n    width: 95vw;\n    max-width: none;\n  }\n  \n  .qr-dialog-header {\n    padding: 1rem 1.25rem 0.75rem 1.25rem;\n  }\n  \n  .qr-dialog-content {\n    padding: 1.25rem;\n  }\n  \n  .qr-dialog-title {\n    font-size: 1rem;\n  }\n  \n  .qr-code-container {\n    padding: 0.75rem;\n    margin-bottom: 1.25rem;\n  }\n  \n  .qr-code-image {\n    max-width: 240px;\n  }\n  \n  .qr-copy-button {\n    width: 100%;\n    justify-content: center;\n  }\n}\n\n/* ============================================================================\n   ACCESSIBILITY\n   ============================================================================ */\n\n@media (prefers-reduced-motion: reduce) {\n  .qr-dialog-backdrop,\n  .qr-dialog,\n  .qr-dialog-close,\n  .qr-copy-button {\n    transition: none;\n  }\n}\n\n/* High contrast mode support */\n@media (prefers-contrast: high) {\n  .qr-dialog {\n    border-width: 2px;\n  }\n  \n  .qr-dialog-close,\n  .qr-copy-button {\n    border-width: 2px;\n  }\n} ", "/*\n * Mobile Community Navigation Styles\n * Bottom navigation layout for screens < 768px\n */\n\n/* Hide desktop sidebar on mobile */\n@media (max-width: 767px) {\n  .curia-community-nav {\n    display: none !important;\n  }\n}\n\n/* Mobile bottom navigation */\n.curia-mobile-bottom-nav {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  background: linear-gradient(135deg, \n    var(--sidebar-bg-from, #f8fafc) 0%, \n    var(--sidebar-bg-to, #f1f5f9) 100%);\n  border-top: 1px solid var(--sidebar-border, rgba(148, 163, 184, 0.2));\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 16px;\n  z-index: 1000;\n  backdrop-filter: blur(8px);\n  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);\n}\n\n/* Mobile bottom nav sections - 4 equal sections with edge positioning */\n.mobile-nav-section {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  padding: 8px 4px;\n  border-radius: 12px;\n  transition: all 0.2s ease;\n  position: relative;\n}\n\n/* First section (burger + community) - push to left edge */\n.mobile-nav-section:first-child {\n  justify-content: flex-start;\n  padding-left: 6px; /* Minimal margin to left edge */\n  flex: none;\n  width: auto;\n}\n\n/* Last section (profile) - push to right edge */\n.mobile-nav-section:last-child {\n  justify-content: flex-end;\n  padding-right: 6px; /* Minimal margin to right edge */\n  flex: none;\n  width: auto;\n}\n\n/* Middle sections (stubs) - evenly distribute */\n.mobile-nav-section:not(:first-child):not(:last-child) {\n  flex: 1;\n  justify-content: center;\n}\n\n.mobile-nav-section:hover:not(.inactive):not(:first-child) {\n  background: rgba(255, 255, 255, 0.1);\n  transform: scale(1.02);\n}\n\n/* Community burger menu (left section) - cohesive pill design */\n.mobile-community-burger {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 12px;\n  border-radius: 20px; /* More pill-like */\n  transition: all 0.2s ease;\n  \n  /* Subtle inset/impression effect */\n  background: linear-gradient(135deg, \n    var(--sidebar-bg-from) 0%, \n    var(--sidebar-bg-to) 100%);\n  border: 1px solid var(--sidebar-border);\n  box-shadow: \n    inset 0 1px 2px rgba(0, 0, 0, 0.05),\n    0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.mobile-nav-section:hover:not(.inactive) .mobile-community-burger {\n  background: linear-gradient(135deg, \n    var(--item-hover-bg) 0%, \n    var(--item-bg) 100%);\n  transform: scale(1.02);\n  box-shadow: \n    inset 0 1px 2px rgba(0, 0, 0, 0.1),\n    0 2px 6px rgba(0, 0, 0, 0.15);\n}\n\n.mobile-burger-icon {\n  width: 20px;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--preview-text, #1f2937);\n  font-size: 16px;\n  flex-shrink: 0;\n}\n\n.mobile-community-indicator {\n  width: 24px;\n  height: 24px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n  flex-shrink: 0;\n}\n\n/* Inactive stub sections (search, messages, notifications) */\n.mobile-nav-section.inactive {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.mobile-stub-icon {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--preview-text-muted);\n}\n\n/* Lucide icon styling within stub icons */\n.mobile-stub-icon .lucide-icon {\n  stroke: var(--preview-text-muted);\n  opacity: 0.7; /* Subtle appearance for inactive stubs */\n}\n\n/* Profile section (right) */\n.mobile-profile-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 2px;\n}\n\n.mobile-profile-avatar {\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n  border: 2px solid transparent;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n}\n\n\n\n/* Iframe container adjustment for mobile nav */\n@media (max-width: 767px) {\n  .curia-iframe-container {\n    padding-bottom: 60px !important;\n  }\n}\n\n/* Mobile Community Picker Modal */\n.mobile-community-picker-overlay {\n  position: absolute; /* \uD83C\uDFAF Changed from fixed - respects embed boundaries */\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 10000;\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n}\n\n.mobile-community-picker-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  opacity: 0;\n  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.mobile-community-picker-content {\n  position: relative;\n  width: 100%;\n  max-height: 80vh;\n  background: var(--preview-bg);\n  border-radius: 20px 20px 0 0;\n  box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);\n  transform: translateY(100%);\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n/* Animation states */\n.mobile-community-picker-visible .mobile-community-picker-backdrop {\n  opacity: 1;\n}\n\n.mobile-community-picker-visible .mobile-community-picker-content {\n  transform: translateY(0);\n}\n\n/* Header */\n.mobile-community-picker-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 20px 24px 16px;\n  border-bottom: 1px solid var(--preview-border);\n  flex-shrink: 0;\n}\n\n.mobile-community-picker-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: var(--preview-text);\n  margin: 0;\n}\n\n.mobile-community-picker-close {\n  width: 32px;\n  height: 32px;\n  border: none;\n  background: transparent; /* Free floating, no background */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 22px; /* Better size alignment with title (20px) */\n  font-weight: 500; /* Slightly less bold for better harmony */\n  color: var(--preview-text-muted);\n  transition: all 0.2s ease;\n  margin-top: -1px; /* Subtle vertical adjustment for better alignment */\n}\n\n.mobile-community-picker-close:hover {\n  color: var(--preview-text);\n  transform: scale(1.1); /* Subtle scale instead of background change */\n}\n\n/* Lucide chevron icon styling in close button */\n.mobile-community-picker-close .lucide-icon {\n  stroke: var(--preview-text-muted);\n  transition: all 0.2s ease;\n}\n\n.mobile-community-picker-close:hover .lucide-icon {\n  stroke: var(--preview-text);\n}\n\n/* Grid container with scroll */\n.mobile-community-picker-grid-container {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px 24px;\n  -webkit-overflow-scrolling: touch;\n}\n\n.mobile-community-picker-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n  gap: 20px;\n  padding-bottom: 16px;\n}\n\n/* Community items */\n.mobile-community-picker-item {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  padding: 8px;\n  border-radius: 12px;\n}\n\n.mobile-community-picker-item:hover {\n  background: rgba(59, 130, 246, 0.05);\n  transform: scale(1.02);\n}\n\n.mobile-community-picker-item.active {\n  background: rgba(59, 130, 246, 0.1);\n}\n\n.mobile-community-picker-item.active .mobile-community-picker-icon {\n  transform: scale(1.05);\n  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);\n}\n\n.mobile-community-picker-icon {\n  width: 56px;\n  height: 56px;\n  border-radius: 14px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 8px;\n  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n}\n\n.mobile-community-picker-name {\n  font-size: 12px;\n  font-weight: 500;\n  color: var(--preview-text);\n  text-align: center;\n  max-width: 80px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* Plus button section */\n.mobile-community-picker-plus-section {\n  padding: 16px 24px 24px;\n  border-top: 1px solid var(--preview-border);\n  flex-shrink: 0;\n}\n\n.mobile-community-picker-plus {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 16px;\n  background: linear-gradient(135deg, \n    var(--sidebar-bg-from) 0%, \n    var(--sidebar-bg-to) 100%);\n  border: 2px dashed var(--sidebar-border);\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n}\n\n.mobile-community-picker-plus:hover {\n  border-color: rgba(59, 130, 246, 0.4);\n  background: rgba(59, 130, 246, 0.05);\n  transform: scale(1.02);\n}\n\n.mobile-community-picker-plus-icon {\n  width: 32px;\n  height: 32px;\n  border-radius: 8px;\n  background: var(--sidebar-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 20px;\n  font-weight: 600;\n  color: var(--preview-text-muted);\n  transition: all 0.25s ease;\n}\n\n.mobile-community-picker-plus:hover .mobile-community-picker-plus-icon {\n  background: rgba(59, 130, 246, 0.2);\n  color: rgba(59, 130, 246, 0.8);\n}\n\n.mobile-community-picker-plus-text {\n  font-size: 16px;\n  font-weight: 500;\n  color: var(--preview-text-muted);\n  transition: color 0.25s ease;\n}\n\n.mobile-community-picker-plus:hover .mobile-community-picker-plus-text {\n  color: #3b82f6;\n}\n\n/* Mobile Profile Drawer */\n.mobile-profile-drawer-overlay {\n  position: absolute; /* \uD83C\uDFAF Changed from fixed - respects embed boundaries */\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 10000;\n  display: flex;\n  align-items: flex-end;\n  justify-content: center;\n}\n\n.mobile-profile-drawer-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(4px);\n  opacity: 0;\n  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.mobile-profile-drawer-content {\n  position: relative;\n  width: 100%;\n  max-height: 80vh;\n  background: var(--preview-bg);\n  border-radius: 20px 20px 0 0;\n  box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);\n  transform: translateY(100%);\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n/* Animation states */\n.mobile-profile-drawer-visible .mobile-profile-drawer-backdrop {\n  opacity: 1;\n}\n\n.mobile-profile-drawer-visible .mobile-profile-drawer-content {\n  transform: translateY(0);\n}\n\n/* Header */\n.mobile-profile-drawer-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 20px 24px 16px;\n  border-bottom: 1px solid var(--preview-border);\n  flex-shrink: 0;\n}\n\n.mobile-profile-drawer-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: var(--preview-text);\n  margin: 0;\n}\n\n.mobile-profile-drawer-close {\n  width: 32px;\n  height: 32px;\n  border: none;\n  background: transparent; /* Free floating, no background */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  font-size: 22px; /* Better size alignment with title (20px) */\n  font-weight: 500; /* Slightly less bold for better harmony */\n  color: var(--preview-text-muted);\n  transition: all 0.2s ease;\n  margin-top: -1px; /* Subtle vertical adjustment for better alignment */\n}\n\n.mobile-profile-drawer-close:hover {\n  color: var(--preview-text);\n  transform: scale(1.1); /* Subtle scale instead of background change */\n}\n\n/* Lucide chevron icon styling in close button */\n.mobile-profile-drawer-close .lucide-icon {\n  stroke: var(--preview-text-muted);\n  transition: all 0.2s ease;\n}\n\n.mobile-profile-drawer-close:hover .lucide-icon {\n  stroke: var(--preview-text);\n}\n\n/* Profile section */\n.mobile-profile-drawer-profile {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  padding: 24px;\n  border-bottom: 1px solid var(--preview-border);\n}\n\n.mobile-profile-drawer-avatar {\n  width: 64px;\n  height: 64px;\n  border-radius: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  overflow: hidden;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.mobile-profile-drawer-info {\n  flex: 1;\n  min-width: 0;\n}\n\n.mobile-profile-drawer-name {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--preview-text);\n  margin: 0 0 4px 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.mobile-profile-drawer-type {\n  font-size: 14px;\n  color: var(--preview-text-muted);\n  margin: 0;\n}\n\n/* Actions section */\n.mobile-profile-drawer-actions {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px 24px 24px;\n  -webkit-overflow-scrolling: touch;\n}\n\n.mobile-profile-drawer-section {\n  margin-bottom: 24px;\n}\n\n.mobile-profile-drawer-section:last-child {\n  margin-bottom: 0;\n}\n\n.mobile-profile-drawer-section-title {\n  font-size: 12px;\n  font-weight: 600;\n  color: var(--preview-text-muted);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  margin-bottom: 12px;\n  padding: 0 4px;\n}\n\n.mobile-profile-drawer-action {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-bottom: 8px;\n}\n\n.mobile-profile-drawer-action:hover {\n  background: var(--item-hover-bg);\n  transform: translateX(2px);\n}\n\n.mobile-profile-drawer-action.destructive:hover {\n  background: rgba(239, 68, 68, 0.05);\n}\n\n.mobile-profile-drawer-action-icon {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  flex-shrink: 0;\n}\n\n.mobile-profile-drawer-action-text {\n  font-size: 16px;\n  font-weight: 500;\n  color: var(--preview-text);\n  flex: 1;\n}\n\n.mobile-profile-drawer-action.destructive .mobile-profile-drawer-action-text {\n  color: #ef4444;\n} ", "/*\n * Light Theme for Curia Community Navigation\n * Default theme with clean, bright appearance\n * Extended scope to include mobile components\n */\n\n.curia-community-nav,\n.curia-mobile-bottom-nav,\n.mobile-community-picker-overlay,\n.mobile-profile-drawer-overlay,\n.light.community-preview {\n  --sidebar-bg-from: #f8fafc;\n  --sidebar-bg-to: #f1f5f9;\n  --sidebar-border: rgba(148, 163, 184, 0.2);\n  --item-bg: rgba(255, 255, 255, 0.8);\n  --item-hover-bg: rgba(255, 255, 255, 0.95);\n  --item-active-bg: rgba(59, 130, 246, 0.1);\n  --item-active-border: rgba(59, 130, 246, 0.3);\n  --item-active-shadow: rgba(59, 130, 246, 0.2);\n  --preview-bg: rgba(255, 255, 255, 0.95);\n  --preview-border: rgba(148, 163, 184, 0.2);\n  --preview-text: #1f2937;\n  --preview-text-muted: #6b7280;\n} ", "/*\n * Dark Theme for Curia Community Navigation\n * Modern dark appearance with blue accents\n * Extended scope to include mobile components\n */\n\n[data-theme=\"dark\"] .curia-community-nav,\n[data-theme=\"dark\"] .curia-mobile-bottom-nav,\n[data-theme=\"dark\"] .mobile-community-picker-overlay,\n[data-theme=\"dark\"] .mobile-profile-drawer-overlay,\n.dark .curia-community-nav,\n.dark .curia-mobile-bottom-nav,\n.dark .mobile-community-picker-overlay,\n.dark .mobile-profile-drawer-overlay,\n.dark.community-preview {\n  --sidebar-bg-from: #1e293b;\n  --sidebar-bg-to: #0f172a;\n  --sidebar-border: rgba(71, 85, 105, 0.3);\n  --item-bg: rgba(30, 41, 59, 0.8);\n  --item-hover-bg: rgba(30, 41, 59, 0.95);\n  --item-active-bg: rgba(59, 130, 246, 0.2);\n  --item-active-border: rgba(59, 130, 246, 0.4);\n  --item-active-shadow: rgba(59, 130, 246, 0.3);\n  --preview-bg: rgba(30, 41, 59, 0.95);\n  --preview-border: rgba(71, 85, 105, 0.3);\n  --preview-text: #f1f5f9;\n  --preview-text-muted: #94a3b8;\n} ", "/**\n * Main styling module for Curia embed components\n * Handles CSS injection and provides utility functions\n */\n\nexport * from './utils';\n\n// Import CSS files as text strings (esbuild loader: '.css': 'text')\n// CRITICAL: Reset must come first to establish complete CSS isolation\nimport resetCSS from './reset.css';\nimport stylesCSS from './styles.css';\nimport sidebarCSS from './sidebar.css';\nimport previewCSS from './preview.css';\nimport profileMenuCSS from './profile-menu.css';\nimport qrDialogCSS from './qr-dialog.css';\nimport mobileCSS from './mobile.css';\nimport lightThemeCSS from './themes/light.css';\nimport darkThemeCSS from './themes/dark.css';\n\n/**\n * Get all CSS content as a string\n */\nfunction getCSSContent(): string {\n  // Combine all CSS files in the correct order\n  // Reset MUST be first to ensure complete isolation\n  return [\n    resetCSS,       // \uD83C\uDFAF CRITICAL: Complete CSS reset and isolation - MUST BE FIRST\n    stylesCSS,      // Main CSS entry point\n    sidebarCSS,     // Base sidebar component styles\n    previewCSS,     // Community preview styles\n    profileMenuCSS, // Profile menu styles\n    qrDialogCSS,    // QR code dialog styles\n    mobileCSS,      // Mobile responsive styles\n    lightThemeCSS,  // Light theme (default)\n    darkThemeCSS    // Dark theme overrides\n  ].join('\\n\\n');\n}\n\n/**\n * Inject all CSS styles into the document head\n * Should be called once when initializing the embed\n */\nexport function injectStyles(): void {\n  // Check if styles are already injected\n  const existingStyles = document.head.querySelector('#curia-embed-styles');\n  if (existingStyles) {\n    return; // Already injected\n  }\n\n  const styleElement = document.createElement('style');\n  styleElement.id = 'curia-embed-styles';\n  styleElement.textContent = getCSSContent();\n  document.head.appendChild(styleElement);\n}\n\n/**\n * Remove injected styles from document\n * Useful for cleanup\n */\nexport function removeStyles(): void {\n  const existingStyles = document.head.querySelector('#curia-embed-styles');\n  if (existingStyles) {\n    existingStyles.remove();\n  }\n} ", "/**\n * CommunityItem Component\n * Renders individual community icons in the sidebar\n * \n * Extracted from InternalPluginHost.ts for better maintainability\n * Handles: logo display, gradient fallbacks, role badges, hover effects\n */\n\nimport { getGradientClass, getGradientStyle, getIconForCommunity } from '../../styling';\n\nexport interface UserCommunityMembership {\n  id: string;\n  name: string;\n  logoUrl: string | null;\n  userRole: 'member' | 'moderator' | 'admin' | 'owner';\n  isMember: boolean;\n}\n\nexport interface CommunityItemOptions {\n  community: UserCommunityMembership;\n  isActive: boolean;\n  hasIframeLoaded?: boolean; // Simple flag: true = iframe in memory, false = not loaded\n  onHover?: (community: UserCommunityMembership, element: HTMLElement) => void;\n  onHoverEnd?: () => void;\n  onClick?: (community: UserCommunityMembership) => void;\n}\n\nexport class CommunityItem {\n  private community: UserCommunityMembership;\n  private isActive: boolean;\n  private options: CommunityItemOptions;\n  private element: HTMLElement | null = null;\n  private hoverTimeout: NodeJS.Timeout | null = null;\n\n  constructor(options: CommunityItemOptions) {\n    this.community = options.community;\n    this.isActive = options.isActive;\n    this.options = options;\n  }\n\n  render(): HTMLElement {\n    const item = document.createElement('div');\n    item.className = `community-item ${this.isActive ? 'active' : ''}`;\n\n    // Create the beautiful background (logo or gradient + emoji)\n    if (this.community.logoUrl) {\n      this.addCommunityLogo(item);\n    } else {\n      this.addGradientFallback(item);\n    }\n\n    // Enhanced hover effects\n    this.addHoverEffects(item);\n\n    // Simple online indicator (tiny green dot if iframe loaded)\n    this.addOnlineIndicator(item);\n\n    // Click handler\n    if (this.options.onClick) {\n      item.addEventListener('click', () => {\n        this.options.onClick?.(this.community);\n      });\n    }\n\n    this.element = item;\n    return item;\n  }\n\n  private addCommunityLogo(item: HTMLElement): void {\n    const logo = document.createElement('img');\n    logo.src = this.community.logoUrl!;\n    logo.alt = this.community.name;\n    logo.className = 'community-icon-image';\n    \n    logo.onerror = () => {\n      // Fallback to gradient + emoji if image fails\n      item.removeChild(logo);\n      this.addGradientFallback(item);\n    };\n    \n    item.appendChild(logo);\n  }\n\n  private addGradientFallback(item: HTMLElement): void {\n    // Generate gradient class and icon using same logic as API\n    const gradientClass = getGradientClass(this.community.name);\n    const icon = getIconForCommunity(this.community.name);\n    \n    // Set gradient background\n    item.style.background = getGradientStyle(gradientClass);\n    \n    // Add emoji icon\n    const iconSpan = document.createElement('span');\n    iconSpan.textContent = icon;\n    iconSpan.className = 'community-icon-emoji';\n    item.appendChild(iconSpan);\n  }\n\n\n\n  private addHoverEffects(item: HTMLElement): void {\n    item.addEventListener('mouseenter', () => {\n      // Show preview card after slight delay (but not for active community)\n      if (!this.isActive && this.options.onHover) {\n        this.hoverTimeout = setTimeout(() => {\n          this.options.onHover?.(this.community, item);\n        }, 500);\n      }\n    });\n\n    item.addEventListener('mouseleave', () => {\n      // Clear timeout\n      if (this.hoverTimeout) {\n        clearTimeout(this.hoverTimeout);\n        this.hoverTimeout = null;\n      }\n      \n      // Notify parent about hover end\n      this.options.onHoverEnd?.();\n    });\n  }\n\n  private addOnlineIndicator(item: HTMLElement): void {\n    // Only show indicator if iframe is loaded\n    if (!this.options.hasIframeLoaded) {\n      return;\n    }\n\n    console.log(`[MULTI-IFRAME] [OnlineIndicator] Adding online dot for community: ${this.community.name}`);\n\n    // \u2705 Ensure parent has proper stacking context\n    item.style.position = 'relative';\n    item.style.zIndex = '10';\n    item.style.overflow = 'visible';\n\n    const indicator = document.createElement('div');\n    indicator.className = 'online-indicator';\n    indicator.style.cssText = `\n      position: absolute;\n      top: -8px;\n      right: -8px;\n      width: 16px;\n      height: 16px;\n      background: #10b981;\n      border: 2px solid var(--sidebar-bg-from, #f8fafc);\n      border-radius: 50%;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);\n      z-index: 20;\n      overflow: visible;\n    `;\n    \n    item.appendChild(indicator);\n  }\n\n  /**\n   * Update the active state of this community item\n   */\n  updateActiveState(isActive: boolean): void {\n    if (this.isActive === isActive) return;\n    \n    this.isActive = isActive;\n    \n    if (this.element) {\n      if (isActive) {\n        this.element.classList.add('active');\n      } else {\n        this.element.classList.remove('active');\n      }\n    }\n  }\n\n  /**\n   * Cleanup method for removing event listeners\n   */\n  destroy(): void {\n    if (this.hoverTimeout) {\n      clearTimeout(this.hoverTimeout);\n      this.hoverTimeout = null;\n    }\n    \n    this.element = null;\n  }\n} ", "/**\n * CommunityPreview Component\n * Handles hover preview cards for community items\n * \n * Extracted from InternalPluginHost.ts for better maintainability\n * Uses portal pattern for document-level rendering to avoid z-index issues\n */\n\nimport { getGradientClass, getGradientStyle, getIconForCommunity } from '../../styling';\nimport { UserCommunityMembership } from './CommunityItem';\n\nexport class CommunityPreview {\n  private community: UserCommunityMembership;\n  private triggerElement: HTMLElement;\n  private previewElement: HTMLElement | null = null;\n\n  constructor(community: UserCommunityMembership, triggerElement: HTMLElement) {\n    this.community = community;\n    this.triggerElement = triggerElement;\n  }\n\n  show(): HTMLElement {\n    const preview = document.createElement('div');\n    preview.className = 'community-preview';\n    \n    // \uD83C\uDFAF THEME FIX: Apply current theme class to preview card for CSS variable access\n    if (document.documentElement.classList.contains('dark')) {\n      preview.classList.add('dark');\n    } else {\n      preview.classList.add('light');\n    }\n    \n    // Position the preview card relative to trigger element\n    this.positionPreview(preview);\n    \n    // Generate same visual styling as the main icon\n    const gradientClass = getGradientClass(this.community.name);\n    const icon = getIconForCommunity(this.community.name);\n    \n    preview.innerHTML = `\n      <div class=\"community-preview-header\">\n        <div class=\"community-preview-icon\" style=\"background: ${getGradientStyle(gradientClass)}\">\n          ${this.community.logoUrl ? \n            `<img src=\"${this.community.logoUrl}\" alt=\"${this.community.name}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n            `<span style=\"font-size: 18px;\">${icon}</span>`\n          }\n        </div>\n        <div class=\"community-preview-info\">\n          <h4>${this.community.name}</h4>\n          <p>Role: ${this.formatRole(this.community.userRole)}</p>\n        </div>\n      </div>\n      \n      <div class=\"community-preview-stats\">\n        <div class=\"community-preview-stat\">\n          <span>\uD83D\uDC65</span>\n          <span>Community</span>\n        </div>\n        <div class=\"community-preview-stat\">\n          <span>\u2728</span>\n          <span>${this.community.isMember ? 'Member' : 'Visitor'}</span>\n        </div>\n      </div>\n    `;\n\n    // Portal pattern - append to document.body to escape stacking context\n    document.body.appendChild(preview);\n    \n    // Trigger animation\n    requestAnimationFrame(() => {\n      preview.classList.add('show');\n    });\n\n    this.previewElement = preview;\n    return preview;\n  }\n\n  hide(): void {\n    if (this.previewElement) {\n      this.previewElement.classList.remove('show');\n      \n      // Clean up after animation\n      setTimeout(() => {\n        if (this.previewElement && document.body.contains(this.previewElement)) {\n          document.body.removeChild(this.previewElement);\n        }\n        this.previewElement = null;\n      }, 200);\n    }\n  }\n\n  private positionPreview(preview: HTMLElement): void {\n    // Get absolute position of trigger button\n    const rect = this.triggerElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const previewWidth = 280; // max-width from CSS\n    const spacing = 16; // spacing from trigger\n\n    // Position preview to the right of trigger with some spacing\n    let left = rect.right + spacing;\n    let top = rect.top;\n\n    // Adjust if preview would go off-screen horizontally\n    if (left + previewWidth > viewportWidth - spacing) {\n      // Position to the left of trigger instead\n      left = rect.left - previewWidth - spacing;\n    }\n\n    // Adjust if preview would go off-screen vertically\n    const previewHeight = 120; // estimated height\n    if (top + previewHeight > viewportHeight - spacing) {\n      top = viewportHeight - previewHeight - spacing;\n    }\n\n    // Ensure preview doesn't go above viewport\n    if (top < spacing) {\n      top = spacing;\n    }\n\n    preview.style.left = `${Math.max(spacing, left)}px`;\n    preview.style.top = `${Math.max(spacing, top)}px`;\n  }\n\n  private formatRole(role: string): string {\n    switch (role) {\n      case 'owner': return '\uD83D\uDC51 Owner';\n      case 'admin': return '\u26A1 Admin';\n      case 'moderator': return '\uD83D\uDEE1\uFE0F Moderator';\n      case 'member': return '\uD83D\uDC64 Member';\n      default: return '\uD83D\uDC64 Member';\n    }\n  }\n}\n\n/**\n * Preview Manager - Handles global preview state\n * Ensures only one preview is shown at a time\n */\nexport class CommunityPreviewManager {\n  private static instance: CommunityPreviewManager;\n  private currentPreview: CommunityPreview | null = null;\n\n  static getInstance(): CommunityPreviewManager {\n    if (!CommunityPreviewManager.instance) {\n      CommunityPreviewManager.instance = new CommunityPreviewManager();\n    }\n    return CommunityPreviewManager.instance;\n  }\n\n  showPreview(community: UserCommunityMembership, triggerElement: HTMLElement): void {\n    // Hide any existing preview\n    this.hidePreview();\n\n    // Create and show new preview\n    this.currentPreview = new CommunityPreview(community, triggerElement);\n    this.currentPreview.show();\n  }\n\n  hidePreview(): void {\n    if (this.currentPreview) {\n      this.currentPreview.hide();\n      this.currentPreview = null;\n    }\n  }\n} ", "/**\n * QRCodeGenerator - Utility for generating QR codes containing session transfer data\n * \n * Handles encoding session data directly into QR codes for cross-device transfer.\n * No backend required - sessions are encoded as JSON directly into the QR code.\n */\n\nimport QRCode from 'qrcode';\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\nexport interface QRTransferData {\n  sessions: SessionTransferData[];\n  timestamp: number;\n  version: string;\n  sourceDevice?: string;\n}\n\nexport interface SessionTransferData {\n  sessionToken: string;\n  userId: string;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress?: string;\n  ensName?: string;\n  upAddress?: string;\n  name?: string;\n  profileImageUrl?: string;\n  expiresAt: string; // ISO string for JSON serialization\n  lastAccessedAt: string; // ISO string for JSON serialization\n  isActive: boolean;\n}\n\nexport interface QRGenerationOptions {\n  width?: number;\n  errorCorrectionLevel?: 'L' | 'M' | 'Q' | 'H';\n  margin?: number;\n  darkColor?: string;\n  lightColor?: string;\n}\n\n// ============================================================================\n// QR CODE GENERATOR CLASS\n// ============================================================================\n\nexport class QRCodeGenerator {\n  private static readonly DEFAULT_OPTIONS: Required<QRGenerationOptions> = {\n    width: 256,\n    errorCorrectionLevel: 'M',\n    margin: 1,\n    darkColor: '#000000',\n    lightColor: '#FFFFFF'\n  };\n\n  /**\n   * Generate QR code containing session data directly\n   * @param sessions - Array of session data to transfer\n   * @param options - QR code generation options\n   * @returns Data URL for QR code image\n   */\n  static async generateSessionTransferQR(\n    sessions: SessionTransferData[], \n    options: QRGenerationOptions = {}\n  ): Promise<string> {\n    try {\n      // Filter out expired or inactive sessions\n      const validSessions = this.filterValidSessions(sessions);\n      \n      if (validSessions.length === 0) {\n        throw new Error('No valid sessions to transfer');\n      }\n\n      // Create transfer data structure\n      const transferData: QRTransferData = {\n        sessions: validSessions,\n        timestamp: Date.now(),\n        version: '1.0',\n        sourceDevice: this.getDeviceInfo()\n      };\n\n      // Encode as JSON string\n      const dataString = JSON.stringify(transferData);\n      \n      // Generate QR code with full options\n      const finalOptions = { ...this.DEFAULT_OPTIONS, ...options };\n      \n      const qrDataUrl = await QRCode.toDataURL(dataString, {\n        errorCorrectionLevel: finalOptions.errorCorrectionLevel,\n        width: finalOptions.width,\n        margin: finalOptions.margin,\n        color: {\n          dark: finalOptions.darkColor,\n          light: finalOptions.lightColor\n        }\n      });\n      \n      return qrDataUrl;\n\n    } catch (error) {\n      console.error('[QRCodeGenerator] Failed to generate QR code:', error);\n      throw new Error(`QR generation failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Parse session data from QR code scan\n   * @param qrData - Scanned QR code data string\n   * @returns Parsed session transfer data\n   */\n  static parseSessionTransferData(qrData: string): QRTransferData {\n    try {\n      const parsed = JSON.parse(qrData);\n      \n      // Validate required structure\n      if (!this.isValidTransferData(parsed)) {\n        throw new Error('Invalid QR code format - missing required fields');\n      }\n\n      return parsed;\n    } catch (error) {\n      console.error('[QRCodeGenerator] Failed to parse QR data:', error);\n      throw new Error(`QR parsing failed: ${error instanceof Error ? error.message : 'Invalid JSON'}`);\n    }\n  }\n\n  /**\n   * Convert SessionManager session data to transfer format\n   * @param sessionData - SessionData from SessionManager\n   * @returns Session data formatted for transfer\n   */\n  static convertToTransferFormat(sessionData: any): SessionTransferData {\n    return {\n      sessionToken: sessionData.sessionToken,\n      userId: sessionData.userId,\n      identityType: sessionData.identityType,\n      walletAddress: sessionData.walletAddress,\n      ensName: sessionData.ensName,\n      upAddress: sessionData.upAddress,\n      name: sessionData.name,\n      profileImageUrl: sessionData.profileImageUrl,\n      expiresAt: sessionData.expiresAt instanceof Date \n        ? sessionData.expiresAt.toISOString() \n        : sessionData.expiresAt,\n      lastAccessedAt: sessionData.lastAccessedAt instanceof Date \n        ? sessionData.lastAccessedAt.toISOString() \n        : sessionData.lastAccessedAt,\n      isActive: sessionData.isActive\n    };\n  }\n\n  // ============================================================================\n  // PRIVATE HELPER METHODS\n  // ============================================================================\n\n  /**\n   * Filter out expired or inactive sessions\n   */\n  private static filterValidSessions(sessions: SessionTransferData[]): SessionTransferData[] {\n    const now = new Date();\n    \n    return sessions.filter(session => {\n      // Check if session is active\n      if (!session.isActive) return false;\n      \n      // Check if session is not expired\n      const expiresAt = new Date(session.expiresAt);\n      if (expiresAt <= now) return false;\n      \n      // Check if required fields exist\n      if (!session.sessionToken || !session.userId) return false;\n      \n      return true;\n    });\n  }\n\n  /**\n   * Validate QR transfer data structure\n   */\n  private static isValidTransferData(data: any): data is QRTransferData {\n    return (\n      data &&\n      typeof data === 'object' &&\n      Array.isArray(data.sessions) &&\n      typeof data.timestamp === 'number' &&\n      typeof data.version === 'string' &&\n      data.sessions.every((session: any) => \n        session.sessionToken && \n        session.userId && \n        session.identityType\n      )\n    );\n  }\n\n  /**\n   * Get basic device information for debugging\n   */\n  private static getDeviceInfo(): string {\n    try {\n      const userAgent = navigator.userAgent;\n      return userAgent.slice(0, 50); // Truncate for QR size\n    } catch (error) {\n      return 'Unknown Device';\n    }\n  }\n\n  /**\n   * Estimate QR code data size\n   * @param data - Transfer data to measure\n   * @returns Size in bytes\n   */\n  static estimateDataSize(data: QRTransferData): number {\n    return new Blob([JSON.stringify(data)]).size;\n  }\n\n  /**\n   * Check if data size is within QR code limits\n   * @param data - Transfer data to check\n   * @returns Whether data fits in QR code\n   */\n  static isDataSizeValid(data: QRTransferData): boolean {\n    const size = this.estimateDataSize(data);\n    // QR codes with error correction level M can handle ~1800 bytes\n    return size < 1500; // Conservative limit\n  }\n} ", "/**\n * QRCodeDialog - Responsive dialog component for displaying QR codes\n * \n * Handles QR code display with session transfer information, countdown timer,\n * and responsive design for mobile/desktop compatibility.\n */\n\nimport { QRCodeGenerator, type SessionTransferData } from './QRCodeGenerator';\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\nexport interface QRCodeDialogOptions {\n  sessions: SessionTransferData[];\n  onClose?: () => void;\n  title?: string;\n  showCopyButton?: boolean;\n}\n\n// ============================================================================\n// QR CODE DIALOG CLASS\n// ============================================================================\n\nexport class QRCodeDialog {\n  private options: QRCodeDialogOptions;\n  private dialogElement: HTMLElement | null = null;\n  private backdropElement: HTMLElement | null = null;\n  private qrDataUrl: string | null = null;\n  private isVisible: boolean = false;\n\n  constructor(options: QRCodeDialogOptions) {\n    this.options = {\n      title: 'Share Login QR Code',\n      showCopyButton: true,\n      ...options\n    };\n  }\n\n  /**\n   * Show the QR code dialog\n   */\n  async show(): Promise<void> {\n    try {\n      // Generate QR code\n      console.log('[QRCodeDialog] Generating QR code for', this.options.sessions.length, 'sessions');\n      this.qrDataUrl = await QRCodeGenerator.generateSessionTransferQR(this.options.sessions);\n\n      // Create and show dialog\n      this.createDialog();\n      this.appendToDocument();\n      this.setupEventHandlers();\n      \n      // Animate in\n      setTimeout(() => {\n        if (this.backdropElement) {\n          this.backdropElement.classList.add('qr-dialog-backdrop-visible');\n        }\n        if (this.dialogElement) {\n          this.dialogElement.classList.add('qr-dialog-visible');\n        }\n      }, 10);\n\n      this.isVisible = true;\n      \n      // Focus trap\n      this.focusDialog();\n\n    } catch (error) {\n      console.error('[QRCodeDialog] Failed to show dialog:', error);\n      throw new Error(`Failed to display QR code: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Hide the QR code dialog\n   */\n  hide(): void {\n    if (!this.isVisible) return;\n\n    // Animate out\n    if (this.backdropElement) {\n      this.backdropElement.classList.remove('qr-dialog-backdrop-visible');\n    }\n    if (this.dialogElement) {\n      this.dialogElement.classList.remove('qr-dialog-visible');\n    }\n\n    // Remove after animation\n    setTimeout(() => {\n      this.cleanup();\n    }, 200); // Match CSS transition duration\n\n    this.isVisible = false;\n\n    // Call onClose callback\n    if (this.options.onClose) {\n      this.options.onClose();\n    }\n  }\n\n  // ============================================================================\n  // PRIVATE METHODS\n  // ============================================================================\n\n  /**\n   * Create the dialog DOM structure\n   */\n  private createDialog(): void {\n    // Create backdrop\n    this.backdropElement = document.createElement('div');\n    this.backdropElement.className = 'qr-dialog-backdrop';\n\n    // Create dialog container\n    this.dialogElement = document.createElement('div');\n    this.dialogElement.className = 'qr-dialog';\n    this.dialogElement.setAttribute('role', 'dialog');\n    this.dialogElement.setAttribute('aria-modal', 'true');\n    this.dialogElement.setAttribute('aria-labelledby', 'qr-dialog-title');\n\n    // Build dialog content\n    this.dialogElement.innerHTML = this.createDialogHTML();\n\n    // Append dialog to backdrop\n    this.backdropElement.appendChild(this.dialogElement);\n  }\n\n  /**\n   * Create the dialog HTML content\n   */\n  private createDialogHTML(): string {\n    const sessionCount = this.options.sessions.length;\n    const sessionText = sessionCount === 1 ? 'account' : 'accounts';\n\n    return `\n      <div class=\"qr-dialog-header\">\n        <h3 id=\"qr-dialog-title\" class=\"qr-dialog-title\">\n          ${this.options.title}\n        </h3>\n        <button class=\"qr-dialog-close\" aria-label=\"Close dialog\">\n          \u00D7\n        </button>\n      </div>\n\n      <div class=\"qr-dialog-content\">\n        <div class=\"qr-code-container\">\n          <img \n            src=\"${this.qrDataUrl}\" \n            alt=\"QR Code for session transfer\" \n            class=\"qr-code-image\"\n          />\n        </div>\n\n        <div class=\"qr-transfer-info\">\n          <p class=\"qr-session-count\">\n            \uD83D\uDCF1 Transferring ${sessionCount} ${sessionText}\n          </p>\n          <p class=\"qr-instructions\">\n            Scan this code with your mobile device to transfer your login sessions\n          </p>\n        </div>\n\n        ${this.options.showCopyButton ? `\n          <div class=\"qr-actions\">\n            <button class=\"qr-copy-button\">\n              \uD83D\uDCCB Copy Sessions Data\n            </button>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }\n\n  /**\n   * Append dialog to document\n   */\n  private appendToDocument(): void {\n    if (this.backdropElement) {\n      document.body.appendChild(this.backdropElement);\n      \n      // Prevent body scroll\n      document.body.style.overflow = 'hidden';\n    }\n  }\n\n  /**\n   * Setup event handlers\n   */\n  private setupEventHandlers(): void {\n    if (!this.backdropElement || !this.dialogElement) return;\n\n    // Close button\n    const closeButton = this.dialogElement.querySelector('.qr-dialog-close');\n    if (closeButton) {\n      closeButton.addEventListener('click', () => this.hide());\n    }\n\n    // Copy button\n    const copyButton = this.dialogElement.querySelector('.qr-copy-button');\n    if (copyButton && this.options.showCopyButton) {\n      copyButton.addEventListener('click', () => this.handleCopyData());\n    }\n\n    // Backdrop click to close\n    this.backdropElement.addEventListener('click', (e) => {\n      if (e.target === this.backdropElement) {\n        this.hide();\n      }\n    });\n\n    // Escape key to close\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        this.hide();\n        document.removeEventListener('keydown', handleKeyDown);\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n  }\n\n  /**\n   * Handle copy sessions data\n   */\n  private async handleCopyData(): Promise<void> {\n    try {\n      const transferData = {\n        sessions: this.options.sessions,\n        timestamp: Date.now(),\n        version: '1.0'\n      };\n      \n      const dataString = JSON.stringify(transferData, null, 2);\n      \n      if (navigator.clipboard) {\n        await navigator.clipboard.writeText(dataString);\n        console.log('[QRCodeDialog] Session data copied to clipboard');\n        \n        // Show success feedback\n        this.showCopySuccess();\n      } else {\n        // Fallback for older browsers\n        this.fallbackCopyToClipboard(dataString);\n      }\n    } catch (error) {\n      console.error('[QRCodeDialog] Failed to copy data:', error);\n      this.showCopyError();\n    }\n  }\n\n  /**\n   * Show copy success feedback\n   */\n  private showCopySuccess(): void {\n    const copyButton = this.dialogElement?.querySelector('.qr-copy-button');\n    if (copyButton) {\n      const originalText = copyButton.textContent;\n      copyButton.textContent = '\u2705 Copied!';\n      copyButton.setAttribute('disabled', 'true');\n      \n      setTimeout(() => {\n        copyButton.textContent = originalText;\n        copyButton.removeAttribute('disabled');\n      }, 2000);\n    }\n  }\n\n  /**\n   * Show copy error feedback\n   */\n  private showCopyError(): void {\n    const copyButton = this.dialogElement?.querySelector('.qr-copy-button');\n    if (copyButton) {\n      const originalText = copyButton.textContent;\n      copyButton.textContent = '\u274C Copy failed';\n      \n      setTimeout(() => {\n        copyButton.textContent = originalText;\n      }, 2000);\n    }\n  }\n\n  /**\n   * Fallback copy method for older browsers\n   */\n  private fallbackCopyToClipboard(text: string): void {\n    const textArea = document.createElement('textarea');\n    textArea.value = text;\n    textArea.style.position = 'fixed';\n    textArea.style.left = '-999999px';\n    textArea.style.top = '-999999px';\n    \n    document.body.appendChild(textArea);\n    textArea.select();\n    \n    try {\n      document.execCommand('copy');\n      this.showCopySuccess();\n    } catch (error) {\n      console.error('[QRCodeDialog] Fallback copy failed:', error);\n      this.showCopyError();\n    } finally {\n      document.body.removeChild(textArea);\n    }\n  }\n\n  /**\n   * Focus the dialog for accessibility\n   */\n  private focusDialog(): void {\n    if (this.dialogElement) {\n      this.dialogElement.focus();\n    }\n  }\n\n  /**\n   * Cleanup dialog and restore page state\n   */\n  private cleanup(): void {\n    // Remove from DOM\n    if (this.backdropElement && this.backdropElement.parentNode) {\n      this.backdropElement.parentNode.removeChild(this.backdropElement);\n    }\n\n    // Restore body scroll\n    document.body.style.overflow = '';\n\n    // Clear references\n    this.dialogElement = null;\n    this.backdropElement = null;\n    this.qrDataUrl = null;\n  }\n\n  /**\n   * Check if dialog is currently visible\n   */\n  isOpen(): boolean {\n    return this.isVisible;\n  }\n} ", "/**\n * UserProfile Component\n * Renders the user profile section at the bottom of the sidebar\n * \n * Extracted from InternalPluginHost.ts for better maintainability\n * Handles: avatar display, identity indicators, profile menu interactions\n * Enhanced with SessionManager integration for multi-account support\n */\n\nimport { getGradientClass, getGradientStyle, getUserInitials, getIdentityIcon } from '../../styling';\nimport { sessionManager, SessionData } from '../../../SessionManager';\nimport { QRCodeGenerator, QRCodeDialog, type SessionTransferData } from '../qr';\n\nexport interface UserProfile {\n  userId: string;\n  name: string;\n  profilePictureUrl: string | null;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress: string | null;\n  ensDomain: string | null;\n  upAddress: string | null;\n  isAnonymous: boolean;\n}\n\nexport interface UserProfileOptions {\n  userProfile: UserProfile;\n  onMenuAction?: (action: string) => void;\n}\n\nexport class UserProfileComponent {\n  private userProfile: UserProfile;\n  private options: UserProfileOptions;\n  private element: HTMLElement | null = null;\n  private profileMenuElement: HTMLElement | null = null;\n  \n  // SessionManager integration\n  private sessionManager = sessionManager;\n  private sessionSubscription: (() => void) | null = null;\n  private allSessions: SessionData[] = [];\n\n  constructor(options: UserProfileOptions) {\n    this.userProfile = options.userProfile;\n    this.options = options;\n    \n    // Subscribe to session changes for reactive menu updates\n    this.sessionSubscription = this.sessionManager.subscribe((sessions, activeToken, activeSession) => {\n      this.allSessions = sessions;\n      this.refreshMenu();\n    });\n    \n    // Initial load of sessions\n    this.allSessions = this.sessionManager.getAllSessions();\n  }\n  \n  /**\n   * Refresh menu when sessions change\n   * \uD83C\uDFAF FIX: Enhanced logging and session data synchronization\n   */\n  private refreshMenu(): void {\n    if (this.profileMenuElement && this.profileMenuElement.classList.contains('show')) {\n      // Menu is currently open, update its content with fresh session data\n      console.log('[UserProfile] \uD83D\uDD27 Refreshing open menu with updated session data');\n      \n      // Update our session cache first\n      this.allSessions = this.sessionManager.getAllSessions();\n      console.log('[UserProfile] \uD83D\uDD27 Updated session cache, count:', this.allSessions.length);\n      \n      const headerHtml = this.createActiveSessionHeader();\n      const sessionsHtml = this.createAvailableSessions();\n      const actionsHtml = this.createMenuActions();\n      \n      this.profileMenuElement.innerHTML = headerHtml + sessionsHtml + actionsHtml;\n      \n      // Re-attach event handlers since innerHTML replaced the content\n      this.attachMenuHandlers(this.profileMenuElement);\n      \n      console.log('[UserProfile] \u2705 Menu content refreshed with correct session data');\n    } else {\n      // Menu is not open, but still update our session cache for next time\n      this.allSessions = this.sessionManager.getAllSessions();\n      console.log('[UserProfile] \uD83D\uDD27 Updated session cache (menu closed), count:', this.allSessions.length);\n    }\n  }\n\n  render(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'user-profile-section';\n    \n    const avatar = document.createElement('div');\n    avatar.className = 'user-profile-avatar';\n\n    // Create avatar content (image or fallback)\n    if (this.userProfile.profilePictureUrl) {\n      this.addUserImage(avatar);\n    } else {\n      this.addUserAvatarFallback(avatar);\n    }\n\n    // Add identity type indicator\n    this.addIdentityIndicator(avatar);\n\n    // Profile menu interactions - click-based\n    this.setupMenuInteractions(avatar);\n\n    section.appendChild(avatar);\n    this.element = section;\n    return section;\n  }\n\n  private addUserImage(avatar: HTMLElement): void {\n    const img = document.createElement('img');\n    img.src = this.userProfile.profilePictureUrl!;\n    img.alt = this.userProfile.name;\n    img.style.cssText = `\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      border-radius: inherit;\n    `;\n    img.onerror = () => {\n      // Fallback to gradient + initials if image fails\n      avatar.removeChild(img);\n      this.addUserAvatarFallback(avatar);\n    };\n    avatar.appendChild(img);\n  }\n\n  private addUserAvatarFallback(avatar: HTMLElement): void {\n    const name = this.userProfile.name || 'User';\n    const gradientClass = getGradientClass(name);\n    \n    // Set gradient background\n    avatar.style.background = getGradientStyle(gradientClass);\n    \n    // Add initials\n    const initials = document.createElement('span');\n    initials.textContent = getUserInitials(name);\n    initials.style.cssText = `\n      color: white;\n      font-weight: 600;\n      font-size: 18px;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n    `;\n    avatar.appendChild(initials);\n  }\n\n  private addIdentityIndicator(avatar: HTMLElement): void {\n    const indicator = document.createElement('div');\n    indicator.style.cssText = `\n      position: absolute;\n      bottom: -2px;\n      right: -2px;\n      width: 18px;\n      height: 18px;\n      border: 2px solid var(--sidebar-bg-from, #f8fafc);\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      background: ${this.getIdentityColor()};\n    `;\n\n    indicator.textContent = getIdentityIcon(this.userProfile.identityType || 'anonymous');\n    avatar.appendChild(indicator);\n  }\n\n  private setupMenuInteractions(avatar: HTMLElement): void {\n    const showMenu = () => {\n      if (this.profileMenuElement) return; // Already open\n\n      this.profileMenuElement = this.createUserProfileMenu(avatar);\n      if (this.profileMenuElement) {\n        document.body.appendChild(this.profileMenuElement);\n        \n        requestAnimationFrame(() => {\n          this.profileMenuElement?.classList.add('show');\n        });\n      }\n    };\n\n    const hideMenu = () => {\n      if (this.profileMenuElement) {\n        this.profileMenuElement.classList.remove('show');\n        setTimeout(() => {\n          if (this.profileMenuElement && document.body.contains(this.profileMenuElement)) {\n            document.body.removeChild(this.profileMenuElement);\n          }\n          this.profileMenuElement = null;\n        }, 200);\n      }\n    };\n\n    // Click to toggle menu\n    avatar.addEventListener('click', (e) => {\n      e.stopPropagation();\n      if (this.profileMenuElement) {\n        hideMenu();\n      } else {\n        showMenu();\n      }\n    });\n\n    // Click outside to close menu\n    document.addEventListener('click', (e) => {\n      if (this.profileMenuElement && \n          !this.profileMenuElement.contains(e.target as Node) && \n          !avatar.contains(e.target as Node)) {\n        hideMenu();\n      }\n    });\n  }\n\n  private createUserProfileMenu(triggerElement: HTMLElement): HTMLElement {\n    const menu = document.createElement('div');\n    menu.className = 'user-profile-menu';\n    \n    // \uD83C\uDFAF THEME CLEANUP: No longer need manual theme detection/setting\n    // InternalPluginHost now sets document.documentElement classes properly\n    // CSS selectors will work automatically: .dark .user-profile-menu { }\n    \n    // Position menu relative to trigger element\n    this.positionMenu(menu, triggerElement);\n\n    // Build menu sections\n    const headerHtml = this.createActiveSessionHeader();\n    const sessionsHtml = this.createAvailableSessions();\n    const actionsHtml = this.createMenuActions();\n    \n    menu.innerHTML = headerHtml + sessionsHtml + actionsHtml;\n\n    // Enhanced click handlers for sessions and actions\n    this.attachMenuHandlers(menu);\n\n    return menu;\n  }\n\n  /**\n   * Create the active session header section\n   * \uD83C\uDFAF FIX: Always use SessionManager as source of truth for active session\n   */\n  private createActiveSessionHeader(): string {\n    const activeSession = this.sessionManager.getActiveSession();\n    console.log('[UserProfile] \uD83D\uDD27 Creating header for active session:', activeSession?.sessionToken, activeSession?.name);\n    \n    if (!activeSession) {\n      console.warn('[UserProfile] \u26A0\uFE0F No active session found, falling back to userProfile data');\n      // Fallback to static userProfile if no active session\n      const userName = this.userProfile.name || 'Anonymous User';\n      const hasProfileImage = !!this.userProfile.profilePictureUrl;\n      const gradientClass = this.getGradientClass(userName);\n      const gradientStyle = this.getGradientStyle(gradientClass);\n      \n      return `\n        <div class=\"profile-menu-header\">\n          <div class=\"profile-menu-avatar\" style=\"background: ${hasProfileImage ? 'transparent' : gradientStyle}\">\n            ${hasProfileImage ? \n              `<img src=\"${this.userProfile.profilePictureUrl}\" alt=\"${userName}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n              `<span style=\"color: white; font-weight: 600; font-size: 18px;\">${this.getUserInitials(userName)}</span>`\n            }\n          </div>\n          <div class=\"profile-menu-info\">\n            <h4>${userName}</h4>\n            <p>${this.getIdentityLabel()} \u2022 Active (Fallback)</p>\n          </div>\n        </div>\n      `;\n    }\n    \n    // Use active session data - this should always be the source of truth\n    const userName = activeSession.name || 'Anonymous User';\n    const hasProfileImage = !!activeSession.profileImageUrl;\n    const gradientClass = this.getGradientClass(userName);\n    const gradientStyle = this.getGradientStyle(gradientClass);\n    \n    console.log('[UserProfile] \u2705 Using active session data for header:', {\n      token: activeSession.sessionToken,\n      name: userName,\n      identityType: activeSession.identityType,\n      hasImage: hasProfileImage\n    });\n    \n    return `\n      <div class=\"profile-menu-header\">\n        <div class=\"profile-menu-avatar\" style=\"background: ${hasProfileImage ? 'transparent' : gradientStyle}\">\n          ${hasProfileImage ? \n            `<img src=\"${activeSession.profileImageUrl}\" alt=\"${userName}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n            `<span style=\"color: white; font-weight: 600; font-size: 18px;\">${this.getUserInitials(userName)}</span>`\n          }\n        </div>\n        <div class=\"profile-menu-info\">\n          <h4>${userName}</h4>\n          <p>${this.getIdentityTypeLabel(activeSession.identityType)} \u2022 Active</p>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Create the available sessions section\n   * \uD83C\uDFAF FIX: Ensure proper filtering and deduplication with active session priority\n   */\n  private createAvailableSessions(): string {\n    const activeToken = this.sessionManager.getActiveToken();\n    const activeSession = this.sessionManager.getActiveSession();\n    console.log('[UserProfile] \uD83D\uDD27 Creating available sessions list (active token:', activeToken, ')');\n    console.log('[UserProfile] \uD83D\uDD27 All sessions count:', this.allSessions.length);\n    \n    // 1. Filter out active session (it's shown in header)\n    let inactiveSessions = this.allSessions.filter(session => {\n      const isActive = session.sessionToken === activeToken;\n      if (isActive) {\n        console.log('[UserProfile] \uD83D\uDD27 Filtering out active session:', session.sessionToken, session.name);\n      }\n      return !isActive;\n    });\n    \n    console.log('[UserProfile] \uD83D\uDD27 Inactive sessions count:', inactiveSessions.length);\n    \n    // 2. \uD83C\uDFAF NEW: If active session is anonymous, hide ALL other anonymous sessions\n    if (activeSession?.identityType === 'anonymous') {\n      const beforeCount = inactiveSessions.length;\n      inactiveSessions = inactiveSessions.filter(session => {\n        const isAnonymous = session.identityType === 'anonymous';\n        if (isAnonymous) {\n          console.log('[UserProfile] \uD83C\uDFAF Hiding anonymous session (active is anonymous):', session.sessionToken);\n        }\n        return !isAnonymous;\n      });\n      console.log('[UserProfile] \uD83C\uDFAF Anonymous session filtering: removed', beforeCount - inactiveSessions.length, 'sessions');\n    }\n    \n    // 3. \uD83C\uDFAF Deduplicate by actual identity (display-only filtering)\n    // Note: deduplication now properly handles active session priority\n    const uniqueSessions = this.deduplicateSessionsByIdentity(inactiveSessions);\n    \n    console.log('[UserProfile] \uD83D\uDD27 Unique sessions after deduplication:', uniqueSessions.length);\n    \n    if (uniqueSessions.length === 0) {\n      console.log('[UserProfile] \uD83D\uDD27 No available sessions to show');\n      return ''; // No available sessions section\n    }\n    \n    const sessionsHtml = uniqueSessions.map(session => {\n      const sessionName = session.name || 'Unknown User';\n      const hasImage = !!session.profileImageUrl;\n      const gradientClass = this.getGradientClass(sessionName);\n      const gradientStyle = this.getGradientStyle(gradientClass);\n      \n      return `\n        <div class=\"profile-menu-session\" data-action=\"switch-session\" data-token=\"${session.sessionToken}\">\n          <div class=\"profile-session-avatar\" style=\"background: ${hasImage ? 'transparent' : gradientStyle}\">\n            ${hasImage ? \n              `<img src=\"${session.profileImageUrl}\" alt=\"${sessionName}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n              `<span style=\"color: white; font-weight: 600; font-size: 12px;\">${this.getUserInitials(sessionName)}</span>`\n            }\n          </div>\n          <div class=\"profile-session-info\">\n            <div class=\"profile-session-name\">${sessionName}</div>\n            <div class=\"profile-session-type\">${this.getIdentityTypeLabel(session.identityType)}</div>\n          </div>\n        </div>\n      `;\n    }).join('');\n    \n    return `\n      <div class=\"profile-menu-sessions\">\n        <div class=\"profile-menu-section-label\">Available Accounts</div>\n        ${sessionsHtml}\n      </div>\n    `;\n  }\n\n  /**\n   * Get unique identity key for session deduplication\n   * \uD83C\uDFAF FIX: Anonymous sessions are treated as one identity (no wallet differentiation)\n   */\n  private getIdentityKey(session: SessionData): string {\n    switch (session.identityType) {\n      case 'ens':\n        return `ens:${session.ensName}`;           // e.g., \"ens:vitalik.eth\" (unique per ENS name)\n      case 'universal_profile':\n        return `up:${session.upAddress}`;          // e.g., \"up:0x123...\" (unique per UP address)\n      case 'anonymous':\n        return 'anonymous';                        // \uD83C\uDFAF ALL anonymous sessions = same identity\n      default:\n        return `user:${session.userId}`;           // Fallback to userId\n    }\n  }\n\n  /**\n   * Deduplicate sessions by actual identity, keeping most recent for each unique identity\n   * This is display-only filtering - all sessions remain in storage\n   * \uD83C\uDFAF FIX: Prioritize currently active session over lastAccessedAt\n   */\n  private deduplicateSessionsByIdentity(sessions: SessionData[]): SessionData[] {\n    const identityMap = new Map<string, SessionData>();\n    const activeToken = this.sessionManager.getActiveToken();\n    \n    for (const session of sessions) {\n      const identityKey = this.getIdentityKey(session);\n      const existing = identityMap.get(identityKey);\n      \n      if (!existing) {\n        // First session for this identity\n        identityMap.set(identityKey, session);\n      } else {\n        // Decide which session to keep for this identity\n        let shouldReplace = false;\n        \n        // \uD83C\uDFAF PRIORITY 1: Always keep the currently active session\n        if (session.sessionToken === activeToken) {\n          shouldReplace = true;\n          console.log('[UserProfile] \uD83C\uDFAF Keeping active session for identity:', identityKey, session.sessionToken);\n        } \n        // \uD83C\uDFAF PRIORITY 2: Don't replace if existing is the active session\n        else if (existing.sessionToken === activeToken) {\n          shouldReplace = false;\n          console.log('[UserProfile] \uD83C\uDFAF Preserving active session for identity:', identityKey, existing.sessionToken);\n        }\n        // \uD83C\uDFAF PRIORITY 3: Fall back to lastAccessedAt for non-active sessions\n        else if (session.lastAccessedAt > existing.lastAccessedAt) {\n          shouldReplace = true;\n        }\n        \n        if (shouldReplace) {\n          identityMap.set(identityKey, session);\n        }\n      }\n    }\n    \n    return Array.from(identityMap.values());\n  }\n\n  // \uD83C\uDFAF REMOVED detectDarkTheme() method - no longer needed!\n  // InternalPluginHost now handles document theme classes properly\n  // CSS selectors automatically work: .dark .user-profile-menu { }\n\n  /**\n   * Create the menu actions section  \n   */\n  private createMenuActions(): string {\n    // Check if we have transferable sessions for QR code generation\n    const transferableSessions = this.getTransferableSessions();\n    const hasTransferableSessions = transferableSessions.length > 0;\n    \n    return `\n      <div class=\"profile-menu-actions\">\n        <button class=\"profile-menu-action\" data-action=\"add-session\">\n          <div class=\"profile-menu-action-icon\">\u2795</div>\n          <span>Add Another Account</span>\n        </button>\n        ${hasTransferableSessions ? `\n          <button class=\"profile-menu-action\" data-action=\"share-qr\">\n            <div class=\"profile-menu-action-icon\">\uD83D\uDCF1</div>\n            <span>Share Login QR</span>\n            <div class=\"profile-menu-action-badge\">${transferableSessions.length}</div>\n          </button>\n        ` : ''}\n        <button class=\"profile-menu-action\" data-action=\"sign-out\">\n          <div class=\"profile-menu-action-icon\">\uD83D\uDEAA</div>\n          <span>Sign Out</span>\n        </button>\n      </div>\n    `;\n  }\n\n  /**\n   * Get identity type label for display\n   */\n  private getIdentityTypeLabel(identityType: 'ens' | 'universal_profile' | 'anonymous'): string {\n    switch (identityType) {\n      case 'ens':\n        return 'ENS';\n      case 'universal_profile':\n        return 'Universal Profile';\n      case 'anonymous':\n        return 'Guest';\n      default:\n        return 'User';\n    }\n  }\n\n  /**\n   * Get sessions that can be transferred via QR code\n   */\n  private getTransferableSessions(): SessionTransferData[] {\n    const allSessions = this.sessionManager.getAllSessions();\n    const now = new Date();\n    \n    return allSessions\n      .filter(session => {\n        // Must be active and not expired\n        if (!session.isActive || session.expiresAt <= now) return false;\n        \n        // Must have required fields\n        if (!session.sessionToken || !session.userId) return false;\n        \n        return true;\n      })\n      .map(session => QRCodeGenerator.convertToTransferFormat(session));\n  }\n\n  /**\n   * Handle QR code generation and display\n   */\n  private async handleShareQR(): Promise<void> {\n    try {\n      console.log('[UserProfile] Generating QR code for session transfer');\n      \n      // Get transferable sessions\n      const transferableSessions = this.getTransferableSessions();\n      \n      if (transferableSessions.length === 0) {\n        console.warn('[UserProfile] No transferable sessions available');\n        // Could show an error message to user here\n        return;\n      }\n\n      console.log('[UserProfile] Found', transferableSessions.length, 'transferable sessions');\n\n      // Create and show QR dialog\n      const qrDialog = new QRCodeDialog({\n        sessions: transferableSessions,\n        onClose: () => {\n          console.log('[UserProfile] QR dialog closed');\n          qrDialog.hide();\n        }\n      });\n\n      await qrDialog.show();\n      \n      console.log('[UserProfile] QR dialog displayed successfully');\n      \n    } catch (error) {\n      console.error('[UserProfile] Failed to generate QR code:', error);\n      // Could show error message to user here\n    }\n  }\n\n  /**\n   * Attach enhanced click handlers for menu interactions\n   */\n  private attachMenuHandlers(menu: HTMLElement): void {\n    menu.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n      const actionElement = target.closest('[data-action]') as HTMLElement;\n      \n      if (!actionElement) return;\n      \n      const action = actionElement.getAttribute('data-action');\n      const token = actionElement.getAttribute('data-token');\n      \n      if (action === 'switch-session' && token) {\n        // Handle session switching directly\n        this.handleSessionSwitch(token);\n      } else if (action === 'share-qr') {\n        // Handle QR code generation directly\n        this.handleShareQR();\n      } else if (action && this.options.onMenuAction) {\n        // Handle other actions through parent callback\n        this.options.onMenuAction(action);\n      }\n    });\n  }\n\n  /**\n   * Handle session switching\n   * \uD83D\uDE80 FIX: Delegate to parent via callback instead of direct SessionManager call\n   */\n  private async handleSessionSwitch(sessionToken: string): Promise<void> {\n    try {\n      console.log('[UserProfileComponent] Delegating session switch to parent:', sessionToken);\n      \n      // Delegate to parent using existing callback pattern with token encoded in action\n      if (this.options.onMenuAction) {\n        this.options.onMenuAction(`switch-session:${sessionToken}`);\n      } else {\n        console.warn('[UserProfileComponent] No onMenuAction callback available for session switch');\n      }\n      \n      console.log('[UserProfileComponent] Session switch delegated successfully');\n    } catch (error) {\n      console.error('[UserProfileComponent] Failed to delegate session switch:', error);\n    }\n  }\n\n  private positionMenu(menu: HTMLElement, triggerElement: HTMLElement): void {\n    const rect = triggerElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const menuWidth = 320;\n    const spacing = 8;\n    \n    // Position menu ABOVE the button using BOTTOM positioning\n    let left = rect.right + spacing;\n    let bottom = viewportHeight - rect.top + spacing;\n\n    // Adjust if menu would go off-screen horizontally\n    if (left + menuWidth > viewportWidth - spacing) {\n      left = rect.left - menuWidth - spacing;\n    }\n    \n    if (left < spacing) {\n      left = spacing;\n    }\n\n    menu.style.left = `${left}px`;\n    menu.style.bottom = `${bottom}px`;\n  }\n\n  private getIdentityColor(): string {\n    switch (this.userProfile.identityType) {\n      case 'ens': return 'linear-gradient(135deg, #3b82f6, #1d4ed8)';\n      case 'universal_profile': return 'linear-gradient(135deg, #ec4899, #be185d)';\n      case 'anonymous': return 'linear-gradient(135deg, #6b7280, #4b5563)';\n      default: return 'linear-gradient(135deg, #6b7280, #4b5563)';\n    }\n  }\n\n  private getIdentityLabel(): string {\n    switch (this.userProfile.identityType) {\n      case 'ens':\n        return this.userProfile.ensDomain ? `ENS: ${this.userProfile.ensDomain}` : 'ENS Domain';\n      case 'universal_profile':\n        return this.userProfile.upAddress ? `UP: ${this.userProfile.upAddress.slice(0, 6)}...${this.userProfile.upAddress.slice(-4)}` : 'Universal Profile';\n      case 'anonymous':\n        return 'Anonymous Session';\n      default:\n        return 'User Account';\n    }\n  }\n\n  private getGradientClass(name: string): string {\n    const gradients = [\n      'gradient-pink-purple',\n      'gradient-blue-cyan', \n      'gradient-emerald-teal',\n      'gradient-orange-pink',\n      'gradient-purple-blue',\n      'gradient-cyan-emerald'\n    ];\n    \n    const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n    return gradients[hash % gradients.length];\n  }\n\n  private getGradientStyle(gradientClass: string): string {\n    const gradientMap: Record<string, string> = {\n      'gradient-pink-purple': 'linear-gradient(135deg, #ec4899, #8b5cf6)',\n      'gradient-blue-cyan': 'linear-gradient(135deg, #3b82f6, #06b6d4)',\n      'gradient-emerald-teal': 'linear-gradient(135deg, #10b981, #14b8a6)',\n      'gradient-orange-pink': 'linear-gradient(135deg, #f97316, #ec4899)',\n      'gradient-purple-blue': 'linear-gradient(135deg, #8b5cf6, #3b82f6)',\n      'gradient-cyan-emerald': 'linear-gradient(135deg, #06b6d4, #10b981)'\n    };\n    \n    return gradientMap[gradientClass] || gradientMap['gradient-blue-cyan'];\n  }\n\n  private getUserInitials(name: string): string {\n    return name\n      .split(' ')\n      .map(word => word.charAt(0))\n      .join('')\n      .substring(0, 2)\n      .toUpperCase();\n  }\n\n  /**\n   * Cleanup method for removing event listeners and DOM elements\n   */\n  destroy(): void {\n    // Cleanup session subscription\n    if (this.sessionSubscription) {\n      this.sessionSubscription();\n      this.sessionSubscription = null;\n    }\n    \n    // Cleanup DOM elements\n    if (this.profileMenuElement) {\n      this.profileMenuElement.remove();\n      this.profileMenuElement = null;\n    }\n    this.element = null;\n  }\n} ", "/**\n * MobileBottomNav Component\n * Bottom navigation bar for mobile devices\n * \n * Displays burger menu + community indicator, messages stub, notifications stub, and profile menu\n */\n\nimport { UserCommunityMembership } from '../sidebar/CommunityItem';\nimport { UserProfile } from '../profile/UserProfile';\nimport { getGradientStyle, getGradientClass, getIconForCommunity, getIconHTML } from '../../styling';\n\nexport interface MobileBottomNavOptions {\n  communities: UserCommunityMembership[];\n  currentCommunityId: string;\n  userProfile: UserProfile;\n  onCommunityMenuClick: () => void;\n  onProfileMenuClick: () => void;\n}\n\nexport class MobileBottomNav {\n  private communities: UserCommunityMembership[];\n  private currentCommunityId: string;\n  private userProfile: UserProfile;\n  private options: MobileBottomNavOptions;\n  private element: HTMLElement | null = null;\n\n  constructor(options: MobileBottomNavOptions) {\n    this.communities = options.communities;\n    this.currentCommunityId = options.currentCommunityId;\n    this.userProfile = options.userProfile;\n    this.options = options;\n  }\n\n  render(): HTMLElement {\n    const bottomNav = document.createElement('div');\n    bottomNav.className = 'curia-mobile-bottom-nav';\n\n    // 1. Community burger menu (left)\n    const communitySection = this.renderCommunityBurger();\n    bottomNav.appendChild(communitySection);\n\n    // 2. Search stub (center-left)\n    const searchSection = this.renderSearchStub();\n    bottomNav.appendChild(searchSection);\n\n    // 3. Messages stub (center)\n    const messagesSection = this.renderMessagesStub();\n    bottomNav.appendChild(messagesSection);\n\n    // 4. Notifications stub (center-right)\n    const notificationsSection = this.renderNotificationsStub();\n    bottomNav.appendChild(notificationsSection);\n\n    // 5. Profile menu (right)\n    const profileSection = this.renderProfileMenu();\n    bottomNav.appendChild(profileSection);\n\n    this.element = bottomNav;\n    return bottomNav;\n  }\n\n  private renderCommunityBurger(): HTMLElement {\n    const currentCommunity = this.communities.find(c => c.id === this.currentCommunityId);\n    \n    const section = document.createElement('div');\n    section.className = 'mobile-nav-section';\n    \n    const burger = document.createElement('div');\n    burger.className = 'mobile-community-burger';\n    \n    // Expand/collapse icon (more cohesive than hamburger)\n    const burgerIcon = document.createElement('div');\n    burgerIcon.className = 'mobile-burger-icon';\n    burgerIcon.innerHTML = '\u2303'; // Up chevron - suggests expandable menu\n    \n    // Community indicator (small version of current community)\n    const indicator = document.createElement('div');\n    indicator.className = 'mobile-community-indicator';\n    \n    if (currentCommunity?.logoUrl) {\n      const img = document.createElement('img');\n      img.src = currentCommunity.logoUrl;\n      img.alt = currentCommunity.name;\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      indicator.appendChild(img);\n    } else if (currentCommunity) {\n      // Gradient fallback\n      const gradientClass = getGradientClass(currentCommunity.name);\n      indicator.style.background = getGradientStyle(gradientClass);\n      \n      const icon = document.createElement('span');\n      icon.textContent = getIconForCommunity(currentCommunity.name);\n      indicator.appendChild(icon);\n    }\n    \n    burger.appendChild(burgerIcon);\n    burger.appendChild(indicator);\n    section.appendChild(burger);\n    \n    // Click handler to open community picker\n    section.addEventListener('click', () => {\n      this.options.onCommunityMenuClick();\n    });\n    \n    return section;\n  }\n\n  private renderSearchStub(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-nav-section inactive';\n    \n    const icon = document.createElement('div');\n    icon.className = 'mobile-stub-icon';\n    icon.innerHTML = getIconHTML('search', { size: 20 }); // Beautiful Lucide search icon\n    \n    section.appendChild(icon);\n    return section;\n  }\n\n  private renderMessagesStub(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-nav-section inactive';\n    \n    const icon = document.createElement('div');\n    icon.className = 'mobile-stub-icon';\n    icon.innerHTML = getIconHTML('messages', { size: 20 }); // Beautiful Lucide message square icon\n    \n    section.appendChild(icon);\n    return section;\n  }\n\n  private renderNotificationsStub(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-nav-section inactive';\n    \n    const icon = document.createElement('div');\n    icon.className = 'mobile-stub-icon';\n    icon.innerHTML = getIconHTML('notifications', { size: 20 }); // Beautiful Lucide bell icon\n    \n    section.appendChild(icon);\n    return section;  \n  }\n\n  private renderProfileMenu(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-nav-section';\n    \n    const profileSection = document.createElement('div');\n    profileSection.className = 'mobile-profile-section';\n    \n    // Profile avatar\n    const avatar = document.createElement('div');\n    avatar.className = 'mobile-profile-avatar';\n    \n    if (this.userProfile.profilePictureUrl) {\n      const img = document.createElement('img');\n      img.src = this.userProfile.profilePictureUrl;\n      img.alt = this.userProfile.name;\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      avatar.appendChild(img);\n    } else {\n      // Gradient fallback with initials\n      const name = this.userProfile.name || 'User';\n      const gradientClass = getGradientClass(name);\n      avatar.style.background = getGradientStyle(gradientClass);\n      \n      const initials = document.createElement('span');\n      initials.textContent = this.getUserInitials(name);\n      initials.style.cssText = `\n        color: white;\n        font-weight: 600;\n        font-size: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      `;\n      avatar.appendChild(initials);\n    }\n    \n    profileSection.appendChild(avatar);\n    section.appendChild(profileSection);\n    \n    // Click handler for profile menu\n    section.addEventListener('click', () => {\n      this.options.onProfileMenuClick();\n    });\n    \n    return section;\n  }\n\n  private getUserInitials(name: string): string {\n    if (!name) return '?';\n    \n    const words = name.trim().split(/\\s+/);\n    if (words.length === 1) {\n      return words[0].substring(0, 2).toUpperCase();\n    }\n    \n    return words\n      .slice(0, 2)\n      .map(word => word.charAt(0).toUpperCase())\n      .join('');\n  }\n\n  /**\n   * Update the active community display\n   */\n  updateActiveCommunity(communityId: string): void {\n    this.currentCommunityId = communityId;\n    \n    if (this.element) {\n      // Re-render community burger section (first child)\n      const burgerSection = this.element.children[0];\n      if (burgerSection) {\n        const newSection = this.renderCommunityBurger();\n        burgerSection.replaceWith(newSection);\n      }\n    }\n  }\n\n  /**\n   * Update communities list\n   */\n  updateCommunities(communities: UserCommunityMembership[]): void {\n    this.communities = communities;\n    this.updateActiveCommunity(this.currentCommunityId);\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    this.element = null;\n  }\n} ", "/**\n * MobileCommunityPicker Component\n * Full-screen modal for community selection on mobile devices\n * \n * Features:\n * - Slide-up animation from bottom\n * - Grid layout with touch-friendly community icons\n * - Dark backdrop with blur effect\n * - Dismiss on backdrop click or close button\n */\n\nimport { UserCommunityMembership } from '../sidebar/CommunityItem';\nimport { getGradientStyle, getGradientClass, getIconForCommunity, getIconHTML } from '../../styling';\n\nexport interface MobileCommunityPickerOptions {\n  communities: UserCommunityMembership[];\n  currentCommunityId: string;\n  onCommunitySelect: (community: UserCommunityMembership) => void;\n  onClose: () => void;\n  onPlusButtonClick?: () => void; // Same callback as desktop\n  embedContainer?: HTMLElement; // \uD83C\uDFAF Container for boundary-respecting modals\n}\n\nexport class MobileCommunityPicker {\n  private communities: UserCommunityMembership[];\n  private currentCommunityId: string;\n  private options: MobileCommunityPickerOptions;\n  private embedContainer: HTMLElement; // \uD83C\uDFAF Container for boundary-respecting modals\n  private element: HTMLElement | null = null;\n  private isVisible: boolean = false;\n\n  constructor(options: MobileCommunityPickerOptions) {\n    this.communities = options.communities;\n    this.currentCommunityId = options.currentCommunityId;\n    this.options = options;\n    this.embedContainer = options.embedContainer || document.body; // \uD83C\uDFAF Fallback to document.body for backward compatibility\n  }\n\n  show(): void {\n    if (this.isVisible) return;\n    \n    this.isVisible = true;\n    const modal = this.render();\n    this.embedContainer.appendChild(modal); // \uD83C\uDFAF Respect embed boundaries - no more hijacking!\n    \n    // Trigger animation after DOM insertion\n    requestAnimationFrame(() => {\n      modal.classList.add('mobile-community-picker-visible');\n    });\n  }\n\n  hide(): void {\n    if (!this.isVisible || !this.element) return;\n    \n    this.isVisible = false;\n    this.element.classList.remove('mobile-community-picker-visible');\n    \n    // Remove from DOM after animation completes\n    setTimeout(() => {\n      if (this.element && this.element.parentNode) {\n        this.element.parentNode.removeChild(this.element);\n      }\n      this.element = null;\n    }, 300); // Match CSS animation duration\n  }\n\n  private render(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'mobile-community-picker-overlay';\n    \n    // Backdrop - clicking dismisses modal\n    const backdrop = document.createElement('div');\n    backdrop.className = 'mobile-community-picker-backdrop';\n    backdrop.addEventListener('click', () => {\n      this.options.onClose();\n    });\n    \n    // Modal content\n    const content = document.createElement('div');\n    content.className = 'mobile-community-picker-content';\n    \n    // Prevent content clicks from dismissing modal\n    content.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    \n    // Header with title and close button\n    const header = this.renderHeader();\n    content.appendChild(header);\n    \n    // Communities grid\n    const grid = this.renderCommunitiesGrid();\n    content.appendChild(grid);\n    \n    // Plus button for discovery\n    const plusSection = this.renderPlusButton();\n    content.appendChild(plusSection);\n    \n    modal.appendChild(backdrop);\n    modal.appendChild(content);\n    \n    this.element = modal;\n    return modal;\n  }\n\n  private renderHeader(): HTMLElement {\n    const header = document.createElement('div');\n    header.className = 'mobile-community-picker-header';\n    \n    const title = document.createElement('h2');\n    title.className = 'mobile-community-picker-title';\n    title.textContent = 'Choose Community';\n    \n    const closeButton = document.createElement('button');\n    closeButton.className = 'mobile-community-picker-close';\n    closeButton.innerHTML = getIconHTML('chevronDown', { size: 24 }); // Beautiful Lucide chevron down\n    closeButton.addEventListener('click', () => {\n      this.options.onClose();\n    });\n    \n    header.appendChild(title);\n    header.appendChild(closeButton);\n    \n    return header;\n  }\n\n  private renderCommunitiesGrid(): HTMLElement {\n    const gridContainer = document.createElement('div');\n    gridContainer.className = 'mobile-community-picker-grid-container';\n    \n    const grid = document.createElement('div');\n    grid.className = 'mobile-community-picker-grid';\n    \n    this.communities.forEach(community => {\n      const item = this.renderCommunityItem(community);\n      grid.appendChild(item);\n    });\n    \n    gridContainer.appendChild(grid);\n    return gridContainer;\n  }\n\n  private renderCommunityItem(community: UserCommunityMembership): HTMLElement {\n    const item = document.createElement('div');\n    item.className = 'mobile-community-picker-item';\n    \n    if (community.id === this.currentCommunityId) {\n      item.classList.add('active');\n    }\n    \n    // Community icon (larger for touch)\n    const icon = document.createElement('div');\n    icon.className = 'mobile-community-picker-icon';\n    \n    if (community.logoUrl) {\n      const img = document.createElement('img');\n      img.src = community.logoUrl;\n      img.alt = community.name;\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      icon.appendChild(img);\n    } else {\n      // Gradient fallback\n      const gradientClass = getGradientClass(community.name);\n      icon.style.background = getGradientStyle(gradientClass);\n      \n      const iconSpan = document.createElement('span');\n      iconSpan.textContent = getIconForCommunity(community.name);\n      iconSpan.style.cssText = `\n        color: white;\n        font-size: 24px;\n        font-weight: 600;\n      `;\n      icon.appendChild(iconSpan);\n    }\n    \n    // Community name\n    const name = document.createElement('div');\n    name.className = 'mobile-community-picker-name';\n    name.textContent = community.name;\n    \n    item.appendChild(icon);\n    item.appendChild(name);\n    \n    // Click handler\n    item.addEventListener('click', () => {\n      this.options.onCommunitySelect(community);\n    });\n    \n    return item;\n  }\n\n  private renderPlusButton(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-community-picker-plus-section';\n    \n    const plusButton = document.createElement('div');\n    plusButton.className = 'mobile-community-picker-plus';\n    \n    const plusIcon = document.createElement('div');\n    plusIcon.className = 'mobile-community-picker-plus-icon';\n    plusIcon.textContent = '+';\n    \n    const plusText = document.createElement('div');\n    plusText.className = 'mobile-community-picker-plus-text';\n    plusText.textContent = 'Discover Communities';\n    \n    plusButton.appendChild(plusIcon);\n    plusButton.appendChild(plusText);\n    \n    // Click handler (same as desktop)\n    plusButton.addEventListener('click', () => {\n      console.log('[MobileCommunityPicker] Plus button clicked - community discovery');\n      if (this.options.onPlusButtonClick) {\n        this.options.onPlusButtonClick();\n      }\n    });\n    \n    section.appendChild(plusButton);\n    return section;\n  }\n\n  /**\n   * Update communities and current selection\n   */\n  updateCommunities(communities: UserCommunityMembership[], currentCommunityId: string): void {\n    this.communities = communities;\n    this.currentCommunityId = currentCommunityId;\n    \n    // Re-render if modal is visible\n    if (this.isVisible && this.element) {\n      const gridContainer = this.element.querySelector('.mobile-community-picker-grid-container');\n      if (gridContainer) {\n        const newGrid = this.renderCommunitiesGrid();\n        gridContainer.replaceWith(newGrid);\n      }\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    this.hide();\n  }\n} ", "/**\n * MobileProfileDrawer Component\n * Full-screen drawer for user profile management on mobile devices\n * \n * Features:\n * - Slide-up animation from bottom\n * - Session management and account switching\n * - Dark backdrop with blur effect\n * - Dismiss on backdrop click or close button\n */\n\nimport { UserProfile } from '../profile/UserProfile';\nimport { getGradientStyle, getGradientClass, getIconHTML } from '../../styling';\nimport { sessionManager, SessionData } from '../../../SessionManager';\nimport { QRCodeGenerator, QRCodeDialog, type SessionTransferData } from '../qr';\n\nexport interface MobileProfileDrawerOptions {\n  userProfile: UserProfile;\n  onMenuAction: (action: string) => void;\n  onClose: () => void;\n  embedContainer?: HTMLElement; // \uD83C\uDFAF Container for boundary-respecting modals\n}\n\nexport class MobileProfileDrawer {\n  private userProfile: UserProfile;\n  private options: MobileProfileDrawerOptions;\n  private embedContainer: HTMLElement; // \uD83C\uDFAF Container for boundary-respecting modals\n  private element: HTMLElement | null = null;\n  private isVisible: boolean = false;\n  \n  // SessionManager integration (same as desktop)\n  private sessionManager = sessionManager;\n  private sessionSubscription: (() => void) | null = null;\n  private allSessions: SessionData[] = [];\n\n  constructor(options: MobileProfileDrawerOptions) {\n    this.userProfile = options.userProfile;\n    this.options = options;\n    this.embedContainer = options.embedContainer || document.body; // \uD83C\uDFAF Fallback to document.body for backward compatibility\n    \n    // Subscribe to session changes for reactive menu updates (same as desktop)\n    this.sessionSubscription = this.sessionManager.subscribe((sessions, activeToken, activeSession) => {\n      this.allSessions = sessions;\n      this.refreshDrawer();\n    });\n    \n    // Initial load of sessions\n    this.allSessions = this.sessionManager.getAllSessions();\n  }\n\n  show(): void {\n    if (this.isVisible) return;\n    \n    this.isVisible = true;\n    const modal = this.render();\n    this.embedContainer.appendChild(modal); // \uD83C\uDFAF Respect embed boundaries - no more hijacking!\n    \n    // Trigger animation after DOM insertion\n    requestAnimationFrame(() => {\n      modal.classList.add('mobile-profile-drawer-visible');\n    });\n  }\n\n  hide(): void {\n    if (!this.isVisible || !this.element) return;\n    \n    this.isVisible = false;\n    this.element.classList.remove('mobile-profile-drawer-visible');\n    \n    // Remove from DOM after animation completes\n    setTimeout(() => {\n      if (this.element && this.element.parentNode) {\n        this.element.parentNode.removeChild(this.element);\n      }\n      this.element = null;\n    }, 300); // Match CSS animation duration\n  }\n\n  /**\n   * Refresh drawer when sessions change (same as desktop)\n   */\n  private refreshDrawer(): void {\n    if (this.isVisible && this.element) {\n      // Re-render profile section with updated session data\n      const profileSection = this.element.querySelector('.mobile-profile-drawer-profile');\n      if (profileSection) {\n        const newProfile = this.renderProfileSection();\n        profileSection.replaceWith(newProfile);\n      }\n      \n      // Re-render actions section with updated session data  \n      const actionsSection = this.element.querySelector('.mobile-profile-drawer-actions');\n      if (actionsSection) {\n        const newActions = this.renderActions();\n        actionsSection.replaceWith(newActions);\n      }\n    }\n  }\n\n  private render(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'mobile-profile-drawer-overlay';\n    \n    // Backdrop - clicking dismisses modal\n    const backdrop = document.createElement('div');\n    backdrop.className = 'mobile-profile-drawer-backdrop';\n    backdrop.addEventListener('click', () => {\n      this.options.onClose();\n    });\n    \n    // Modal content\n    const content = document.createElement('div');\n    content.className = 'mobile-profile-drawer-content';\n    \n    // Prevent content clicks from dismissing modal\n    content.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    \n    // Header with title and close button\n    const header = this.renderHeader();\n    content.appendChild(header);\n    \n    // Profile section\n    const profile = this.renderProfileSection();\n    content.appendChild(profile);\n    \n    // Actions section\n    const actions = this.renderActions();\n    content.appendChild(actions);\n    \n    modal.appendChild(backdrop);\n    modal.appendChild(content);\n    \n    this.element = modal;\n    return modal;\n  }\n\n  private renderHeader(): HTMLElement {\n    const header = document.createElement('div');\n    header.className = 'mobile-profile-drawer-header';\n    \n    const title = document.createElement('h2');\n    title.className = 'mobile-profile-drawer-title';\n    title.textContent = 'Profile';\n    \n    const closeButton = document.createElement('button');\n    closeButton.className = 'mobile-profile-drawer-close';\n    closeButton.innerHTML = getIconHTML('chevronDown', { size: 24 }); // Beautiful Lucide chevron down\n    closeButton.addEventListener('click', () => {\n      this.options.onClose();\n    });\n    \n    header.appendChild(title);\n    header.appendChild(closeButton);\n    \n    return header;\n  }\n\n  private renderProfileSection(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'mobile-profile-drawer-profile';\n    \n    // Get current active session from SessionManager (same as desktop)\n    const activeSession = this.sessionManager.getActiveSession();\n    const userName = activeSession?.name || this.userProfile.name || 'Unknown User';\n    const profileImageUrl = activeSession?.profileImageUrl || this.userProfile.profilePictureUrl;\n    const identityType = activeSession?.identityType || this.userProfile.identityType || 'anonymous';\n    \n    // Profile avatar\n    const avatar = document.createElement('div');\n    avatar.className = 'mobile-profile-drawer-avatar';\n    \n    if (profileImageUrl) {\n      const img = document.createElement('img');\n      img.src = profileImageUrl;\n      img.alt = userName;\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      avatar.appendChild(img);\n    } else {\n      // Gradient fallback with initials\n      const gradientClass = getGradientClass(userName);\n      avatar.style.background = getGradientStyle(gradientClass);\n      \n      const initials = document.createElement('span');\n      initials.textContent = this.getUserInitials(userName);\n      initials.style.cssText = `\n        color: white;\n        font-weight: 600;\n        font-size: 24px;\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      `;\n      avatar.appendChild(initials);\n    }\n    \n    // Profile info\n    const info = document.createElement('div');\n    info.className = 'mobile-profile-drawer-info';\n    \n    const name = document.createElement('h3');\n    name.className = 'mobile-profile-drawer-name';\n    name.textContent = userName;\n    \n    const type = document.createElement('p');\n    type.className = 'mobile-profile-drawer-type';\n    type.textContent = this.getIdentityTypeLabel(identityType) + ' \u2022 Active';\n    \n    info.appendChild(name);\n    info.appendChild(type);\n    \n    section.appendChild(avatar);\n    section.appendChild(info);\n    \n    return section;\n  }\n\n  private renderActions(): HTMLElement {\n    const actions = document.createElement('div');\n    actions.className = 'mobile-profile-drawer-actions';\n    \n    // Available Sessions section (same as desktop)\n    const activeToken = this.sessionManager.getActiveToken();\n    const inactiveSessions = this.allSessions.filter(session => \n      session.sessionToken !== activeToken\n    );\n    \n    if (inactiveSessions.length > 0) {\n      const sessionSection = document.createElement('div');\n      sessionSection.className = 'mobile-profile-drawer-section';\n      \n      const sessionTitle = document.createElement('div');\n      sessionTitle.className = 'mobile-profile-drawer-section-title';\n      sessionTitle.textContent = 'Available Accounts';\n      sessionSection.appendChild(sessionTitle);\n      \n      // Render each inactive session\n      inactiveSessions.forEach(session => {\n        const sessionItem = this.renderSessionItem(session);\n        sessionSection.appendChild(sessionItem);\n      });\n      \n      actions.appendChild(sessionSection);\n    }\n    \n    // Actions section (same as desktop)\n    const actionsSection = document.createElement('div');\n    actionsSection.className = 'mobile-profile-drawer-section';\n    \n    const actionsTitle = document.createElement('div');\n    actionsTitle.className = 'mobile-profile-drawer-section-title';\n    actionsTitle.textContent = 'Actions';\n    actionsSection.appendChild(actionsTitle);\n    \n    // Add Another Account (same action as desktop)\n    const addAccount = this.renderAction({\n      icon: '\u2795',\n      text: 'Add Another Account',\n      action: 'add-session'\n    });\n    actionsSection.appendChild(addAccount);\n\n    // Share Login QR (if transferable sessions exist)\n    const transferableSessions = this.getTransferableSessions();\n    if (transferableSessions.length > 0) {\n      const shareQR = this.renderAction({\n        icon: '\uD83D\uDCF1',\n        text: 'Share Login QR',\n        action: 'share-qr'\n      });\n      actionsSection.appendChild(shareQR);\n    }\n    \n    // Settings (same action as desktop)\n    const settings = this.renderAction({\n      icon: '\u2699\uFE0F',\n      text: 'Settings',\n      action: 'settings'\n    });\n    actionsSection.appendChild(settings);\n    \n    // Sign Out (same action as desktop)\n    const signOut = this.renderAction({\n      icon: '\uD83D\uDEAA',\n      text: 'Sign Out',\n      action: 'sign-out',\n      destructive: true\n    });\n    actionsSection.appendChild(signOut);\n    \n    actions.appendChild(actionsSection);\n    \n    return actions;\n  }\n\n  private renderSessionItem(session: SessionData): HTMLElement {\n    const item = document.createElement('div');\n    item.className = 'mobile-profile-drawer-action';\n    \n    // Avatar\n    const avatar = document.createElement('div');\n    avatar.className = 'mobile-profile-drawer-action-icon';\n    avatar.style.cssText = `\n      width: 32px;\n      height: 32px;\n      border-radius: 8px;\n      overflow: hidden;\n    `;\n    \n    if (session.profileImageUrl) {\n      const img = document.createElement('img');\n      img.src = session.profileImageUrl;\n      img.alt = session.name || 'User';\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      avatar.appendChild(img);\n    } else {\n      // Gradient fallback\n      const name = session.name || 'User';\n      const gradientClass = getGradientClass(name);\n      avatar.style.background = getGradientStyle(gradientClass);\n      \n      const initials = document.createElement('span');\n      initials.textContent = this.getUserInitials(name);\n      initials.style.cssText = `\n        color: white;\n        font-weight: 600;\n        font-size: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n      `;\n      avatar.appendChild(initials);\n    }\n    \n    // Session info\n    const info = document.createElement('div');\n    info.style.cssText = 'flex: 1; min-width: 0;';\n    \n    const name = document.createElement('div');\n    name.className = 'mobile-profile-drawer-action-text';\n    name.textContent = session.name || 'Unknown User';\n    name.style.cssText = 'margin-bottom: 2px; font-size: 14px;';\n    \n    const type = document.createElement('div');\n    type.style.cssText = 'font-size: 12px; color: var(--preview-text-muted); font-weight: normal;';\n    type.textContent = this.getIdentityTypeLabel(session.identityType);\n    \n    info.appendChild(name);\n    info.appendChild(type);\n    \n    item.appendChild(avatar);\n    item.appendChild(info);\n    \n    // Click handler for session switching (same as desktop)\n    item.addEventListener('click', () => {\n      this.handleSessionSwitch(session.sessionToken);\n    });\n    \n    return item;\n  }\n\n  private renderAction(config: {\n    icon: string;\n    text: string;\n    action: string;\n    destructive?: boolean;\n  }): HTMLElement {\n    const action = document.createElement('div');\n    action.className = `mobile-profile-drawer-action${config.destructive ? ' destructive' : ''}`;\n    \n    const icon = document.createElement('div');\n    icon.className = 'mobile-profile-drawer-action-icon';\n    icon.textContent = config.icon;\n    \n    const text = document.createElement('div');\n    text.className = 'mobile-profile-drawer-action-text';\n    text.textContent = config.text;\n    \n    action.appendChild(icon);\n    action.appendChild(text);\n    \n    // Click handler\n    action.addEventListener('click', () => {\n      if (config.action === 'share-qr') {\n        // Handle QR generation directly\n        this.handleShareQR();\n      } else {\n        this.options.onMenuAction(config.action);\n      }\n    });\n    \n    return action;\n  }\n\n  private getUserInitials(name: string): string {\n    if (!name) return '?';\n    \n    const words = name.trim().split(/\\s+/);\n    if (words.length === 1) {\n      return words[0].substring(0, 2).toUpperCase();\n    }\n    \n    return words\n      .slice(0, 2)\n      .map(word => word.charAt(0).toUpperCase())\n      .join('');\n  }\n\n  /**\n   * Get identity type label for display (same as desktop)\n   */\n  private getIdentityTypeLabel(identityType: 'ens' | 'universal_profile' | 'anonymous'): string {\n    switch (identityType) {\n      case 'ens':\n        return 'ENS';\n      case 'universal_profile':\n        return 'Universal Profile';\n      case 'anonymous':\n        return 'Guest';\n      default:\n        return 'User';\n    }\n  }\n\n  /**\n   * Handle session switching (same as desktop)\n   * \uD83D\uDE80 FIX: Delegate to parent via callback instead of direct SessionManager call\n   */\n  private async handleSessionSwitch(sessionToken: string): Promise<void> {\n    try {\n      console.log('[MobileProfileDrawer] Delegating session switch to parent:', sessionToken);\n      \n      // Delegate to parent using existing callback pattern with token encoded in action\n      this.options.onMenuAction(`switch-session:${sessionToken}`);\n      \n      console.log('[MobileProfileDrawer] Session switch delegated successfully');\n    } catch (error) {\n      console.error('[MobileProfileDrawer] Failed to delegate session switch:', error);\n    }\n  }\n\n  /**\n   * Get sessions that can be transferred via QR code\n   */\n  private getTransferableSessions(): SessionTransferData[] {\n    const allSessions = this.sessionManager.getAllSessions();\n    const now = new Date();\n    \n    return allSessions\n      .filter(session => {\n        // Must be active and not expired\n        if (!session.isActive || session.expiresAt <= now) return false;\n        \n        // Must have required fields\n        if (!session.sessionToken || !session.userId) return false;\n        \n        return true;\n      })\n      .map(session => QRCodeGenerator.convertToTransferFormat(session));\n  }\n\n  /**\n   * Handle QR code generation and display\n   */\n  private async handleShareQR(): Promise<void> {\n    try {\n      console.log('[MobileProfileDrawer] Generating QR code for session transfer');\n      \n      // Get transferable sessions\n      const transferableSessions = this.getTransferableSessions();\n      \n      if (transferableSessions.length === 0) {\n        console.warn('[MobileProfileDrawer] No transferable sessions available');\n        return;\n      }\n\n      console.log('[MobileProfileDrawer] Found', transferableSessions.length, 'transferable sessions');\n\n      // Create and show QR dialog\n      const qrDialog = new QRCodeDialog({\n        sessions: transferableSessions,\n        onClose: () => {\n          console.log('[MobileProfileDrawer] QR dialog closed');\n          qrDialog.hide();\n        }\n      });\n\n      await qrDialog.show();\n      \n      console.log('[MobileProfileDrawer] QR dialog displayed successfully');\n      \n    } catch (error) {\n      console.error('[MobileProfileDrawer] Failed to generate QR code:', error);\n    }\n  }\n\n  /**\n   * Update user profile information\n   */\n  updateUserProfile(userProfile: UserProfile): void {\n    this.userProfile = userProfile;\n    \n    // Re-render if drawer is visible\n    if (this.isVisible && this.element) {\n      const profileSection = this.element.querySelector('.mobile-profile-drawer-profile');\n      if (profileSection) {\n        const newProfile = this.renderProfileSection();\n        profileSection.replaceWith(newProfile);\n      }\n    }\n  }\n\n  /**\n   * Cleanup (same as desktop)\n   */\n  destroy(): void {\n    // Cleanup session subscription\n    if (this.sessionSubscription) {\n      this.sessionSubscription();\n      this.sessionSubscription = null;\n    }\n    \n    this.hide();\n  }\n} ", "/**\n * Responsive utilities for mobile/desktop detection\n */\n\nexport function isMobileViewport(): boolean {\n  return window.innerWidth < 768;\n}\n\nexport function isDesktopViewport(): boolean {\n  return window.innerWidth >= 768;\n}\n\nexport function addResizeListener(callback: (isMobile: boolean) => void): () => void {\n  const handler = () => callback(isMobileViewport());\n  window.addEventListener('resize', handler);\n  \n  // Return cleanup function\n  return () => window.removeEventListener('resize', handler);\n}\n\n// Breakpoint constants\nexport const MOBILE_BREAKPOINT = 768; // px\nexport const DESKTOP_MIN_WIDTH = 768; // px ", "/**\n * CommunitySidebar Component\n * Main sidebar component that orchestrates community items and user profile\n * \n * Extracted from CommunityNavigationUI class for better maintainability\n * Composes CommunityItem and UserProfile components\n */\n\nimport { CommunityItem, UserCommunityMembership } from './CommunityItem';\nimport { CommunityPreviewManager } from './CommunityPreview';\nimport { UserProfileComponent, UserProfile } from '../profile/UserProfile';\nimport { MobileBottomNav } from '../mobile/MobileBottomNav';\nimport { MobileCommunityPicker } from '../mobile/MobileCommunityPicker';\nimport { MobileProfileDrawer } from '../mobile/MobileProfileDrawer';\nimport { injectStyles } from '../../styling';\nimport { getIconHTML } from '../../styling/utils/icons';\nimport { isMobileViewport, addResizeListener } from '../../utils/responsive';\n\nexport interface CommunitySidebarOptions {\n  communities: UserCommunityMembership[];\n  currentCommunityId: string;\n  userProfile: UserProfile | null;\n  hostServiceUrl: string; // \uD83C\uDFAF Host service URL for absolute asset paths\n  onCommunitySelect?: (community: UserCommunityMembership) => void;\n  onMenuAction?: (action: string) => void;\n  getIframeStatus?: (communityId: string) => boolean; // Simple function to check if iframe is loaded\n  onPlusButtonClick?: () => void; // Callback for plus button click (community discovery)\n  embedContainer?: HTMLElement; // \uD83C\uDFAF Container for modal boundaries - no more hijacking!\n}\n\nexport class CommunitySidebar {\n  private communities: UserCommunityMembership[];\n  private currentCommunityId: string;\n  private userProfile: UserProfile | null;\n  private hostServiceUrl: string; // \uD83C\uDFAF Host service URL for absolute asset paths\n  private options: CommunitySidebarOptions;\n  private embedContainer: HTMLElement | null = null; // \uD83C\uDFAF Reference to embed container for boundary respect\n  \n  private container: HTMLElement | null = null;\n  private communityItems: CommunityItem[] = [];\n  private userProfileComponent: UserProfileComponent | null = null;\n  private previewManager: CommunityPreviewManager;\n  \n  // Mobile-specific properties\n  private mobileBottomNav: MobileBottomNav | null = null;\n  private mobileCommunityPicker: MobileCommunityPicker | null = null;\n  private mobileProfileDrawer: MobileProfileDrawer | null = null;\n  private isMobile: boolean = false;\n  private resizeCleanup: (() => void) | null = null;\n\n  constructor(options: CommunitySidebarOptions) {\n    this.communities = options.communities;\n    this.currentCommunityId = options.currentCommunityId;\n    this.userProfile = options.userProfile;\n    this.hostServiceUrl = options.hostServiceUrl; // \uD83C\uDFAF Store host service URL\n    this.options = options;\n    this.embedContainer = options.embedContainer || null; // \uD83C\uDFAF Store embed container reference\n    this.previewManager = CommunityPreviewManager.getInstance();\n    \n    // Initialize mobile state\n    this.isMobile = isMobileViewport();\n    \n    // Set up responsive listener\n    this.resizeCleanup = addResizeListener((isMobile) => {\n      if (this.isMobile !== isMobile) {\n        this.isMobile = isMobile;\n        this.handleViewportChange();\n      }\n    });\n  }\n\n  render(): HTMLElement {\n    // Inject CSS styles from proper CSS files!\n    injectStyles();\n    \n    if (this.isMobile) {\n      return this.renderMobile();\n    } else {\n      return this.renderDesktop();\n    }\n  }\n\n  private renderDesktop(): HTMLElement {\n    const nav = document.createElement('div');\n    nav.className = 'curia-community-nav';\n    \n    // \uD83C\uDFA8 Add logo section at the top\n    const logoSection = this.renderLogoSection();\n    nav.appendChild(logoSection);\n    \n    // \uD83D\uDE80 Add navigation items section (search, messages, notifications)\n    const navItemsSection = this.renderNavigationItems();\n    nav.appendChild(navItemsSection);\n    \n    // \u2796 Add divider\n    const divider = this.renderDivider();\n    nav.appendChild(divider);\n    \n    // \uD83C\uDFE0 Create scrollable community list container\n    const communityListContainer = document.createElement('div');\n    communityListContainer.className = 'community-list-container';\n    \n    // Add communities to scrollable container\n    this.renderCommunityItems(communityListContainer);\n    \n    nav.appendChild(communityListContainer);\n\n    // Add user profile section at the bottom (fixed)\n    if (this.userProfile) {\n      const userSection = this.renderUserProfile();\n      nav.appendChild(userSection);\n    }\n    \n    this.container = nav;\n    return nav;\n  }\n\n  private renderMobile(): HTMLElement {\n    // Create wrapper container for mobile layout\n    const wrapper = document.createElement('div');\n    wrapper.className = 'curia-mobile-wrapper';\n    \n    if (this.userProfile) {\n      // Create mobile community picker modal\n      this.mobileCommunityPicker = new MobileCommunityPicker({\n        communities: this.communities,\n        currentCommunityId: this.currentCommunityId,\n        onCommunitySelect: (community) => {\n          console.log('[CommunitySidebar] Community selected:', community.name);\n          // Hide modal first\n          if (this.mobileCommunityPicker) {\n            this.mobileCommunityPicker.hide();\n          }\n          // Then trigger community selection\n          if (this.options.onCommunitySelect) {\n            this.options.onCommunitySelect(community);\n          }\n        },\n        onClose: () => {\n          console.log('[CommunitySidebar] Mobile community picker closed');\n          if (this.mobileCommunityPicker) {\n            this.mobileCommunityPicker.hide();\n          }\n        },\n        onPlusButtonClick: () => {\n          console.log('[CommunitySidebar] Mobile plus button clicked - same as desktop');\n          // Same callback as desktop\n          if (this.options.onPlusButtonClick) {\n            this.options.onPlusButtonClick();\n          }\n        },\n        embedContainer: this.embedContainer || undefined // \uD83C\uDFAF Pass embed container for boundary respect (null \u2192 undefined)\n      });\n\n      // Create mobile profile drawer\n      this.mobileProfileDrawer = new MobileProfileDrawer({\n        userProfile: this.userProfile,\n        onMenuAction: (action) => {\n          console.log('[CommunitySidebar] Profile action:', action);\n          // Hide drawer first\n          if (this.mobileProfileDrawer) {\n            this.mobileProfileDrawer.hide();\n          }\n          // Then trigger action\n          if (this.options.onMenuAction) {\n            this.options.onMenuAction(action);\n          }\n        },\n        onClose: () => {\n          console.log('[CommunitySidebar] Mobile profile drawer closed');\n          if (this.mobileProfileDrawer) {\n            this.mobileProfileDrawer.hide();\n          }\n        },\n        embedContainer: this.embedContainer || undefined // \uD83C\uDFAF Pass embed container for boundary respect (null \u2192 undefined)\n      });\n\n      // Create mobile bottom navigation\n      this.mobileBottomNav = new MobileBottomNav({\n        communities: this.communities,\n        currentCommunityId: this.currentCommunityId,\n        userProfile: this.userProfile,\n        onCommunityMenuClick: () => {\n          console.log('[CommunitySidebar] Mobile community menu clicked - showing picker');\n          if (this.mobileCommunityPicker) {\n            this.mobileCommunityPicker.show();\n          }\n        },\n        onProfileMenuClick: () => {\n          console.log('[CommunitySidebar] Mobile profile menu clicked - showing drawer');\n          if (this.mobileProfileDrawer) {\n            this.mobileProfileDrawer.show();\n          }\n        }\n      });\n      \n      const bottomNavElement = this.mobileBottomNav.render();\n      wrapper.appendChild(bottomNavElement);\n    }\n    \n    this.container = wrapper; \n    return wrapper;\n  }\n\n  private renderCommunityItems(container: HTMLElement): void {\n    // Clear existing items\n    this.communityItems.forEach(item => item.destroy());\n    this.communityItems = [];\n\n    this.communities.forEach(community => {\n      const communityItem = new CommunityItem({\n        community,\n        isActive: community.id === this.currentCommunityId,\n        hasIframeLoaded: this.options.getIframeStatus ? this.options.getIframeStatus(community.id) : false,\n        onHover: (community, element) => {\n          this.previewManager.showPreview(community, element);\n        },\n        onHoverEnd: () => {\n          this.previewManager.hidePreview();\n        },\n        onClick: (community) => {\n          if (this.options.onCommunitySelect) {\n            this.options.onCommunitySelect(community);\n          }\n          this.updateActiveCommunity(community.id);\n        }\n      });\n\n      const itemElement = communityItem.render();\n      container.appendChild(itemElement);\n      this.communityItems.push(communityItem);\n    });\n    \n    // Add plus icon placeholder for discovering/creating communities\n    this.addPlusIconPlaceholder(container);\n  }\n\n  /**\n   * Add subtle plus icon placeholder for community discovery/creation\n   */\n  private addPlusIconPlaceholder(container: HTMLElement): void {\n    const plusIcon = document.createElement('div');\n    plusIcon.className = 'community-item plus-icon-placeholder';\n    \n    // Subtle styling for the plus icon\n    plusIcon.style.cssText = `\n      background: rgba(148, 163, 184, 0.1);\n      border: 2px dashed rgba(148, 163, 184, 0.3);\n      color: rgba(148, 163, 184, 0.7);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 24px;\n      transition: all 0.25s ease;\n      cursor: pointer;\n    `;\n    \n    plusIcon.innerHTML = '+';\n    \n    // Hover effect\n    plusIcon.addEventListener('mouseenter', () => {\n      plusIcon.style.borderColor = 'rgba(59, 130, 246, 0.4)';\n      plusIcon.style.backgroundColor = 'rgba(59, 130, 246, 0.05)';\n      plusIcon.style.color = 'rgba(59, 130, 246, 0.8)';\n      plusIcon.style.transform = 'scale(1.08) translateY(-1px)';\n    });\n    \n    plusIcon.addEventListener('mouseleave', () => {\n      plusIcon.style.borderColor = 'rgba(148, 163, 184, 0.3)';\n      plusIcon.style.backgroundColor = 'rgba(148, 163, 184, 0.1)';\n      plusIcon.style.color = 'rgba(148, 163, 184, 0.7)';\n      plusIcon.style.transform = '';\n    });\n    \n    // Click handler for community discovery\n    plusIcon.addEventListener('click', () => {\n      console.log('[CommunitySidebar] Plus icon clicked - opening community discovery');\n      if (this.options.onPlusButtonClick) {\n        this.options.onPlusButtonClick();\n      }\n    });\n    \n    container.appendChild(plusIcon);\n  }\n\n  private renderUserProfile(): HTMLElement {\n    if (!this.userProfile) {\n      throw new Error('Cannot render user profile: userProfile is null');\n    }\n\n    this.userProfileComponent = new UserProfileComponent({\n      userProfile: this.userProfile,\n      onMenuAction: (action) => {\n        if (this.options.onMenuAction) {\n          this.options.onMenuAction(action);\n        }\n      }\n    });\n\n    return this.userProfileComponent.render();\n  }\n\n  /**\n   * Handle viewport changes between mobile and desktop\n   */\n  private handleViewportChange(): void {\n    // Force re-render when viewport changes\n    if (this.container && this.container.parentNode) {\n      const parent = this.container.parentNode;\n      const newElement = this.render();\n      parent.replaceChild(newElement, this.container);\n    }\n  }\n\n  /**\n   * Update which community is currently active\n   */\n  updateActiveCommunity(communityId: string): void {\n    if (this.currentCommunityId === communityId) return;\n\n    this.currentCommunityId = communityId;\n\n    if (this.isMobile) {\n      // Update mobile bottom nav\n      if (this.mobileBottomNav) {\n        this.mobileBottomNav.updateActiveCommunity(communityId);\n      }\n      // Update mobile community picker\n      if (this.mobileCommunityPicker) {\n        this.mobileCommunityPicker.updateCommunities(this.communities, communityId);\n      }\n    } else {\n      // Update desktop community items\n      this.communityItems.forEach(item => {\n        const isActive = item['community'].id === communityId; // Access private property\n        item.updateActiveState(isActive);\n      });\n    }\n  }\n\n  /**\n   * Update the community list with new data\n   */\n  updateCommunities(communities: UserCommunityMembership[]): void {\n    this.communities = communities;\n    \n    if (this.isMobile) {\n      // Update mobile bottom nav\n      if (this.mobileBottomNav) {\n        this.mobileBottomNav.updateCommunities(communities);\n      }\n      // Update mobile community picker\n      if (this.mobileCommunityPicker) {\n        this.mobileCommunityPicker.updateCommunities(communities, this.currentCommunityId);\n      }\n    } else {\n      // Update desktop sidebar\n      if (this.container) {\n        const communityListContainer = this.container.querySelector('.community-list-container');\n        if (communityListContainer) {\n          // Clear existing items\n          communityListContainer.innerHTML = '';\n          this.renderCommunityItems(communityListContainer as HTMLElement);\n        }\n      }\n    }\n  }\n\n  /**\n   * Update online indicators after iframe status changes\n   */\n  updateOnlineIndicators(): void {\n    console.log(`[MULTI-IFRAME] [CommunitySidebar] Refreshing online indicators for ${this.communityItems.length} communities`);\n    \n    // Simple approach: re-render the community list to update indicators\n    if (this.container) {\n      const communityListContainer = this.container.querySelector('.community-list-container');\n      if (communityListContainer) {\n        communityListContainer.innerHTML = '';\n        this.renderCommunityItems(communityListContainer as HTMLElement);\n      }\n    }\n  }\n\n  /**\n   * Update user profile information\n   */\n  updateUserProfile(userProfile: UserProfile): void {\n    this.userProfile = userProfile;\n    \n    if (this.isMobile) {\n      // Update mobile profile drawer\n      if (this.mobileProfileDrawer) {\n        this.mobileProfileDrawer.updateUserProfile(userProfile);\n      }\n    } else {\n      // Update desktop profile component\n      if (this.container && this.userProfileComponent) {\n        // Remove old profile component\n        const oldProfileElement = this.container.querySelector('.user-profile-section');\n        if (oldProfileElement) {\n          oldProfileElement.remove();\n        }\n        \n        // Add new profile component\n        const userSection = this.renderUserProfile();\n        this.container.appendChild(userSection);\n      }\n    }\n  }\n\n\n\n  /**\n   * Update the embed container reference for mobile component boundaries\n   * Called after embedContainer is created in InternalPluginHost\n   */\n  updateEmbedContainer(embedContainer: HTMLElement): void {\n    console.log('[CommunitySidebar] Updating embed container reference for mobile boundaries');\n    this.embedContainer = embedContainer;\n    \n    // Update existing mobile components with the new container reference\n    if (this.mobileCommunityPicker) {\n      (this.mobileCommunityPicker as any).embedContainer = embedContainer;\n    }\n    \n    if (this.mobileProfileDrawer) {\n      (this.mobileProfileDrawer as any).embedContainer = embedContainer;\n    }\n  }\n\n  /**\n   * Cleanup method for removing event listeners and DOM elements  \n   */\n  destroy(): void {\n    // Cleanup community items\n    this.communityItems.forEach(item => item.destroy());\n    this.communityItems = [];\n\n    // Cleanup user profile component\n    if (this.userProfileComponent) {\n      this.userProfileComponent.destroy();\n      this.userProfileComponent = null;\n    }\n\n    // Cleanup mobile bottom nav\n    if (this.mobileBottomNav) {\n      this.mobileBottomNav.destroy();\n      this.mobileBottomNav = null;\n    }\n\n    // Cleanup mobile community picker\n    if (this.mobileCommunityPicker) {\n      this.mobileCommunityPicker.destroy();\n      this.mobileCommunityPicker = null;\n    }\n\n    // Cleanup mobile profile drawer\n    if (this.mobileProfileDrawer) {\n      this.mobileProfileDrawer.destroy();\n      this.mobileProfileDrawer = null;\n    }\n\n    // Cleanup resize listener\n    if (this.resizeCleanup) {\n      this.resizeCleanup();\n      this.resizeCleanup = null;\n    }\n\n    // Hide any open preview\n    this.previewManager.hidePreview();\n\n    this.container = null;\n  }\n\n  /**\n   * Render the Curia logo section at the top of the sidebar\n   */\n  private renderLogoSection(): HTMLElement {\n    const logoSection = document.createElement('div');\n    logoSection.className = 'sidebar-logo-section';\n    \n    const logoImg = document.createElement('img');\n    logoImg.src = `${this.hostServiceUrl}/curia.webp`; // \uD83C\uDFA8 Using absolute URL to host service\n    logoImg.alt = 'Curia';\n    logoImg.className = 'sidebar-logo-img';\n    \n    logoSection.appendChild(logoImg);\n    return logoSection;\n  }\n\n  /**\n   * Render navigation items (search, messages, notifications)\n   */\n  private renderNavigationItems(): HTMLElement {\n    const navSection = document.createElement('div');\n    navSection.className = 'sidebar-nav-section';\n    \n    // \uD83D\uDD0D Search\n    const searchItem = this.createNavItem('search', 'Search');\n    navSection.appendChild(searchItem);\n    \n    // \uD83D\uDCAC Messages (Direct Messages)\n    const messagesItem = this.createNavItem('messages', 'Direct Messages');\n    navSection.appendChild(messagesItem);\n    \n    // \uD83D\uDD14 Notifications\n    const notificationsItem = this.createNavItem('notifications', 'Notifications');\n    navSection.appendChild(notificationsItem);\n    \n    return navSection;\n  }\n\n  /**\n   * Create a navigation item with icon and hover functionality\n   */\n  private createNavItem(iconName: 'search' | 'messages' | 'notifications', label: string): HTMLElement {\n    const item = document.createElement('div');\n    item.className = 'sidebar-nav-item';\n    item.title = label;\n    \n    const iconContainer = document.createElement('div');\n    iconContainer.className = 'sidebar-nav-icon';\n    iconContainer.innerHTML = getIconHTML(iconName, { size: 20 });\n    \n    item.appendChild(iconContainer);\n    \n    // Add click handler (stub for now)\n    item.addEventListener('click', () => {\n      console.log(`[CommunitySidebar] ${label} clicked - functionality not implemented yet`);\n    });\n    \n    return item;\n  }\n\n  /**\n   * Render divider between nav items and community list\n   */\n  private renderDivider(): HTMLElement {\n    const divider = document.createElement('div');\n    divider.className = 'sidebar-divider';\n    return divider;\n  }\n} ", "/**\n * AuthenticationService\n * Handles all authentication flows, session management, and user data fetching\n * \n * Extracted from InternalPluginHost for better separation of concerns\n * Responsibilities:\n * - Initialize auth phase and create auth iframe\n * - Handle auth completion and session establishment\n * - Fetch user communities and profile data\n * - Handle session switching and cross-tab synchronization\n * - Manage sign-out and session cleanup\n */\n\nimport { sessionManager } from '../../../SessionManager';\nimport { ApiProxyClient } from '@curia_/iframe-api-proxy';\n\nexport interface InternalAuthContext {\n  userId: string;\n  communityId: string;\n  sessionToken?: string;\n  externalParams?: Record<string, string>;\n  parentUrl?: string;\n}\n\nexport interface UserCommunityMembership {\n  id: string;\n  name: string;\n  logoUrl: string | null;\n  userRole: 'member' | 'moderator' | 'admin' | 'owner';\n  isMember: boolean;\n}\n\nexport interface UserProfile {\n  userId: string;\n  name: string;\n  profilePictureUrl: string | null;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress: string | null;\n  ensDomain: string | null;\n  upAddress: string | null;\n  isAnonymous: boolean;\n}\n\nexport interface AuthConfig {\n  theme?: string;\n  backgroundColor?: string;\n  community?: string;\n  mode?: string;\n  parentUrl?: string;\n  externalParams?: Record<string, string>;\n  width?: string;\n  height?: string;\n  borderRadius?: string;\n}\n\nexport interface AuthenticationCallbacks {\n  onAuthComplete?: (authData: any, context: InternalAuthContext) => Promise<void>;\n  onSessionSwitch?: (profile: UserProfile) => Promise<void>;\n  onSignOut?: () => void;\n  onCrossTabSessionUpdate?: () => void;\n}\n\nexport class AuthenticationService {\n  private hostServiceUrl: string;\n  private authContext: InternalAuthContext | null = null;\n  private callbacks: AuthenticationCallbacks;\n  private sessionListener?: (event: MessageEvent) => void;\n  private crossTabListener?: (event: Event) => void;\n  private sessionManagerSubscription?: () => void;\n  private lastActiveSessionToken: string | null = null;\n  private apiProxy: ApiProxyClient | null = null;  // \uD83C\uDD95 NEW - For CSP-compliant API calls\n\n  constructor(\n    hostServiceUrl: string, \n    callbacks: AuthenticationCallbacks = {},\n    apiProxy?: ApiProxyClient  // \uD83C\uDD95 NEW - Optional API proxy for CSP compliance\n  ) {\n    this.hostServiceUrl = hostServiceUrl;\n    this.callbacks = callbacks;\n    this.apiProxy = apiProxy || null;  // \uD83C\uDD95 NEW - Store the API proxy instance\n    \n    // Subscribe to SessionManager changes to trigger session switching\n    this.setupSessionManagerSubscription();\n    \n    console.log('[AuthenticationService] Initialized');\n  }\n\n  /**\n   * Get current authentication context\n   */\n  getAuthContext(): InternalAuthContext | null {\n    return this.authContext;\n  }\n\n  /**\n   * Make API call with multi-phase retry strategy optimized for fast user experience\n   * Phase 1: Every 50ms for first 500ms (10 attempts) - iframe usually ready quickly\n   * Phase 2: Every 100ms for next 500ms (4 attempts) - reasonable fallback  \n   * Phase 3: Every 200ms for next 1000ms (4 attempts) - persistence for edge cases\n   * Phase 4: Final attempt at 3000ms (1 attempt) - last chance\n   */\n  private async makeApiCallWithRetry(\n    method: 'getUserCommunities' | 'getUserProfile', \n    params: any\n  ): Promise<any> {\n    if (!this.apiProxy || !this.authContext) {\n      throw new Error('API proxy or auth context not available');\n    }\n\n    // Define retry schedule: [delay_ms, phase_name]\n    const retrySchedule: Array<[number, string]> = [\n      // Phase 1: Aggressive early attempts (every 50ms for 500ms)\n      [0, 'Phase1'], [50, 'Phase1'], [100, 'Phase1'], [150, 'Phase1'], [200, 'Phase1'],\n      [250, 'Phase1'], [300, 'Phase1'], [350, 'Phase1'], [400, 'Phase1'], [450, 'Phase1'],\n      // Phase 2: Moderate fallback (every 100ms for next 500ms) \n      [600, 'Phase2'], [700, 'Phase2'], [800, 'Phase2'], [900, 'Phase2'],\n      // Phase 3: Patient persistence (every 200ms for next 1000ms)\n      [1200, 'Phase3'], [1400, 'Phase3'], [1600, 'Phase3'], [1800, 'Phase3'],\n      // Phase 4: Final attempt\n      [3000, 'Phase4']\n    ];\n\n    console.log(`[AuthenticationService] \uD83D\uDD04 Starting multi-phase API proxy calls for ${method} (${retrySchedule.length} attempts over 3s)`);\n    \n    const startTime = Date.now();\n    let lastError: Error | null = null;\n\n    for (let i = 0; i < retrySchedule.length; i++) {\n      const [targetDelay, phase] = retrySchedule[i];\n      const attempt = i + 1;\n      \n      // Wait for the target delay from start time\n      const elapsed = Date.now() - startTime;\n      const waitTime = Math.max(0, targetDelay - elapsed);\n      \n      if (waitTime > 0) {\n        await new Promise(resolve => setTimeout(resolve, waitTime));\n      }\n\n      try {\n        const actualElapsed = Date.now() - startTime;\n        console.log(`[AuthenticationService] \uD83C\uDFAF ${phase} attempt ${attempt}/${retrySchedule.length} for ${method} (${actualElapsed}ms elapsed)`);\n        \n        // Prepare request data for internal API call (no signing needed for same-process calls)\n        const requestData = {\n          method,\n          userId: this.authContext.userId,\n          communityId: this.authContext.communityId,\n          params\n        };\n\n        console.log(`[AuthenticationService] \uD83D\uDD04 Making internal API call for ${method} (no signature required)`);\n\n        const response = await this.apiProxy.makeApiRequest(requestData);\n\n        if (response.success) {\n          const successTime = Date.now() - startTime;\n          console.log(`[AuthenticationService] \u2705 API proxy SUCCESS for ${method} on ${phase} attempt ${attempt} (${successTime}ms total)`);\n          return response;\n        } else {\n          throw new Error(response.error || `API request failed for ${method}`);\n        }\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n        \n        if (attempt === retrySchedule.length) {\n          const totalTime = Date.now() - startTime;\n          console.log(`[AuthenticationService] \u274C API proxy FINAL FAILURE for ${method} after ${retrySchedule.length} attempts (${totalTime}ms total):`, lastError.message);\n          break;\n        }\n\n        // Log failure but continue (no explicit delay - handled by schedule)\n        const failTime = Date.now() - startTime;\n        console.log(`[AuthenticationService] \u23F3 ${phase} attempt ${attempt} failed for ${method} (${failTime}ms elapsed):`, lastError.message);\n      }\n    }\n\n    throw lastError || new Error(`API proxy failed after ${retrySchedule.length} attempts for ${method}`);\n  }\n\n  /**\n   * Create and configure auth iframe\n   */\n  createAuthIframe(config: AuthConfig, container: HTMLElement): HTMLIFrameElement {\n    console.log('[AuthenticationService] Creating auth iframe');\n    \n    // Build auth iframe URL with theme and community parameters\n    const authUrl = new URL(`${this.hostServiceUrl}/embed`);\n    authUrl.searchParams.set('theme', config.theme || 'light');\n    \n    if (config.backgroundColor) {\n      authUrl.searchParams.set('background_color', config.backgroundColor);\n    }\n    if (config.community) {\n      authUrl.searchParams.set('community', config.community);\n      console.log('[AuthenticationService] Adding community parameter:', config.community);\n    }\n    if (config.mode) {\n      authUrl.searchParams.set('mode', config.mode);\n      console.log('[AuthenticationService] Adding mode parameter:', config.mode);\n    }\n    \n    // Add parent URL to auth iframe\n    if (config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(config.parentUrl);\n      authUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n      console.log('[AuthenticationService] Adding parent URL:', config.parentUrl);\n    }\n    \n    // Add external parameters from parent page\n    if (config.externalParams) {\n      console.log('[AuthenticationService] Adding external parameters:', config.externalParams);\n      for (const [key, value] of Object.entries(config.externalParams)) {\n        authUrl.searchParams.set(key, value);\n      }\n    }\n    \n    // Create auth iframe\n    const iframe = document.createElement('iframe');\n    iframe.src = authUrl.toString();\n    iframe.style.width = config.width || '100%';\n    iframe.style.height = config.height || '700px';\n    iframe.style.border = 'none';\n    iframe.style.borderRadius = config.borderRadius || '8px';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', this.getIframePermissions());\n    \n    console.log('[AuthenticationService] Auth iframe created with theme:', config.theme);\n    return iframe;\n  }\n\n  /**\n   * Handle authentication completion from iframe\n   */\n  async handleAuthCompletion(authData: any): Promise<void> {\n    console.log('[AuthenticationService] Auth completion received:', authData);\n    \n    // Store auth context including external parameters and parent URL\n    this.authContext = {\n      userId: authData.userId,\n      communityId: authData.communityId,\n      sessionToken: authData.sessionToken,\n      externalParams: authData.externalParams,\n      parentUrl: authData.parentUrl\n    };\n    \n    console.log('[AuthenticationService] Auth context set:', this.authContext);\n    \n    // Notify parent about auth completion\n    if (this.callbacks.onAuthComplete) {\n      await this.callbacks.onAuthComplete(authData, this.authContext);\n    }\n  }\n\n  /**\n   * Fetch user's community memberships\n   * Direct API call (will work on non-CSP sites, may fail on strict CSP sites)\n   */\n  async fetchUserCommunities(): Promise<UserCommunityMembership[]> {\n    try {\n      console.log('[AuthenticationService] Fetching user communities...');\n      \n      if (!this.authContext?.sessionToken) {\n        console.log('[AuthenticationService] No session token available');\n        return [];\n      }\n\n      // \uD83C\uDFAF API PROXY ONLY: No fallback to direct fetch for cleaner testing\n      if (this.apiProxy && this.authContext) {\n        try {\n          console.log('[AuthenticationService] Using API proxy with retry logic for communities');\n          const proxyResponse = await this.makeApiCallWithRetry('getUserCommunities', {\n            sessionToken: this.authContext.sessionToken\n          });\n\n          if (proxyResponse.data?.userCommunities) {\n            console.log('[AuthenticationService] API proxy success:', proxyResponse.data.userCommunities.length, 'communities');\n            return proxyResponse.data.userCommunities.map((community: any) => ({\n              id: community.id,\n              name: community.name,\n              logoUrl: community.logoUrl || null,\n              userRole: community.userRole || 'member',\n              isMember: community.isMember\n            }));\n          }\n        } catch (proxyError) {\n          console.log('[AuthenticationService] \uD83D\uDEAB API proxy failed after all retries for communities:', proxyError);\n          \n          // \uD83C\uDFAF DEBUGGING: Log specific iframe availability issues\n          if (proxyError instanceof Error && proxyError.message.includes('Active iframe content window not available')) {\n            console.log('[AuthenticationService] \uD83D\uDD27 IFRAME ISSUE: API proxy iframe contentWindow not available - check iframe loading timing');\n          }\n          \n          console.log('[AuthenticationService] \uD83D\uDEAB Giving up on community fetch - returning empty list');\n          return [];\n        }\n      }\n\n      console.log('[AuthenticationService] \uD83D\uDEAB No API proxy available - returning empty communities');\n      return [];\n    } catch (error) {\n      console.error('[AuthenticationService] Error fetching user communities:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Fetch user profile information\n   * Direct API call (will work on non-CSP sites, may fail on strict CSP sites)\n   */\n  async fetchUserProfile(): Promise<UserProfile | null> {\n    try {\n      if (!this.authContext?.sessionToken) {\n        console.log('[AuthenticationService] No session token for user profile fetch');\n        return null;\n      }\n\n      // \uD83C\uDFAF API PROXY ONLY: No fallback to direct fetch for cleaner testing\n      if (this.apiProxy && this.authContext) {\n        try {\n          console.log('[AuthenticationService] Using API proxy with retry logic for profile');\n          const proxyResponse = await this.makeApiCallWithRetry('getUserProfile', {\n            sessionToken: this.authContext.sessionToken\n          });\n\n          if (proxyResponse.data?.user) {\n            console.log('[AuthenticationService] API proxy profile success');\n            return {\n              userId: proxyResponse.data.user.user_id,\n              name: proxyResponse.data.user.name,\n              profilePictureUrl: proxyResponse.data.user.profile_picture_url || null,\n              identityType: proxyResponse.data.user.identity_type || 'anonymous',\n              walletAddress: proxyResponse.data.user.wallet_address || null,\n              ensDomain: proxyResponse.data.user.ens_domain || null,\n              upAddress: proxyResponse.data.user.up_address || null,\n              isAnonymous: proxyResponse.data.user.is_anonymous\n            };\n          }\n        } catch (proxyError) {\n          console.log('[AuthenticationService] \uD83D\uDEAB API proxy failed after all retries for profile:', proxyError);\n          console.log('[AuthenticationService] \uD83D\uDEAB Giving up on profile fetch - returning null');\n          return null;\n        }\n      }\n\n      console.log('[AuthenticationService] \uD83D\uDEAB No API proxy available - returning null profile');\n      return null;\n    } catch (error) {\n      console.error('[AuthenticationService] Error fetching user profile:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Handle session switching (e.g., from account switcher)\n   */\n  async handleSessionSwitch(): Promise<void> {\n    console.log('[AuthenticationService] Handling session switch');\n    \n    try {\n      // Get the new active session\n      const activeSession = sessionManager.getActiveSession();\n      if (!activeSession) {\n        console.log('[AuthenticationService] No active session after switch');\n        if (this.callbacks.onSignOut) {\n          this.callbacks.onSignOut();\n        }\n        return;\n      }\n\n      // Update user profile from session\n      const userProfile: UserProfile = {\n        userId: activeSession.userId,\n        name: activeSession.name || 'Anonymous User',\n        profilePictureUrl: activeSession.profileImageUrl || null,\n        identityType: activeSession.identityType,\n        walletAddress: activeSession.walletAddress || null,\n        ensDomain: activeSession.ensName || null,\n        upAddress: activeSession.upAddress || null,\n        isAnonymous: activeSession.identityType === 'anonymous',\n      };\n\n      // Notify parent about session switch\n      if (this.callbacks.onSessionSwitch) {\n        await this.callbacks.onSessionSwitch(userProfile);\n      }\n\n      console.log('[AuthenticationService] Session switch completed');\n      \n    } catch (error) {\n      console.error('[AuthenticationService] Failed to handle session switch:', error);\n    }\n  }\n\n  /**\n   * Sign out current user\n   */\n  async signOut(): Promise<void> {\n    console.log('[AuthenticationService] Signing out user');\n    \n    // Clear auth context\n    this.authContext = null;\n    \n    // Clear session using SessionManager\n    try {\n      await sessionManager.removeActiveSession();\n      console.log('[AuthenticationService] Session cleared via SessionManager');\n    } catch (error) {\n      console.error('[AuthenticationService] Failed to clear session:', error);\n    }\n    \n    // Notify parent\n    if (this.callbacks.onSignOut) {\n      this.callbacks.onSignOut();\n    }\n  }\n\n  /**\n   * Subscribe to SessionManager changes to handle session switching\n   * Only triggers when the ACTIVE SESSION actually changes (not just any session data)\n   */\n  private setupSessionManagerSubscription(): void {\n    this.sessionManagerSubscription = sessionManager.subscribe((sessions, activeToken, activeSession) => {\n      // Only trigger handleSessionSwitch if:\n      // 1. We have an auth context (i.e., we're in an active embed, not just initializing)\n      // 2. The active session token has actually changed (not just session data updates)\n      if (this.authContext && activeToken !== this.lastActiveSessionToken) {\n        console.log('[AuthenticationService] Active session changed from', this.lastActiveSessionToken, 'to', activeToken);\n        console.log('[AuthenticationService] Triggering session switch (full reload)');\n        \n        // Update tracked token BEFORE triggering reload (since reload destroys this instance)\n        this.lastActiveSessionToken = activeToken;\n        \n        this.handleSessionSwitch();\n      } else if (activeToken !== this.lastActiveSessionToken) {\n        // Update tracked token even if we don't have auth context yet (initialization)\n        console.log('[AuthenticationService] Active session token updated (no auth context yet):', activeToken);\n        this.lastActiveSessionToken = activeToken;\n      }\n    });\n  }\n\n  /**\n   * Setup cross-tab session synchronization\n   */\n  setupCrossTabSessionListener(): void {\n    // Listen for session changes from other tabs\n    this.sessionListener = (event: MessageEvent) => {\n      if (event.data?.type === 'session-updated') {\n        console.log('[AuthenticationService] Cross-tab session update detected');\n        if (this.callbacks.onCrossTabSessionUpdate) {\n          this.callbacks.onCrossTabSessionUpdate();\n        }\n      }\n    };\n\n    window.addEventListener('message', this.sessionListener);\n    \n    // Listen for specific SessionManager cross-tab events (not all storage changes)\n    const crossTabListener = (event: Event) => {\n      // Only respond to SessionManager's specific cross-tab events\n      if (event instanceof CustomEvent && event.type === 'curia-session-change') {\n        console.log('[AuthenticationService] Cross-tab session change detected via custom event');\n        if (this.callbacks.onCrossTabSessionUpdate) {\n          this.callbacks.onCrossTabSessionUpdate();\n        }\n      }\n    };\n    \n    // Store reference for cleanup\n    this.crossTabListener = crossTabListener;\n    window.addEventListener('curia-session-change', crossTabListener);\n    \n    console.log('[AuthenticationService] Cross-tab session listener setup (using custom events)');\n  }\n\n  /**\n   * Get iframe permissions string\n   */\n  private getIframePermissions(): string {\n    return 'camera; microphone; geolocation; clipboard-write; clipboard-read; payment; autoplay; fullscreen';\n  }\n\n  /**\n   * Update the active community context for API requests\n   */\n  updateCommunityContext(communityId: string): void {\n    if (!this.authContext) {\n      console.error('[AuthenticationService] Cannot update community context - no auth context available');\n      return;\n    }\n\n    const previousCommunityId = this.authContext.communityId;\n    this.authContext.communityId = communityId;\n    \n    console.log(`[MULTI-IFRAME] [AuthenticationService] Community context updated:`);\n    console.log(`[MULTI-IFRAME] [AuthenticationService]   Previous: ${previousCommunityId}`);\n    console.log(`[MULTI-IFRAME] [AuthenticationService]   New: ${communityId}`);\n    console.log(`[MULTI-IFRAME] [AuthenticationService] API requests will now use community: ${communityId}`);\n  }\n\n  /**\n   * Clean up listeners and resources\n   */\n  destroy(): void {\n    if (this.sessionListener) {\n      window.removeEventListener('message', this.sessionListener);\n      this.sessionListener = undefined;\n    }\n    \n    if (this.crossTabListener) {\n      window.removeEventListener('curia-session-change', this.crossTabListener);\n      this.crossTabListener = undefined;\n    }\n    \n    if (this.sessionManagerSubscription) {\n      this.sessionManagerSubscription();\n      this.sessionManagerSubscription = undefined;\n    }\n    \n    this.authContext = null;\n    console.log('[AuthenticationService] Destroyed and cleaned up listeners');\n  }\n} ", "/**\n * FrontendSignatureValidator - Browser-compatible signature validation\n * \n * Validates cryptographic signatures created by CgPluginLibHost using Web Crypto API.\n * This runs in the browser (frontend) and validates signatures BEFORE data transformation.\n * \n * Key features:\n * - RSA-PKCS1-v1_5 with SHA-256 (matches CgPluginLibHost exactly)\n * - Identical data normalization (timestamp + recursive key sorting + JSON.stringify)\n * - Web Crypto API (browser-native, no Node.js dependencies)\n * - PEM key import with proper format handling\n * - Comprehensive error handling and logging\n */\n\n/**\n * Interface for data that can be signature-validated\n */\nexport interface SignableData {\n  method: string;\n  iframeUid?: string;\n  requestId?: string;\n  params?: any;\n  timestamp?: number;\n  [key: string]: any;\n}\n\n/**\n * Browser-compatible signature validation service\n */\nexport class FrontendSignatureValidator {\n  private publicKey: CryptoKey | null = null;\n  private publicKeyPem: string;\n  private isInitialized: boolean = false;\n\n  /**\n   * Initialize the validator with a PEM-formatted public key\n   * \n   * @param publicKeyPem - RSA public key in PEM format\n   */\n  constructor(publicKeyPem: string) {\n    this.publicKeyPem = publicKeyPem;\n  }\n\n  /**\n   * Initialize the validator by importing the public key\n   * This is called automatically on first validation attempt\n   */\n  public async initialize(): Promise<void> {\n    if (this.isInitialized) {\n      return;\n    }\n\n    try {\n      console.log('[FrontendSignatureValidator] Initializing with public key...');\n      \n      this.publicKey = await this.importPublicKey();\n      this.isInitialized = true;\n      \n      console.log('[FrontendSignatureValidator] \u2705 Initialized successfully');\n    } catch (error) {\n      console.error('[FrontendSignatureValidator] \u274C Initialization failed:', error);\n      throw new Error(`Failed to initialize signature validator: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Validate a cryptographic signature against the provided data\n   * \n   * @param data - The original data that was signed\n   * @param signature - Base64-encoded signature to validate\n   * @returns Promise<boolean> - Whether the signature is valid\n   */\n  public async validateSignature(data: SignableData, signature: string): Promise<boolean> {\n    try {\n      // Ensure validator is initialized\n      if (!this.isInitialized) {\n        await this.initialize();\n      }\n\n      if (!this.publicKey) {\n        throw new Error('Public key not available after initialization');\n      }\n\n      console.log('[FrontendSignatureValidator] \uD83D\uDD10 Validating signature for data:', {\n        method: data.method,\n        hasTimestamp: !!data.timestamp,\n        dataKeys: Object.keys(data)\n      });\n\n      // Step 1: Normalize data exactly like CgPluginLibHost does\n      const normalizedData = this.normalizeSignedData(data);\n      \n      // \uD83D\uDD0D DEBUG: Log normalized data and serialization\n      console.log('[FrontendSignatureValidator] \uD83D\uDD0D DEBUG - Normalized data:', JSON.stringify(normalizedData, null, 2));\n      const serializedData = JSON.stringify(normalizedData);\n      console.log('[FrontendSignatureValidator] \uD83D\uDD0D DEBUG - Serialized data:', serializedData);\n      console.log('[FrontendSignatureValidator] \uD83D\uDD0D DEBUG - Serialized length:', serializedData.length);\n      \n      // Step 2: Convert normalized data to bytes for verification\n      const dataBuffer = new TextEncoder().encode(serializedData);\n      \n      // Step 3: Decode base64 signature to bytes\n      const signatureBuffer = this.base64ToArrayBuffer(signature);\n      \n      // Step 4: Verify signature using Web Crypto API\n      const isValid = await crypto.subtle.verify(\n        {\n          name: 'RSASSA-PKCS1-v1_5', // \u2705 CONFIRMED from CgPluginLibHost\n        },\n        this.publicKey,\n        signatureBuffer,\n        dataBuffer\n      );\n\n      console.log(`[FrontendSignatureValidator] ${isValid ? '\u2705' : '\u274C'} Signature validation result: ${isValid}`);\n      \n      return isValid;\n    } catch (error) {\n      console.error('[FrontendSignatureValidator] \u274C Signature validation error:', error);\n      return false; // Invalid signature on any error\n    }\n  }\n\n  /**\n   * Import RSA public key from PEM format using Web Crypto API\n   */\n  private async importPublicKey(): Promise<CryptoKey> {\n    try {\n      // Extract base64 content from PEM format\n      const pemHeader = '-----BEGIN PUBLIC KEY-----';\n      const pemFooter = '-----END PUBLIC KEY-----';\n      const pemContents = this.publicKeyPem\n        .replace(pemHeader, '')\n        .replace(pemFooter, '')\n        .replace(/\\s/g, ''); // Remove all whitespace including newlines\n\n      if (!pemContents) {\n        throw new Error('Invalid PEM format: No key content found');\n      }\n\n      // Convert base64 to ArrayBuffer\n      const binaryData = atob(pemContents);\n      const bytes = new Uint8Array(binaryData.length);\n      for (let i = 0; i < binaryData.length; i++) {\n        bytes[i] = binaryData.charCodeAt(i);\n      }\n\n      // Import key using Web Crypto API\n      const publicKey = await crypto.subtle.importKey(\n        'spki', // Subject Public Key Info format\n        bytes.buffer,\n        {\n          name: 'RSASSA-PKCS1-v1_5', // \u2705 CONFIRMED from CgPluginLibHost\n          hash: 'SHA-256',            // \u2705 CONFIRMED from CgPluginLibHost\n        },\n        false, // Not extractable\n        ['verify'] // Only for signature verification\n      );\n\n      return publicKey;\n    } catch (error) {\n      throw new Error(`Failed to import public key: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Normalize data for signing exactly like CgPluginLibHost does\n   * \n   * CRITICAL: This must match CgPluginLibHost.prepareDataForSigning() exactly!\n   * \n   * Process:\n   * 1. Add timestamp if not present (\u26A0\uFE0F Frontend receives already-signed data with timestamp)\n   * 2. Sort object keys recursively \n   * 3. Return normalized object (JSON.stringify happens in validateSignature)\n   */\n  private normalizeSignedData(data: SignableData): any {\n    // \u26A0\uFE0F IMPORTANT: Frontend validation receives data that was already signed.\n    // The timestamp was added during signing, so we DON'T add a new Date.now()\n    // We only add timestamp if somehow missing (edge case)\n    const dataWithTimestamp = {\n      ...data,\n      timestamp: data.timestamp || Date.now(), // Only add if missing\n    };\n\n    // Sort object keys recursively for consistent serialization\n    return this.sortObjectKeys(dataWithTimestamp);\n  }\n\n  /**\n   * Recursively sort object keys for consistent serialization\n   * \n   * \u2705 EXACT COPY of CgPluginLibHost.sortObjectKeys() method\n   */\n  private sortObjectKeys(obj: any): any {\n    if (obj === null || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(item => this.sortObjectKeys(item));\n    }\n\n    const sorted: any = {};\n    Object.keys(obj)\n      .sort()\n      .forEach(key => {\n        sorted[key] = this.sortObjectKeys(obj[key]);\n      });\n\n    return sorted;\n  }\n\n  /**\n   * Convert base64 string to ArrayBuffer for Web Crypto API\n   */\n  private base64ToArrayBuffer(base64: string): ArrayBuffer {\n    try {\n      const binaryString = atob(base64);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      return bytes.buffer;\n    } catch (error) {\n      throw new Error(`Invalid base64 signature format: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Static factory method to create validator from environment variable\n   * \n   * @returns FrontendSignatureValidator instance\n   * @throws Error if NEXT_PUBLIC_CURIA_PUBKEY is not configured\n   */\n  public static fromEnvironment(): FrontendSignatureValidator {\n    const publicKey = process.env.NEXT_PUBLIC_CURIA_PUBKEY;\n    \n    if (!publicKey) {\n      throw new Error('NEXT_PUBLIC_CURIA_PUBKEY environment variable is required for signature validation');\n    }\n\n    return new FrontendSignatureValidator(publicKey);\n  }\n\n  /**\n   * Static factory method to create validator from public key parameter\n   * \n   * @param publicKey - RSA public key in PEM format\n   * @returns FrontendSignatureValidator instance\n   */\n  public static fromPublicKey(publicKey: string): FrontendSignatureValidator {\n    if (!publicKey) {\n      throw new Error('Public key is required for signature validation');\n    }\n\n    return new FrontendSignatureValidator(publicKey);\n  }\n\n  /**\n   * Check if validator is ready for use\n   */\n  public isReady(): boolean {\n    return this.isInitialized && this.publicKey !== null;\n  }\n} ", "/**\n * MessageRouter Service\n * Handles all iframe messaging, API routing, and inter-frame communication\n * \n * Extracted from InternalPluginHost for better separation of concerns\n * Responsibilities:\n * - Set up message listeners for iframe communication\n * - Route API requests from iframe to host service via proxy\n * - Handle authentication completion messages\n * - Send responses and errors back to iframes\n * - Manage message routing between multiple embed instances\n */\n\nimport { ApiProxyClient } from '@curia_/iframe-api-proxy';\nimport { InternalAuthContext } from '../auth/AuthenticationService';\nimport { FrontendSignatureValidator } from '../signature';\n\nexport enum InternalMessageType {\n  API_REQUEST = 'api_request',\n  API_RESPONSE = 'api_response',\n  INIT = 'init',\n  ERROR = 'error'\n}\n\nexport interface InternalPluginMessage {\n  type: InternalMessageType;\n  iframeUid: string;\n  requestId: string;\n  method?: string;\n  params?: any;\n  data?: any;\n  error?: string;\n  signature?: string;\n  timestamp?: number; // \u2705 Add timestamp field to match signed data\n}\n\nexport interface MessageRouterCallbacks {\n  onAuthComplete?: (authData: any) => Promise<void>;\n  onForumInit?: () => void;\n  getAuthContext?: () => InternalAuthContext | null;\n  onCommunitySwitchRequest?: (communityId: string, options?: any) => Promise<any>;\n  onCommunityDiscoveryComplete?: (discoveryData: any) => Promise<void>;\n  onAddSessionComplete?: (sessionData: any) => Promise<void>;\n  onApiProxyReady?: (sourceWindow: Window) => void;\n}\n\nexport class MessageRouter {\n  private apiProxy: ApiProxyClient;\n  private callbacks: MessageRouterCallbacks;\n  private messageListener?: (event: MessageEvent) => void;\n  private myUid: string;\n  private signatureValidator: FrontendSignatureValidator;\n\n  constructor(\n    myUid: string,\n    apiProxy: ApiProxyClient,\n    callbacks: MessageRouterCallbacks = {},\n    publicKey?: string\n  ) {\n    // Use the shared API proxy client (don't create a new one!)\n    this.apiProxy = apiProxy;\n    this.myUid = myUid;\n    this.callbacks = callbacks;\n    \n    // Initialize signature validator for frontend validation\n    if (publicKey) {\n      // Use provided public key (for embed script)\n      this.signatureValidator = FrontendSignatureValidator.fromPublicKey(publicKey);\n    } else {\n      // Use environment variable (for Next.js components)\n      this.signatureValidator = FrontendSignatureValidator.fromEnvironment();\n    }\n    \n    console.log('[MessageRouter] Initialized with shared API proxy client and signature validator');\n  }\n\n  /**\n   * Set up message listener for all plugin communication\n   */\n  setupMessageListener(): void {\n    // Store listener reference for proper cleanup\n    this.messageListener = (event: MessageEvent) => {\n      this.handleMessage(event);\n    };\n    \n    window.addEventListener('message', this.messageListener);\n    console.log('[MessageRouter] Message listener attached for UID:', this.myUid);\n  }\n\n  /**\n   * Handle all incoming messages\n   */\n  private async handleMessage(event: MessageEvent): Promise<void> {\n    if (!event.data || typeof event.data !== 'object') {\n      return;\n    }\n\n    // Handle auth completion from embed iframe\n    if (event.data.type === 'curia-auth-complete') {\n      if (this.callbacks.onAuthComplete) {\n        await this.callbacks.onAuthComplete(event.data);\n      }\n      return;\n    }\n\n    // Handle community discovery completion from embed iframe\n    if (event.data.type === 'curia-community-discovery-complete') {\n      if (this.callbacks.onCommunityDiscoveryComplete) {\n        await this.callbacks.onCommunityDiscoveryComplete(event.data);\n      }\n      return;\n    }\n\n    // Handle add session completion from embed iframe\n    if (event.data.type === 'curia-add-session-complete') {\n      if (this.callbacks.onAddSessionComplete) {\n        await this.callbacks.onAddSessionComplete(event.data);\n      }\n      return;\n    }\n\n    // Handle API proxy ready notification from iframe\n    if (event.data.type === 'curia-api-proxy-ready') {\n      console.log('[MessageRouter] API proxy ready notification received');\n      if (this.callbacks.onApiProxyReady) {\n        this.callbacks.onApiProxyReady(event.source as Window);\n      }\n      return;\n    }\n\n    // Handle API requests from forum\n    const message = event.data as InternalPluginMessage;\n    if (message.type === InternalMessageType.API_REQUEST) {\n      await this.handleApiRequest(message, event.source as Window);\n      return;\n    }\n\n    // Handle other message types\n    if (message.type === InternalMessageType.INIT) {\n      console.log('[MessageRouter] Forum initialized');\n      if (this.callbacks.onForumInit) {\n        this.callbacks.onForumInit();\n      }\n      return;\n    }\n  }\n\n  /**\n   * Handle API requests from forum iframe\n   */\n  private async handleApiRequest(message: InternalPluginMessage, source: Window): Promise<void> {\n    try {\n      console.log('[MessageRouter] API request:', message.method, message.params);\n      \n      // Get auth context from callback\n      const authContext = this.callbacks.getAuthContext?.();\n      if (!authContext) {\n        throw new Error('No authentication context available');\n      }\n\n      // Instance-based UID filtering - only handle our own messages\n      if (message.iframeUid !== this.myUid) {\n        // Silently ignore messages from other embed instances\n        return;\n      }\n\n      // Validate method is provided and supported\n      if (!message.method || !this.isMethodSupported(message.method)) {\n        throw new Error(`Unknown API method: ${message.method}`);\n      }\n\n      // \uD83D\uDD10 FRONTEND SIGNATURE VALIDATION: Validate iframe request before transformation\n      if (message.signature) {\n        console.log('[MessageRouter] \uD83D\uDD10 Validating signature (frontend Web Crypto API)');\n        \n        try {\n          // Reconstruct original signed data (what CgPluginLib actually signed)\n          const originalSignedData: any = {\n            method: message.method,\n            iframeUid: message.iframeUid,\n            requestId: message.requestId,\n            timestamp: message.timestamp // \u2705 Use timestamp from message\n          };\n          \n          // Only include params if it exists and is not undefined (matches signing behavior)\n          if (message.params !== undefined) {\n            originalSignedData.params = message.params;\n          }\n\n          // \uD83D\uDD0D DEBUG: Log exactly what we're validating\n          console.log('[MessageRouter] \uD83D\uDD0D DEBUG - Message received:', JSON.stringify(message, null, 2));\n          console.log('[MessageRouter] \uD83D\uDD0D DEBUG - Data for validation:', JSON.stringify(originalSignedData, null, 2));\n          console.log('[MessageRouter] \uD83D\uDD0D DEBUG - Signature length:', message.signature?.length);\n\n          // Validate signature using browser-native Web Crypto API\n          const isValid = await this.signatureValidator.validateSignature(originalSignedData, message.signature);\n          \n          if (!isValid) {\n            throw new Error('Invalid signature - request rejected');\n          }\n          \n          console.log('[MessageRouter] \u2705 Frontend signature validation passed');\n        } catch (error) {\n          console.error('[MessageRouter] \u274C Frontend signature validation failed:', error);\n          this.sendError(source, message, `Signature validation failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n          return;\n        }\n      } else {\n        // No signature means this should be an internal call, but iframe requests should always have signatures\n        console.warn('[MessageRouter] \u26A0\uFE0F No signature provided for iframe request - this might be a security issue');\n      }\n\n      // Handle community switching requests locally (not via API proxy)\n      if (message.method === 'switchCommunity') {\n        console.log('[MessageRouter] Handling community switch request:', message.params);\n        \n        if (!this.callbacks.onCommunitySwitchRequest) {\n          throw new Error('Community switching not supported - no callback registered');\n        }\n\n        const { communityId, options } = message.params;\n        if (!communityId) {\n          throw new Error('Missing communityId parameter for community switch');\n        }\n\n        const switchResult = await this.callbacks.onCommunitySwitchRequest(communityId, options);\n        this.sendResponse(source, message, switchResult);\n        return;\n      }\n\n      // Use API proxy client to make request (bypasses CSP restrictions)\n      console.log('[MessageRouter] Making API request via proxy:', message.method);\n      console.log('[MessageRouter] Auth context:', {\n        communityId: authContext.communityId,\n        userId: authContext.userId\n      });\n      console.log('[MessageRouter] Signature present:', !!message.signature);\n      console.log(`[MULTI-IFRAME] [MessageRouter] API request \"${message.method}\" using community context: ${authContext.communityId}`);\n      \n      const result = await this.apiProxy.makeApiRequest({\n        method: message.method as any,\n        params: message.params,\n        communityId: authContext.communityId,\n        userId: authContext.userId,\n        signature: message.signature\n      });\n\n      console.log('[MessageRouter] API proxy response:', result);\n      \n      if (result.success) {\n        // Send successful response\n        this.sendResponse(source, message, result.data);\n      } else {\n        throw new Error(result.error || 'API request failed');\n      }\n      \n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      console.error('[MessageRouter] API error:', errorMessage);\n      this.sendError(source, message, errorMessage);\n    }\n  }\n\n  /**\n   * Send successful response to forum\n   */\n  private sendResponse(source: Window, originalMessage: InternalPluginMessage, data: any): void {\n    const response: InternalPluginMessage = {\n      type: InternalMessageType.API_RESPONSE,\n      iframeUid: originalMessage.iframeUid,\n      requestId: originalMessage.requestId,\n      data: data\n    };\n    \n    source.postMessage(response, '*');\n    console.log('[MessageRouter] Response sent for request:', originalMessage.requestId);\n  }\n\n  /**\n   * Send error response to forum\n   */\n  private sendError(source: Window, originalMessage: InternalPluginMessage, error: string): void {\n    const response: InternalPluginMessage = {\n      type: InternalMessageType.API_RESPONSE,\n      iframeUid: originalMessage.iframeUid,\n      requestId: originalMessage.requestId,\n      error: error\n    };\n    \n    source.postMessage(response, '*');\n    console.log('[MessageRouter] Error response sent for request:', originalMessage.requestId, error);\n  }\n\n  /**\n   * Check if API method is supported\n   */\n  private isMethodSupported(method: string): boolean {\n    const supportedMethods = [\n      'getUserInfo',\n      'getUserFriends', \n      'getContextData',\n      'getCommunityInfo',\n      'giveRole',\n      'switchCommunity',\n      'getUserCommunities',  // \uD83C\uDFAF For fetchUserCommunities() - bypasses CSP\n      'getUserProfile'       // \uD83C\uDFAF For fetchUserProfile() - bypasses CSP\n    ];\n    \n    return supportedMethods.includes(method);\n  }\n\n  /**\n   * Send a message to an iframe\n   */\n  sendMessageToIframe(iframe: HTMLIFrameElement, message: InternalPluginMessage): void {\n    if (iframe.contentWindow) {\n      iframe.contentWindow.postMessage(message, '*');\n      console.log('[MessageRouter] Message sent to iframe:', message.type, message.requestId);\n    }\n  }\n\n  /**\n   * Update the unique identifier for this embed instance\n   */\n  updateUid(newUid: string): void {\n    this.myUid = newUid;\n    console.log('[MessageRouter] UID updated to:', newUid);\n  }\n\n  /**\n   * Clean up message listeners and resources\n   */\n  destroy(): void {\n    if (this.messageListener) {\n      window.removeEventListener('message', this.messageListener);\n      this.messageListener = undefined;\n      console.log('[MessageRouter] Message listener removed');\n    }\n  }\n} ", "/**\n * IframeManager Service\n * Handles iframe lifecycle, creation, URL building, and DOM management\n * \n * Extracted from InternalPluginHost for better separation of concerns\n * Responsibilities:\n * - Create and configure auth iframes\n * - Create and configure forum iframes\n * - Generate unique iframe UIDs\n * - Handle iframe URL building with parameters\n * - Manage iframe permissions and security attributes\n * - Clean up iframe-related DOM elements\n * - Handle iframe switching between auth and forum phases\n */\n\nimport { ApiProxyClient } from '@curia_/iframe-api-proxy';\nimport { InternalAuthContext } from '../auth/AuthenticationService';\nimport { EmbedConfig } from '../../types/EmbedTypes';\n\nexport interface IframeManagerCallbacks {\n  onIframeSwitch?: (iframe: HTMLIFrameElement, type: 'auth' | 'forum') => void;\n}\n\nexport class IframeManager {\n  private hostServiceUrl: string;\n  private forumUrl: string;\n  private apiProxy: ApiProxyClient;\n  private callbacks: IframeManagerCallbacks;\n  private currentIframe: HTMLIFrameElement | null = null;\n  private myUid: string;\n\n  constructor(\n    hostServiceUrl: string,\n    forumUrl: string,\n    apiProxy: ApiProxyClient,\n    callbacks: IframeManagerCallbacks = {}\n  ) {\n    this.hostServiceUrl = hostServiceUrl;\n    this.forumUrl = forumUrl;\n    this.apiProxy = apiProxy;\n    this.callbacks = callbacks;\n    this.myUid = this.generateIframeUid();\n  }\n\n  /**\n   * Get the current iframe UID\n   */\n  getUid(): string {\n    return this.myUid;\n  }\n\n  /**\n   * Get the currently active iframe\n   */\n  getCurrentIframe(): HTMLIFrameElement | null {\n    return this.currentIframe;\n  }\n\n  /**\n   * Generate unique iframe UID\n   */\n  private generateIframeUid(): string {\n    const timestamp = Date.now().toString(36).toUpperCase();\n    const random = Math.random().toString(36).substring(2, 8).toUpperCase();\n    return `${timestamp}${random}`.substring(0, 10);\n  }\n\n  /**\n   * Create auth iframe with proper configuration\n   */\n  createAuthIframe(config: EmbedConfig): HTMLIFrameElement {\n    console.log('[IframeManager] Creating auth iframe');\n    \n    // Build auth iframe URL\n    const authUrl = new URL(`${this.hostServiceUrl}/embed`);\n    authUrl.searchParams.set('theme', config.theme || 'light');\n    \n    if (config.backgroundColor) {\n      authUrl.searchParams.set('background_color', config.backgroundColor);\n    }\n    if (config.community) {\n      authUrl.searchParams.set('community', config.community);\n    }\n    if (config.mode) {\n      authUrl.searchParams.set('mode', config.mode);\n    }\n    \n    // Add parent URL to auth iframe\n    if (config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(config.parentUrl);\n      authUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n    }\n    \n    // Add external parameters from parent page\n    if (config.externalParams) {\n      for (const [key, value] of Object.entries(config.externalParams)) {\n        authUrl.searchParams.set(key, value);\n      }\n    }\n    \n    // Create iframe\n    const iframe = document.createElement('iframe');\n    iframe.src = authUrl.toString();\n    iframe.style.width = config.width || '100%';\n    iframe.style.height = config.height || '700px';\n    iframe.style.border = 'none';\n    iframe.style.borderRadius = config.borderRadius || '8px';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', this.getIframePermissions());\n    \n    this.currentIframe = iframe;\n    \n    // \uD83C\uDFAF CRITICAL FIX: Set auth iframe as active iframe for API proxy during auth phase\n    this.apiProxy.setActiveIframe(iframe);\n    console.log('[IframeManager] API proxy client configured for auth iframe:', {\n      iframeSrc: iframe.src,\n      hasContentWindow: !!iframe.contentWindow\n    });\n    \n    // Notify callback\n    if (this.callbacks.onIframeSwitch) {\n      this.callbacks.onIframeSwitch(iframe, 'auth');\n    }\n    \n    console.log('[IframeManager] Auth iframe created');\n    return iframe;\n  }\n\n  /**\n   * Create forum iframe with auth context and configuration\n   */\n  createForumIframe(\n    config: EmbedConfig,\n    authContext: InternalAuthContext,\n    targetContainer: HTMLElement\n  ): HTMLIFrameElement {\n    console.log('[IframeManager] Creating forum iframe');\n    \n    // Build forum URL with parameters\n    const forumUrl = new URL(this.forumUrl);\n    forumUrl.searchParams.set('mod', 'standalone');\n    \n    // Theme resolution\n    let resolvedTheme = config.theme || 'light';\n    if (resolvedTheme === 'auto') {\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        resolvedTheme = 'dark';\n      } else {\n        resolvedTheme = 'light';\n      }\n      console.log('[IframeManager] Resolved auto theme to:', resolvedTheme);\n    }\n    \n    forumUrl.searchParams.set('cg_theme', resolvedTheme);\n    if (config.backgroundColor) {\n      forumUrl.searchParams.set('cg_bg_color', config.backgroundColor);\n    }\n    forumUrl.searchParams.set('iframeUid', this.myUid);\n    \n    // Add parent URL parameter ONLY if community is pre-specified\n    if (config.community && config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(config.parentUrl);\n      forumUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n      console.log('[IframeManager] Adding parent URL (community pre-specified):', config.parentUrl);\n    }\n    \n    // Add external parameters to forum URL\n    if (authContext.externalParams) {\n      console.log('[IframeManager] Adding external parameters to forum iframe:', authContext.externalParams);\n      for (const [key, value] of Object.entries(authContext.externalParams)) {\n        forumUrl.searchParams.set(key, value);\n      }\n    }\n    \n    console.log('[IframeManager] Forum URL:', forumUrl.toString());\n    \n    // Create forum iframe - use 100% to fill the properly-sized container\n    const iframe = document.createElement('iframe');\n    iframe.src = forumUrl.toString();\n    iframe.style.width = '100%';\n    iframe.style.height = '100%';\n    iframe.style.border = 'none';\n    iframe.style.margin = '0';\n    iframe.style.padding = '0';\n    iframe.style.display = 'block';\n    iframe.style.verticalAlign = 'top';\n    // Only apply border radius to right side since sidebar is always present on left\n    const borderRadius = config.borderRadius || '8px';\n    iframe.style.borderRadius = `0 ${borderRadius} ${borderRadius} 0`;\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', this.getIframePermissions());\n    \n    console.log('[IframeManager] Forum iframe set to fill container (100% x 100%)');\n    \n    // Add iframe to container\n    targetContainer.appendChild(iframe);\n    this.currentIframe = iframe;\n    \n    // Set forum iframe as active iframe for API proxy\n    this.apiProxy.setActiveIframe(iframe);\n    console.log('[IframeManager] API proxy client configured for forum iframe:', {\n      iframeSrc: iframe.src,\n      hasContentWindow: !!iframe.contentWindow\n    });\n    \n    // Notify callback\n    if (this.callbacks.onIframeSwitch) {\n      this.callbacks.onIframeSwitch(iframe, 'forum');\n    }\n    \n    console.log('[IframeManager] Forum iframe created and added to container');\n    return iframe;\n  }\n\n  /**\n   * Reload the current iframe (useful for session switches)\n   */\n  reloadCurrentIframe(): void {\n    if (this.currentIframe) {\n      console.log('[IframeManager] Reloading current iframe');\n      const currentSrc = this.currentIframe.src;\n      this.currentIframe.src = currentSrc;\n    }\n  }\n\n  /**\n   * Update iframe with new URL parameters\n   */\n  updateIframeUrl(iframe: HTMLIFrameElement, newParams: Record<string, string>): void {\n    const url = new URL(iframe.src);\n    \n    // Add new parameters\n    for (const [key, value] of Object.entries(newParams)) {\n      url.searchParams.set(key, value);\n    }\n    \n    iframe.src = url.toString();\n    console.log('[IframeManager] Updated iframe URL with new parameters');\n  }\n\n  /**\n   * Clean up iframe-related portal elements\n   */\n  cleanupPortalElements(): void {\n    console.log('[IframeManager] Cleaning up iframe portal elements');\n    \n    // Clean up portal elements (community previews, user profile menu)\n    const portals = document.querySelectorAll('.community-preview, .user-profile-menu');\n    portals.forEach(portal => {\n      console.log('[IframeManager] Removing portal element:', portal.className);\n      portal.remove();\n    });\n    \n    console.log('[IframeManager] Portal elements cleanup complete');\n  }\n\n  /**\n   * Remove current iframe and clean up references\n   */\n  removeCurrentIframe(): void {\n    if (this.currentIframe) {\n      console.log('[IframeManager] Removing current iframe');\n      \n      // Remove from DOM\n      if (this.currentIframe.parentNode) {\n        this.currentIframe.parentNode.removeChild(this.currentIframe);\n      }\n      \n      // Clear reference\n      this.currentIframe = null;\n      \n      console.log('[IframeManager] Current iframe removed');\n    }\n  }\n\n  /**\n   * Get iframe permissions string for security attributes\n   */\n  private getIframePermissions(): string {\n    return [\n      'clipboard-write *',\n      'clipboard-read *', \n      'fullscreen *',\n      'web-share *',\n      'autoplay *',\n      'picture-in-picture *',\n      'payment *',\n      'encrypted-media *',\n      'storage-access *',\n      'camera *',\n      'microphone *',\n      'geolocation *'\n    ].join('; ');\n  }\n\n  /**\n   * Regenerate UID (useful for new sessions)\n   */\n  regenerateUid(): string {\n    this.myUid = this.generateIframeUid();\n    console.log('[IframeManager] Generated new UID:', this.myUid);\n    return this.myUid;\n  }\n\n  /**\n   * Clean up resources and references\n   */\n  destroy(): void {\n    console.log('[IframeManager] Destroying iframe manager');\n    \n    // Clean up portal elements\n    this.cleanupPortalElements();\n    \n    // Remove current iframe\n    this.removeCurrentIframe();\n    \n    console.log('[IframeManager] Iframe manager destroyed');\n  }\n} ", "/**\n * Embed Script Entry Point\n * \n * This is the main entry point for the embed.js bundle.\n * It imports the actual TypeScript classes and creates a self-contained script.\n */\n\nimport { EmbedConfig } from './types/EmbedTypes';\nimport { parseEmbedConfig } from './core/EmbedConfig';\nimport { InternalPluginHost } from './plugin-host/InternalPluginHost';\n\n// Use global interface from EmbedTypes (avoids circular import issues)\n// window.curiaEmbed will be InternalPluginHost but typed as any\n\n// Get environment values (injected at build time via esbuild define)\ndeclare const CURIA_HOST_URL: string;\ndeclare const CURIA_FORUM_URL: string;\ndeclare const CURIA_PUBLIC_KEY: string;\n\n// Capture script element during initial execution when document.currentScript works\nconst EMBED_SCRIPT_ELEMENT = document.currentScript as HTMLScriptElement;\n\n// Validate that we have the script element\nif (!EMBED_SCRIPT_ELEMENT) {\n  console.error('[Embed] Failed to capture script element during initialization');\n}\n\n/**\n * Extract curia_* parameters from parent page URL\n * Converts curia_highlight=comment-123 to ext_highlight=comment-123\n */\nfunction extractCuriaParameters(): Record<string, string> {\n  const params = new URLSearchParams(window.location.search);\n  const curiaParams: Record<string, string> = {};\n  \n  console.log('[Embed] Checking parent page URL for curia_* parameters:', window.location.search);\n  \n  for (const [key, value] of params) {\n    if (key.startsWith('curia_')) {\n      const cleanKey = key.substring(6); // Remove 'curia_' prefix\n      const externalKey = `ext_${cleanKey}`; // Add 'ext_' prefix\n      curiaParams[externalKey] = value;\n      console.log(`[Embed] Found curia parameter: ${key}=${value} \u2192 ${externalKey}=${value}`);\n    }\n  }\n  \n  return curiaParams;\n}\n\n/**\n * Strip curia_* parameters from parent page URL\n * Preserves all other query parameters but removes our internal curia_* params\n */\nfunction stripCuriaParameters(url: string): string {\n  try {\n    const urlObj = new URL(url);\n    \n    // Collect all curia_* parameter keys to delete\n    const keysToDelete: string[] = [];\n    for (const [key] of urlObj.searchParams) {\n      if (key.startsWith('curia_')) {\n        keysToDelete.push(key);\n      }\n    }\n    \n    // Delete all curia_* parameters\n    for (const key of keysToDelete) {\n      urlObj.searchParams.delete(key);\n    }\n    \n    if (keysToDelete.length > 0) {\n      console.log('[Embed] Stripped curia_* parameters:', keysToDelete);\n    }\n    \n    return urlObj.toString();\n  } catch (error) {\n    console.warn('[Embed] Failed to parse parent URL, using original:', url);\n    return url;\n  }\n}\n\n// Main embed initialization function\nfunction initializeEmbed() {\n  console.log('[Embed] Initializing Curia embed script...');\n\n  try {\n    // Capture parent page URL and strip curia_* parameters to prevent recursion\n    const rawParentUrl = window.location.href;\n    const parentUrl = stripCuriaParameters(rawParentUrl);\n    console.log('[Embed] Raw parent page URL:', rawParentUrl);\n    console.log('[Embed] Clean parent page URL (curia_* stripped):', parentUrl);\n    \n    // Extract external parameters from parent page URL\n    const externalParams = extractCuriaParameters();\n    \n    // Parse configuration from script attributes using captured script element\n    // If capture failed, parseEmbedConfig will try document.currentScript as fallback\n    const config = parseEmbedConfig(EMBED_SCRIPT_ELEMENT);\n    \n    // Add parent URL to config\n    config.parentUrl = parentUrl;\n    \n    // Add external parameters to config\n    if (Object.keys(externalParams).length > 0) {\n      config.externalParams = externalParams;\n      console.log('[Embed] External parameters added to config:', externalParams);\n    }\n    \n    console.log('[Embed] Final parsed config:', config);\n\n    // Find or create target container\n    const containerId = config.container || 'curia-forum';\n    let container = document.getElementById(containerId);\n    \n    if (!container) {\n      console.log(`[Embed] Container \"${containerId}\" not found, creating it`);\n      container = document.createElement('div');\n      container.id = containerId;\n      \n      // Try to insert next to script element, otherwise append to body\n      if (EMBED_SCRIPT_ELEMENT?.parentNode) {\n        EMBED_SCRIPT_ELEMENT.parentNode.insertBefore(container, EMBED_SCRIPT_ELEMENT.nextSibling);\n      } else {\n        console.warn('[Embed] No script element available, appending container to body');\n        document.body.appendChild(container);\n      }\n    }\n\n    // Clean up any existing embed instance\n    if (window.curiaEmbed) {\n      console.log('[Embed] Cleaning up existing embed instance');\n      window.curiaEmbed.destroy();\n      delete window.curiaEmbed;\n    }\n\n    // Create new embed instance using the real TypeScript class\n    console.log('[Embed] Creating InternalPluginHost instance');\n    const embedInstance = new InternalPluginHost(\n      container,\n      config,\n      CURIA_HOST_URL,\n      CURIA_FORUM_URL,\n      CURIA_PUBLIC_KEY\n    );\n\n    // Store global reference for cleanup\n    window.curiaEmbed = embedInstance;\n    \n    console.log('[Embed] Embed initialized successfully');\n    \n  } catch (error) {\n    console.error('[Embed] Failed to initialize embed:', error);\n  }\n}\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initializeEmbed);\n} else {\n  // DOM already loaded, initialize immediately\n  initializeEmbed();\n} "],
  "mappings": "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G;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QACT;AAAA,QAAG;AAAA,QAAG;AAAA,QAAI;AAAA,QACV;AAAA,QAAG;AAAA,QAAG;AAAA,QAAI;AAAA,QACV;AAAA,QAAG;AAAA,QAAG;AAAA,QAAI;AAAA,QACV;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QACX;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QACZ;AAAA,QAAI;AAAA,QAA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",
  "names": ["MessageType", "ProxyErrorType", "ApiProxyClient", "module", "require_utils", "QRCode", "QRCode", "userName", "hasProfileImage", "gradientClass", "gradientStyle", "name", "community"]
}
