{
  "version": 3,
  "sources": ["../node_modules/@curia_/iframe-api-proxy/src/types/ApiTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/types/MessageTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/types/ProxyTypes.ts", "../node_modules/@curia_/iframe-api-proxy/src/client/ApiProxyClient.ts", "../node_modules/@curia_/iframe-api-proxy/src/server/ApiProxyServer.ts", "../node_modules/@curia_/iframe-api-proxy/src/index.ts", "../src/lib/embed/core/EmbedConfig.ts", "../src/lib/embed/plugin-host/InternalPluginHost.ts", "../src/lib/SessionManager.ts", "../src/lib/embed/embed-entry.ts"],
  "sourcesContent": [null, null, null, null, null, null, "/**\n * Embed Configuration Module\n * \n * Handles parsing configuration from script data attributes\n */\n\nimport { EmbedConfig } from '../types/EmbedTypes';\n\n/**\n * Parse configuration from script data attributes\n */\nexport function parseEmbedConfig(scriptElement?: HTMLScriptElement): EmbedConfig {\n  // Get the script element - either passed in or from document.currentScript\n  const script = scriptElement || (document.currentScript as HTMLScriptElement);\n  if (!script) {\n    throw new Error('[Curia] Could not find script element');\n  }\n\n  // Read configuration from data attributes\n  const config: EmbedConfig = {\n    community: script.getAttribute('data-community') || null,\n    theme: (script.getAttribute('data-theme') as 'light' | 'dark' | 'auto') || 'light',\n    backgroundColor: script.getAttribute('data-background-color') || undefined,\n    borderRadius: script.getAttribute('data-border-radius') || undefined,\n    container: script.getAttribute('data-container') || null,\n    height: script.getAttribute('data-height') || '600px',\n    width: script.getAttribute('data-width') || '100%',\n    mode: (script.getAttribute('data-mode') as 'full' | 'auth-only') || 'full'\n  };\n\n  console.log('[Curia] Parsed embed config:', config);\n  return config;\n}\n\n/**\n * Validate embed configuration\n */\nexport function validateEmbedConfig(config: EmbedConfig): void {\n  // Validate theme\n  if (config.theme !== 'light' && config.theme !== 'dark' && config.theme !== 'auto') {\n    console.warn('[Curia] Invalid theme, using light:', config.theme);\n    config.theme = 'light';\n  }\n\n  // Validate background color (if provided)\n  if (config.backgroundColor && !config.backgroundColor.match(/^#[0-9A-Fa-f]{6}$/)) {\n    console.warn('[Curia] Invalid background color format, removing:', config.backgroundColor);\n    config.backgroundColor = undefined;\n  }\n\n  // Validate height format\n  if (config.height && !config.height.match(/^\\d+(px|%|vh|em|rem)$/)) {\n    console.warn('[Curia] Invalid height format, using 600px:', config.height);\n    config.height = '600px';\n  }\n\n  // Validate width format\n  if (config.width && !config.width.match(/^\\d+(px|%|vw|em|rem)$/)) {\n    console.warn('[Curia] Invalid width format, using 100%:', config.width);\n    config.width = '100%';\n  }\n}\n\n/**\n * Generate embed script configuration JavaScript\n */\nexport function generateConfigCode(config: EmbedConfig): string {\n  return `\n  // Get the script element that loaded this code\n  const script = document.currentScript;\n  if (!script) {\n    console.error('[Curia] Could not find script element');\n    return;\n  }\n\n  // Read configuration from data attributes\n  const config = {\n    community: script.getAttribute('data-community') || null,\n    theme: script.getAttribute('data-theme') || 'light',\n    backgroundColor: script.getAttribute('data-background-color') || undefined,\n    borderRadius: script.getAttribute('data-border-radius') || undefined,\n    container: script.getAttribute('data-container') || null,\n    height: script.getAttribute('data-height') || '600px',\n    width: script.getAttribute('data-width') || '100%'\n  };\n\n  console.log('[Curia] Initializing embed with config:', config);\n  `;\n} ", "/**\n * Internal Plugin Host - Self-contained plugin hosting within embed script\n * \n * This class embeds all ClientPluginHost functionality directly into the embed script,\n * making it completely self-contained so customers don't need to implement any logic.\n * \n * Updated to use SessionManager instead of localStorage for session management.\n * \n * Responsibilities:\n * 1. Handle auth completion from embed iframe\n * 2. Manage iframe switching (auth \u2192 forum)\n * 3. Route API requests from forum to host service\n * 4. Maintain auth context throughout session\n */\n\nimport { EmbedConfig } from '../types/EmbedTypes';\nimport { ApiProxyClient } from '@curia_/iframe-api-proxy';\nimport { sessionManager } from '../../SessionManager';\n\n/**\n * Authentication context for API requests\n */\nexport interface InternalAuthContext {\n  userId: string;\n  communityId: string;\n  sessionToken?: string;\n  externalParams?: Record<string, string>;\n  parentUrl?: string;\n}\n\n/**\n * User's community membership info\n */\nexport interface UserCommunityMembership {\n  id: string;\n  name: string;\n  logoUrl: string | null;\n  userRole: 'member' | 'moderator' | 'admin' | 'owner';\n  isMember: boolean;\n}\n\n/**\n * User profile information from authentication\n */\nexport interface UserProfile {\n  userId: string;\n  name: string;\n  profilePictureUrl: string | null;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress: string | null;\n  ensDomain: string | null;\n  upAddress: string | null;\n  isAnonymous: boolean;\n}\n\n/**\n * Beautiful Discord-style community navigation sidebar\n */\nclass CommunityNavigationUI {\n  private communities: UserCommunityMembership[];\n  private currentCommunityId: string;\n  private userProfile: UserProfile | null;\n  private onMenuAction?: (action: string) => void;\n  private container: HTMLElement | null = null;\n\n  constructor(communities: UserCommunityMembership[], currentCommunityId: string, userProfile: UserProfile | null, onMenuAction?: (action: string) => void) {\n    this.communities = communities;\n    this.currentCommunityId = currentCommunityId;\n    this.userProfile = userProfile;\n    this.onMenuAction = onMenuAction;\n  }\n\n  render(): HTMLElement {\n    const nav = document.createElement('div');\n    nav.className = 'curia-community-nav';\n    \n    // Beautiful inset sidebar styling with gradients\n    nav.style.cssText = `\n      width: 80px;\n      background: linear-gradient(135deg, \n        var(--sidebar-bg-from, #f8fafc) 0%, \n        var(--sidebar-bg-to, #f1f5f9) 100%);\n      border-right: 1px solid var(--sidebar-border, rgba(148, 163, 184, 0.2));\n      box-shadow: \n        inset 2px 0 4px rgba(0, 0, 0, 0.05),\n        inset 0 2px 4px rgba(0, 0, 0, 0.03);\n      display: flex;\n      flex-direction: column;\n      padding: 16px;\n      position: relative;\n      min-height: 0;\n    `;\n    \n    // Add comprehensive styling for dark/light modes and hover effects\n    const globalStyles = document.createElement('style');\n    globalStyles.textContent = `\n      .curia-community-nav::-webkit-scrollbar { display: none; }\n      \n      /* Dark mode variables */\n      [data-theme=\"dark\"] .curia-community-nav,\n      .dark .curia-community-nav {\n        --sidebar-bg-from: #1e293b;\n        --sidebar-bg-to: #0f172a;\n        --sidebar-border: rgba(71, 85, 105, 0.3);\n        --item-bg: rgba(30, 41, 59, 0.8);\n        --item-hover-bg: rgba(30, 41, 59, 0.95);\n        --item-active-bg: rgba(59, 130, 246, 0.2);\n        --item-active-border: rgba(59, 130, 246, 0.4);\n        --item-active-shadow: rgba(59, 130, 246, 0.3);\n        --preview-bg: rgba(30, 41, 59, 0.95);\n        --preview-border: rgba(71, 85, 105, 0.3);\n        --preview-text: #f1f5f9;\n        --preview-text-muted: #94a3b8;\n      }\n      \n      /* Light mode variables */\n      .curia-community-nav {\n        --sidebar-bg-from: #f8fafc;\n        --sidebar-bg-to: #f1f5f9;\n        --sidebar-border: rgba(148, 163, 184, 0.2);\n        --item-bg: rgba(255, 255, 255, 0.8);\n        --item-hover-bg: rgba(255, 255, 255, 0.95);\n        --item-active-bg: rgba(59, 130, 246, 0.1);\n        --item-active-border: rgba(59, 130, 246, 0.3);\n        --item-active-shadow: rgba(59, 130, 246, 0.2);\n        --preview-bg: rgba(255, 255, 255, 0.95);\n        --preview-border: rgba(148, 163, 184, 0.2);\n        --preview-text: #1f2937;\n        --preview-text-muted: #6b7280;\n      }\n      \n      /* Community item hover effects */\n      .community-item:hover::after {\n        content: '';\n        position: absolute;\n        inset: -2px;\n        border-radius: 14px;\n        background: var(--item-hover-bg);\n        z-index: -1;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      /* Preview card styling - Portal pattern for document-level rendering */\n      .community-preview {\n        position: fixed;\n        min-width: 220px;\n        max-width: 280px;\n        background: var(--preview-bg);\n        border: 1px solid var(--preview-border);\n        border-radius: 12px;\n        padding: 16px;\n        box-shadow: \n          0 20px 40px rgba(0, 0, 0, 0.15),\n          0 8px 16px rgba(0, 0, 0, 0.1);\n        z-index: 999999;\n        opacity: 0;\n        transform: translateX(-8px) scale(0.95);\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n        pointer-events: none;\n        backdrop-filter: blur(12px);\n      }\n      \n      .community-preview.show {\n        opacity: 1;\n        transform: translateX(0) scale(1);\n      }\n      \n      .community-preview-header {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        margin-bottom: 12px;\n      }\n      \n      .community-preview-icon {\n        width: 40px;\n        height: 40px;\n        border-radius: 10px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 18px;\n        flex-shrink: 0;\n      }\n      \n      .community-preview-info h4 {\n        color: var(--preview-text);\n        font-weight: 600;\n        font-size: 16px;\n        margin: 0 0 4px 0;\n        line-height: 1.2;\n      }\n      \n      .community-preview-info p {\n        color: var(--preview-text-muted);\n        font-size: 14px;\n        margin: 0;\n        line-height: 1.3;\n      }\n      \n      .community-preview-stats {\n        display: flex;\n        gap: 16px;\n        margin-top: 12px;\n        padding-top: 12px;\n        border-top: 1px solid var(--preview-border);\n      }\n      \n      .community-preview-stat {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n                 color: var(--preview-text-muted);\n         font-size: 13px;\n       }\n\n\n\n       .user-profile-avatar {\n         width: 48px;\n         height: 48px;\n         border-radius: 12px;\n         display: flex;\n         align-items: center;\n         justify-content: center;\n         cursor: pointer;\n         transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n         position: relative;\n         overflow: hidden;\n         user-select: none;\n         border: 2px solid transparent;\n         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n       }\n\n       .user-profile-avatar:hover {\n         transform: scale(1.08) translateY(-1px);\n         box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\n       }\n\n       /* Profile menu styling - Portal pattern */\n       .user-profile-menu {\n         position: fixed;\n         min-width: 280px;\n         max-width: 320px;\n         background: var(--preview-bg);\n         border: 1px solid var(--preview-border);\n         border-radius: 12px;\n         padding: 16px;\n         box-shadow: \n           0 20px 40px rgba(0, 0, 0, 0.15),\n           0 8px 16px rgba(0, 0, 0, 0.1);\n         z-index: 999999;\n         opacity: 0;\n         transform: translateX(-8px) scale(0.95);\n         transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n         pointer-events: none;\n         backdrop-filter: blur(12px);\n       }\n\n       .user-profile-menu.show {\n         opacity: 1;\n         transform: translateX(0) scale(1);\n         pointer-events: auto;\n       }\n\n       .profile-menu-header {\n         display: flex;\n         align-items: center;\n         gap: 12px;\n         margin-bottom: 16px;\n         padding-bottom: 16px;\n         border-bottom: 1px solid var(--preview-border);\n       }\n\n       .profile-menu-avatar {\n         width: 48px;\n         height: 48px;\n         border-radius: 12px;\n         display: flex;\n         align-items: center;\n         justify-content: center;\n         flex-shrink: 0;\n       }\n\n       .profile-menu-info h4 {\n         color: var(--preview-text);\n         font-weight: 600;\n         font-size: 16px;\n         margin: 0 0 4px 0;\n         line-height: 1.2;\n       }\n\n       .profile-menu-info p {\n         color: var(--preview-text-muted);\n         font-size: 14px;\n         margin: 0;\n         line-height: 1.3;\n       }\n\n       .profile-menu-actions {\n         display: flex;\n         flex-direction: column;\n         gap: 8px;\n       }\n\n       .profile-menu-action {\n         display: flex;\n         align-items: center;\n         gap: 12px;\n         padding: 12px;\n         border-radius: 8px;\n         background: transparent;\n         border: none;\n         cursor: pointer;\n         transition: all 0.2s ease;\n         color: var(--preview-text);\n         font-size: 14px;\n         text-align: left;\n         width: 100%;\n       }\n\n       .profile-menu-action:hover {\n         background: var(--item-hover-bg);\n       }\n\n       .profile-menu-action-icon {\n         width: 20px;\n         height: 20px;\n         display: flex;\n         align-items: center;\n         justify-content: center;\n         color: var(--preview-text-muted);\n       }\n\n       /* Community list container - scrollable */\n       .community-list-container {\n         flex: 1;\n         overflow-y: auto;\n         scrollbar-width: thin;\n         scrollbar-color: var(--sidebar-border) transparent;\n         padding: 0 4px;\n         margin: 0 -4px;\n         display: flex;\n         flex-direction: column;\n         gap: 14px;\n       }\n\n       .community-list-container::-webkit-scrollbar {\n         width: 6px;\n       }\n\n       .community-list-container::-webkit-scrollbar-track {\n         background: transparent;\n       }\n\n       .community-list-container::-webkit-scrollbar-thumb {\n         background: var(--sidebar-border);\n         border-radius: 3px;\n       }\n\n       .community-list-container::-webkit-scrollbar-thumb:hover {\n         background: var(--preview-text-muted);\n       }\n\n       /* User profile section styling - fixed at bottom */\n       .user-profile-section {\n         margin-top: 16px;\n         padding-top: 16px;\n         border-top: 1px solid var(--sidebar-border, rgba(148, 163, 184, 0.2));\n         flex-shrink: 0;\n       }\n     `;\n     document.head.appendChild(globalStyles);\n    \n    // Create scrollable community list container\n    const communityListContainer = document.createElement('div');\n    communityListContainer.className = 'community-list-container';\n    \n    // Add communities to scrollable container\n    this.communities.forEach(community => {\n      const item = this.renderCommunityItem(community);\n      communityListContainer.appendChild(item);\n    });\n    \n    nav.appendChild(communityListContainer);\n\n    // Add user profile section at the bottom (fixed)\n    if (this.userProfile) {\n      const userSection = this.renderUserProfileSection();\n      nav.appendChild(userSection);\n    }\n    \n    this.container = nav;\n    return nav;\n  }\n\n  private renderCommunityItem(community: UserCommunityMembership): HTMLElement {\n    const item = document.createElement('div');\n    const isActive = community.id === this.currentCommunityId;\n    \n    item.className = `community-item ${isActive ? 'active' : ''}`;\n    \n    // Perfect 48x48 squircle styling\n    item.style.cssText = `\n      width: 48px;\n      height: 48px;\n      border-radius: 12px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\n      position: relative;\n      overflow: hidden;\n      user-select: none;\n      border: ${isActive ? '2px solid var(--item-active-border)' : '2px solid transparent'};\n      box-shadow: ${isActive ? \n        '0 4px 12px var(--item-active-shadow), 0 0 0 1px var(--item-active-border)' : \n        '0 2px 8px rgba(0, 0, 0, 0.1)'\n      };\n    `;\n\n    // Create the beautiful background (logo or gradient + emoji)\n    if (community.logoUrl) {\n      // Use community logo with perfect squircle fit\n      const logo = document.createElement('img');\n      logo.src = community.logoUrl;\n      logo.alt = community.name;\n      logo.style.cssText = `\n        width: calc(100% - 4px);\n        height: calc(100% - 4px);\n        object-fit: cover;\n        border-radius: 10px;\n        margin: 2px;\n      `;\n      logo.onerror = () => {\n        // Fallback to gradient + emoji if image fails\n        item.removeChild(logo);\n        this.addGradientFallback(item, community);\n      };\n      item.appendChild(logo);\n    } else {\n      // Use gradient + emoji fallback (same as API logic)\n      this.addGradientFallback(item, community);\n    }\n\n    // Role badge for admins/owners - updated positioning\n    if (community.userRole === 'admin' || community.userRole === 'owner') {\n      const badge = document.createElement('div');\n      badge.style.cssText = `\n        position: absolute;\n        bottom: -3px;\n        right: -3px;\n        width: 18px;\n        height: 18px;\n        background: linear-gradient(135deg, #10b981, #059669);\n        border: 2px solid var(--sidebar-bg-from, #f8fafc);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 9px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        z-index: 10;\n      `;\n      \n      badge.textContent = community.userRole === 'owner' ? '\uD83D\uDC51' : '\u26A1';\n      item.appendChild(badge);\n    }\n\n    // Enhanced hover effects with preview\n    let hoverTimeout: NodeJS.Timeout;\n    let previewElement: HTMLElement | null = null;\n\n        item.addEventListener('mouseenter', () => {\n      // Visual hover effect\n      if (!isActive) {\n        item.style.transform = 'scale(1.08) translateY(-1px)';\n        item.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.15)';\n      }\n\n      // Show preview card after slight delay (but not for active community)\n      if (!isActive) {\n        hoverTimeout = setTimeout(() => {\n          previewElement = this.createPreviewCard(community, item);\n          if (previewElement) {\n            // Portal pattern - append to document.body to escape stacking context\n            document.body.appendChild(previewElement);\n            \n            // Trigger animation\n            requestAnimationFrame(() => {\n              previewElement?.classList.add('show');\n            });\n          }\n        }, 500);\n      }\n    });\n\n    item.addEventListener('mouseleave', () => {\n      // Clear timeout\n      clearTimeout(hoverTimeout);\n      \n      // Remove preview with portal cleanup\n      if (previewElement) {\n        previewElement.classList.remove('show');\n        setTimeout(() => {\n          if (previewElement && document.body.contains(previewElement)) {\n            document.body.removeChild(previewElement);\n          }\n          previewElement = null;\n        }, 200);\n      }\n\n      // Reset visual state\n      if (!isActive) {\n        item.style.transform = 'scale(1) translateY(0)';\n        item.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';\n      }\n    });\n\n    return item;\n  }\n\n  private addGradientFallback(item: HTMLElement, community: UserCommunityMembership): void {\n    // Generate gradient class and icon using same logic as API\n    const gradientClass = this.getGradientClass(community.name);\n    const icon = this.getIconForCommunity(community.name);\n    \n    // Set gradient background\n    item.style.background = this.getGradientStyle(gradientClass);\n    \n    // Add emoji icon\n    const iconSpan = document.createElement('span');\n    iconSpan.textContent = icon;\n    iconSpan.style.cssText = `\n      font-size: 24px;\n      line-height: 1;\n    `;\n    item.appendChild(iconSpan);\n  }\n\n  private getGradientClass(name: string): string {\n    const gradients = [\n      'gradient-pink-purple',\n      'gradient-blue-cyan', \n      'gradient-emerald-teal',\n      'gradient-orange-pink',\n      'gradient-purple-blue',\n      'gradient-cyan-emerald'\n    ];\n    \n    const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n    return gradients[hash % gradients.length];\n  }\n\n  private getIconForCommunity(name: string): string {\n    const lowercaseName = name.toLowerCase();\n    \n    if (lowercaseName.includes('lukso')) return '\uD83C\uDD99';\n    if (lowercaseName.includes('ethereum')) return '\u27E0';\n    if (lowercaseName.includes('defi') || lowercaseName.includes('governance')) return '\uD83C\uDFDB\uFE0F';\n    if (lowercaseName.includes('nft') || lowercaseName.includes('art')) return '\uD83C\uDFA8';\n    if (lowercaseName.includes('gaming')) return '\uD83C\uDFAE';\n    if (lowercaseName.includes('dao')) return '\uD83C\uDFDB\uFE0F';\n    if (lowercaseName.includes('social')) return '\uD83D\uDC65';\n    if (lowercaseName.includes('tech')) return '\uD83D\uDD27';\n    if (lowercaseName.includes('crypto')) return '\uD83D\uDC8E';\n    \n    // Default icons for variety\n    const defaultIcons = ['\uD83C\uDF1F', '\uD83D\uDE80', '\uD83D\uDCAB', '\uD83D\uDD2E', '\u26A1', '\uD83C\uDF08', '\uD83C\uDFAF', '\uD83C\uDFAA'];\n    const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n    return defaultIcons[hash % defaultIcons.length];\n  }\n\n  private getGradientStyle(gradientClass: string): string {\n    const gradientMap: Record<string, string> = {\n      'gradient-pink-purple': 'linear-gradient(135deg, #ec4899, #8b5cf6)',\n      'gradient-blue-cyan': 'linear-gradient(135deg, #3b82f6, #06b6d4)',\n      'gradient-emerald-teal': 'linear-gradient(135deg, #10b981, #14b8a6)',\n      'gradient-orange-pink': 'linear-gradient(135deg, #f97316, #ec4899)',\n      'gradient-purple-blue': 'linear-gradient(135deg, #8b5cf6, #3b82f6)',\n      'gradient-cyan-emerald': 'linear-gradient(135deg, #06b6d4, #10b981)'\n    };\n    \n    return gradientMap[gradientClass] || gradientMap['gradient-blue-cyan'];\n  }\n\n  private createPreviewCard(community: UserCommunityMembership, triggerElement: HTMLElement): HTMLElement {\n    const preview = document.createElement('div');\n    preview.className = 'community-preview';\n    \n    // Calculate perfect positioning using viewport coordinates\n    const rect = triggerElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const cardWidth = 280; // max-width from CSS\n    const cardHeight = 120; // estimated height\n    \n    // Position to the right of the trigger, with smart viewport awareness\n    let left = rect.right + 12; // 12px gap from sidebar\n    let top = rect.top + (rect.height / 2) - (cardHeight / 2); // Center vertically\n    \n    // Smart viewport boundary detection\n    if (left + cardWidth > viewportWidth - 16) {\n      // Not enough space on right, show on left\n      left = rect.left - cardWidth - 12;\n    }\n    \n    if (top < 16) {\n      // Too close to top, align with trigger top\n      top = rect.top;\n    } else if (top + cardHeight > viewportHeight - 16) {\n      // Too close to bottom, align with trigger bottom\n      top = rect.bottom - cardHeight;\n    }\n    \n    // Apply calculated positioning\n    preview.style.left = `${Math.max(16, left)}px`;\n    preview.style.top = `${Math.max(16, top)}px`;\n    \n    // Generate same visual styling as the main icon\n    const gradientClass = this.getGradientClass(community.name);\n    const icon = this.getIconForCommunity(community.name);\n    \n    preview.innerHTML = `\n      <div class=\"community-preview-header\">\n        <div class=\"community-preview-icon\" style=\"background: ${this.getGradientStyle(gradientClass)}\">\n          ${community.logoUrl ? \n            `<img src=\"${community.logoUrl}\" alt=\"${community.name}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n            `<span style=\"font-size: 18px;\">${icon}</span>`\n          }\n        </div>\n        <div class=\"community-preview-info\">\n          <h4>${community.name}</h4>\n          <p>Member since joining</p>\n        </div>\n      </div>\n      <div class=\"community-preview-stats\">\n        <div class=\"community-preview-stat\">\n          <span>\uD83D\uDC64</span>\n          <span>Your role: ${community.userRole}</span>\n        </div>\n        <div class=\"community-preview-stat\">\n          <span>\u26A1</span>\n          <span>Active member</span>\n        </div>\n      </div>\n    `;\n    \n    return preview;\n  }\n\n  private renderUserProfileSection(): HTMLElement {\n    const section = document.createElement('div');\n    section.className = 'user-profile-section';\n    \n    const avatar = document.createElement('div');\n    avatar.className = 'user-profile-avatar';\n\n    // Create avatar content (image or fallback)\n    if (this.userProfile?.profilePictureUrl) {\n      const img = document.createElement('img');\n      img.src = this.userProfile.profilePictureUrl;\n      img.alt = this.userProfile.name;\n      img.style.cssText = `\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        border-radius: inherit;\n      `;\n      img.onerror = () => {\n        // Fallback to gradient + initials if image fails\n        avatar.removeChild(img);\n        this.addUserAvatarFallback(avatar);\n      };\n      avatar.appendChild(img);\n    } else {\n      // Use gradient + initials fallback\n      this.addUserAvatarFallback(avatar);\n    }\n\n    // Add identity type indicator\n    this.addIdentityIndicator(avatar);\n\n    // Profile menu interactions - click-based\n    let profileMenuElement: HTMLElement | null = null;\n\n    const showMenu = () => {\n      if (profileMenuElement) return; // Already open\n\n      profileMenuElement = this.createUserProfileMenu(avatar);\n      if (profileMenuElement) {\n        document.body.appendChild(profileMenuElement);\n        \n        // Add menu hover handlers to keep it open\n        profileMenuElement.addEventListener('mouseenter', () => {\n          // Keep menu open when hovering over it\n        });\n        \n        profileMenuElement.addEventListener('mouseleave', () => {\n          // Keep menu open even when leaving (only close on click outside)\n        });\n        \n        requestAnimationFrame(() => {\n          profileMenuElement?.classList.add('show');\n        });\n      }\n    };\n\n    const hideMenu = () => {\n      if (profileMenuElement) {\n        profileMenuElement.classList.remove('show');\n        setTimeout(() => {\n          if (profileMenuElement && document.body.contains(profileMenuElement)) {\n            document.body.removeChild(profileMenuElement);\n          }\n          profileMenuElement = null;\n        }, 200);\n      }\n    };\n\n    // Click to toggle menu\n    avatar.addEventListener('click', (e) => {\n      e.stopPropagation();\n      if (profileMenuElement) {\n        hideMenu();\n      } else {\n        showMenu();\n      }\n    });\n\n    // Click outside to close menu\n    document.addEventListener('click', (e) => {\n      if (profileMenuElement && !profileMenuElement.contains(e.target as Node) && !avatar.contains(e.target as Node)) {\n        hideMenu();\n      }\n    });\n\n    section.appendChild(avatar);\n    return section;\n  }\n\n  private addUserAvatarFallback(avatar: HTMLElement): void {\n    const name = this.userProfile?.name || 'User';\n    const gradientClass = this.getGradientClass(name);\n    \n    // Set gradient background\n    avatar.style.background = this.getGradientStyle(gradientClass);\n    \n    // Add initials\n    const initials = document.createElement('span');\n    initials.textContent = this.getUserInitials(name);\n    initials.style.cssText = `\n      color: white;\n      font-weight: 600;\n      font-size: 18px;\n      font-family: system-ui, -apple-system, sans-serif;\n    `;\n    avatar.appendChild(initials);\n  }\n\n  private addIdentityIndicator(avatar: HTMLElement): void {\n    if (!this.userProfile) return;\n\n    const indicator = document.createElement('div');\n    indicator.style.cssText = `\n      position: absolute;\n      bottom: -2px;\n      right: -2px;\n      width: 18px;\n      height: 18px;\n      border: 2px solid var(--sidebar-bg-from, #f8fafc);\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      background: ${this.getIdentityColor()};\n    `;\n\n    indicator.textContent = this.getIdentityIcon();\n    avatar.appendChild(indicator);\n  }\n\n  private getIdentityColor(): string {\n    switch (this.userProfile?.identityType) {\n      case 'ens': return 'linear-gradient(135deg, #3b82f6, #1d4ed8)';\n      case 'universal_profile': return 'linear-gradient(135deg, #ec4899, #be185d)';\n      case 'anonymous': return 'linear-gradient(135deg, #6b7280, #4b5563)';\n      default: return 'linear-gradient(135deg, #6b7280, #4b5563)';\n    }\n  }\n\n  private getIdentityIcon(): string {\n    switch (this.userProfile?.identityType) {\n      case 'ens': return '\u27E0';\n      case 'universal_profile': return '\uD83C\uDD99';\n      case 'anonymous': return '\uD83D\uDC64';\n      default: return '\uD83D\uDC64';\n    }\n  }\n\n  private getUserInitials(name: string): string {\n    return name\n      .split(' ')\n      .map(word => word.charAt(0))\n      .join('')\n      .substring(0, 2)\n      .toUpperCase();\n  }\n\n  private createUserProfileMenu(triggerElement: HTMLElement): HTMLElement {\n    const menu = document.createElement('div');\n    menu.className = 'user-profile-menu';\n    \n    // Get absolute position of trigger button\n    const rect = triggerElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const menuWidth = 320;\n    const spacing = 8; // Gap between button and menu\n    \n    // Position menu ABOVE the button using BOTTOM positioning (duh!)\n    let left = rect.right + spacing;\n    let bottom = viewportHeight - rect.top + spacing; // Menu bottom is spacing pixels above button top\n    \n    // Handle right edge overflow - flip to left side of button\n    if (left + menuWidth > viewportWidth - 16) {\n      left = rect.left - menuWidth - spacing;\n    }\n    \n    menu.style.left = `${left}px`;\n    menu.style.bottom = `${bottom}px`;\n\n    // Create menu content\n    menu.innerHTML = `\n      <div class=\"profile-menu-header\">\n        <div class=\"profile-menu-avatar\" style=\"background: ${this.userProfile?.profilePictureUrl ? 'transparent' : this.getGradientStyle(this.getGradientClass(this.userProfile?.name || 'User'))}\">\n          ${this.userProfile?.profilePictureUrl ? \n            `<img src=\"${this.userProfile.profilePictureUrl}\" alt=\"${this.userProfile.name}\" style=\"width: 100%; height: 100%; object-fit: cover; border-radius: inherit;\">` :\n            `<span style=\"color: white; font-weight: 600; font-size: 18px;\">${this.getUserInitials(this.userProfile?.name || 'User')}</span>`\n          }\n        </div>\n        <div class=\"profile-menu-info\">\n          <h4>${this.userProfile?.name || 'Anonymous User'}</h4>\n          <p>${this.getIdentityLabel()}</p>\n        </div>\n      </div>\n      <div class=\"profile-menu-actions\">\n        <button class=\"profile-menu-action\" data-action=\"settings\">\n          <div class=\"profile-menu-action-icon\">\u2699\uFE0F</div>\n          <span>Settings</span>\n        </button>\n        <button class=\"profile-menu-action\" data-action=\"switch-account\">\n          <div class=\"profile-menu-action-icon\">\uD83D\uDD04</div>\n          <span>Switch Account</span>\n        </button>\n        <button class=\"profile-menu-action\" data-action=\"sign-out\">\n          <div class=\"profile-menu-action-icon\">\uD83D\uDEAA</div>\n          <span>Sign Out</span>\n        </button>\n      </div>\n    `;\n    \n    // Add event listeners for menu actions\n    menu.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n      const button = target.closest('.profile-menu-action') as HTMLElement;\n      if (!button) return;\n      \n      const action = button.getAttribute('data-action');\n      if (action && this.onMenuAction) {\n        this.onMenuAction(action);\n      }\n    });\n    \n    return menu;\n  }\n\n  private getIdentityLabel(): string {\n    if (!this.userProfile) return 'Unknown';\n    \n    switch (this.userProfile.identityType) {\n      case 'ens':\n        return this.userProfile.ensDomain ? `ENS: ${this.userProfile.ensDomain}` : 'ENS Domain';\n      case 'universal_profile':\n        return this.userProfile.upAddress ? `UP: ${this.userProfile.upAddress.slice(0, 6)}...${this.userProfile.upAddress.slice(-4)}` : 'Universal Profile';\n      case 'anonymous':\n        return 'Anonymous Session';\n      default:\n        return 'User Account';\n    }\n  }\n\n\n}\n\n/**\n * Message types for internal communication\n */\nenum InternalMessageType {\n  API_REQUEST = 'api_request',\n  API_RESPONSE = 'api_response',\n  INIT = 'init',\n  ERROR = 'error'\n}\n\n/**\n * Internal plugin message interface\n */\ninterface InternalPluginMessage {\n  type: InternalMessageType;\n  iframeUid: string;\n  requestId: string;\n  method?: string;\n  params?: any;\n  data?: any;\n  error?: string;\n}\n\n/**\n * Get iframe permissions for forum functionality\n */\nfunction getIframePermissions(): string {\n  return [\n    'clipboard-write *',\n    'clipboard-read *', \n    'fullscreen *',\n    'web-share *',\n    'autoplay *',\n    'picture-in-picture *',\n    'payment *',\n    'encrypted-media *',\n    'storage-access *',\n    'camera *',\n    'microphone *',\n    'geolocation *'\n  ].join('; ');\n}\n\n/**\n * Internal Plugin Host - completely self-contained within embed script\n */\nexport class InternalPluginHost {\n  private container: HTMLElement;\n  private config: EmbedConfig;\n  private authContext: InternalAuthContext | null = null;\n  private currentIframe: HTMLIFrameElement | null = null;\n  private myUid: string; // Instance-specific UID (not singleton)\n  private hostServiceUrl: string;\n  private forumUrl: string;\n  private messageListener: ((event: MessageEvent) => void) | null = null;\n  private apiProxy: ApiProxyClient;\n  private communityNavigation: CommunityNavigationUI | null = null;\n  private userCommunities: UserCommunityMembership[] = [];\n  private userProfile: UserProfile | null = null;\n  private embedContainer: HTMLElement | null = null;\n\n  constructor(container: HTMLElement, config: EmbedConfig, hostServiceUrl: string, forumUrl: string) {\n    this.container = container;\n    this.config = config;\n    this.hostServiceUrl = hostServiceUrl;\n    this.forumUrl = forumUrl;\n    this.myUid = this.generateIframeUid(); // Generate instance-specific UID\n    \n    // Initialize API proxy client\n    this.apiProxy = new ApiProxyClient({\n      debug: true,\n      defaultTimeout: 10000,\n      maxRetries: 3\n    });\n    \n    this.setupMessageListener();\n    this.initializeAuthPhase();\n  }\n\n  /**\n   * Initialize auth phase - load embed iframe for authentication\n   */\n  private initializeAuthPhase(): void {\n    console.log('[InternalPluginHost] Initializing auth phase');\n    \n    // Build auth iframe URL with theme and community parameters\n    const authUrl = new URL(`${this.hostServiceUrl}/embed`);\n    authUrl.searchParams.set('theme', this.config.theme || 'light');\n    if (this.config.backgroundColor) {\n      authUrl.searchParams.set('background_color', this.config.backgroundColor);\n    }\n    if (this.config.community) {\n      authUrl.searchParams.set('community', this.config.community);\n      console.log('[InternalPluginHost] Adding community parameter to auth iframe:', this.config.community);\n    }\n    if (this.config.mode) {\n      authUrl.searchParams.set('mode', this.config.mode);\n      console.log('[InternalPluginHost] Adding mode parameter to auth iframe:', this.config.mode);\n    }\n    \n    // Add parent URL to auth iframe\n    if (this.config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(this.config.parentUrl);\n      authUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n      console.log('[InternalPluginHost] Adding parent URL to auth iframe:', this.config.parentUrl);\n    }\n    \n    // Add external parameters from parent page\n    if (this.config.externalParams) {\n      console.log('[InternalPluginHost] Adding external parameters to auth iframe:', this.config.externalParams);\n      for (const [key, value] of Object.entries(this.config.externalParams)) {\n        authUrl.searchParams.set(key, value);\n      }\n    }\n    \n    // Create auth iframe\n    const iframe = document.createElement('iframe');\n    iframe.src = authUrl.toString();\n    iframe.style.width = this.config.width || '100%';\n    iframe.style.height = this.config.height || '700px';\n    iframe.style.border = 'none';\n    iframe.style.borderRadius = this.config.borderRadius || '8px';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', getIframePermissions());\n    \n    // Add iframe to container\n    this.container.appendChild(iframe);\n    this.currentIframe = iframe;\n    \n    console.log('[InternalPluginHost] Auth iframe loaded with theme:', this.config.theme);\n  }\n\n  /**\n   * Set up message listener for all plugin communication\n   */\n  private setupMessageListener(): void {\n    // Store listener reference for proper cleanup\n    this.messageListener = (event: MessageEvent) => {\n      this.handleMessage(event);\n    };\n    \n    window.addEventListener('message', this.messageListener);\n    console.log('[InternalPluginHost] Message listener attached for UID:', this.myUid);\n  }\n\n  /**\n   * Handle all incoming messages\n   */\n  private async handleMessage(event: MessageEvent): Promise<void> {\n    if (!event.data || typeof event.data !== 'object') {\n      return;\n    }\n\n    // Handle auth completion from embed iframe\n    if (event.data.type === 'curia-auth-complete') {\n      await this.handleAuthCompletion(event.data);\n      return;\n    }\n\n    // Handle API requests from forum\n    const message = event.data as InternalPluginMessage;\n    if (message.type === InternalMessageType.API_REQUEST) {\n      await this.handleApiRequest(message, event.source as Window);\n      return;\n    }\n\n    // Handle other message types\n    if (message.type === InternalMessageType.INIT) {\n      console.log('[InternalPluginHost] Forum initialized');\n      return;\n    }\n  }\n\n  /**\n   * Handle auth completion and switch to forum\n   */\n  private async handleAuthCompletion(authData: any): Promise<void> {\n    console.log('[InternalPluginHost] Auth completion received:', authData);\n    \n    // Store auth context including external parameters and parent URL\n    this.authContext = {\n      userId: authData.userId,\n      communityId: authData.communityId,\n      sessionToken: authData.sessionToken,\n      externalParams: authData.externalParams,\n      parentUrl: authData.parentUrl || this.config.parentUrl\n    };\n    \n    console.log('[InternalPluginHost] Auth context set:', this.authContext);\n    \n    // Check for auth-only mode\n    if (authData.mode === 'auth-only') {\n      console.log('[InternalPluginHost] \uD83C\uDFAF Auth-only mode detected - NOT switching to forum');\n      console.log('[InternalPluginHost] Auth-only flow complete - embed stays on auth-complete step');\n      return; // Don't switch to forum in auth-only mode\n    }\n    \n    // Initialize community navigation\n    await this.initializeCommunityNavigation();\n    \n    // Normal flow: switch to forum phase\n    console.log('[InternalPluginHost] Normal mode - switching to forum');\n    await this.switchToForum();\n  }\n\n  /**\n   * Fetch user's community memberships\n   */\n  private async fetchUserCommunities(): Promise<UserCommunityMembership[]> {\n    try {\n      console.log('[InternalPluginHost] Fetching user communities...');\n      \n      if (!this.authContext?.sessionToken) {\n        console.log('[InternalPluginHost] No session token available');\n        return [];\n      }\n\n      // Make direct fetch call to /api/communities with auth\n      const response = await fetch(`${this.hostServiceUrl}/api/communities`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${this.authContext.sessionToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        console.error('[InternalPluginHost] Failed to fetch communities:', response.status);\n        return [];\n      }\n\n      const data = await response.json();\n      \n      if (data.userCommunities && Array.isArray(data.userCommunities)) {\n        console.log('[InternalPluginHost] Fetched user communities:', data.userCommunities.length);\n        return data.userCommunities.map((community: any) => ({\n          id: community.id,\n          name: community.name,\n          logoUrl: community.logoUrl,\n          userRole: community.userRole,\n          isMember: community.isMember\n        }));\n      }\n\n      return [];\n    } catch (error) {\n      console.error('[InternalPluginHost] Error fetching user communities:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Fetch user profile information\n   */\n  private async fetchUserProfile(): Promise<UserProfile | null> {\n    try {\n      if (!this.authContext?.sessionToken) {\n        console.log('[InternalPluginHost] No session token for user profile fetch');\n        return null;\n      }\n\n      // Use the validate-session endpoint to get user profile data\n      const response = await fetch(`${this.hostServiceUrl}/api/auth/validate-session`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          sessionToken: this.authContext.sessionToken\n        })\n      });\n\n      if (!response.ok) {\n        console.error('[InternalPluginHost] Failed to fetch user profile:', response.status);\n        return null;\n      }\n\n      const data = await response.json();\n      \n      if (data.user) {\n        return {\n          userId: data.user.user_id,\n          name: data.user.name,\n          profilePictureUrl: data.user.profile_picture_url,\n          identityType: data.user.identity_type,\n          walletAddress: data.user.wallet_address,\n          ensDomain: data.user.ens_domain,\n          upAddress: data.user.up_address,\n          isAnonymous: data.user.is_anonymous\n        };\n      }\n\n      return null;\n    } catch (error) {\n      console.error('[InternalPluginHost] Error fetching user profile:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Initialize community navigation if user has multiple communities\n   */\n  private async initializeCommunityNavigation(): Promise<void> {\n    // Fetch both user communities and profile data\n    const [communities, profile] = await Promise.all([\n      this.fetchUserCommunities(),\n      this.fetchUserProfile()\n    ]);\n    \n    this.userCommunities = communities;\n    this.userProfile = profile;\n    \n    // Only show navigation if user has 2+ communities\n    if (this.userCommunities.length < 2) {\n      console.log('[InternalPluginHost] User has <2 communities, hiding navigation');\n      return;\n    }\n    \n    console.log('[InternalPluginHost] User has', this.userCommunities.length, 'communities, showing navigation');\n    \n    // Create community navigation with user profile and menu action handler\n    this.communityNavigation = new CommunityNavigationUI(\n      this.userCommunities,\n      this.authContext?.communityId || '',\n      this.userProfile,\n      (action: string) => this.handleMenuAction(action)\n    );\n  }\n\n  /**\n   * Setup container layout based on whether sidebar should be shown\n   */\n  private setupContainerLayout(): void {\n    if (this.communityNavigation) {\n      // Create embed container with sidebar + iframe layout\n      this.embedContainer = document.createElement('div');\n      this.embedContainer.className = 'curia-embed-container';\n      this.embedContainer.style.cssText = `\n        display: flex;\n        width: ${this.config.width || '100%'};\n        height: ${this.config.height || '700px'};\n        border-radius: ${this.config.borderRadius || '8px'};\n        overflow: hidden;\n        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n      `;\n\n      // Add navigation sidebar\n      const navElement = this.communityNavigation.render();\n      this.embedContainer.appendChild(navElement);\n\n      // Add iframe container\n      const iframeContainer = document.createElement('div');\n      iframeContainer.className = 'curia-iframe-container';\n      iframeContainer.style.cssText = `\n        flex: 1;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n      `;\n      this.embedContainer.appendChild(iframeContainer);\n\n      // Replace container content\n      this.container.innerHTML = '';\n      this.container.appendChild(this.embedContainer);\n    } else {\n      // No sidebar needed - use container directly\n      this.container.innerHTML = '';\n      this.embedContainer = null;\n    }\n  }\n\n  /**\n   * Switch iframe from auth to forum\n   */\n  private async switchToForum(): Promise<void> {\n    console.log('[InternalPluginHost] Switching to forum phase');\n    \n    if (!this.authContext) {\n      console.error('[InternalPluginHost] Cannot switch to forum - no auth context');\n      return;\n    }\n\n    // Setup container layout (sidebar + iframe or just iframe)\n    this.setupContainerLayout();\n\n    // Build forum URL with parameters\n    const forumUrl = new URL(this.forumUrl);\n    forumUrl.searchParams.set('mod', 'standalone');\n    \n    // Theme resolution\n    let resolvedTheme = this.config.theme || 'light';\n    if (resolvedTheme === 'auto') {\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        resolvedTheme = 'dark';\n      } else {\n        resolvedTheme = 'light';\n      }\n      console.log('[InternalPluginHost] Resolved auto theme to:', resolvedTheme);\n    }\n    \n    forumUrl.searchParams.set('cg_theme', resolvedTheme);\n    if (this.config.backgroundColor) {\n      forumUrl.searchParams.set('cg_bg_color', this.config.backgroundColor);\n    }\n    forumUrl.searchParams.set('iframeUid', this.myUid);\n    \n    // Add parent URL parameter ONLY if community is pre-specified\n    if (this.config.community && this.config.parentUrl) {\n      const encodedParentUrl = encodeURIComponent(this.config.parentUrl);\n      forumUrl.searchParams.set('cg_parent_url', encodedParentUrl);\n      console.log('[InternalPluginHost] Adding parent URL (community pre-specified):', this.config.parentUrl);\n    } else if (!this.config.community) {\n      console.log('[InternalPluginHost] Skipping parent URL (no community pre-specified)');\n    }\n    \n    // Add external parameters to forum URL\n    if (this.authContext?.externalParams) {\n      console.log('[InternalPluginHost] Adding external parameters to forum iframe:', this.authContext.externalParams);\n      for (const [key, value] of Object.entries(this.authContext.externalParams)) {\n        forumUrl.searchParams.set(key, value);\n      }\n    }\n    \n    console.log('[InternalPluginHost] Forum URL:', forumUrl.toString());\n    \n    // Create forum iframe\n    const iframe = document.createElement('iframe');\n    iframe.src = forumUrl.toString();\n    iframe.style.width = '100%';\n    iframe.style.height = '100%';\n    iframe.style.border = 'none';\n    iframe.style.borderRadius = this.config.borderRadius || '8px';\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\n    iframe.setAttribute('allow', getIframePermissions());\n    \n    // Add iframe to appropriate container\n    const iframeContainer = this.embedContainer?.querySelector('.curia-iframe-container') || this.container;\n    iframeContainer.appendChild(iframe);\n    this.currentIframe = iframe;\n    \n    // Set forum iframe as active iframe for API proxy\n    this.apiProxy.setActiveIframe(iframe);\n    console.log('[InternalPluginHost] API proxy client configured for forum iframe');\n    \n    console.log('[InternalPluginHost] Forum iframe loaded');\n  }\n\n  /**\n   * Handle API requests from forum\n   */\n  private async handleApiRequest(message: InternalPluginMessage, source: Window): Promise<void> {\n    try {\n      console.log('[InternalPluginHost] API request:', message.method, message.params);\n      \n      // Validate auth context\n      if (!this.authContext) {\n        throw new Error('No authentication context available');\n      }\n\n      // Instance-based UID filtering - only handle our own messages\n      if (message.iframeUid !== this.myUid) {\n        // Silently ignore messages from other embed instances\n        return;\n      }\n\n      // Validate method is provided and supported\n      if (!message.method || !['getUserInfo', 'getUserFriends', 'getContextData', 'getCommunityInfo', 'giveRole'].includes(message.method)) {\n        throw new Error(`Unknown API method: ${message.method}`);\n      }\n\n      // Use API proxy client to make request (bypasses CSP restrictions)\n      console.log('[InternalPluginHost] Making API request via proxy:', message.method);\n      const result = await this.apiProxy.makeApiRequest({\n        method: message.method as any,\n        params: message.params,\n        communityId: this.authContext.communityId,\n        userId: this.authContext.userId\n      });\n\n      console.log('[InternalPluginHost] API proxy response:', result);\n      \n      if (result.success) {\n        // Send successful response\n        this.sendResponse(source, message, result.data);\n      } else {\n        throw new Error(result.error || 'API request failed');\n      }\n      \n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      console.error('[InternalPluginHost] API error:', errorMessage);\n      this.sendError(source, message, errorMessage);\n    }\n  }\n\n  /**\n   * Send successful response to forum\n   */\n  private sendResponse(source: Window, originalMessage: InternalPluginMessage, data: any): void {\n    const response: InternalPluginMessage = {\n      type: InternalMessageType.API_RESPONSE,\n      iframeUid: originalMessage.iframeUid,\n      requestId: originalMessage.requestId,\n      data: data\n    };\n    \n    source.postMessage(response, '*');\n  }\n\n  /**\n   * Send error response to forum\n   */\n  private sendError(source: Window, originalMessage: InternalPluginMessage, error: string): void {\n    const response: InternalPluginMessage = {\n      type: InternalMessageType.API_RESPONSE,\n      iframeUid: originalMessage.iframeUid,\n      requestId: originalMessage.requestId,\n      error: error\n    };\n    \n    source.postMessage(response, '*');\n  }\n\n  /**\n   * Generate unique iframe UID\n   */\n  private generateIframeUid(): string {\n    const timestamp = Date.now().toString(36).toUpperCase();\n    const random = Math.random().toString(36).substring(2, 8).toUpperCase();\n    return `${timestamp}${random}`.substring(0, 10);\n  }\n\n  /**\n   * Cleanup when embed is destroyed\n   */\n  public destroy(): void {\n    // Remove iframe\n    if (this.currentIframe && this.currentIframe.parentElement) {\n      this.currentIframe.parentElement.removeChild(this.currentIframe);\n    }\n    \n    // Remove message listener to prevent stale listeners\n    if (this.messageListener) {\n      window.removeEventListener('message', this.messageListener);\n      this.messageListener = null;\n      console.log('[InternalPluginHost] Message listener removed');\n    }\n    \n    // Clean up API proxy client\n    if (this.apiProxy) {\n      this.apiProxy.destroy();\n      console.log('[InternalPluginHost] API proxy client destroyed');\n    }\n    \n    // Clear state\n    this.currentIframe = null;\n    this.authContext = null;\n    // myUid stays - it's not nullable and helps identify this instance in logs\n    \n    console.log('[InternalPluginHost] Destroyed instance with UID:', this.myUid);\n  }\n\n  /**\n   * Handle menu action clicks from the user profile menu\n   */\n  private handleMenuAction(action: string): void {\n    switch (action) {\n      case 'sign-out':\n        this.signOut();\n        break;\n      case 'switch-account':\n        this.switchAccount();\n        break;\n      case 'settings':\n        this.openSettings();\n        break;\n      default:\n        console.log('[InternalPluginHost] Unknown menu action:', action);\n    }\n  }\n\n  /**\n   * Sign out: Complete reset to initial state\n   */\n  private signOut(): void {\n    console.log('[InternalPluginHost] Signing out user - performing complete reset');\n    this.resetToInitialState();\n  }\n\n  /**\n   * Switch account: Complete reset to initial state\n   */\n  private switchAccount(): void {\n    console.log('[InternalPluginHost] Switching account - performing complete reset');\n    this.resetToInitialState();\n  }\n\n  /**\n   * Open settings: Placeholder for future implementation\n   */\n  private openSettings(): void {\n    console.log('[InternalPluginHost] Opening settings (placeholder)');\n    // TODO: Implement settings modal or navigation\n  }\n\n  /**\n   * Complete reset to initial state - clean up all forum-phase artifacts\n   */\n  private resetToInitialState(): void {\n    console.log('[InternalPluginHost] Resetting to initial state');\n    \n    // 1. Clean up all forum phase DOM elements\n    this.cleanupForumPhase();\n    \n    // 2. Reset all state variables\n    this.communityNavigation = null;\n    this.userCommunities = [];\n    this.userProfile = null;\n    this.embedContainer = null;\n    this.authContext = null;\n    this.currentIframe = null;\n    \n    // 3. Clear session using SessionManager instead of localStorage\n    try {\n      sessionManager.removeActiveSession().catch(error => {\n        console.error('[InternalPluginHost] Failed to clear session via SessionManager:', error);\n      });\n      console.log('[InternalPluginHost] \u2705 Session cleared via SessionManager');\n    } catch (error) {\n      console.error('[InternalPluginHost] SessionManager clear error:', error);\n    }\n    \n    // 4. Recreate clean auth iframe\n    this.container.innerHTML = '';\n    this.initializeAuthPhase();\n  }\n\n  /**\n   * Clean up all forum phase artifacts\n   */\n  private cleanupForumPhase(): void {\n    console.log('[InternalPluginHost] Cleaning up forum phase artifacts');\n    \n    // Clean up portal elements (community previews, user profile menu)\n    const portals = document.querySelectorAll('.community-preview, .user-profile-menu');\n    portals.forEach(portal => {\n      console.log('[InternalPluginHost] Removing portal element:', portal.className);\n      portal.remove();\n    });\n    \n    // Note: API proxy iframe reference will be reset when new iframe is set\n    // No need to explicitly clear it as setActiveIframe will be called with new iframe\n    \n    console.log('[InternalPluginHost] Forum phase cleanup complete');\n  }\n}\n\n ", "/**\n * SessionManager - Centralized session management for Curia\n * \n * Replaces scattered localStorage usage with a unified system that supports:\n * - Multi-account sessions (ENS, Universal Profile, Anonymous)\n * - Database-backed session persistence\n * - Cross-tab synchronization\n * - Automatic token rotation handling\n * - Bulletproof error recovery\n */\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\nexport interface SessionData {\n  sessionToken: string;\n  userId: string;\n  identityType: 'ens' | 'universal_profile' | 'anonymous';\n  walletAddress?: string;\n  ensName?: string;\n  upAddress?: string;\n  name?: string;\n  profileImageUrl?: string;\n  expiresAt: Date;\n  lastAccessedAt: Date;\n  isActive: boolean;\n}\n\nexport interface SessionStorage {\n  activeSessions: SessionData[];\n  activeSessionToken: string | null;\n  lastSyncedAt: number;\n  version: number; // For migration handling\n}\n\nexport type SessionChangeListener = (\n  sessions: SessionData[], \n  activeToken: string | null,\n  activeSession: SessionData | null\n) => void;\n\n// ============================================================================\n// CORE SESSION MANAGER CLASS\n// ============================================================================\n\nexport class SessionManager {\n  private static instance: SessionManager;\n  private static readonly STORAGE_KEY = 'curia_sessions';\n  private static readonly LEGACY_TOKEN_KEY = 'curia_session_token';\n  private static readonly STORAGE_VERSION = 1;\n  private static readonly SYNC_INTERVAL = 30_000; // 30 seconds\n  \n  private storage: SessionStorage;\n  private listeners: Set<SessionChangeListener> = new Set();\n  private syncInterval: NodeJS.Timeout | null = null;\n  private isInitialized = false;\n\n  private constructor() {\n    this.storage = this.loadFromStorage();\n    this.setupStorageListener();\n    this.setupPeriodicSync();\n    this.migrateLegacySession();\n    this.isInitialized = true;\n    \n    console.log('[SessionManager] Initialized with', this.storage.activeSessions.length, 'sessions');\n  }\n\n  public static getInstance(): SessionManager {\n    if (!SessionManager.instance) {\n      SessionManager.instance = new SessionManager();\n    }\n    return SessionManager.instance;\n  }\n\n  // ============================================================================\n  // CORE SESSION OPERATIONS\n  // ============================================================================\n\n  /**\n   * Add a new session to the manager\n   */\n  public async addSession(sessionData: Omit<SessionData, 'lastAccessedAt'>): Promise<void> {\n    try {\n      const session: SessionData = {\n        ...sessionData,\n        lastAccessedAt: new Date(),\n        expiresAt: new Date(sessionData.expiresAt),\n      };\n\n      if (!this.validateSession(session)) {\n        throw new Error('Invalid session data provided');\n      }\n\n      // Remove existing session with same token (if any)\n      this.storage.activeSessions = this.storage.activeSessions.filter(\n        s => s.sessionToken !== session.sessionToken\n      );\n\n      // Add new session\n      this.storage.activeSessions.push(session);\n\n      // Set as active if it's the first session\n      if (!this.storage.activeSessionToken) {\n        this.storage.activeSessionToken = session.sessionToken;\n      }\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Session added:', session.identityType, session.userId);\n    } catch (error) {\n      console.error('[SessionManager] Failed to add session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remove a session by token\n   */\n  public async removeSession(sessionToken: string): Promise<void> {\n    try {\n      const sessionExists = this.storage.activeSessions.some(s => s.sessionToken === sessionToken);\n      \n      if (!sessionExists) {\n        console.warn('[SessionManager] Attempted to remove non-existent session:', sessionToken);\n        return;\n      }\n\n      // Remove session\n      this.storage.activeSessions = this.storage.activeSessions.filter(\n        s => s.sessionToken !== sessionToken\n      );\n\n      // Update active session if we removed the active one\n      if (this.storage.activeSessionToken === sessionToken) {\n        this.storage.activeSessionToken = this.storage.activeSessions[0]?.sessionToken || null;\n      }\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Session removed:', sessionToken);\n    } catch (error) {\n      console.error('[SessionManager] Failed to remove session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Set the active session\n   */\n  public async setActiveSession(sessionToken: string): Promise<void> {\n    try {\n      const session = this.getSessionByToken(sessionToken);\n      if (!session) {\n        throw new Error(`Session not found: ${sessionToken}`);\n      }\n\n      if (!session.isActive || session.expiresAt <= new Date()) {\n        throw new Error('Cannot activate expired or inactive session');\n      }\n\n      this.storage.activeSessionToken = sessionToken;\n      \n      // Update last accessed time\n      session.lastAccessedAt = new Date();\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Active session changed:', session.identityType, session.userId);\n    } catch (error) {\n      console.error('[SessionManager] Failed to set active session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remove the active session (logout)\n   */\n  public async removeActiveSession(): Promise<void> {\n    try {\n      if (!this.storage.activeSessionToken) {\n        console.warn('[SessionManager] No active session to remove');\n        return;\n      }\n\n      await this.removeSession(this.storage.activeSessionToken);\n      console.log('[SessionManager] Active session removed (logout)');\n    } catch (error) {\n      console.error('[SessionManager] Failed to remove active session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Clear all sessions (full logout)\n   */\n  public async clearAllSessions(): Promise<void> {\n    try {\n      this.storage.activeSessions = [];\n      this.storage.activeSessionToken = null;\n      this.storage.lastSyncedAt = Date.now();\n\n      this.saveToStorage();\n      this.broadcastChange();\n      this.notifyListeners();\n\n      console.log('[SessionManager] All sessions cleared');\n    } catch (error) {\n      console.error('[SessionManager] Failed to clear all sessions:', error);\n      throw error;\n    }\n  }\n\n  // ============================================================================\n  // GETTERS\n  // ============================================================================\n\n  public getActiveSession(): SessionData | null {\n    if (!this.storage.activeSessionToken) return null;\n    \n    const session = this.getSessionByToken(this.storage.activeSessionToken);\n    if (!session || !session.isActive || session.expiresAt <= new Date()) {\n      // Clean up expired or invalid active session\n      this.storage.activeSessionToken = null;\n      this.saveToStorage();\n      return null;\n    }\n    \n    return session;\n  }\n\n  public getActiveToken(): string | null {\n    const activeSession = this.getActiveSession();\n    return activeSession?.sessionToken || null;\n  }\n\n  public getAllSessions(): SessionData[] {\n    // Filter out expired sessions\n    const validSessions = this.storage.activeSessions.filter(\n      session => session.isActive && session.expiresAt > new Date()\n    );\n\n    // Update storage if we filtered out expired sessions\n    if (validSessions.length !== this.storage.activeSessions.length) {\n      this.storage.activeSessions = validSessions;\n      this.saveToStorage();\n    }\n\n    return validSessions;\n  }\n\n  public getSessionByToken(token: string): SessionData | null {\n    return this.storage.activeSessions.find(s => s.sessionToken === token) || null;\n  }\n\n  public getSessionsByIdentityType(type: 'ens' | 'universal_profile' | 'anonymous'): SessionData[] {\n    return this.getAllSessions().filter(s => s.identityType === type);\n  }\n\n  public isAuthenticated(): boolean {\n    return this.getActiveSession() !== null;\n  }\n\n  // ============================================================================\n  // REACTIVITY & EVENTS\n  // ============================================================================\n\n  public subscribe(callback: SessionChangeListener): () => void {\n    this.listeners.add(callback);\n    \n    // Immediately call with current state\n    if (this.isInitialized) {\n      callback(this.getAllSessions(), this.getActiveToken(), this.getActiveSession());\n    }\n    \n    return () => {\n      this.listeners.delete(callback);\n    };\n  }\n\n  private notifyListeners(): void {\n    const sessions = this.getAllSessions();\n    const activeToken = this.getActiveToken();\n    const activeSession = this.getActiveSession();\n    \n    this.listeners.forEach(callback => {\n      try {\n        callback(sessions, activeToken, activeSession);\n      } catch (error) {\n        console.error('[SessionManager] Listener error:', error);\n      }\n    });\n  }\n\n  // ============================================================================\n  // PERSISTENCE & STORAGE\n  // ============================================================================\n\n  private loadFromStorage(): SessionStorage {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, using default storage');\n        return this.getDefaultStorage();\n      }\n\n      const stored = localStorage.getItem(SessionManager.STORAGE_KEY);\n      if (!stored) {\n        return this.getDefaultStorage();\n      }\n\n      const parsed: SessionStorage = JSON.parse(stored);\n      \n      // Validate and sanitize storage\n      return this.sanitizeStorage(parsed);\n    } catch (error) {\n      console.error('[SessionManager] Failed to load from storage, using defaults:', error);\n      return this.getDefaultStorage();\n    }\n  }\n\n  private saveToStorage(): void {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, skipping storage save');\n        return;\n      }\n\n      const serialized = JSON.stringify({\n        ...this.storage,\n        lastSyncedAt: Date.now(),\n      });\n      \n      localStorage.setItem(SessionManager.STORAGE_KEY, serialized);\n    } catch (error) {\n      if (error instanceof DOMException && error.code === 22) {\n        console.error('[SessionManager] localStorage quota exceeded, clearing old sessions');\n        this.handleStorageQuotaExceeded();\n      } else {\n        console.error('[SessionManager] Failed to save to storage:', error);\n      }\n    }\n  }\n\n  private getDefaultStorage(): SessionStorage {\n    return {\n      activeSessions: [],\n      activeSessionToken: null,\n      lastSyncedAt: Date.now(),\n      version: SessionManager.STORAGE_VERSION,\n    };\n  }\n\n  private sanitizeStorage(storage: SessionStorage): SessionStorage {\n    try {\n      // Ensure version compatibility\n      if (!storage.version || storage.version < SessionManager.STORAGE_VERSION) {\n        console.log('[SessionManager] Migrating storage to version', SessionManager.STORAGE_VERSION);\n        storage.version = SessionManager.STORAGE_VERSION;\n      }\n\n      // Validate and filter sessions\n      const validSessions = (storage.activeSessions || [])\n        .map(session => ({\n          ...session,\n          expiresAt: new Date(session.expiresAt),\n          lastAccessedAt: new Date(session.lastAccessedAt),\n        }))\n        .filter(this.validateSession);\n\n      // Ensure active session is still valid\n      const activeStillValid = validSessions.some(\n        s => s.sessionToken === storage.activeSessionToken\n      );\n\n      return {\n        activeSessions: validSessions,\n        activeSessionToken: activeStillValid \n          ? storage.activeSessionToken \n          : (validSessions[0]?.sessionToken || null),\n        lastSyncedAt: storage.lastSyncedAt || Date.now(),\n        version: SessionManager.STORAGE_VERSION,\n      };\n    } catch (error) {\n      console.error('[SessionManager] Storage sanitization failed:', error);\n      return this.getDefaultStorage();\n    }\n  }\n\n  private validateSession(session: SessionData): boolean {\n    try {\n      return (\n        typeof session.sessionToken === 'string' &&\n        session.sessionToken.length > 10 &&\n        typeof session.userId === 'string' &&\n        session.userId.length > 0 &&\n        ['ens', 'universal_profile', 'anonymous'].includes(session.identityType) &&\n        session.expiresAt instanceof Date &&\n        session.expiresAt > new Date() &&\n        typeof session.isActive === 'boolean' &&\n        session.isActive\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  private handleStorageQuotaExceeded(): void {\n    try {\n      // Remove oldest sessions first, keeping at least the active one\n      const sorted = this.storage.activeSessions.sort(\n        (a, b) => a.lastAccessedAt.getTime() - b.lastAccessedAt.getTime()\n      );\n\n      const activeToken = this.storage.activeSessionToken;\n      const keepSessions = sorted.filter(s => s.sessionToken === activeToken).slice(-3); // Keep last 3\n      \n      this.storage.activeSessions = keepSessions;\n      this.saveToStorage();\n      \n      console.log('[SessionManager] Cleaned up old sessions due to storage quota');\n    } catch (error) {\n      console.error('[SessionManager] Failed to handle storage quota:', error);\n      \n      // Last resort: clear everything (browser-only)\n      if (typeof window !== 'undefined') {\n        localStorage.removeItem(SessionManager.STORAGE_KEY);\n      }\n      this.storage = this.getDefaultStorage();\n    }\n  }\n\n  // ============================================================================\n  // CROSS-TAB SYNCHRONIZATION\n  // ============================================================================\n\n  private setupStorageListener(): void {\n    if (typeof window === 'undefined') return;\n\n    // Listen for localStorage changes from other tabs\n    window.addEventListener('storage', (e) => {\n      if (e.key === SessionManager.STORAGE_KEY && e.newValue) {\n        try {\n          const newStorage: SessionStorage = JSON.parse(e.newValue);\n          this.storage = this.sanitizeStorage(newStorage);\n          this.notifyListeners();\n          console.log('[SessionManager] Cross-tab sync: Session state updated from other tab');\n        } catch (error) {\n          console.error('[SessionManager] Cross-tab sync failed:', error);\n        }\n      }\n    });\n\n    // Listen for custom session events (same-tab updates)\n    window.addEventListener('curia-session-change', () => {\n      this.storage = this.loadFromStorage();\n      this.notifyListeners();\n    });\n  }\n\n  private broadcastChange(): void {\n    if (typeof window !== 'undefined') {\n      window.dispatchEvent(new CustomEvent('curia-session-change', {\n        detail: {\n          activeToken: this.getActiveToken(),\n          sessionCount: this.storage.activeSessions.length,\n        }\n      }));\n    }\n  }\n\n  // ============================================================================\n  // DATABASE SYNCHRONIZATION\n  // ============================================================================\n\n  private setupPeriodicSync(): void {\n    if (typeof window === 'undefined') return;\n\n    // Sync on initialization if we have sessions\n    if (this.storage.activeSessions.length > 0) {\n      this.syncWithDatabase();\n    }\n\n    // Set up periodic sync\n    this.syncInterval = setInterval(() => {\n      if (this.storage.activeSessions.length > 0) {\n        this.syncWithDatabase();\n      }\n    }, SessionManager.SYNC_INTERVAL);\n  }\n\n  public async syncWithDatabase(): Promise<void> {\n    try {\n      const activeToken = this.getActiveToken();\n      if (!activeToken) {\n        console.log('[SessionManager] No active session for database sync');\n        return;\n      }\n\n      const response = await fetch('/api/auth/sessions', {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${activeToken}`,\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (!response.ok) {\n        console.warn('[SessionManager] Database sync failed:', response.status, response.statusText);\n        return;\n      }\n\n      const dbSessions: SessionData[] = await response.json();\n      \n      // Merge database sessions with localStorage cache\n      const mergedSessions = this.mergeSessionStates(this.storage.activeSessions, dbSessions);\n      \n      this.storage.activeSessions = mergedSessions;\n      this.storage.lastSyncedAt = Date.now();\n      this.saveToStorage();\n      this.notifyListeners();\n\n      console.log('[SessionManager] Database sync completed:', mergedSessions.length, 'sessions');\n    } catch (error) {\n      console.error('[SessionManager] Database sync error:', error);\n      // Graceful degradation - continue with localStorage cache\n    }\n  }\n\n  private mergeSessionStates(localSessions: SessionData[], dbSessions: SessionData[]): SessionData[] {\n    const sessionMap = new Map<string, SessionData>();\n\n    // Start with database sessions (source of truth for metadata)\n    for (const session of dbSessions) {\n      sessionMap.set(session.sessionToken, {\n        ...session,\n        expiresAt: new Date(session.expiresAt),\n        lastAccessedAt: new Date(session.lastAccessedAt),\n      });\n    }\n\n    // Override with localStorage cache for active session context\n    for (const session of localSessions) {\n      const existing = sessionMap.get(session.sessionToken);\n      if (existing) {\n        // Keep database metadata but preserve localStorage context\n        sessionMap.set(session.sessionToken, {\n          ...existing,\n          lastAccessedAt: session.lastAccessedAt, // Keep local access time\n        });\n      }\n    }\n\n    return Array.from(sessionMap.values());\n  }\n\n  // ============================================================================\n  // LEGACY MIGRATION\n  // ============================================================================\n\n  private migrateLegacySession(): void {\n    try {\n      // \u2705 Browser-only check to prevent SSR errors\n      if (typeof window === 'undefined') {\n        console.log('[SessionManager] SSR environment detected, skipping legacy migration');\n        return;\n      }\n\n      const legacyToken = localStorage.getItem(SessionManager.LEGACY_TOKEN_KEY);\n      if (!legacyToken || this.storage.activeSessions.length > 0) {\n        return; // No migration needed\n      }\n\n      console.log('[SessionManager] Migrating legacy session token');\n\n      // Create a placeholder session that will be validated by the next database sync\n      const legacySession: SessionData = {\n        sessionToken: legacyToken,\n        userId: 'legacy-migration', // Will be updated by database sync\n        identityType: 'anonymous', // Will be updated by database sync\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\n        lastAccessedAt: new Date(),\n        isActive: true,\n      };\n\n      this.storage.activeSessions = [legacySession];\n      this.storage.activeSessionToken = legacyToken;\n      this.saveToStorage();\n\n      // Remove legacy token\n      localStorage.removeItem(SessionManager.LEGACY_TOKEN_KEY);\n      \n      // Trigger immediate database sync to validate and populate session data\n      this.syncWithDatabase();\n\n      console.log('[SessionManager] Legacy session migration completed');\n    } catch (error) {\n      console.error('[SessionManager] Legacy migration failed:', error);\n    }\n  }\n\n  // ============================================================================\n  // CLEANUP\n  // ============================================================================\n\n  public destroy(): void {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n    }\n    this.listeners.clear();\n    console.log('[SessionManager] Destroyed');\n  }\n}\n\n// ============================================================================\n// SINGLETON INSTANCE & CONVENIENCE EXPORTS\n// ============================================================================\n\nexport const sessionManager = SessionManager.getInstance();\n\n// Convenience functions for simple use cases\nexport const getSessionToken = (): string | null => sessionManager.getActiveToken();\nexport const setSessionToken = (sessionData: Omit<SessionData, 'lastAccessedAt'>): Promise<void> => sessionManager.addSession(sessionData);\nexport const clearSessionToken = (): Promise<void> => sessionManager.removeActiveSession();\nexport const isAuthenticated = (): boolean => sessionManager.isAuthenticated(); ", "/**\n * Embed Script Entry Point\n * \n * This is the main entry point for the embed.js bundle.\n * It imports the actual TypeScript classes and creates a self-contained script.\n */\n\nimport { EmbedConfig } from './types/EmbedTypes';\nimport { parseEmbedConfig } from './core/EmbedConfig';\nimport { InternalPluginHost } from './plugin-host/InternalPluginHost';\n\n// Use global interface from EmbedTypes (avoids circular import issues)\n// window.curiaEmbed will be InternalPluginHost but typed as any\n\n// Get environment URLs (injected at build time via esbuild define)\ndeclare const CURIA_HOST_URL: string;\ndeclare const CURIA_FORUM_URL: string;\n\n// Capture script element during initial execution when document.currentScript works\nconst EMBED_SCRIPT_ELEMENT = document.currentScript as HTMLScriptElement;\n\n// Validate that we have the script element\nif (!EMBED_SCRIPT_ELEMENT) {\n  console.error('[Embed] Failed to capture script element during initialization');\n}\n\n/**\n * Extract curia_* parameters from parent page URL\n * Converts curia_highlight=comment-123 to ext_highlight=comment-123\n */\nfunction extractCuriaParameters(): Record<string, string> {\n  const params = new URLSearchParams(window.location.search);\n  const curiaParams: Record<string, string> = {};\n  \n  console.log('[Embed] Checking parent page URL for curia_* parameters:', window.location.search);\n  \n  for (const [key, value] of params) {\n    if (key.startsWith('curia_')) {\n      const cleanKey = key.substring(6); // Remove 'curia_' prefix\n      const externalKey = `ext_${cleanKey}`; // Add 'ext_' prefix\n      curiaParams[externalKey] = value;\n      console.log(`[Embed] Found curia parameter: ${key}=${value} \u2192 ${externalKey}=${value}`);\n    }\n  }\n  \n  return curiaParams;\n}\n\n/**\n * Strip curia_* parameters from parent page URL\n * Preserves all other query parameters but removes our internal curia_* params\n */\nfunction stripCuriaParameters(url: string): string {\n  try {\n    const urlObj = new URL(url);\n    \n    // Collect all curia_* parameter keys to delete\n    const keysToDelete: string[] = [];\n    for (const [key] of urlObj.searchParams) {\n      if (key.startsWith('curia_')) {\n        keysToDelete.push(key);\n      }\n    }\n    \n    // Delete all curia_* parameters\n    for (const key of keysToDelete) {\n      urlObj.searchParams.delete(key);\n    }\n    \n    if (keysToDelete.length > 0) {\n      console.log('[Embed] Stripped curia_* parameters:', keysToDelete);\n    }\n    \n    return urlObj.toString();\n  } catch (error) {\n    console.warn('[Embed] Failed to parse parent URL, using original:', url);\n    return url;\n  }\n}\n\n// Main embed initialization function\nfunction initializeEmbed() {\n  console.log('[Embed] Initializing Curia embed script...');\n\n  try {\n    // Capture parent page URL and strip curia_* parameters to prevent recursion\n    const rawParentUrl = window.location.href;\n    const parentUrl = stripCuriaParameters(rawParentUrl);\n    console.log('[Embed] Raw parent page URL:', rawParentUrl);\n    console.log('[Embed] Clean parent page URL (curia_* stripped):', parentUrl);\n    \n    // Extract external parameters from parent page URL\n    const externalParams = extractCuriaParameters();\n    \n    // Parse configuration from script attributes using captured script element\n    // If capture failed, parseEmbedConfig will try document.currentScript as fallback\n    const config = parseEmbedConfig(EMBED_SCRIPT_ELEMENT);\n    \n    // Add parent URL to config\n    config.parentUrl = parentUrl;\n    \n    // Add external parameters to config\n    if (Object.keys(externalParams).length > 0) {\n      config.externalParams = externalParams;\n      console.log('[Embed] External parameters added to config:', externalParams);\n    }\n    \n    console.log('[Embed] Final parsed config:', config);\n\n    // Find or create target container\n    const containerId = config.container || 'curia-forum';\n    let container = document.getElementById(containerId);\n    \n    if (!container) {\n      console.log(`[Embed] Container \"${containerId}\" not found, creating it`);\n      container = document.createElement('div');\n      container.id = containerId;\n      \n      // Try to insert next to script element, otherwise append to body\n      if (EMBED_SCRIPT_ELEMENT?.parentNode) {\n        EMBED_SCRIPT_ELEMENT.parentNode.insertBefore(container, EMBED_SCRIPT_ELEMENT.nextSibling);\n      } else {\n        console.warn('[Embed] No script element available, appending container to body');\n        document.body.appendChild(container);\n      }\n    }\n\n    // Clean up any existing embed instance\n    if (window.curiaEmbed) {\n      console.log('[Embed] Cleaning up existing embed instance');\n      window.curiaEmbed.destroy();\n      delete window.curiaEmbed;\n    }\n\n    // Create new embed instance using the real TypeScript class\n    console.log('[Embed] Creating InternalPluginHost instance');\n    const embedInstance = new InternalPluginHost(\n      container,\n      config,\n      CURIA_HOST_URL,\n      CURIA_FORUM_URL\n    );\n\n    // Store global reference for cleanup\n    window.curiaEmbed = embedInstance;\n    \n    console.log('[Embed] Embed initialized successfully');\n    \n  } catch (error) {\n    console.error('[Embed] Failed to initialize embed:', error);\n  }\n}\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initializeEmbed);\n} else {\n  // DOM already loaded, initialize immediately\n  initializeEmbed();\n} "],
  "mappings": "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",
  "names": ["MessageType", "ProxyErrorType", "ApiProxyClient"]
}
